{"version":3,"file":"app-d00c00ed.2384d3fce1a12a237460.bundle.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AAAA;AAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;ACxLA;AACA;AACA;AACA","sources":["webpack://uccss-old-new/./src/modules/user/profile.js","webpack://uccss-old-new/./src/modules/user/profile.html"],"sourcesContent":["import {inject} from 'aurelia-framework';\r\nimport {Router} from \"aurelia-router\";\r\nimport Validation from '../../resources/utils/validation';\r\nimport {Utils} from '../../resources/utils/utils';\r\nimport {is4ua} from '../../resources/data/is4ua';\r\nimport {People} from '../../resources/data/people';\r\nimport { CommonDialogs } from '../../resources/dialogs/common-dialogs';\r\nimport {AppConfig} from '../../config/appConfig';\r\n\r\n@inject(is4ua,People, Router, Utils, Validation, CommonDialogs, AppConfig)\r\nexport class Profile {\r\n    title=\"Profile\";\r\n    phoneMask = \"\";\r\n\r\n    constructor(is4ua, people, router, utils, validation, dialog, config) {\r\n        this.is4ua = is4ua;\r\n        this.people = people;\r\n        this.router = router;\r\n        this.utils = utils;\r\n        this.dialog = dialog;\r\n        this.config = config;\r\n        this.validation = validation;\r\n        this.validation.initialize(this);\r\n        this._setupValidation();\r\n\r\n        this.userObj = JSON.parse(sessionStorage.getItem('user'));\r\n    };\r\n\r\n    _setupValidation(){\r\n        this.validation.addRule(1,\"editFirstName\",[{\"rule\":\"required\",\"message\":\"First Name is required\", \"value\": \"people.selectedPerson.firstName\"}]);\r\n        this.validation.addRule(1,\"editLastName\",[{\"rule\":\"required\",\"message\":\"Last Name is required\", \"value\": \"people.selectedPerson.lastName\"}]);\r\n        this.validation.addRule(1,\"editInstitution\",[{\"rule\":\"required\",\"message\":\"Institution is required\", \"value\": \"people.selectedPerson.institutionId\"}]);\r\n        this.validation.addRule(1,\"register_password\",[{\"rule\":\"required\",\"message\":\"Password is required\", \"value\": \"people.selectedPerson.password\"}]);\r\n        this.validation.addRule(1,\"register_password_repeat\",[{\"rule\":\"custom\",\"message\":\"Passwords must match\",\r\n        \"valFunction\":function(context){\r\n            return (context.password === context.password_repeat);\r\n        }}], true);\r\n        this.validation.addRule(4,\"register_password\",[{\"rule\":\"custom\",\"message\": \"Password should be at least \" + this.thresholdLength + \" characters long and should contain \"  + (this.threshold < 4 ? \"at least \" + this.threshold + \" of the following groups:\" : \"a combination of\") + \" of the following groups: a combination of lowercase letters, uppercase letters, digits or special characters\",\r\n            \"valFunction\":function(context){\r\n            return context.complexPassword;\r\n        }}]);\r\n    }\r\n\r\n    attached(){\r\n        $('[data-toggle=\"tooltip\"]').tooltip();\r\n    }\r\n\r\n    getPhoneMask(){\r\n        this.phoneMask = \"\";\r\n        setTimeout(() =>{\r\n            for(let i = 0; i < this.config.PHONE_MASKS.length; i++){\r\n                if(this.people.selectedPerson.country === this.config.PHONE_MASKS[i].country){\r\n                    this.phoneMask = this.config.PHONE_MASKS[i].mask;\r\n                    break;\r\n                }\r\n            }\r\n        },500)\r\n    }\r\n\r\n    async activate() {\r\n        let responses = await Promise.all([\r\n            this.people.getPerson(this.userObj._id),\r\n            this.people.getInstitutionsArray('?fields=_id name&order=name'),\r\n            this.is4ua.loadIs4ua()\r\n        ]);\r\n        this.config.getConfig(true);\r\n        this.user = this.people.selectedPerson;\r\n        if(this.people.selectedPerson.file && this.people.selectedPerson.file.fileName) {\r\n            this.personImage = this.people.selectedPerson.file.fileName;\r\n        }\r\n        this.getPhoneMask();\r\n    }\r\n\r\n    canActivate(){\r\n        if(!this.userObj) {\r\n        this.userObj = this.config.user;\r\n        if(!this.userObj) {\r\n            this.utils.showNotification(\"Couldn't find your user information.  Try logging in again or call the UCC.\");\r\n            this.router.navigate(\"home\");\r\n        }\r\n        }\r\n    }\r\n\r\n    buildAudit(){\r\n        var changes = this.people.isPersonDirty(this.user);\r\n        changes.forEach(item => {\r\n            this.people.selectedPerson.audit.push({\r\n                 property: item.property,\r\n                eventDate: new Date(),\r\n                oldValue: item.oldValue,\r\n                newValue: item.newValue,\r\n                personId: JSON.parse(sessionStorage.getItem('user'))._id\r\n            })\r\n        });\r\n    }\r\n\r\n    async save() {\r\n        if(this.validation.validate(1,this)) {\r\n            if(this.password && this.password.length > 0){\r\n                this.people.selectedPerson.password = this.password;\r\n            }\r\n            if(this.people.selectedPerson.roles.indexOf(\"PROV\") > -1){\r\n                this.people.selectedPerson.roles.splice(this.people.selectedPerson.roles.indexOf(\"PROV\"), 1);\r\n            }\r\n            this.buildAudit();\r\n            let response = await this.people.savePerson()\r\n            if(!response.error){\r\n                 if (this.filesToUpload && this.filesToUpload.length > 0) {\r\n                    await this.people.uploadFile(this.filesToUpload);\r\n                    this.personImage = this.people.selectedPerson._id + this.people.selectedPerson.file.fileName.substring(this.people.selectedPerson.file.fileName.indexOf('.'))\r\n                }\r\n                this.utils.showNotification(\"Your profile has been updated.\");\r\n                this.showPreview = false;\r\n            } else {\r\n                this.utils.showNotification(\"An error occurred updating your profile\");\r\n            }\r\n        }\r\n    };\r\n\r\n    changePassword(){\r\n     var passwords = {password: \"\", password_repeat: \"\"};\r\n        return this.dialog.showPassword(\r\n              \"Change Password\",\r\n              passwords,\r\n              ['Submit', 'Cancel']\r\n          ).whenClosed(response => {\r\n              if (!response.wasCancelled) {\r\n                this.savePassword(response.output.password);\r\n              } else {\r\n                console.log(\"Cancelled\");\r\n              }\r\n          });\r\n    }\r\n\r\n    async savePassword(password) {\r\n        var obj = {\r\n            password: password\r\n        }\r\n        let response = await this.people.updatePassword(obj);\r\n        if (!response.error) {\r\n            this.utils.showNotification(\"The password was updated\");\r\n        }\r\n    }\r\n\r\n    cancel(){\r\n        this.utils.copyObject(this.users, this.people.selectedPerson);\r\n    }\r\n\r\n    changeFiles(){\r\n        if(this.files[0].size > 100000){\r\n            this.utils.showNotification(\"That image is too large.  The limit is 100,000 KB\");\r\n            return;\r\n        }\r\n        if(!this.people.selectedPerson.file) this.people.selectedPerson.file = new Object();\r\n        this.filesToUpload = new Array(); \r\n        this.filesToUpload.push(this.files[0]);\r\n        this.people.selectedPerson.file.fileName = this.filesToUpload[0].name;\r\n        this.previewFile();\r\n    }\r\n\r\n    previewFile() {\r\n        var preview = this.preview;\r\n        var reader  = new FileReader(); \r\n        this.showPreview = true;\r\n\r\n        reader.onloadend = function () {\r\n            preview.src = reader.result;\r\n        }\r\n\r\n        if ( this.files[0]) {\r\n            reader.readAsDataURL( this.files[0]);\r\n        } else {\r\n            preview.src = \"\";\r\n        }\r\n    }\r\n\r\n\tdeleteImage(){\r\n        this.people.selectedPerson.file = new Object();\r\n        this.preview.src=\"\";\r\n        document.getElementById(\"fileUpload\").value = \"\";\r\n        this.personImage = undefined;\r\n        this.showPreview = false;\r\n    }\r\n\r\n}\r\n","// Module\nvar code = \"<template>\\n    <compose view='../../resources/elements/submenu.html'></compose>   \\n\\n <div class=\\\"col-lg-8 col-lg-offset-2\\\">\\n  <div class=\\\"panel panel-primary topMargin\\\">\\n    <div class=\\\"panel-body\\\">\\n      <div class=\\\"bottomMargin list-group-item leftMargin rightMargin\\\">\\n          <span click.delegate=\\\"save()\\\" class=\\\"smallMarginRight\\\" bootstrap-tooltip data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"\\\" data-original-title=\\\"Save\\\"><i class=\\\"fa fa-floppy-o fa-lg fa-border\\\" aria-hidden=\\\"true\\\"></i></span>\\n          <span click.delegate=\\\"changePassword()\\\" class=\\\"smallMarginRight\\\" bootstrap-tooltip data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"\\\" data-original-title=\\\"Change Password\\\"><i class=\\\"fa fa-key fa-lg fa-border\\\" aria-hidden=\\\"true\\\"></i></span>\\n          <span click.delegate=\\\"cancel()\\\" class=\\\"smallMarginRight\\\" bootstrap-tooltip data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"\\\" data-original-title=\\\"Cancel Changes\\\"><i class=\\\"fa fa-ban fa-lg fa-border\\\" aria-hidden=\\\"true\\\"></i></span>\\n      </div>\\n      <div class=\\\"topMargin col-lg-2\\\">\\n        <div class=\\\"topMargin\\\">\\n            <img if.bind=\\\"personImage\\\" class=\\\"circular--square leftMargin\\\" src =\\\"${config.PERSON_IMAGE_DOWNLOAD_URL}/${personImage}\\\" height=\\\"100\\\">\\n        </div>\\n        <div if.bind=\\\"!personImage\\\" style=\\\"height:100px;width:100px;\\\" innerhtml.bind=\\\"people.selectedPerson.email | gravatarUrl:100:6\\\"></div>\\n        <div class=\\\"topMargin\\\">\\n            <h6>Register your email with <a href=\\\"https://en.gravatar.com/\\\">gravatar.com</a> to show your image.</h6>\\n        </div>\\n        \\n        <label class=\\\"btn btn-primary\\\">\\n                Or Upload a Photo&hellip; <input type=\\\"file\\\" id=\\\"fileUpload\\\" style=\\\"display: none;\\\" change.delegate=\\\"changeFiles()\\\" files.bind=\\\"files\\\">\\n        </label>\\n        <button if.bind=\\\"people.selectedPerson.file.fileName\\\" class=\\\"btn btn-danger topMargin\\\" click.trigger=\\\"deleteImage()\\\">Delete Image</button>\\n        <div show.bind=\\\"showPreview\\\" class=\\\"topMargin\\\">\\n            <!-- <img id=\\\"preview\\\"  class=\\\"circular--square leftMargin\\\" src=\\\"\\\" height=\\\"100\\\" alt=\\\"Image preview...\\\" ref=\\\"preview\\\"> -->\\n            <label>Preview</label>\\n        </div>\\n      </div>\\n      <div class=\\\"col-lg-9 leftMargin topMargin\\\">\\n        <form class=\\\"form-horizontal\\\">\\n          <div class=\\\"row\\\">\\n            <!-- Row 1 -->\\n            <div class=\\\"col-lg-4\\\">\\n              <label for=\\\"editFirstName\\\" class=\\\"control-label hideOnPhone\\\">Name</label>\\n              <input value.bind=\\\"people.selectedPerson.firstName\\\" id=\\\"editFirstName\\\" class=\\\"form-control input-md\\\" placeholder=\\\"First Name\\\" type=\\\"text\\\" />\\n            </div>\\n            <div class=\\\"col-lg-4\\\">\\n              <label for=\\\"editMiddleName\\\" class=\\\"control-label hideOnPhone\\\">Middle Name</label>\\n              <input value.bind=\\\"people.selectedPerson.middleName\\\" id=\\\"editMiddleName\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Middle Name\\\" type=\\\"text\\\" />\\n            </div>\\n            <div class=\\\"col-lg-4\\\">\\n              <label for=\\\"editLastName\\\" class=\\\"control-label hideOnPhone\\\">Last Name</label>\\n              <input value.bind=\\\"people.selectedPerson.lastName\\\" id=\\\"editLastName\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Last Name\\\" type=\\\"text\\\" />\\n            </div>\\n          </div>\\n          <!-- Row 2 -->\\n          <div class=\\\"row topMargin\\\">\\n            <div class=\\\"col-lg-5\\\">\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editPhone\\\" class=\\\"control-label hideOnPhone\\\">Phone</label>\\n                  <input if.bind=\\\"phoneMask\\\" class=\\\"form-control\\\" id=\\\"editMobile\\\" masked=\\\"value.bind: people.selectedPerson.phone; mask.bind: phoneMask; placeholder: *\\\"/>\\n                  <input if.bind=\\\"!phoneMask\\\" class=\\\"form-control\\\" id=\\\"editMobile\\\" value.bind=\\\"people.selectedPerson.phone\\\" />\\n                  <!--o\\n                  <input value.bind=\\\"people.selectedPerson.phone| phoneNumber\\\" id=\\\"editPhone\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Phone\\\" type=\\\"text\\\" />\\n                  -->\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editext\\\" class=\\\"control-label hideOnPhone\\\">Extension</label>\\n                  <input value.bind=\\\"people.selectedPerson.ext\\\" id=\\\"editext\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Extension\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editMobile\\\" class=\\\"control-label hideOnPhone\\\">Mobile</label>\\n                  <input if.bind=\\\"phoneMask\\\" class=\\\"form-control\\\" id=\\\"editMobile\\\" masked=\\\"value.bind: people.selectedPerson.mobile; mask.bind: phoneMask; placeholder: *\\\"/>\\n                  <input if.bind=\\\"!phoneMask\\\" class=\\\"form-control\\\" id=\\\"editMobile\\\" value.bind=\\\"people.selectedPerson.mobile\\\" />\\n                  <!--\\n                  <input value.bind=\\\"people.selectedPerson.mobile | phoneNumber\\\" id=\\\"editMobile\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Mobile\\\" type=\\\"text\\\" />\\n                  -->\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editEmail\\\" class=\\\"control-label hideOnPhone\\\">Email</label>\\n                  <input disabled value.bind=\\\"people.selectedPerson.email\\\" id=\\\"editEmail\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Email\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editInstitution\\\" class=\\\"control-label\\\">Institution</label>\\n                  <select value.bind=\\\"people.selectedPerson.institutionId\\\" id=\\\"editInstitution\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Institution\\\">\\n                      <option value=\\\"\\\">Select an option</option>\\n                      <option repeat.for=\\\"institution of people.institutionsArray\\\" value=\\\"${institution._id}\\\">${institution.name}</option>\\n                  </select>\\n              </div>\\n            </div>\\n            <div class=\\\"col-lg-5 col-lg-offset-1\\\">\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editAddress1\\\" class=\\\"control-label hideOnPhone\\\">Address 1</label>\\n                  <input value.bind=\\\"people.selectedPerson.address1\\\" id=\\\"editAddress1\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Address 1\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editAddress2\\\" class=\\\"control-label hideOnPhone\\\">Address 2</label>\\n                  <input value.bind=\\\"people.selectedPerson.address2\\\" id=\\\"editAddress2\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Address2\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editCity\\\" class=\\\"control-label hideOnPhone\\\">City</label>\\n                  <input value.bind=\\\"people.selectedPerson.city\\\" id=\\\"editCity\\\" class=\\\"form-control input-md\\\" placeholder=\\\"City\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editRegion\\\" class=\\\"control-label hideOnPhone\\\">Region</label>\\n                  <input value.bind=\\\"people.selectedPerson.region\\\" id=\\\"editRegion\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Region\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editPostalCode\\\" class=\\\"control-label hideOnPhone\\\">Postal Code</label>\\n                  <input value.bind=\\\"people.selectedPerson.postalCode\\\" id=\\\"editPostalCode\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Postal Code\\\" type=\\\"text\\\" />\\n              </div>\\n              <div class=\\\"col-lg-12\\\">\\n                  <label for=\\\"editCountry\\\" class=\\\"control-label hideOnPhone\\\">Country</label>\\n                  <input value.bind=\\\"people.selectedPerson.country\\\" id=\\\"editCountry\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Country\\\" type=\\\"text\\\" />\\n              </div>\\n          </div>\\n            <div class=\\\"row topMargin\\\">\\n              <div class=\\\"col-lg-5\\\">\\n               <label for=\\\"editSpecialization\\\" class=\\\"control-label\\\">Specialization</label>\\n               <select value.bind=\\\"people.selectedPerson.personSpecialization\\\" id=\\\"editSpecialization\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Specializatin\\\">\\n                   <option value=\\\"\\\">Select an option</option>\\n                   <option repeat.for=\\\"name of is4ua.specialArray\\\" value=\\\"${name.code}\\\">${name.description}</option>\\n               </select>\\n              </div>\\n              <div class=\\\"col-lg-5 col-lg-offset-1\\\">\\n               <label for=\\\"editDepartment\\\" class=\\\"control-label\\\">Department</label>\\n               <select value.bind=\\\"people.selectedPerson.departmentCategory\\\" id=\\\"editDepartment\\\" class=\\\"form-control input-md\\\" placeholder=\\\"Department\\\">\\n                   <option value=\\\"\\\">Select an option</option>\\n                   <option repeat.for=\\\"name of is4ua.deptArray\\\" value=\\\"${name.code}\\\">${name.description}</option>\\n               </select>\\n              </div>\\n            </div>\\n          </div>\\n        </form>\\n     </div>\\n   </div>\\n </div>\\n</div>\\n</template>\\n\";\n// Exports\nexport default code;"],"names":[],"sourceRoot":""}