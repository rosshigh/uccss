(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["vendors~eedc5558"],{

/***/ "xN81":
/*!****************************************************!*\
  !*** ./node_modules/summernote/dist/summernote.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/*!\n * \n * Super simple wysiwyg editor v0.8.18\n * https://summernote.org\n * \n * \n * Copyright 2013- Alan Hong. and other contributors\n * summernote may be freely distributed under the MIT license.\n * \n * Date: 2020-05-20T16:47Z\n * \n */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(true)\n\t\tmodule.exports = factory(__webpack_require__(/*! jquery */ \"EVdn\"));\n\telse { var i, a; }\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 52);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 0:\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__0__;\n\n/***/ }),\n\n/***/ 1:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar Renderer = /*#__PURE__*/function () {\n  function Renderer(markup, children, options, callback) {\n    _classCallCheck(this, Renderer);\n\n    this.markup = markup;\n    this.children = children;\n    this.options = options;\n    this.callback = callback;\n  }\n\n  _createClass(Renderer, [{\n    key: \"render\",\n    value: function render($parent) {\n      var $node = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.markup);\n\n      if (this.options && this.options.contents) {\n        $node.html(this.options.contents);\n      }\n\n      if (this.options && this.options.className) {\n        $node.addClass(this.options.className);\n      }\n\n      if (this.options && this.options.data) {\n        jquery__WEBPACK_IMPORTED_MODULE_0___default.a.each(this.options.data, function (k, v) {\n          $node.attr('data-' + k, v);\n        });\n      }\n\n      if (this.options && this.options.click) {\n        $node.on('click', this.options.click);\n      }\n\n      if (this.children) {\n        var $container = $node.find('.note-children-container');\n        this.children.forEach(function (child) {\n          child.render($container.length ? $container : $node);\n        });\n      }\n\n      if (this.callback) {\n        this.callback($node, this.options);\n      }\n\n      if (this.options && this.options.callback) {\n        this.options.callback($node);\n      }\n\n      if ($parent) {\n        $parent.append($node);\n      }\n\n      return $node;\n    }\n  }]);\n\n  return Renderer;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = ({\n  create: function create(markup, callback) {\n    return function () {\n      var options = _typeof(arguments[1]) === 'object' ? arguments[1] : arguments[0];\n      var children = Array.isArray(arguments[0]) ? arguments[0] : [];\n\n      if (options && options.children) {\n        children = options.children;\n      }\n\n      return new Renderer(markup, children, options, callback);\n    };\n  }\n});\n\n/***/ }),\n\n/***/ 2:\n/***/ (function(module, exports) {\n\n/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */\nmodule.exports = __webpack_amd_options__;\n\n/* WEBPACK VAR INJECTION */}.call(this, {}))\n\n/***/ }),\n\n/***/ 3:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// EXTERNAL MODULE: external {\"root\":\"jQuery\",\"commonjs2\":\"jquery\",\"commonjs\":\"jquery\",\"amd\":\"jquery\"}\nvar external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_ = __webpack_require__(0);\nvar external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default = /*#__PURE__*/__webpack_require__.n(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_);\n\n// CONCATENATED MODULE: ./src/js/base/summernote-en-US.js\n\nexternal_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote || {\n  lang: {}\n};\nexternal_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.lang, {\n  'en-US': {\n    font: {\n      bold: 'Bold',\n      italic: 'Italic',\n      underline: 'Underline',\n      clear: 'Remove Font Style',\n      height: 'Line Height',\n      name: 'Font Family',\n      strikethrough: 'Strikethrough',\n      subscript: 'Subscript',\n      superscript: 'Superscript',\n      size: 'Font Size',\n      sizeunit: 'Font Size Unit'\n    },\n    image: {\n      image: 'Picture',\n      insert: 'Insert Image',\n      resizeFull: 'Resize full',\n      resizeHalf: 'Resize half',\n      resizeQuarter: 'Resize quarter',\n      resizeNone: 'Original size',\n      floatLeft: 'Float Left',\n      floatRight: 'Float Right',\n      floatNone: 'Remove float',\n      shapeRounded: 'Shape: Rounded',\n      shapeCircle: 'Shape: Circle',\n      shapeThumbnail: 'Shape: Thumbnail',\n      shapeNone: 'Shape: None',\n      dragImageHere: 'Drag image or text here',\n      dropImage: 'Drop image or Text',\n      selectFromFiles: 'Select from files',\n      maximumFileSize: 'Maximum file size',\n      maximumFileSizeError: 'Maximum file size exceeded.',\n      url: 'Image URL',\n      remove: 'Remove Image',\n      original: 'Original'\n    },\n    video: {\n      video: 'Video',\n      videoLink: 'Video Link',\n      insert: 'Insert Video',\n      url: 'Video URL',\n      providers: '(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)'\n    },\n    link: {\n      link: 'Link',\n      insert: 'Insert Link',\n      unlink: 'Unlink',\n      edit: 'Edit',\n      textToDisplay: 'Text to display',\n      url: 'To what URL should this link go?',\n      openInNewWindow: 'Open in new window',\n      useProtocol: 'Use default protocol'\n    },\n    table: {\n      table: 'Table',\n      addRowAbove: 'Add row above',\n      addRowBelow: 'Add row below',\n      addColLeft: 'Add column left',\n      addColRight: 'Add column right',\n      delRow: 'Delete row',\n      delCol: 'Delete column',\n      delTable: 'Delete table'\n    },\n    hr: {\n      insert: 'Insert Horizontal Rule'\n    },\n    style: {\n      style: 'Style',\n      p: 'Normal',\n      blockquote: 'Quote',\n      pre: 'Code',\n      h1: 'Header 1',\n      h2: 'Header 2',\n      h3: 'Header 3',\n      h4: 'Header 4',\n      h5: 'Header 5',\n      h6: 'Header 6'\n    },\n    lists: {\n      unordered: 'Unordered list',\n      ordered: 'Ordered list'\n    },\n    options: {\n      help: 'Help',\n      fullscreen: 'Full Screen',\n      codeview: 'Code View'\n    },\n    paragraph: {\n      paragraph: 'Paragraph',\n      outdent: 'Outdent',\n      indent: 'Indent',\n      left: 'Align left',\n      center: 'Align center',\n      right: 'Align right',\n      justify: 'Justify full'\n    },\n    color: {\n      recent: 'Recent Color',\n      more: 'More Color',\n      background: 'Background Color',\n      foreground: 'Text Color',\n      transparent: 'Transparent',\n      setTransparent: 'Set transparent',\n      reset: 'Reset',\n      resetToDefault: 'Reset to default',\n      cpSelect: 'Select'\n    },\n    shortcut: {\n      shortcuts: 'Keyboard shortcuts',\n      close: 'Close',\n      textFormatting: 'Text formatting',\n      action: 'Action',\n      paragraphFormatting: 'Paragraph formatting',\n      documentStyle: 'Document Style',\n      extraKeys: 'Extra keys'\n    },\n    help: {\n      'escape': 'Escape',\n      'insertParagraph': 'Insert Paragraph',\n      'undo': 'Undo the last command',\n      'redo': 'Redo the last command',\n      'tab': 'Tab',\n      'untab': 'Untab',\n      'bold': 'Set a bold style',\n      'italic': 'Set a italic style',\n      'underline': 'Set a underline style',\n      'strikethrough': 'Set a strikethrough style',\n      'removeFormat': 'Clean a style',\n      'justifyLeft': 'Set left align',\n      'justifyCenter': 'Set center align',\n      'justifyRight': 'Set right align',\n      'justifyFull': 'Set full align',\n      'insertUnorderedList': 'Toggle unordered list',\n      'insertOrderedList': 'Toggle ordered list',\n      'outdent': 'Outdent on current paragraph',\n      'indent': 'Indent on current paragraph',\n      'formatPara': 'Change current block\\'s format as a paragraph(P tag)',\n      'formatH1': 'Change current block\\'s format as H1',\n      'formatH2': 'Change current block\\'s format as H2',\n      'formatH3': 'Change current block\\'s format as H3',\n      'formatH4': 'Change current block\\'s format as H4',\n      'formatH5': 'Change current block\\'s format as H5',\n      'formatH6': 'Change current block\\'s format as H6',\n      'insertHorizontalRule': 'Insert horizontal rule',\n      'linkDialog.show': 'Show Link Dialog'\n    },\n    history: {\n      undo: 'Undo',\n      redo: 'Redo'\n    },\n    specialChar: {\n      specialChar: 'SPECIAL CHARACTERS',\n      select: 'Select Special characters'\n    },\n    output: {\n      noSelection: 'No Selection Made!'\n    }\n  }\n});\n// CONCATENATED MODULE: ./src/js/base/core/env.js\n\nvar isSupportAmd =  true && __webpack_require__(2); // eslint-disable-line\n\n/**\n * returns whether font is installed or not.\n *\n * @param {String} fontName\n * @return {Boolean}\n */\n\nvar genericFontFamilies = ['sans-serif', 'serif', 'monospace', 'cursive', 'fantasy'];\n\nfunction validFontName(fontName) {\n  return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.inArray(fontName.toLowerCase(), genericFontFamilies) === -1 ? \"'\".concat(fontName, \"'\") : fontName;\n}\n\nfunction env_isFontInstalled(fontName) {\n  var testFontName = fontName === 'Comic Sans MS' ? 'Courier New' : 'Comic Sans MS';\n  var testText = 'mmmmmmmmmmwwwww';\n  var testSize = '200px';\n  var canvas = document.createElement('canvas');\n  var context = canvas.getContext('2d');\n  context.font = testSize + \" '\" + testFontName + \"'\";\n  var originalWidth = context.measureText(testText).width;\n  context.font = testSize + ' ' + validFontName(fontName) + ', \"' + testFontName + '\"';\n  var width = context.measureText(testText).width;\n  return originalWidth !== width;\n}\n\nvar userAgent = navigator.userAgent;\nvar isMSIE = /MSIE|Trident/i.test(userAgent);\nvar browserVersion;\n\nif (isMSIE) {\n  var matches = /MSIE (\\d+[.]\\d+)/.exec(userAgent);\n\n  if (matches) {\n    browserVersion = parseFloat(matches[1]);\n  }\n\n  matches = /Trident\\/.*rv:([0-9]{1,}[.0-9]{0,})/.exec(userAgent);\n\n  if (matches) {\n    browserVersion = parseFloat(matches[1]);\n  }\n}\n\nvar isEdge = /Edge\\/\\d+/.test(userAgent);\nvar isSupportTouch = 'ontouchstart' in window || navigator.MaxTouchPoints > 0 || navigator.msMaxTouchPoints > 0; // [workaround] IE doesn't have input events for contentEditable\n// - see: https://goo.gl/4bfIvA\n\nvar inputEventName = isMSIE ? 'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted' : 'input';\n/**\n * @class core.env\n *\n * Object which check platform and agent\n *\n * @singleton\n * @alternateClassName env\n */\n\n/* harmony default export */ var env = ({\n  isMac: navigator.appVersion.indexOf('Mac') > -1,\n  isMSIE: isMSIE,\n  isEdge: isEdge,\n  isFF: !isEdge && /firefox/i.test(userAgent),\n  isPhantom: /PhantomJS/i.test(userAgent),\n  isWebkit: !isEdge && /webkit/i.test(userAgent),\n  isChrome: !isEdge && /chrome/i.test(userAgent),\n  isSafari: !isEdge && /safari/i.test(userAgent) && !/chrome/i.test(userAgent),\n  browserVersion: browserVersion,\n  jqueryVersion: parseFloat(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.fn.jquery),\n  isSupportAmd: isSupportAmd,\n  isSupportTouch: isSupportTouch,\n  isFontInstalled: env_isFontInstalled,\n  isW3CRangeSupport: !!document.createRange,\n  inputEventName: inputEventName,\n  genericFontFamilies: genericFontFamilies,\n  validFontName: validFontName\n});\n// CONCATENATED MODULE: ./src/js/base/core/func.js\n\n/**\n * @class core.func\n *\n * func utils (for high-order func's arg)\n *\n * @singleton\n * @alternateClassName func\n */\n\nfunction eq(itemA) {\n  return function (itemB) {\n    return itemA === itemB;\n  };\n}\n\nfunction eq2(itemA, itemB) {\n  return itemA === itemB;\n}\n\nfunction peq2(propName) {\n  return function (itemA, itemB) {\n    return itemA[propName] === itemB[propName];\n  };\n}\n\nfunction ok() {\n  return true;\n}\n\nfunction fail() {\n  return false;\n}\n\nfunction not(f) {\n  return function () {\n    return !f.apply(f, arguments);\n  };\n}\n\nfunction and(fA, fB) {\n  return function (item) {\n    return fA(item) && fB(item);\n  };\n}\n\nfunction func_self(a) {\n  return a;\n}\n\nfunction func_invoke(obj, method) {\n  return function () {\n    return obj[method].apply(obj, arguments);\n  };\n}\n\nvar idCounter = 0;\n/**\n * reset globally-unique id\n *\n */\n\nfunction resetUniqueId() {\n  idCounter = 0;\n}\n/**\n * generate a globally-unique id\n *\n * @param {String} [prefix]\n */\n\n\nfunction uniqueId(prefix) {\n  var id = ++idCounter + '';\n  return prefix ? prefix + id : id;\n}\n/**\n * returns bnd (bounds) from rect\n *\n * - IE Compatibility Issue: http://goo.gl/sRLOAo\n * - Scroll Issue: http://goo.gl/sNjUc\n *\n * @param {Rect} rect\n * @return {Object} bounds\n * @return {Number} bounds.top\n * @return {Number} bounds.left\n * @return {Number} bounds.width\n * @return {Number} bounds.height\n */\n\n\nfunction rect2bnd(rect) {\n  var $document = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document);\n  return {\n    top: rect.top + $document.scrollTop(),\n    left: rect.left + $document.scrollLeft(),\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n}\n/**\n * returns a copy of the object where the keys have become the values and the values the keys.\n * @param {Object} obj\n * @return {Object}\n */\n\n\nfunction invertObject(obj) {\n  var inverted = {};\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      inverted[obj[key]] = key;\n    }\n  }\n\n  return inverted;\n}\n/**\n * @param {String} namespace\n * @param {String} [prefix]\n * @return {String}\n */\n\n\nfunction namespaceToCamel(namespace, prefix) {\n  prefix = prefix || '';\n  return prefix + namespace.split('.').map(function (name) {\n    return name.substring(0, 1).toUpperCase() + name.substring(1);\n  }).join('');\n}\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing.\n * @param {Function} func\n * @param {Number} wait\n * @param {Boolean} immediate\n * @return {Function}\n */\n\n\nfunction debounce(func, wait, immediate) {\n  var timeout;\n  return function () {\n    var context = this;\n    var args = arguments;\n\n    var later = function later() {\n      timeout = null;\n\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    };\n\n    var callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n\n    if (callNow) {\n      func.apply(context, args);\n    }\n  };\n}\n/**\n *\n * @param {String} url\n * @return {Boolean}\n */\n\n\nfunction isValidUrl(url) {\n  var expression = /[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)/gi;\n  return expression.test(url);\n}\n\n/* harmony default export */ var func = ({\n  eq: eq,\n  eq2: eq2,\n  peq2: peq2,\n  ok: ok,\n  fail: fail,\n  self: func_self,\n  not: not,\n  and: and,\n  invoke: func_invoke,\n  resetUniqueId: resetUniqueId,\n  uniqueId: uniqueId,\n  rect2bnd: rect2bnd,\n  invertObject: invertObject,\n  namespaceToCamel: namespaceToCamel,\n  debounce: debounce,\n  isValidUrl: isValidUrl\n});\n// CONCATENATED MODULE: ./src/js/base/core/lists.js\n\n/**\n * returns the first item of an array.\n *\n * @param {Array} array\n */\n\nfunction lists_head(array) {\n  return array[0];\n}\n/**\n * returns the last item of an array.\n *\n * @param {Array} array\n */\n\n\nfunction lists_last(array) {\n  return array[array.length - 1];\n}\n/**\n * returns everything but the last entry of the array.\n *\n * @param {Array} array\n */\n\n\nfunction initial(array) {\n  return array.slice(0, array.length - 1);\n}\n/**\n * returns the rest of the items in an array.\n *\n * @param {Array} array\n */\n\n\nfunction tail(array) {\n  return array.slice(1);\n}\n/**\n * returns item of array\n */\n\n\nfunction find(array, pred) {\n  for (var idx = 0, len = array.length; idx < len; idx++) {\n    var item = array[idx];\n\n    if (pred(item)) {\n      return item;\n    }\n  }\n}\n/**\n * returns true if all of the values in the array pass the predicate truth test.\n */\n\n\nfunction lists_all(array, pred) {\n  for (var idx = 0, len = array.length; idx < len; idx++) {\n    if (!pred(array[idx])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n/**\n * returns true if the value is present in the list.\n */\n\n\nfunction contains(array, item) {\n  if (array && array.length && item) {\n    if (array.indexOf) {\n      return array.indexOf(item) !== -1;\n    } else if (array.contains) {\n      // `DOMTokenList` doesn't implement `.indexOf`, but it implements `.contains`\n      return array.contains(item);\n    }\n  }\n\n  return false;\n}\n/**\n * get sum from a list\n *\n * @param {Array} array - array\n * @param {Function} fn - iterator\n */\n\n\nfunction sum(array, fn) {\n  fn = fn || func.self;\n  return array.reduce(function (memo, v) {\n    return memo + fn(v);\n  }, 0);\n}\n/**\n * returns a copy of the collection with array type.\n * @param {Collection} collection - collection eg) node.childNodes, ...\n */\n\n\nfunction from(collection) {\n  var result = [];\n  var length = collection.length;\n  var idx = -1;\n\n  while (++idx < length) {\n    result[idx] = collection[idx];\n  }\n\n  return result;\n}\n/**\n * returns whether list is empty or not\n */\n\n\nfunction lists_isEmpty(array) {\n  return !array || !array.length;\n}\n/**\n * cluster elements by predicate function.\n *\n * @param {Array} array - array\n * @param {Function} fn - predicate function for cluster rule\n * @param {Array[]}\n */\n\n\nfunction clusterBy(array, fn) {\n  if (!array.length) {\n    return [];\n  }\n\n  var aTail = tail(array);\n  return aTail.reduce(function (memo, v) {\n    var aLast = lists_last(memo);\n\n    if (fn(lists_last(aLast), v)) {\n      aLast[aLast.length] = v;\n    } else {\n      memo[memo.length] = [v];\n    }\n\n    return memo;\n  }, [[lists_head(array)]]);\n}\n/**\n * returns a copy of the array with all false values removed\n *\n * @param {Array} array - array\n * @param {Function} fn - predicate function for cluster rule\n */\n\n\nfunction compact(array) {\n  var aResult = [];\n\n  for (var idx = 0, len = array.length; idx < len; idx++) {\n    if (array[idx]) {\n      aResult.push(array[idx]);\n    }\n  }\n\n  return aResult;\n}\n/**\n * produces a duplicate-free version of the array\n *\n * @param {Array} array\n */\n\n\nfunction unique(array) {\n  var results = [];\n\n  for (var idx = 0, len = array.length; idx < len; idx++) {\n    if (!contains(results, array[idx])) {\n      results.push(array[idx]);\n    }\n  }\n\n  return results;\n}\n/**\n * returns next item.\n * @param {Array} array\n */\n\n\nfunction lists_next(array, item) {\n  if (array && array.length && item) {\n    var idx = array.indexOf(item);\n    return idx === -1 ? null : array[idx + 1];\n  }\n\n  return null;\n}\n/**\n * returns prev item.\n * @param {Array} array\n */\n\n\nfunction prev(array, item) {\n  if (array && array.length && item) {\n    var idx = array.indexOf(item);\n    return idx === -1 ? null : array[idx - 1];\n  }\n\n  return null;\n}\n/**\n * @class core.list\n *\n * list utils\n *\n * @singleton\n * @alternateClassName list\n */\n\n\n/* harmony default export */ var lists = ({\n  head: lists_head,\n  last: lists_last,\n  initial: initial,\n  tail: tail,\n  prev: prev,\n  next: lists_next,\n  find: find,\n  contains: contains,\n  all: lists_all,\n  sum: sum,\n  from: from,\n  isEmpty: lists_isEmpty,\n  clusterBy: clusterBy,\n  compact: compact,\n  unique: unique\n});\n// CONCATENATED MODULE: ./src/js/base/core/dom.js\n\n\n\n\nvar NBSP_CHAR = String.fromCharCode(160);\nvar ZERO_WIDTH_NBSP_CHAR = \"\\uFEFF\";\n/**\n * @method isEditable\n *\n * returns whether node is `note-editable` or not.\n *\n * @param {Node} node\n * @return {Boolean}\n */\n\nfunction isEditable(node) {\n  return node && external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(node).hasClass('note-editable');\n}\n/**\n * @method isControlSizing\n *\n * returns whether node is `note-control-sizing` or not.\n *\n * @param {Node} node\n * @return {Boolean}\n */\n\n\nfunction isControlSizing(node) {\n  return node && external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(node).hasClass('note-control-sizing');\n}\n/**\n * @method makePredByNodeName\n *\n * returns predicate which judge whether nodeName is same\n *\n * @param {String} nodeName\n * @return {Function}\n */\n\n\nfunction makePredByNodeName(nodeName) {\n  nodeName = nodeName.toUpperCase();\n  return function (node) {\n    return node && node.nodeName.toUpperCase() === nodeName;\n  };\n}\n/**\n * @method isText\n *\n *\n *\n * @param {Node} node\n * @return {Boolean} true if node's type is text(3)\n */\n\n\nfunction isText(node) {\n  return node && node.nodeType === 3;\n}\n/**\n * @method isElement\n *\n *\n *\n * @param {Node} node\n * @return {Boolean} true if node's type is element(1)\n */\n\n\nfunction isElement(node) {\n  return node && node.nodeType === 1;\n}\n/**\n * ex) br, col, embed, hr, img, input, ...\n * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\n */\n\n\nfunction isVoid(node) {\n  return node && /^BR|^IMG|^HR|^IFRAME|^BUTTON|^INPUT|^AUDIO|^VIDEO|^EMBED/.test(node.nodeName.toUpperCase());\n}\n\nfunction isPara(node) {\n  if (isEditable(node)) {\n    return false;\n  } // Chrome(v31.0), FF(v25.0.1) use DIV for paragraph\n\n\n  return node && /^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());\n}\n\nfunction isHeading(node) {\n  return node && /^H[1-7]/.test(node.nodeName.toUpperCase());\n}\n\nvar isPre = makePredByNodeName('PRE');\nvar isLi = makePredByNodeName('LI');\n\nfunction isPurePara(node) {\n  return isPara(node) && !isLi(node);\n}\n\nvar isTable = makePredByNodeName('TABLE');\nvar isData = makePredByNodeName('DATA');\n\nfunction dom_isInline(node) {\n  return !isBodyContainer(node) && !isList(node) && !isHr(node) && !isPara(node) && !isTable(node) && !isBlockquote(node) && !isData(node);\n}\n\nfunction isList(node) {\n  return node && /^UL|^OL/.test(node.nodeName.toUpperCase());\n}\n\nvar isHr = makePredByNodeName('HR');\n\nfunction dom_isCell(node) {\n  return node && /^TD|^TH/.test(node.nodeName.toUpperCase());\n}\n\nvar isBlockquote = makePredByNodeName('BLOCKQUOTE');\n\nfunction isBodyContainer(node) {\n  return dom_isCell(node) || isBlockquote(node) || isEditable(node);\n}\n\nvar isAnchor = makePredByNodeName('A');\n\nfunction isParaInline(node) {\n  return dom_isInline(node) && !!dom_ancestor(node, isPara);\n}\n\nfunction isBodyInline(node) {\n  return dom_isInline(node) && !dom_ancestor(node, isPara);\n}\n\nvar isBody = makePredByNodeName('BODY');\n/**\n * returns whether nodeB is closest sibling of nodeA\n *\n * @param {Node} nodeA\n * @param {Node} nodeB\n * @return {Boolean}\n */\n\nfunction isClosestSibling(nodeA, nodeB) {\n  return nodeA.nextSibling === nodeB || nodeA.previousSibling === nodeB;\n}\n/**\n * returns array of closest siblings with node\n *\n * @param {Node} node\n * @param {function} [pred] - predicate function\n * @return {Node[]}\n */\n\n\nfunction withClosestSiblings(node, pred) {\n  pred = pred || func.ok;\n  var siblings = [];\n\n  if (node.previousSibling && pred(node.previousSibling)) {\n    siblings.push(node.previousSibling);\n  }\n\n  siblings.push(node);\n\n  if (node.nextSibling && pred(node.nextSibling)) {\n    siblings.push(node.nextSibling);\n  }\n\n  return siblings;\n}\n/**\n * blank HTML for cursor position\n * - [workaround] old IE only works with &nbsp;\n * - [workaround] IE11 and other browser works with bogus br\n */\n\n\nvar blankHTML = env.isMSIE && env.browserVersion < 11 ? '&nbsp;' : '<br>';\n/**\n * @method nodeLength\n *\n * returns #text's text size or element's childNodes size\n *\n * @param {Node} node\n */\n\nfunction nodeLength(node) {\n  if (isText(node)) {\n    return node.nodeValue.length;\n  }\n\n  if (node) {\n    return node.childNodes.length;\n  }\n\n  return 0;\n}\n/**\n * returns whether deepest child node is empty or not.\n *\n * @param {Node} node\n * @return {Boolean}\n */\n\n\nfunction deepestChildIsEmpty(node) {\n  do {\n    if (node.firstElementChild === null || node.firstElementChild.innerHTML === '') break;\n  } while (node = node.firstElementChild);\n\n  return dom_isEmpty(node);\n}\n/**\n * returns whether node is empty or not.\n *\n * @param {Node} node\n * @return {Boolean}\n */\n\n\nfunction dom_isEmpty(node) {\n  var len = nodeLength(node);\n\n  if (len === 0) {\n    return true;\n  } else if (!isText(node) && len === 1 && node.innerHTML === blankHTML) {\n    // ex) <p><br></p>, <span><br></span>\n    return true;\n  } else if (lists.all(node.childNodes, isText) && node.innerHTML === '') {\n    // ex) <p></p>, <span></span>\n    return true;\n  }\n\n  return false;\n}\n/**\n * padding blankHTML if node is empty (for cursor position)\n */\n\n\nfunction paddingBlankHTML(node) {\n  if (!isVoid(node) && !nodeLength(node)) {\n    node.innerHTML = blankHTML;\n  }\n}\n/**\n * find nearest ancestor predicate hit\n *\n * @param {Node} node\n * @param {Function} pred - predicate function\n */\n\n\nfunction dom_ancestor(node, pred) {\n  while (node) {\n    if (pred(node)) {\n      return node;\n    }\n\n    if (isEditable(node)) {\n      break;\n    }\n\n    node = node.parentNode;\n  }\n\n  return null;\n}\n/**\n * find nearest ancestor only single child blood line and predicate hit\n *\n * @param {Node} node\n * @param {Function} pred - predicate function\n */\n\n\nfunction singleChildAncestor(node, pred) {\n  node = node.parentNode;\n\n  while (node) {\n    if (nodeLength(node) !== 1) {\n      break;\n    }\n\n    if (pred(node)) {\n      return node;\n    }\n\n    if (isEditable(node)) {\n      break;\n    }\n\n    node = node.parentNode;\n  }\n\n  return null;\n}\n/**\n * returns new array of ancestor nodes (until predicate hit).\n *\n * @param {Node} node\n * @param {Function} [optional] pred - predicate function\n */\n\n\nfunction listAncestor(node, pred) {\n  pred = pred || func.fail;\n  var ancestors = [];\n  dom_ancestor(node, function (el) {\n    if (!isEditable(el)) {\n      ancestors.push(el);\n    }\n\n    return pred(el);\n  });\n  return ancestors;\n}\n/**\n * find farthest ancestor predicate hit\n */\n\n\nfunction lastAncestor(node, pred) {\n  var ancestors = listAncestor(node);\n  return lists.last(ancestors.filter(pred));\n}\n/**\n * returns common ancestor node between two nodes.\n *\n * @param {Node} nodeA\n * @param {Node} nodeB\n */\n\n\nfunction dom_commonAncestor(nodeA, nodeB) {\n  var ancestors = listAncestor(nodeA);\n\n  for (var n = nodeB; n; n = n.parentNode) {\n    if (ancestors.indexOf(n) > -1) return n;\n  }\n\n  return null; // difference document area\n}\n/**\n * listing all previous siblings (until predicate hit).\n *\n * @param {Node} node\n * @param {Function} [optional] pred - predicate function\n */\n\n\nfunction listPrev(node, pred) {\n  pred = pred || func.fail;\n  var nodes = [];\n\n  while (node) {\n    if (pred(node)) {\n      break;\n    }\n\n    nodes.push(node);\n    node = node.previousSibling;\n  }\n\n  return nodes;\n}\n/**\n * listing next siblings (until predicate hit).\n *\n * @param {Node} node\n * @param {Function} [pred] - predicate function\n */\n\n\nfunction listNext(node, pred) {\n  pred = pred || func.fail;\n  var nodes = [];\n\n  while (node) {\n    if (pred(node)) {\n      break;\n    }\n\n    nodes.push(node);\n    node = node.nextSibling;\n  }\n\n  return nodes;\n}\n/**\n * listing descendant nodes\n *\n * @param {Node} node\n * @param {Function} [pred] - predicate function\n */\n\n\nfunction listDescendant(node, pred) {\n  var descendants = [];\n  pred = pred || func.ok; // start DFS(depth first search) with node\n\n  (function fnWalk(current) {\n    if (node !== current && pred(current)) {\n      descendants.push(current);\n    }\n\n    for (var idx = 0, len = current.childNodes.length; idx < len; idx++) {\n      fnWalk(current.childNodes[idx]);\n    }\n  })(node);\n\n  return descendants;\n}\n/**\n * wrap node with new tag.\n *\n * @param {Node} node\n * @param {Node} tagName of wrapper\n * @return {Node} - wrapper\n */\n\n\nfunction wrap(node, wrapperName) {\n  var parent = node.parentNode;\n  var wrapper = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<' + wrapperName + '>')[0];\n  parent.insertBefore(wrapper, node);\n  wrapper.appendChild(node);\n  return wrapper;\n}\n/**\n * insert node after preceding\n *\n * @param {Node} node\n * @param {Node} preceding - predicate function\n */\n\n\nfunction insertAfter(node, preceding) {\n  var next = preceding.nextSibling;\n  var parent = preceding.parentNode;\n\n  if (next) {\n    parent.insertBefore(node, next);\n  } else {\n    parent.appendChild(node);\n  }\n\n  return node;\n}\n/**\n * append elements.\n *\n * @param {Node} node\n * @param {Collection} aChild\n */\n\n\nfunction appendChildNodes(node, aChild) {\n  external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(aChild, function (idx, child) {\n    node.appendChild(child);\n  });\n  return node;\n}\n/**\n * returns whether boundaryPoint is left edge or not.\n *\n * @param {BoundaryPoint} point\n * @return {Boolean}\n */\n\n\nfunction isLeftEdgePoint(point) {\n  return point.offset === 0;\n}\n/**\n * returns whether boundaryPoint is right edge or not.\n *\n * @param {BoundaryPoint} point\n * @return {Boolean}\n */\n\n\nfunction isRightEdgePoint(point) {\n  return point.offset === nodeLength(point.node);\n}\n/**\n * returns whether boundaryPoint is edge or not.\n *\n * @param {BoundaryPoint} point\n * @return {Boolean}\n */\n\n\nfunction isEdgePoint(point) {\n  return isLeftEdgePoint(point) || isRightEdgePoint(point);\n}\n/**\n * returns whether node is left edge of ancestor or not.\n *\n * @param {Node} node\n * @param {Node} ancestor\n * @return {Boolean}\n */\n\n\nfunction dom_isLeftEdgeOf(node, ancestor) {\n  while (node && node !== ancestor) {\n    if (dom_position(node) !== 0) {\n      return false;\n    }\n\n    node = node.parentNode;\n  }\n\n  return true;\n}\n/**\n * returns whether node is right edge of ancestor or not.\n *\n * @param {Node} node\n * @param {Node} ancestor\n * @return {Boolean}\n */\n\n\nfunction isRightEdgeOf(node, ancestor) {\n  if (!ancestor) {\n    return false;\n  }\n\n  while (node && node !== ancestor) {\n    if (dom_position(node) !== nodeLength(node.parentNode) - 1) {\n      return false;\n    }\n\n    node = node.parentNode;\n  }\n\n  return true;\n}\n/**\n * returns whether point is left edge of ancestor or not.\n * @param {BoundaryPoint} point\n * @param {Node} ancestor\n * @return {Boolean}\n */\n\n\nfunction isLeftEdgePointOf(point, ancestor) {\n  return isLeftEdgePoint(point) && dom_isLeftEdgeOf(point.node, ancestor);\n}\n/**\n * returns whether point is right edge of ancestor or not.\n * @param {BoundaryPoint} point\n * @param {Node} ancestor\n * @return {Boolean}\n */\n\n\nfunction isRightEdgePointOf(point, ancestor) {\n  return isRightEdgePoint(point) && isRightEdgeOf(point.node, ancestor);\n}\n/**\n * returns offset from parent.\n *\n * @param {Node} node\n */\n\n\nfunction dom_position(node) {\n  var offset = 0;\n\n  while (node = node.previousSibling) {\n    offset += 1;\n  }\n\n  return offset;\n}\n\nfunction hasChildren(node) {\n  return !!(node && node.childNodes && node.childNodes.length);\n}\n/**\n * returns previous boundaryPoint\n *\n * @param {BoundaryPoint} point\n * @param {Boolean} isSkipInnerOffset\n * @return {BoundaryPoint}\n */\n\n\nfunction dom_prevPoint(point, isSkipInnerOffset) {\n  var node;\n  var offset;\n\n  if (point.offset === 0) {\n    if (isEditable(point.node)) {\n      return null;\n    }\n\n    node = point.node.parentNode;\n    offset = dom_position(point.node);\n  } else if (hasChildren(point.node)) {\n    node = point.node.childNodes[point.offset - 1];\n    offset = nodeLength(node);\n  } else {\n    node = point.node;\n    offset = isSkipInnerOffset ? 0 : point.offset - 1;\n  }\n\n  return {\n    node: node,\n    offset: offset\n  };\n}\n/**\n * returns next boundaryPoint\n *\n * @param {BoundaryPoint} point\n * @param {Boolean} isSkipInnerOffset\n * @return {BoundaryPoint}\n */\n\n\nfunction dom_nextPoint(point, isSkipInnerOffset) {\n  var node, offset;\n\n  if (nodeLength(point.node) === point.offset) {\n    if (isEditable(point.node)) {\n      return null;\n    }\n\n    var nextTextNode = getNextTextNode(point.node);\n\n    if (nextTextNode) {\n      node = nextTextNode;\n      offset = 0;\n    } else {\n      node = point.node.parentNode;\n      offset = dom_position(point.node) + 1;\n    }\n  } else if (hasChildren(point.node)) {\n    node = point.node.childNodes[point.offset];\n    offset = 0;\n  } else {\n    node = point.node;\n    offset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;\n  }\n\n  return {\n    node: node,\n    offset: offset\n  };\n}\n/**\n * returns next boundaryPoint with empty node\n *\n * @param {BoundaryPoint} point\n * @param {Boolean} isSkipInnerOffset\n * @return {BoundaryPoint}\n */\n\n\nfunction nextPointWithEmptyNode(point, isSkipInnerOffset) {\n  var node, offset; // if node is empty string node, return current node's sibling.\n\n  if (dom_isEmpty(point.node)) {\n    node = point.node.nextSibling;\n    offset = 0;\n    return {\n      node: node,\n      offset: offset\n    };\n  }\n\n  if (nodeLength(point.node) === point.offset) {\n    if (isEditable(point.node)) {\n      return null;\n    }\n\n    var nextTextNode = getNextTextNode(point.node);\n\n    if (nextTextNode) {\n      node = nextTextNode;\n      offset = 0;\n    } else {\n      node = point.node.parentNode;\n      offset = dom_position(point.node) + 1;\n    } // if next node is editable, return current node's sibling node.\n\n\n    if (isEditable(node)) {\n      node = point.node.nextSibling;\n      offset = 0;\n    }\n  } else if (hasChildren(point.node)) {\n    node = point.node.childNodes[point.offset];\n    offset = 0;\n\n    if (dom_isEmpty(node)) {\n      return null;\n    }\n  } else {\n    node = point.node;\n    offset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;\n\n    if (dom_isEmpty(node)) {\n      return null;\n    }\n  }\n\n  return {\n    node: node,\n    offset: offset\n  };\n}\n/*\n* returns the next Text node index or 0 if not found.\n*/\n\n\nfunction getNextTextNode(actual) {\n  if (!actual.nextSibling) return undefined;\n  if (actual.parent !== actual.nextSibling.parent) return undefined;\n  if (isText(actual.nextSibling)) return actual.nextSibling;\n  return getNextTextNode(actual.nextSibling);\n}\n/**\n * returns whether pointA and pointB is same or not.\n *\n * @param {BoundaryPoint} pointA\n * @param {BoundaryPoint} pointB\n * @return {Boolean}\n */\n\n\nfunction isSamePoint(pointA, pointB) {\n  return pointA.node === pointB.node && pointA.offset === pointB.offset;\n}\n/**\n * returns whether point is visible (can set cursor) or not.\n *\n * @param {BoundaryPoint} point\n * @return {Boolean}\n */\n\n\nfunction isVisiblePoint(point) {\n  if (isText(point.node) || !hasChildren(point.node) || dom_isEmpty(point.node)) {\n    return true;\n  }\n\n  var leftNode = point.node.childNodes[point.offset - 1];\n  var rightNode = point.node.childNodes[point.offset];\n\n  if ((!leftNode || isVoid(leftNode)) && (!rightNode || isVoid(rightNode))) {\n    return true;\n  }\n\n  return false;\n}\n/**\n * @method prevPointUtil\n *\n * @param {BoundaryPoint} point\n * @param {Function} pred\n * @return {BoundaryPoint}\n */\n\n\nfunction prevPointUntil(point, pred) {\n  while (point) {\n    if (pred(point)) {\n      return point;\n    }\n\n    point = dom_prevPoint(point);\n  }\n\n  return null;\n}\n/**\n * @method nextPointUntil\n *\n * @param {BoundaryPoint} point\n * @param {Function} pred\n * @return {BoundaryPoint}\n */\n\n\nfunction nextPointUntil(point, pred) {\n  while (point) {\n    if (pred(point)) {\n      return point;\n    }\n\n    point = dom_nextPoint(point);\n  }\n\n  return null;\n}\n/**\n * returns whether point has character or not.\n *\n * @param {Point} point\n * @return {Boolean}\n */\n\n\nfunction isCharPoint(point) {\n  if (!isText(point.node)) {\n    return false;\n  }\n\n  var ch = point.node.nodeValue.charAt(point.offset - 1);\n  return ch && ch !== ' ' && ch !== NBSP_CHAR;\n}\n/**\n * returns whether point has space or not.\n *\n * @param {Point} point\n * @return {Boolean}\n */\n\n\nfunction isSpacePoint(point) {\n  if (!isText(point.node)) {\n    return false;\n  }\n\n  var ch = point.node.nodeValue.charAt(point.offset - 1);\n  return ch === ' ' || ch === NBSP_CHAR;\n}\n/**\n * @method walkPoint\n *\n * @param {BoundaryPoint} startPoint\n * @param {BoundaryPoint} endPoint\n * @param {Function} handler\n * @param {Boolean} isSkipInnerOffset\n */\n\n\nfunction walkPoint(startPoint, endPoint, handler, isSkipInnerOffset) {\n  var point = startPoint;\n\n  while (point) {\n    handler(point);\n\n    if (isSamePoint(point, endPoint)) {\n      break;\n    }\n\n    var isSkipOffset = isSkipInnerOffset && startPoint.node !== point.node && endPoint.node !== point.node;\n    point = nextPointWithEmptyNode(point, isSkipOffset);\n  }\n}\n/**\n * @method makeOffsetPath\n *\n * return offsetPath(array of offset) from ancestor\n *\n * @param {Node} ancestor - ancestor node\n * @param {Node} node\n */\n\n\nfunction makeOffsetPath(ancestor, node) {\n  var ancestors = listAncestor(node, func.eq(ancestor));\n  return ancestors.map(dom_position).reverse();\n}\n/**\n * @method fromOffsetPath\n *\n * return element from offsetPath(array of offset)\n *\n * @param {Node} ancestor - ancestor node\n * @param {array} offsets - offsetPath\n */\n\n\nfunction fromOffsetPath(ancestor, offsets) {\n  var current = ancestor;\n\n  for (var i = 0, len = offsets.length; i < len; i++) {\n    if (current.childNodes.length <= offsets[i]) {\n      current = current.childNodes[current.childNodes.length - 1];\n    } else {\n      current = current.childNodes[offsets[i]];\n    }\n  }\n\n  return current;\n}\n/**\n * @method splitNode\n *\n * split element or #text\n *\n * @param {BoundaryPoint} point\n * @param {Object} [options]\n * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n * @param {Boolean} [options.isDiscardEmptySplits] - default: false\n * @return {Node} right node of boundaryPoint\n */\n\n\nfunction splitNode(point, options) {\n  var isSkipPaddingBlankHTML = options && options.isSkipPaddingBlankHTML;\n  var isNotSplitEdgePoint = options && options.isNotSplitEdgePoint;\n  var isDiscardEmptySplits = options && options.isDiscardEmptySplits;\n\n  if (isDiscardEmptySplits) {\n    isSkipPaddingBlankHTML = true;\n  } // edge case\n\n\n  if (isEdgePoint(point) && (isText(point.node) || isNotSplitEdgePoint)) {\n    if (isLeftEdgePoint(point)) {\n      return point.node;\n    } else if (isRightEdgePoint(point)) {\n      return point.node.nextSibling;\n    }\n  } // split #text\n\n\n  if (isText(point.node)) {\n    return point.node.splitText(point.offset);\n  } else {\n    var childNode = point.node.childNodes[point.offset];\n    var clone = insertAfter(point.node.cloneNode(false), point.node);\n    appendChildNodes(clone, listNext(childNode));\n\n    if (!isSkipPaddingBlankHTML) {\n      paddingBlankHTML(point.node);\n      paddingBlankHTML(clone);\n    }\n\n    if (isDiscardEmptySplits) {\n      if (dom_isEmpty(point.node)) {\n        remove(point.node);\n      }\n\n      if (dom_isEmpty(clone)) {\n        remove(clone);\n        return point.node.nextSibling;\n      }\n    }\n\n    return clone;\n  }\n}\n/**\n * @method splitTree\n *\n * split tree by point\n *\n * @param {Node} root - split root\n * @param {BoundaryPoint} point\n * @param {Object} [options]\n * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n * @return {Node} right node of boundaryPoint\n */\n\n\nfunction splitTree(root, point, options) {\n  // ex) [#text, <span>, <p>]\n  var ancestors = listAncestor(point.node, func.eq(root));\n\n  if (!ancestors.length) {\n    return null;\n  } else if (ancestors.length === 1) {\n    return splitNode(point, options);\n  }\n\n  return ancestors.reduce(function (node, parent) {\n    if (node === point.node) {\n      node = splitNode(point, options);\n    }\n\n    return splitNode({\n      node: parent,\n      offset: node ? dom_position(node) : nodeLength(parent)\n    }, options);\n  });\n}\n/**\n * split point\n *\n * @param {Point} point\n * @param {Boolean} isInline\n * @return {Object}\n */\n\n\nfunction splitPoint(point, isInline) {\n  // find splitRoot, container\n  //  - inline: splitRoot is a child of paragraph\n  //  - block: splitRoot is a child of bodyContainer\n  var pred = isInline ? isPara : isBodyContainer;\n  var ancestors = listAncestor(point.node, pred);\n  var topAncestor = lists.last(ancestors) || point.node;\n  var splitRoot, container;\n\n  if (pred(topAncestor)) {\n    splitRoot = ancestors[ancestors.length - 2];\n    container = topAncestor;\n  } else {\n    splitRoot = topAncestor;\n    container = splitRoot.parentNode;\n  } // if splitRoot is exists, split with splitTree\n\n\n  var pivot = splitRoot && splitTree(splitRoot, point, {\n    isSkipPaddingBlankHTML: isInline,\n    isNotSplitEdgePoint: isInline\n  }); // if container is point.node, find pivot with point.offset\n\n  if (!pivot && container === point.node) {\n    pivot = point.node.childNodes[point.offset];\n  }\n\n  return {\n    rightNode: pivot,\n    container: container\n  };\n}\n\nfunction dom_create(nodeName) {\n  return document.createElement(nodeName);\n}\n\nfunction createText(text) {\n  return document.createTextNode(text);\n}\n/**\n * @method remove\n *\n * remove node, (isRemoveChild: remove child or not)\n *\n * @param {Node} node\n * @param {Boolean} isRemoveChild\n */\n\n\nfunction remove(node, isRemoveChild) {\n  if (!node || !node.parentNode) {\n    return;\n  }\n\n  if (node.removeNode) {\n    return node.removeNode(isRemoveChild);\n  }\n\n  var parent = node.parentNode;\n\n  if (!isRemoveChild) {\n    var nodes = [];\n\n    for (var i = 0, len = node.childNodes.length; i < len; i++) {\n      nodes.push(node.childNodes[i]);\n    }\n\n    for (var _i = 0, _len = nodes.length; _i < _len; _i++) {\n      parent.insertBefore(nodes[_i], node);\n    }\n  }\n\n  parent.removeChild(node);\n}\n/**\n * @method removeWhile\n *\n * @param {Node} node\n * @param {Function} pred\n */\n\n\nfunction removeWhile(node, pred) {\n  while (node) {\n    if (isEditable(node) || !pred(node)) {\n      break;\n    }\n\n    var parent = node.parentNode;\n    remove(node);\n    node = parent;\n  }\n}\n/**\n * @method replace\n *\n * replace node with provided nodeName\n *\n * @param {Node} node\n * @param {String} nodeName\n * @return {Node} - new node\n */\n\n\nfunction dom_replace(node, nodeName) {\n  if (node.nodeName.toUpperCase() === nodeName.toUpperCase()) {\n    return node;\n  }\n\n  var newNode = dom_create(nodeName);\n\n  if (node.style.cssText) {\n    newNode.style.cssText = node.style.cssText;\n  }\n\n  appendChildNodes(newNode, lists.from(node.childNodes));\n  insertAfter(newNode, node);\n  remove(node);\n  return newNode;\n}\n\nvar isTextarea = makePredByNodeName('TEXTAREA');\n/**\n * @param {jQuery} $node\n * @param {Boolean} [stripLinebreaks] - default: false\n */\n\nfunction dom_value($node, stripLinebreaks) {\n  var val = isTextarea($node[0]) ? $node.val() : $node.html();\n\n  if (stripLinebreaks) {\n    return val.replace(/[\\n\\r]/g, '');\n  }\n\n  return val;\n}\n/**\n * @method html\n *\n * get the HTML contents of node\n *\n * @param {jQuery} $node\n * @param {Boolean} [isNewlineOnBlock]\n */\n\n\nfunction dom_html($node, isNewlineOnBlock) {\n  var markup = dom_value($node);\n\n  if (isNewlineOnBlock) {\n    var regexTag = /<(\\/?)(\\b(?!!)[^>\\s]*)(.*?)(\\s*\\/?>)/g;\n    markup = markup.replace(regexTag, function (match, endSlash, name) {\n      name = name.toUpperCase();\n      var isEndOfInlineContainer = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name) && !!endSlash;\n      var isBlockNode = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);\n      return match + (isEndOfInlineContainer || isBlockNode ? '\\n' : '');\n    });\n    markup = markup.trim();\n  }\n\n  return markup;\n}\n\nfunction posFromPlaceholder(placeholder) {\n  var $placeholder = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(placeholder);\n  var pos = $placeholder.offset();\n  var height = $placeholder.outerHeight(true); // include margin\n\n  return {\n    left: pos.left,\n    top: pos.top + height\n  };\n}\n\nfunction attachEvents($node, events) {\n  Object.keys(events).forEach(function (key) {\n    $node.on(key, events[key]);\n  });\n}\n\nfunction detachEvents($node, events) {\n  Object.keys(events).forEach(function (key) {\n    $node.off(key, events[key]);\n  });\n}\n/**\n * @method isCustomStyleTag\n *\n * assert if a node contains a \"note-styletag\" class,\n * which implies that's a custom-made style tag node\n *\n * @param {Node} an HTML DOM node\n */\n\n\nfunction isCustomStyleTag(node) {\n  return node && !isText(node) && lists.contains(node.classList, 'note-styletag');\n}\n\n/* harmony default export */ var dom = ({\n  /** @property {String} NBSP_CHAR */\n  NBSP_CHAR: NBSP_CHAR,\n\n  /** @property {String} ZERO_WIDTH_NBSP_CHAR */\n  ZERO_WIDTH_NBSP_CHAR: ZERO_WIDTH_NBSP_CHAR,\n\n  /** @property {String} blank */\n  blank: blankHTML,\n\n  /** @property {String} emptyPara */\n  emptyPara: \"<p>\".concat(blankHTML, \"</p>\"),\n  makePredByNodeName: makePredByNodeName,\n  isEditable: isEditable,\n  isControlSizing: isControlSizing,\n  isText: isText,\n  isElement: isElement,\n  isVoid: isVoid,\n  isPara: isPara,\n  isPurePara: isPurePara,\n  isHeading: isHeading,\n  isInline: dom_isInline,\n  isBlock: func.not(dom_isInline),\n  isBodyInline: isBodyInline,\n  isBody: isBody,\n  isParaInline: isParaInline,\n  isPre: isPre,\n  isList: isList,\n  isTable: isTable,\n  isData: isData,\n  isCell: dom_isCell,\n  isBlockquote: isBlockquote,\n  isBodyContainer: isBodyContainer,\n  isAnchor: isAnchor,\n  isDiv: makePredByNodeName('DIV'),\n  isLi: isLi,\n  isBR: makePredByNodeName('BR'),\n  isSpan: makePredByNodeName('SPAN'),\n  isB: makePredByNodeName('B'),\n  isU: makePredByNodeName('U'),\n  isS: makePredByNodeName('S'),\n  isI: makePredByNodeName('I'),\n  isImg: makePredByNodeName('IMG'),\n  isTextarea: isTextarea,\n  deepestChildIsEmpty: deepestChildIsEmpty,\n  isEmpty: dom_isEmpty,\n  isEmptyAnchor: func.and(isAnchor, dom_isEmpty),\n  isClosestSibling: isClosestSibling,\n  withClosestSiblings: withClosestSiblings,\n  nodeLength: nodeLength,\n  isLeftEdgePoint: isLeftEdgePoint,\n  isRightEdgePoint: isRightEdgePoint,\n  isEdgePoint: isEdgePoint,\n  isLeftEdgeOf: dom_isLeftEdgeOf,\n  isRightEdgeOf: isRightEdgeOf,\n  isLeftEdgePointOf: isLeftEdgePointOf,\n  isRightEdgePointOf: isRightEdgePointOf,\n  prevPoint: dom_prevPoint,\n  nextPoint: dom_nextPoint,\n  nextPointWithEmptyNode: nextPointWithEmptyNode,\n  isSamePoint: isSamePoint,\n  isVisiblePoint: isVisiblePoint,\n  prevPointUntil: prevPointUntil,\n  nextPointUntil: nextPointUntil,\n  isCharPoint: isCharPoint,\n  isSpacePoint: isSpacePoint,\n  walkPoint: walkPoint,\n  ancestor: dom_ancestor,\n  singleChildAncestor: singleChildAncestor,\n  listAncestor: listAncestor,\n  lastAncestor: lastAncestor,\n  listNext: listNext,\n  listPrev: listPrev,\n  listDescendant: listDescendant,\n  commonAncestor: dom_commonAncestor,\n  wrap: wrap,\n  insertAfter: insertAfter,\n  appendChildNodes: appendChildNodes,\n  position: dom_position,\n  hasChildren: hasChildren,\n  makeOffsetPath: makeOffsetPath,\n  fromOffsetPath: fromOffsetPath,\n  splitTree: splitTree,\n  splitPoint: splitPoint,\n  create: dom_create,\n  createText: createText,\n  remove: remove,\n  removeWhile: removeWhile,\n  replace: dom_replace,\n  html: dom_html,\n  value: dom_value,\n  posFromPlaceholder: posFromPlaceholder,\n  attachEvents: attachEvents,\n  detachEvents: detachEvents,\n  isCustomStyleTag: isCustomStyleTag\n});\n// CONCATENATED MODULE: ./src/js/base/Context.js\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\nvar Context_Context = /*#__PURE__*/function () {\n  /**\n   * @param {jQuery} $note\n   * @param {Object} options\n   */\n  function Context($note, options) {\n    _classCallCheck(this, Context);\n\n    this.$note = $note;\n    this.memos = {};\n    this.modules = {};\n    this.layoutInfo = {};\n    this.options = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(true, {}, options); // init ui with options\n\n    external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui_template(this.options);\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.initialize();\n  }\n  /**\n   * create layout and initialize modules and other resources\n   */\n\n\n  _createClass(Context, [{\n    key: \"initialize\",\n    value: function initialize() {\n      this.layoutInfo = this.ui.createLayout(this.$note);\n\n      this._initialize();\n\n      this.$note.hide();\n      return this;\n    }\n    /**\n     * destroy modules and other resources and remove layout\n     */\n\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._destroy();\n\n      this.$note.removeData('summernote');\n      this.ui.removeLayout(this.$note, this.layoutInfo);\n    }\n    /**\n     * destory modules and other resources and initialize it again\n     */\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      var disabled = this.isDisabled();\n      this.code(dom.emptyPara);\n\n      this._destroy();\n\n      this._initialize();\n\n      if (disabled) {\n        this.disable();\n      }\n    }\n  }, {\n    key: \"_initialize\",\n    value: function _initialize() {\n      var _this = this;\n\n      // set own id\n      this.options.id = func.uniqueId(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.now()); // set default container for tooltips, popovers, and dialogs\n\n      this.options.container = this.options.container || this.layoutInfo.editor; // add optional buttons\n\n      var buttons = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend({}, this.options.buttons);\n      Object.keys(buttons).forEach(function (key) {\n        _this.memo('button.' + key, buttons[key]);\n      });\n      var modules = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend({}, this.options.modules, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.plugins || {}); // add and initialize modules\n\n      Object.keys(modules).forEach(function (key) {\n        _this.module(key, modules[key], true);\n      });\n      Object.keys(this.modules).forEach(function (key) {\n        _this.initializeModule(key);\n      });\n    }\n  }, {\n    key: \"_destroy\",\n    value: function _destroy() {\n      var _this2 = this;\n\n      // destroy modules with reversed order\n      Object.keys(this.modules).reverse().forEach(function (key) {\n        _this2.removeModule(key);\n      });\n      Object.keys(this.memos).forEach(function (key) {\n        _this2.removeMemo(key);\n      }); // trigger custom onDestroy callback\n\n      this.triggerEvent('destroy', this);\n    }\n  }, {\n    key: \"code\",\n    value: function code(html) {\n      var isActivated = this.invoke('codeview.isActivated');\n\n      if (html === undefined) {\n        this.invoke('codeview.sync');\n        return isActivated ? this.layoutInfo.codable.val() : this.layoutInfo.editable.html();\n      } else {\n        if (isActivated) {\n          this.invoke('codeview.sync', html);\n        } else {\n          this.layoutInfo.editable.html(html);\n        }\n\n        this.$note.val(html);\n        this.triggerEvent('change', html, this.layoutInfo.editable);\n      }\n    }\n  }, {\n    key: \"isDisabled\",\n    value: function isDisabled() {\n      return this.layoutInfo.editable.attr('contenteditable') === 'false';\n    }\n  }, {\n    key: \"enable\",\n    value: function enable() {\n      this.layoutInfo.editable.attr('contenteditable', true);\n      this.invoke('toolbar.activate', true);\n      this.triggerEvent('disable', false);\n      this.options.editing = true;\n    }\n  }, {\n    key: \"disable\",\n    value: function disable() {\n      // close codeview if codeview is opend\n      if (this.invoke('codeview.isActivated')) {\n        this.invoke('codeview.deactivate');\n      }\n\n      this.layoutInfo.editable.attr('contenteditable', false);\n      this.options.editing = false;\n      this.invoke('toolbar.deactivate', true);\n      this.triggerEvent('disable', true);\n    }\n  }, {\n    key: \"triggerEvent\",\n    value: function triggerEvent() {\n      var namespace = lists.head(arguments);\n      var args = lists.tail(lists.from(arguments));\n      var callback = this.options.callbacks[func.namespaceToCamel(namespace, 'on')];\n\n      if (callback) {\n        callback.apply(this.$note[0], args);\n      }\n\n      this.$note.trigger('summernote.' + namespace, args);\n    }\n  }, {\n    key: \"initializeModule\",\n    value: function initializeModule(key) {\n      var module = this.modules[key];\n      module.shouldInitialize = module.shouldInitialize || func.ok;\n\n      if (!module.shouldInitialize()) {\n        return;\n      } // initialize module\n\n\n      if (module.initialize) {\n        module.initialize();\n      } // attach events\n\n\n      if (module.events) {\n        dom.attachEvents(this.$note, module.events);\n      }\n    }\n  }, {\n    key: \"module\",\n    value: function module(key, ModuleClass, withoutIntialize) {\n      if (arguments.length === 1) {\n        return this.modules[key];\n      }\n\n      this.modules[key] = new ModuleClass(this);\n\n      if (!withoutIntialize) {\n        this.initializeModule(key);\n      }\n    }\n  }, {\n    key: \"removeModule\",\n    value: function removeModule(key) {\n      var module = this.modules[key];\n\n      if (module.shouldInitialize()) {\n        if (module.events) {\n          dom.detachEvents(this.$note, module.events);\n        }\n\n        if (module.destroy) {\n          module.destroy();\n        }\n      }\n\n      delete this.modules[key];\n    }\n  }, {\n    key: \"memo\",\n    value: function memo(key, obj) {\n      if (arguments.length === 1) {\n        return this.memos[key];\n      }\n\n      this.memos[key] = obj;\n    }\n  }, {\n    key: \"removeMemo\",\n    value: function removeMemo(key) {\n      if (this.memos[key] && this.memos[key].destroy) {\n        this.memos[key].destroy();\n      }\n\n      delete this.memos[key];\n    }\n    /**\n     * Some buttons need to change their visual style immediately once they get pressed\n     */\n\n  }, {\n    key: \"createInvokeHandlerAndUpdateState\",\n    value: function createInvokeHandlerAndUpdateState(namespace, value) {\n      var _this3 = this;\n\n      return function (event) {\n        _this3.createInvokeHandler(namespace, value)(event);\n\n        _this3.invoke('buttons.updateCurrentStyle');\n      };\n    }\n  }, {\n    key: \"createInvokeHandler\",\n    value: function createInvokeHandler(namespace, value) {\n      var _this4 = this;\n\n      return function (event) {\n        event.preventDefault();\n        var $target = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(event.target);\n\n        _this4.invoke(namespace, value || $target.closest('[data-value]').data('value'), $target);\n      };\n    }\n  }, {\n    key: \"invoke\",\n    value: function invoke() {\n      var namespace = lists.head(arguments);\n      var args = lists.tail(lists.from(arguments));\n      var splits = namespace.split('.');\n      var hasSeparator = splits.length > 1;\n      var moduleName = hasSeparator && lists.head(splits);\n      var methodName = hasSeparator ? lists.last(splits) : lists.head(splits);\n      var module = this.modules[moduleName || 'editor'];\n\n      if (!moduleName && this[methodName]) {\n        return this[methodName].apply(this, args);\n      } else if (module && module[methodName] && module.shouldInitialize()) {\n        return module[methodName].apply(module, args);\n      }\n    }\n  }]);\n\n  return Context;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/summernote.js\n\n\n\n\nexternal_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.fn.extend({\n  /**\n   * Summernote API\n   *\n   * @param {Object|String}\n   * @return {this}\n   */\n  summernote: function summernote() {\n    var type = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.type(lists.head(arguments));\n    var isExternalAPICalled = type === 'string';\n    var hasInitOptions = type === 'object';\n    var options = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend({}, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.options, hasInitOptions ? lists.head(arguments) : {}); // Update options\n\n    options.langInfo = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(true, {}, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.lang['en-US'], external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.lang[options.lang]);\n    options.icons = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(true, {}, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.options.icons, options.icons);\n    options.tooltip = options.tooltip === 'auto' ? !env.isSupportTouch : options.tooltip;\n    this.each(function (idx, note) {\n      var $note = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(note);\n\n      if (!$note.data('summernote')) {\n        var context = new Context_Context($note, options);\n        $note.data('summernote', context);\n        $note.data('summernote').triggerEvent('init', context.layoutInfo);\n      }\n    });\n    var $note = this.first();\n\n    if ($note.length) {\n      var context = $note.data('summernote');\n\n      if (isExternalAPICalled) {\n        return context.invoke.apply(context, lists.from(arguments));\n      } else if (options.focus) {\n        context.invoke('editor.focus');\n      }\n    }\n\n    return this;\n  }\n});\n// CONCATENATED MODULE: ./src/js/base/core/range.js\nfunction range_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction range_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction range_createClass(Constructor, protoProps, staticProps) { if (protoProps) range_defineProperties(Constructor.prototype, protoProps); if (staticProps) range_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n/**\n * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js\n *\n * @param {TextRange} textRange\n * @param {Boolean} isStart\n * @return {BoundaryPoint}\n *\n * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx\n */\n\nfunction textRangeToPoint(textRange, isStart) {\n  var container = textRange.parentElement();\n  var offset;\n  var tester = document.body.createTextRange();\n  var prevContainer;\n  var childNodes = lists.from(container.childNodes);\n\n  for (offset = 0; offset < childNodes.length; offset++) {\n    if (dom.isText(childNodes[offset])) {\n      continue;\n    }\n\n    tester.moveToElementText(childNodes[offset]);\n\n    if (tester.compareEndPoints('StartToStart', textRange) >= 0) {\n      break;\n    }\n\n    prevContainer = childNodes[offset];\n  }\n\n  if (offset !== 0 && dom.isText(childNodes[offset - 1])) {\n    var textRangeStart = document.body.createTextRange();\n    var curTextNode = null;\n    textRangeStart.moveToElementText(prevContainer || container);\n    textRangeStart.collapse(!prevContainer);\n    curTextNode = prevContainer ? prevContainer.nextSibling : container.firstChild;\n    var pointTester = textRange.duplicate();\n    pointTester.setEndPoint('StartToStart', textRangeStart);\n    var textCount = pointTester.text.replace(/[\\r\\n]/g, '').length;\n\n    while (textCount > curTextNode.nodeValue.length && curTextNode.nextSibling) {\n      textCount -= curTextNode.nodeValue.length;\n      curTextNode = curTextNode.nextSibling;\n    } // [workaround] enforce IE to re-reference curTextNode, hack\n\n\n    var dummy = curTextNode.nodeValue; // eslint-disable-line\n\n    if (isStart && curTextNode.nextSibling && dom.isText(curTextNode.nextSibling) && textCount === curTextNode.nodeValue.length) {\n      textCount -= curTextNode.nodeValue.length;\n      curTextNode = curTextNode.nextSibling;\n    }\n\n    container = curTextNode;\n    offset = textCount;\n  }\n\n  return {\n    cont: container,\n    offset: offset\n  };\n}\n/**\n * return TextRange from boundary point (inspired by google closure-library)\n * @param {BoundaryPoint} point\n * @return {TextRange}\n */\n\n\nfunction pointToTextRange(point) {\n  var textRangeInfo = function textRangeInfo(container, offset) {\n    var node, isCollapseToStart;\n\n    if (dom.isText(container)) {\n      var prevTextNodes = dom.listPrev(container, func.not(dom.isText));\n      var prevContainer = lists.last(prevTextNodes).previousSibling;\n      node = prevContainer || container.parentNode;\n      offset += lists.sum(lists.tail(prevTextNodes), dom.nodeLength);\n      isCollapseToStart = !prevContainer;\n    } else {\n      node = container.childNodes[offset] || container;\n\n      if (dom.isText(node)) {\n        return textRangeInfo(node, 0);\n      }\n\n      offset = 0;\n      isCollapseToStart = false;\n    }\n\n    return {\n      node: node,\n      collapseToStart: isCollapseToStart,\n      offset: offset\n    };\n  };\n\n  var textRange = document.body.createTextRange();\n  var info = textRangeInfo(point.node, point.offset);\n  textRange.moveToElementText(info.node);\n  textRange.collapse(info.collapseToStart);\n  textRange.moveStart('character', info.offset);\n  return textRange;\n}\n/**\n   * Wrapped Range\n   *\n   * @constructor\n   * @param {Node} sc - start container\n   * @param {Number} so - start offset\n   * @param {Node} ec - end container\n   * @param {Number} eo - end offset\n   */\n\n\nvar range_WrappedRange = /*#__PURE__*/function () {\n  function WrappedRange(sc, so, ec, eo) {\n    range_classCallCheck(this, WrappedRange);\n\n    this.sc = sc;\n    this.so = so;\n    this.ec = ec;\n    this.eo = eo; // isOnEditable: judge whether range is on editable or not\n\n    this.isOnEditable = this.makeIsOn(dom.isEditable); // isOnList: judge whether range is on list node or not\n\n    this.isOnList = this.makeIsOn(dom.isList); // isOnAnchor: judge whether range is on anchor node or not\n\n    this.isOnAnchor = this.makeIsOn(dom.isAnchor); // isOnCell: judge whether range is on cell node or not\n\n    this.isOnCell = this.makeIsOn(dom.isCell); // isOnData: judge whether range is on data node or not\n\n    this.isOnData = this.makeIsOn(dom.isData);\n  } // nativeRange: get nativeRange from sc, so, ec, eo\n\n\n  range_createClass(WrappedRange, [{\n    key: \"nativeRange\",\n    value: function nativeRange() {\n      if (env.isW3CRangeSupport) {\n        var w3cRange = document.createRange();\n        w3cRange.setStart(this.sc, this.so);\n        w3cRange.setEnd(this.ec, this.eo);\n        return w3cRange;\n      } else {\n        var textRange = pointToTextRange({\n          node: this.sc,\n          offset: this.so\n        });\n        textRange.setEndPoint('EndToEnd', pointToTextRange({\n          node: this.ec,\n          offset: this.eo\n        }));\n        return textRange;\n      }\n    }\n  }, {\n    key: \"getPoints\",\n    value: function getPoints() {\n      return {\n        sc: this.sc,\n        so: this.so,\n        ec: this.ec,\n        eo: this.eo\n      };\n    }\n  }, {\n    key: \"getStartPoint\",\n    value: function getStartPoint() {\n      return {\n        node: this.sc,\n        offset: this.so\n      };\n    }\n  }, {\n    key: \"getEndPoint\",\n    value: function getEndPoint() {\n      return {\n        node: this.ec,\n        offset: this.eo\n      };\n    }\n    /**\n     * select update visible range\n     */\n\n  }, {\n    key: \"select\",\n    value: function select() {\n      var nativeRng = this.nativeRange();\n\n      if (env.isW3CRangeSupport) {\n        var selection = document.getSelection();\n\n        if (selection.rangeCount > 0) {\n          selection.removeAllRanges();\n        }\n\n        selection.addRange(nativeRng);\n      } else {\n        nativeRng.select();\n      }\n\n      return this;\n    }\n    /**\n     * Moves the scrollbar to start container(sc) of current range\n     *\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"scrollIntoView\",\n    value: function scrollIntoView(container) {\n      var height = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(container).height();\n\n      if (container.scrollTop + height < this.sc.offsetTop) {\n        container.scrollTop += Math.abs(container.scrollTop + height - this.sc.offsetTop);\n      }\n\n      return this;\n    }\n    /**\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"normalize\",\n    value: function normalize() {\n      /**\n       * @param {BoundaryPoint} point\n       * @param {Boolean} isLeftToRight - true: prefer to choose right node\n       *                                - false: prefer to choose left node\n       * @return {BoundaryPoint}\n       */\n      var getVisiblePoint = function getVisiblePoint(point, isLeftToRight) {\n        if (!point) {\n          return point;\n        } // Just use the given point [XXX:Adhoc]\n        //  - case 01. if the point is on the middle of the node\n        //  - case 02. if the point is on the right edge and prefer to choose left node\n        //  - case 03. if the point is on the left edge and prefer to choose right node\n        //  - case 04. if the point is on the right edge and prefer to choose right node but the node is void\n        //  - case 05. if the point is on the left edge and prefer to choose left node but the node is void\n        //  - case 06. if the point is on the block node and there is no children\n\n\n        if (dom.isVisiblePoint(point)) {\n          if (!dom.isEdgePoint(point) || dom.isRightEdgePoint(point) && !isLeftToRight || dom.isLeftEdgePoint(point) && isLeftToRight || dom.isRightEdgePoint(point) && isLeftToRight && dom.isVoid(point.node.nextSibling) || dom.isLeftEdgePoint(point) && !isLeftToRight && dom.isVoid(point.node.previousSibling) || dom.isBlock(point.node) && dom.isEmpty(point.node)) {\n            return point;\n          }\n        } // point on block's edge\n\n\n        var block = dom.ancestor(point.node, dom.isBlock);\n        var hasRightNode = false;\n\n        if (!hasRightNode) {\n          var prevPoint = dom.prevPoint(point) || {\n            node: null\n          };\n          hasRightNode = (dom.isLeftEdgePointOf(point, block) || dom.isVoid(prevPoint.node)) && !isLeftToRight;\n        }\n\n        var hasLeftNode = false;\n\n        if (!hasLeftNode) {\n          var _nextPoint = dom.nextPoint(point) || {\n            node: null\n          };\n\n          hasLeftNode = (dom.isRightEdgePointOf(point, block) || dom.isVoid(_nextPoint.node)) && isLeftToRight;\n        }\n\n        if (hasRightNode || hasLeftNode) {\n          // returns point already on visible point\n          if (dom.isVisiblePoint(point)) {\n            return point;\n          } // reverse direction\n\n\n          isLeftToRight = !isLeftToRight;\n        }\n\n        var nextPoint = isLeftToRight ? dom.nextPointUntil(dom.nextPoint(point), dom.isVisiblePoint) : dom.prevPointUntil(dom.prevPoint(point), dom.isVisiblePoint);\n        return nextPoint || point;\n      };\n\n      var endPoint = getVisiblePoint(this.getEndPoint(), false);\n      var startPoint = this.isCollapsed() ? endPoint : getVisiblePoint(this.getStartPoint(), true);\n      return new WrappedRange(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);\n    }\n    /**\n     * returns matched nodes on range\n     *\n     * @param {Function} [pred] - predicate function\n     * @param {Object} [options]\n     * @param {Boolean} [options.includeAncestor]\n     * @param {Boolean} [options.fullyContains]\n     * @return {Node[]}\n     */\n\n  }, {\n    key: \"nodes\",\n    value: function nodes(pred, options) {\n      pred = pred || func.ok;\n      var includeAncestor = options && options.includeAncestor;\n      var fullyContains = options && options.fullyContains; // TODO compare points and sort\n\n      var startPoint = this.getStartPoint();\n      var endPoint = this.getEndPoint();\n      var nodes = [];\n      var leftEdgeNodes = [];\n      dom.walkPoint(startPoint, endPoint, function (point) {\n        if (dom.isEditable(point.node)) {\n          return;\n        }\n\n        var node;\n\n        if (fullyContains) {\n          if (dom.isLeftEdgePoint(point)) {\n            leftEdgeNodes.push(point.node);\n          }\n\n          if (dom.isRightEdgePoint(point) && lists.contains(leftEdgeNodes, point.node)) {\n            node = point.node;\n          }\n        } else if (includeAncestor) {\n          node = dom.ancestor(point.node, pred);\n        } else {\n          node = point.node;\n        }\n\n        if (node && pred(node)) {\n          nodes.push(node);\n        }\n      }, true);\n      return lists.unique(nodes);\n    }\n    /**\n     * returns commonAncestor of range\n     * @return {Element} - commonAncestor\n     */\n\n  }, {\n    key: \"commonAncestor\",\n    value: function commonAncestor() {\n      return dom.commonAncestor(this.sc, this.ec);\n    }\n    /**\n     * returns expanded range by pred\n     *\n     * @param {Function} pred - predicate function\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"expand\",\n    value: function expand(pred) {\n      var startAncestor = dom.ancestor(this.sc, pred);\n      var endAncestor = dom.ancestor(this.ec, pred);\n\n      if (!startAncestor && !endAncestor) {\n        return new WrappedRange(this.sc, this.so, this.ec, this.eo);\n      }\n\n      var boundaryPoints = this.getPoints();\n\n      if (startAncestor) {\n        boundaryPoints.sc = startAncestor;\n        boundaryPoints.so = 0;\n      }\n\n      if (endAncestor) {\n        boundaryPoints.ec = endAncestor;\n        boundaryPoints.eo = dom.nodeLength(endAncestor);\n      }\n\n      return new WrappedRange(boundaryPoints.sc, boundaryPoints.so, boundaryPoints.ec, boundaryPoints.eo);\n    }\n    /**\n     * @param {Boolean} isCollapseToStart\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"collapse\",\n    value: function collapse(isCollapseToStart) {\n      if (isCollapseToStart) {\n        return new WrappedRange(this.sc, this.so, this.sc, this.so);\n      } else {\n        return new WrappedRange(this.ec, this.eo, this.ec, this.eo);\n      }\n    }\n    /**\n     * splitText on range\n     */\n\n  }, {\n    key: \"splitText\",\n    value: function splitText() {\n      var isSameContainer = this.sc === this.ec;\n      var boundaryPoints = this.getPoints();\n\n      if (dom.isText(this.ec) && !dom.isEdgePoint(this.getEndPoint())) {\n        this.ec.splitText(this.eo);\n      }\n\n      if (dom.isText(this.sc) && !dom.isEdgePoint(this.getStartPoint())) {\n        boundaryPoints.sc = this.sc.splitText(this.so);\n        boundaryPoints.so = 0;\n\n        if (isSameContainer) {\n          boundaryPoints.ec = boundaryPoints.sc;\n          boundaryPoints.eo = this.eo - this.so;\n        }\n      }\n\n      return new WrappedRange(boundaryPoints.sc, boundaryPoints.so, boundaryPoints.ec, boundaryPoints.eo);\n    }\n    /**\n     * delete contents on range\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"deleteContents\",\n    value: function deleteContents() {\n      if (this.isCollapsed()) {\n        return this;\n      }\n\n      var rng = this.splitText();\n      var nodes = rng.nodes(null, {\n        fullyContains: true\n      }); // find new cursor point\n\n      var point = dom.prevPointUntil(rng.getStartPoint(), function (point) {\n        return !lists.contains(nodes, point.node);\n      });\n      var emptyParents = [];\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(nodes, function (idx, node) {\n        // find empty parents\n        var parent = node.parentNode;\n\n        if (point.node !== parent && dom.nodeLength(parent) === 1) {\n          emptyParents.push(parent);\n        }\n\n        dom.remove(node, false);\n      }); // remove empty parents\n\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(emptyParents, function (idx, node) {\n        dom.remove(node, false);\n      });\n      return new WrappedRange(point.node, point.offset, point.node, point.offset).normalize();\n    }\n    /**\n     * makeIsOn: return isOn(pred) function\n     */\n\n  }, {\n    key: \"makeIsOn\",\n    value: function makeIsOn(pred) {\n      return function () {\n        var ancestor = dom.ancestor(this.sc, pred);\n        return !!ancestor && ancestor === dom.ancestor(this.ec, pred);\n      };\n    }\n    /**\n     * @param {Function} pred\n     * @return {Boolean}\n     */\n\n  }, {\n    key: \"isLeftEdgeOf\",\n    value: function isLeftEdgeOf(pred) {\n      if (!dom.isLeftEdgePoint(this.getStartPoint())) {\n        return false;\n      }\n\n      var node = dom.ancestor(this.sc, pred);\n      return node && dom.isLeftEdgeOf(this.sc, node);\n    }\n    /**\n     * returns whether range was collapsed or not\n     */\n\n  }, {\n    key: \"isCollapsed\",\n    value: function isCollapsed() {\n      return this.sc === this.ec && this.so === this.eo;\n    }\n    /**\n     * wrap inline nodes which children of body with paragraph\n     *\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"wrapBodyInlineWithPara\",\n    value: function wrapBodyInlineWithPara() {\n      if (dom.isBodyContainer(this.sc) && dom.isEmpty(this.sc)) {\n        this.sc.innerHTML = dom.emptyPara;\n        return new WrappedRange(this.sc.firstChild, 0, this.sc.firstChild, 0);\n      }\n      /**\n       * [workaround] firefox often create range on not visible point. so normalize here.\n       *  - firefox: |<p>text</p>|\n       *  - chrome: <p>|text|</p>\n       */\n\n\n      var rng = this.normalize();\n\n      if (dom.isParaInline(this.sc) || dom.isPara(this.sc)) {\n        return rng;\n      } // find inline top ancestor\n\n\n      var topAncestor;\n\n      if (dom.isInline(rng.sc)) {\n        var ancestors = dom.listAncestor(rng.sc, func.not(dom.isInline));\n        topAncestor = lists.last(ancestors);\n\n        if (!dom.isInline(topAncestor)) {\n          topAncestor = ancestors[ancestors.length - 2] || rng.sc.childNodes[rng.so];\n        }\n      } else {\n        topAncestor = rng.sc.childNodes[rng.so > 0 ? rng.so - 1 : 0];\n      }\n\n      if (topAncestor) {\n        // siblings not in paragraph\n        var inlineSiblings = dom.listPrev(topAncestor, dom.isParaInline).reverse();\n        inlineSiblings = inlineSiblings.concat(dom.listNext(topAncestor.nextSibling, dom.isParaInline)); // wrap with paragraph\n\n        if (inlineSiblings.length) {\n          var para = dom.wrap(lists.head(inlineSiblings), 'p');\n          dom.appendChildNodes(para, lists.tail(inlineSiblings));\n        }\n      }\n\n      return this.normalize();\n    }\n    /**\n     * insert node at current cursor\n     *\n     * @param {Node} node\n     * @return {Node}\n     */\n\n  }, {\n    key: \"insertNode\",\n    value: function insertNode(node) {\n      var rng = this;\n\n      if (dom.isText(node) || dom.isInline(node)) {\n        rng = this.wrapBodyInlineWithPara().deleteContents();\n      }\n\n      var info = dom.splitPoint(rng.getStartPoint(), dom.isInline(node));\n\n      if (info.rightNode) {\n        info.rightNode.parentNode.insertBefore(node, info.rightNode);\n\n        if (dom.isEmpty(info.rightNode) && dom.isPara(node)) {\n          info.rightNode.parentNode.removeChild(info.rightNode);\n        }\n      } else {\n        info.container.appendChild(node);\n      }\n\n      return node;\n    }\n    /**\n     * insert html at current cursor\n     */\n\n  }, {\n    key: \"pasteHTML\",\n    value: function pasteHTML(markup) {\n      markup = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.trim(markup);\n      var contentsContainer = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div></div>').html(markup)[0];\n      var childNodes = lists.from(contentsContainer.childNodes); // const rng = this.wrapBodyInlineWithPara().deleteContents();\n\n      var rng = this;\n      var reversed = false;\n\n      if (rng.so >= 0) {\n        childNodes = childNodes.reverse();\n        reversed = true;\n      }\n\n      childNodes = childNodes.map(function (childNode) {\n        return rng.insertNode(childNode);\n      });\n\n      if (reversed) {\n        childNodes = childNodes.reverse();\n      }\n\n      return childNodes;\n    }\n    /**\n     * returns text in range\n     *\n     * @return {String}\n     */\n\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var nativeRng = this.nativeRange();\n      return env.isW3CRangeSupport ? nativeRng.toString() : nativeRng.text;\n    }\n    /**\n     * returns range for word before cursor\n     *\n     * @param {Boolean} [findAfter] - find after cursor, default: false\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"getWordRange\",\n    value: function getWordRange(findAfter) {\n      var endPoint = this.getEndPoint();\n\n      if (!dom.isCharPoint(endPoint)) {\n        return this;\n      }\n\n      var startPoint = dom.prevPointUntil(endPoint, function (point) {\n        return !dom.isCharPoint(point);\n      });\n\n      if (findAfter) {\n        endPoint = dom.nextPointUntil(endPoint, function (point) {\n          return !dom.isCharPoint(point);\n        });\n      }\n\n      return new WrappedRange(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);\n    }\n    /**\n     * returns range for words before cursor\n     *\n     * @param {Boolean} [findAfter] - find after cursor, default: false\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"getWordsRange\",\n    value: function getWordsRange(findAfter) {\n      var endPoint = this.getEndPoint();\n\n      var isNotTextPoint = function isNotTextPoint(point) {\n        return !dom.isCharPoint(point) && !dom.isSpacePoint(point);\n      };\n\n      if (isNotTextPoint(endPoint)) {\n        return this;\n      }\n\n      var startPoint = dom.prevPointUntil(endPoint, isNotTextPoint);\n\n      if (findAfter) {\n        endPoint = dom.nextPointUntil(endPoint, isNotTextPoint);\n      }\n\n      return new WrappedRange(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);\n    }\n    /**\n     * returns range for words before cursor that match with a Regex\n     *\n     * example:\n     *  range: 'hi @Peter Pan'\n     *  regex: '/@[a-z ]+/i'\n     *  return range: '@Peter Pan'\n     *\n     * @param {RegExp} [regex]\n     * @return {WrappedRange|null}\n     */\n\n  }, {\n    key: \"getWordsMatchRange\",\n    value: function getWordsMatchRange(regex) {\n      var endPoint = this.getEndPoint();\n      var startPoint = dom.prevPointUntil(endPoint, function (point) {\n        if (!dom.isCharPoint(point) && !dom.isSpacePoint(point)) {\n          return true;\n        }\n\n        var rng = new WrappedRange(point.node, point.offset, endPoint.node, endPoint.offset);\n        var result = regex.exec(rng.toString());\n        return result && result.index === 0;\n      });\n      var rng = new WrappedRange(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);\n      var text = rng.toString();\n      var result = regex.exec(text);\n\n      if (result && result[0].length === text.length) {\n        return rng;\n      } else {\n        return null;\n      }\n    }\n    /**\n     * create offsetPath bookmark\n     *\n     * @param {Node} editable\n     */\n\n  }, {\n    key: \"bookmark\",\n    value: function bookmark(editable) {\n      return {\n        s: {\n          path: dom.makeOffsetPath(editable, this.sc),\n          offset: this.so\n        },\n        e: {\n          path: dom.makeOffsetPath(editable, this.ec),\n          offset: this.eo\n        }\n      };\n    }\n    /**\n     * create offsetPath bookmark base on paragraph\n     *\n     * @param {Node[]} paras\n     */\n\n  }, {\n    key: \"paraBookmark\",\n    value: function paraBookmark(paras) {\n      return {\n        s: {\n          path: lists.tail(dom.makeOffsetPath(lists.head(paras), this.sc)),\n          offset: this.so\n        },\n        e: {\n          path: lists.tail(dom.makeOffsetPath(lists.last(paras), this.ec)),\n          offset: this.eo\n        }\n      };\n    }\n    /**\n     * getClientRects\n     * @return {Rect[]}\n     */\n\n  }, {\n    key: \"getClientRects\",\n    value: function getClientRects() {\n      var nativeRng = this.nativeRange();\n      return nativeRng.getClientRects();\n    }\n  }]);\n\n  return WrappedRange;\n}();\n/**\n * Data structure\n *  * BoundaryPoint: a point of dom tree\n *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range\n *\n * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position\n */\n\n\n/* harmony default export */ var range = ({\n  /**\n   * create Range Object From arguments or Browser Selection\n   *\n   * @param {Node} sc - start container\n   * @param {Number} so - start offset\n   * @param {Node} ec - end container\n   * @param {Number} eo - end offset\n   * @return {WrappedRange}\n   */\n  create: function create(sc, so, ec, eo) {\n    if (arguments.length === 4) {\n      return new range_WrappedRange(sc, so, ec, eo);\n    } else if (arguments.length === 2) {\n      // collapsed\n      ec = sc;\n      eo = so;\n      return new range_WrappedRange(sc, so, ec, eo);\n    } else {\n      var wrappedRange = this.createFromSelection();\n\n      if (!wrappedRange && arguments.length === 1) {\n        var bodyElement = arguments[0];\n\n        if (dom.isEditable(bodyElement)) {\n          bodyElement = bodyElement.lastChild;\n        }\n\n        return this.createFromBodyElement(bodyElement, dom.emptyPara === arguments[0].innerHTML);\n      }\n\n      return wrappedRange;\n    }\n  },\n  createFromBodyElement: function createFromBodyElement(bodyElement) {\n    var isCollapseToStart = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var wrappedRange = this.createFromNode(bodyElement);\n    return wrappedRange.collapse(isCollapseToStart);\n  },\n  createFromSelection: function createFromSelection() {\n    var sc, so, ec, eo;\n\n    if (env.isW3CRangeSupport) {\n      var selection = document.getSelection();\n\n      if (!selection || selection.rangeCount === 0) {\n        return null;\n      } else if (dom.isBody(selection.anchorNode)) {\n        // Firefox: returns entire body as range on initialization.\n        // We won't never need it.\n        return null;\n      }\n\n      var nativeRng = selection.getRangeAt(0);\n      sc = nativeRng.startContainer;\n      so = nativeRng.startOffset;\n      ec = nativeRng.endContainer;\n      eo = nativeRng.endOffset;\n    } else {\n      // IE8: TextRange\n      var textRange = document.selection.createRange();\n      var textRangeEnd = textRange.duplicate();\n      textRangeEnd.collapse(false);\n      var textRangeStart = textRange;\n      textRangeStart.collapse(true);\n      var startPoint = textRangeToPoint(textRangeStart, true);\n      var endPoint = textRangeToPoint(textRangeEnd, false); // same visible point case: range was collapsed.\n\n      if (dom.isText(startPoint.node) && dom.isLeftEdgePoint(startPoint) && dom.isTextNode(endPoint.node) && dom.isRightEdgePoint(endPoint) && endPoint.node.nextSibling === startPoint.node) {\n        startPoint = endPoint;\n      }\n\n      sc = startPoint.cont;\n      so = startPoint.offset;\n      ec = endPoint.cont;\n      eo = endPoint.offset;\n    }\n\n    return new range_WrappedRange(sc, so, ec, eo);\n  },\n\n  /**\n   * @method\n   *\n   * create WrappedRange from node\n   *\n   * @param {Node} node\n   * @return {WrappedRange}\n   */\n  createFromNode: function createFromNode(node) {\n    var sc = node;\n    var so = 0;\n    var ec = node;\n    var eo = dom.nodeLength(ec); // browsers can't target a picture or void node\n\n    if (dom.isVoid(sc)) {\n      so = dom.listPrev(sc).length - 1;\n      sc = sc.parentNode;\n    }\n\n    if (dom.isBR(ec)) {\n      eo = dom.listPrev(ec).length - 1;\n      ec = ec.parentNode;\n    } else if (dom.isVoid(ec)) {\n      eo = dom.listPrev(ec).length;\n      ec = ec.parentNode;\n    }\n\n    return this.create(sc, so, ec, eo);\n  },\n\n  /**\n   * create WrappedRange from node after position\n   *\n   * @param {Node} node\n   * @return {WrappedRange}\n   */\n  createFromNodeBefore: function createFromNodeBefore(node) {\n    return this.createFromNode(node).collapse(true);\n  },\n\n  /**\n   * create WrappedRange from node after position\n   *\n   * @param {Node} node\n   * @return {WrappedRange}\n   */\n  createFromNodeAfter: function createFromNodeAfter(node) {\n    return this.createFromNode(node).collapse();\n  },\n\n  /**\n   * @method\n   *\n   * create WrappedRange from bookmark\n   *\n   * @param {Node} editable\n   * @param {Object} bookmark\n   * @return {WrappedRange}\n   */\n  createFromBookmark: function createFromBookmark(editable, bookmark) {\n    var sc = dom.fromOffsetPath(editable, bookmark.s.path);\n    var so = bookmark.s.offset;\n    var ec = dom.fromOffsetPath(editable, bookmark.e.path);\n    var eo = bookmark.e.offset;\n    return new range_WrappedRange(sc, so, ec, eo);\n  },\n\n  /**\n   * @method\n   *\n   * create WrappedRange from paraBookmark\n   *\n   * @param {Object} bookmark\n   * @param {Node[]} paras\n   * @return {WrappedRange}\n   */\n  createFromParaBookmark: function createFromParaBookmark(bookmark, paras) {\n    var so = bookmark.s.offset;\n    var eo = bookmark.e.offset;\n    var sc = dom.fromOffsetPath(lists.head(paras), bookmark.s.path);\n    var ec = dom.fromOffsetPath(lists.last(paras), bookmark.e.path);\n    return new range_WrappedRange(sc, so, ec, eo);\n  }\n});\n// CONCATENATED MODULE: ./src/js/base/core/key.js\n\n\nvar KEY_MAP = {\n  'BACKSPACE': 8,\n  'TAB': 9,\n  'ENTER': 13,\n  'ESCAPE': 27,\n  'SPACE': 32,\n  'DELETE': 46,\n  // Arrow\n  'LEFT': 37,\n  'UP': 38,\n  'RIGHT': 39,\n  'DOWN': 40,\n  // Number: 0-9\n  'NUM0': 48,\n  'NUM1': 49,\n  'NUM2': 50,\n  'NUM3': 51,\n  'NUM4': 52,\n  'NUM5': 53,\n  'NUM6': 54,\n  'NUM7': 55,\n  'NUM8': 56,\n  // Alphabet: a-z\n  'B': 66,\n  'E': 69,\n  'I': 73,\n  'J': 74,\n  'K': 75,\n  'L': 76,\n  'R': 82,\n  'S': 83,\n  'U': 85,\n  'V': 86,\n  'Y': 89,\n  'Z': 90,\n  'SLASH': 191,\n  'LEFTBRACKET': 219,\n  'BACKSLASH': 220,\n  'RIGHTBRACKET': 221,\n  // Navigation\n  'HOME': 36,\n  'END': 35,\n  'PAGEUP': 33,\n  'PAGEDOWN': 34\n};\n/**\n * @class core.key\n *\n * Object for keycodes.\n *\n * @singleton\n * @alternateClassName key\n */\n\n/* harmony default export */ var core_key = ({\n  /**\n   * @method isEdit\n   *\n   * @param {Number} keyCode\n   * @return {Boolean}\n   */\n  isEdit: function isEdit(keyCode) {\n    return lists.contains([KEY_MAP.BACKSPACE, KEY_MAP.TAB, KEY_MAP.ENTER, KEY_MAP.SPACE, KEY_MAP.DELETE], keyCode);\n  },\n\n  /**\n   * @method isMove\n   *\n   * @param {Number} keyCode\n   * @return {Boolean}\n   */\n  isMove: function isMove(keyCode) {\n    return lists.contains([KEY_MAP.LEFT, KEY_MAP.UP, KEY_MAP.RIGHT, KEY_MAP.DOWN], keyCode);\n  },\n\n  /**\n   * @method isNavigation\n   *\n   * @param {Number} keyCode\n   * @return {Boolean}\n   */\n  isNavigation: function isNavigation(keyCode) {\n    return lists.contains([KEY_MAP.HOME, KEY_MAP.END, KEY_MAP.PAGEUP, KEY_MAP.PAGEDOWN], keyCode);\n  },\n\n  /**\n   * @property {Object} nameFromCode\n   * @property {String} nameFromCode.8 \"BACKSPACE\"\n   */\n  nameFromCode: func.invertObject(KEY_MAP),\n  code: KEY_MAP\n});\n// CONCATENATED MODULE: ./src/js/base/core/async.js\n\n/**\n * @method readFileAsDataURL\n *\n * read contents of file as representing URL\n *\n * @param {File} file\n * @return {Promise} - then: dataUrl\n */\n\nfunction readFileAsDataURL(file) {\n  return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.Deferred(function (deferred) {\n    external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(new FileReader(), {\n      onload: function onload(e) {\n        var dataURL = e.target.result;\n        deferred.resolve(dataURL);\n      },\n      onerror: function onerror(err) {\n        deferred.reject(err);\n      }\n    }).readAsDataURL(file);\n  }).promise();\n}\n/**\n * @method createImage\n *\n * create `<image>` from url string\n *\n * @param {String} url\n * @return {Promise} - then: $image\n */\n\nfunction createImage(url) {\n  return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.Deferred(function (deferred) {\n    var $img = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<img>');\n    $img.one('load', function () {\n      $img.off('error abort');\n      deferred.resolve($img);\n    }).one('error abort', function () {\n      $img.off('load').detach();\n      deferred.reject($img);\n    }).css({\n      display: 'none'\n    }).appendTo(document.body).attr('src', url);\n  }).promise();\n}\n// CONCATENATED MODULE: ./src/js/base/editing/History.js\nfunction History_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction History_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction History_createClass(Constructor, protoProps, staticProps) { if (protoProps) History_defineProperties(Constructor.prototype, protoProps); if (staticProps) History_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar History_History = /*#__PURE__*/function () {\n  function History(context) {\n    History_classCallCheck(this, History);\n\n    this.stack = [];\n    this.stackOffset = -1;\n    this.context = context;\n    this.$editable = context.layoutInfo.editable;\n    this.editable = this.$editable[0];\n  }\n\n  History_createClass(History, [{\n    key: \"makeSnapshot\",\n    value: function makeSnapshot() {\n      var rng = range.create(this.editable);\n      var emptyBookmark = {\n        s: {\n          path: [],\n          offset: 0\n        },\n        e: {\n          path: [],\n          offset: 0\n        }\n      };\n      return {\n        contents: this.$editable.html(),\n        bookmark: rng && rng.isOnEditable() ? rng.bookmark(this.editable) : emptyBookmark\n      };\n    }\n  }, {\n    key: \"applySnapshot\",\n    value: function applySnapshot(snapshot) {\n      if (snapshot.contents !== null) {\n        this.$editable.html(snapshot.contents);\n      }\n\n      if (snapshot.bookmark !== null) {\n        range.createFromBookmark(this.editable, snapshot.bookmark).select();\n      }\n    }\n    /**\n    * @method rewind\n    * Rewinds the history stack back to the first snapshot taken.\n    * Leaves the stack intact, so that \"Redo\" can still be used.\n    */\n\n  }, {\n    key: \"rewind\",\n    value: function rewind() {\n      // Create snap shot if not yet recorded\n      if (this.$editable.html() !== this.stack[this.stackOffset].contents) {\n        this.recordUndo();\n      } // Return to the first available snapshot.\n\n\n      this.stackOffset = 0; // Apply that snapshot.\n\n      this.applySnapshot(this.stack[this.stackOffset]);\n    }\n    /**\n    *  @method commit\n    *  Resets history stack, but keeps current editor's content.\n    */\n\n  }, {\n    key: \"commit\",\n    value: function commit() {\n      // Clear the stack.\n      this.stack = []; // Restore stackOffset to its original value.\n\n      this.stackOffset = -1; // Record our first snapshot (of nothing).\n\n      this.recordUndo();\n    }\n    /**\n    * @method reset\n    * Resets the history stack completely; reverting to an empty editor.\n    */\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      // Clear the stack.\n      this.stack = []; // Restore stackOffset to its original value.\n\n      this.stackOffset = -1; // Clear the editable area.\n\n      this.$editable.html(''); // Record our first snapshot (of nothing).\n\n      this.recordUndo();\n    }\n    /**\n     * undo\n     */\n\n  }, {\n    key: \"undo\",\n    value: function undo() {\n      // Create snap shot if not yet recorded\n      if (this.$editable.html() !== this.stack[this.stackOffset].contents) {\n        this.recordUndo();\n      }\n\n      if (this.stackOffset > 0) {\n        this.stackOffset--;\n        this.applySnapshot(this.stack[this.stackOffset]);\n      }\n    }\n    /**\n     * redo\n     */\n\n  }, {\n    key: \"redo\",\n    value: function redo() {\n      if (this.stack.length - 1 > this.stackOffset) {\n        this.stackOffset++;\n        this.applySnapshot(this.stack[this.stackOffset]);\n      }\n    }\n    /**\n     * recorded undo\n     */\n\n  }, {\n    key: \"recordUndo\",\n    value: function recordUndo() {\n      this.stackOffset++; // Wash out stack after stackOffset\n\n      if (this.stack.length > this.stackOffset) {\n        this.stack = this.stack.slice(0, this.stackOffset);\n      } // Create new snapshot and push it to the end\n\n\n      this.stack.push(this.makeSnapshot()); // If the stack size reachs to the limit, then slice it\n\n      if (this.stack.length > this.context.options.historyLimit) {\n        this.stack.shift();\n        this.stackOffset -= 1;\n      }\n    }\n  }]);\n\n  return History;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/editing/Style.js\nfunction Style_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Style_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Style_createClass(Constructor, protoProps, staticProps) { if (protoProps) Style_defineProperties(Constructor.prototype, protoProps); if (staticProps) Style_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\nvar Style_Style = /*#__PURE__*/function () {\n  function Style() {\n    Style_classCallCheck(this, Style);\n  }\n\n  Style_createClass(Style, [{\n    key: \"jQueryCSS\",\n\n    /**\n     * @method jQueryCSS\n     *\n     * [workaround] for old jQuery\n     * passing an array of style properties to .css()\n     * will result in an object of property-value pairs.\n     * (compability with version < 1.9)\n     *\n     * @private\n     * @param  {jQuery} $obj\n     * @param  {Array} propertyNames - An array of one or more CSS properties.\n     * @return {Object}\n     */\n    value: function jQueryCSS($obj, propertyNames) {\n      if (env.jqueryVersion < 1.9) {\n        var result = {};\n        external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(propertyNames, function (idx, propertyName) {\n          result[propertyName] = $obj.css(propertyName);\n        });\n        return result;\n      }\n\n      return $obj.css(propertyNames);\n    }\n    /**\n     * returns style object from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */\n\n  }, {\n    key: \"fromNode\",\n    value: function fromNode($node) {\n      var properties = ['font-family', 'font-size', 'text-align', 'list-style-type', 'line-height'];\n      var styleInfo = this.jQueryCSS($node, properties) || {};\n      var fontSize = $node[0].style.fontSize || styleInfo['font-size'];\n      styleInfo['font-size'] = parseInt(fontSize, 10);\n      styleInfo['font-size-unit'] = fontSize.match(/[a-z%]+$/);\n      return styleInfo;\n    }\n    /**\n     * paragraph level style\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} styleInfo\n     */\n\n  }, {\n    key: \"stylePara\",\n    value: function stylePara(rng, styleInfo) {\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(rng.nodes(dom.isPara, {\n        includeAncestor: true\n      }), function (idx, para) {\n        external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(para).css(styleInfo);\n      });\n    }\n    /**\n     * insert and returns styleNodes on range.\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} [options] - options for styleNodes\n     * @param {String} [options.nodeName] - default: `SPAN`\n     * @param {Boolean} [options.expandClosestSibling] - default: `false`\n     * @param {Boolean} [options.onlyPartialContains] - default: `false`\n     * @return {Node[]}\n     */\n\n  }, {\n    key: \"styleNodes\",\n    value: function styleNodes(rng, options) {\n      rng = rng.splitText();\n      var nodeName = options && options.nodeName || 'SPAN';\n      var expandClosestSibling = !!(options && options.expandClosestSibling);\n      var onlyPartialContains = !!(options && options.onlyPartialContains);\n\n      if (rng.isCollapsed()) {\n        return [rng.insertNode(dom.create(nodeName))];\n      }\n\n      var pred = dom.makePredByNodeName(nodeName);\n      var nodes = rng.nodes(dom.isText, {\n        fullyContains: true\n      }).map(function (text) {\n        return dom.singleChildAncestor(text, pred) || dom.wrap(text, nodeName);\n      });\n\n      if (expandClosestSibling) {\n        if (onlyPartialContains) {\n          var nodesInRange = rng.nodes(); // compose with partial contains predication\n\n          pred = func.and(pred, function (node) {\n            return lists.contains(nodesInRange, node);\n          });\n        }\n\n        return nodes.map(function (node) {\n          var siblings = dom.withClosestSiblings(node, pred);\n          var head = lists.head(siblings);\n          var tails = lists.tail(siblings);\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(tails, function (idx, elem) {\n            dom.appendChildNodes(head, elem.childNodes);\n            dom.remove(elem);\n          });\n          return lists.head(siblings);\n        });\n      } else {\n        return nodes;\n      }\n    }\n    /**\n     * get current style on cursor\n     *\n     * @param {WrappedRange} rng\n     * @return {Object} - object contains style properties.\n     */\n\n  }, {\n    key: \"current\",\n    value: function current(rng) {\n      var $cont = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(!dom.isElement(rng.sc) ? rng.sc.parentNode : rng.sc);\n      var styleInfo = this.fromNode($cont); // document.queryCommandState for toggle state\n      // [workaround] prevent Firefox nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"\n\n      try {\n        styleInfo = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(styleInfo, {\n          'font-bold': document.queryCommandState('bold') ? 'bold' : 'normal',\n          'font-italic': document.queryCommandState('italic') ? 'italic' : 'normal',\n          'font-underline': document.queryCommandState('underline') ? 'underline' : 'normal',\n          'font-subscript': document.queryCommandState('subscript') ? 'subscript' : 'normal',\n          'font-superscript': document.queryCommandState('superscript') ? 'superscript' : 'normal',\n          'font-strikethrough': document.queryCommandState('strikethrough') ? 'strikethrough' : 'normal',\n          'font-family': document.queryCommandValue('fontname') || styleInfo['font-family']\n        });\n      } catch (e) {} // eslint-disable-next-line\n      // list-style-type to list-style(unordered, ordered)\n\n\n      if (!rng.isOnList()) {\n        styleInfo['list-style'] = 'none';\n      } else {\n        var orderedTypes = ['circle', 'disc', 'disc-leading-zero', 'square'];\n        var isUnordered = orderedTypes.indexOf(styleInfo['list-style-type']) > -1;\n        styleInfo['list-style'] = isUnordered ? 'unordered' : 'ordered';\n      }\n\n      var para = dom.ancestor(rng.sc, dom.isPara);\n\n      if (para && para.style['line-height']) {\n        styleInfo['line-height'] = para.style.lineHeight;\n      } else {\n        var lineHeight = parseInt(styleInfo['line-height'], 10) / parseInt(styleInfo['font-size'], 10);\n        styleInfo['line-height'] = lineHeight.toFixed(1);\n      }\n\n      styleInfo.anchor = rng.isOnAnchor() && dom.ancestor(rng.sc, dom.isAnchor);\n      styleInfo.ancestors = dom.listAncestor(rng.sc, dom.isEditable);\n      styleInfo.range = rng;\n      return styleInfo;\n    }\n  }]);\n\n  return Style;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/editing/Bullet.js\nfunction Bullet_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Bullet_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Bullet_createClass(Constructor, protoProps, staticProps) { if (protoProps) Bullet_defineProperties(Constructor.prototype, protoProps); if (staticProps) Bullet_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\nvar Bullet_Bullet = /*#__PURE__*/function () {\n  function Bullet() {\n    Bullet_classCallCheck(this, Bullet);\n  }\n\n  Bullet_createClass(Bullet, [{\n    key: \"insertOrderedList\",\n\n    /**\n     * toggle ordered list\n     */\n    value: function insertOrderedList(editable) {\n      this.toggleList('OL', editable);\n    }\n    /**\n     * toggle unordered list\n     */\n\n  }, {\n    key: \"insertUnorderedList\",\n    value: function insertUnorderedList(editable) {\n      this.toggleList('UL', editable);\n    }\n    /**\n     * indent\n     */\n\n  }, {\n    key: \"indent\",\n    value: function indent(editable) {\n      var _this = this;\n\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n      var paras = rng.nodes(dom.isPara, {\n        includeAncestor: true\n      });\n      var clustereds = lists.clusterBy(paras, func.peq2('parentNode'));\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(clustereds, function (idx, paras) {\n        var head = lists.head(paras);\n\n        if (dom.isLi(head)) {\n          var previousList = _this.findList(head.previousSibling);\n\n          if (previousList) {\n            paras.map(function (para) {\n              return previousList.appendChild(para);\n            });\n          } else {\n            _this.wrapList(paras, head.parentNode.nodeName);\n\n            paras.map(function (para) {\n              return para.parentNode;\n            }).map(function (para) {\n              return _this.appendToPrevious(para);\n            });\n          }\n        } else {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(paras, function (idx, para) {\n            external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(para).css('marginLeft', function (idx, val) {\n              return (parseInt(val, 10) || 0) + 25;\n            });\n          });\n        }\n      });\n      rng.select();\n    }\n    /**\n     * outdent\n     */\n\n  }, {\n    key: \"outdent\",\n    value: function outdent(editable) {\n      var _this2 = this;\n\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n      var paras = rng.nodes(dom.isPara, {\n        includeAncestor: true\n      });\n      var clustereds = lists.clusterBy(paras, func.peq2('parentNode'));\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(clustereds, function (idx, paras) {\n        var head = lists.head(paras);\n\n        if (dom.isLi(head)) {\n          _this2.releaseList([paras]);\n        } else {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(paras, function (idx, para) {\n            external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(para).css('marginLeft', function (idx, val) {\n              val = parseInt(val, 10) || 0;\n              return val > 25 ? val - 25 : '';\n            });\n          });\n        }\n      });\n      rng.select();\n    }\n    /**\n     * toggle list\n     *\n     * @param {String} listName - OL or UL\n     */\n\n  }, {\n    key: \"toggleList\",\n    value: function toggleList(listName, editable) {\n      var _this3 = this;\n\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n      var paras = rng.nodes(dom.isPara, {\n        includeAncestor: true\n      });\n      var bookmark = rng.paraBookmark(paras);\n      var clustereds = lists.clusterBy(paras, func.peq2('parentNode')); // paragraph to list\n\n      if (lists.find(paras, dom.isPurePara)) {\n        var wrappedParas = [];\n        external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(clustereds, function (idx, paras) {\n          wrappedParas = wrappedParas.concat(_this3.wrapList(paras, listName));\n        });\n        paras = wrappedParas; // list to paragraph or change list style\n      } else {\n        var diffLists = rng.nodes(dom.isList, {\n          includeAncestor: true\n        }).filter(function (listNode) {\n          return !external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.nodeName(listNode, listName);\n        });\n\n        if (diffLists.length) {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(diffLists, function (idx, listNode) {\n            dom.replace(listNode, listName);\n          });\n        } else {\n          paras = this.releaseList(clustereds, true);\n        }\n      }\n\n      range.createFromParaBookmark(bookmark, paras).select();\n    }\n    /**\n     * @param {Node[]} paras\n     * @param {String} listName\n     * @return {Node[]}\n     */\n\n  }, {\n    key: \"wrapList\",\n    value: function wrapList(paras, listName) {\n      var head = lists.head(paras);\n      var last = lists.last(paras);\n      var prevList = dom.isList(head.previousSibling) && head.previousSibling;\n      var nextList = dom.isList(last.nextSibling) && last.nextSibling;\n      var listNode = prevList || dom.insertAfter(dom.create(listName || 'UL'), last); // P to LI\n\n      paras = paras.map(function (para) {\n        return dom.isPurePara(para) ? dom.replace(para, 'LI') : para;\n      }); // append to list(<ul>, <ol>)\n\n      dom.appendChildNodes(listNode, paras);\n\n      if (nextList) {\n        dom.appendChildNodes(listNode, lists.from(nextList.childNodes));\n        dom.remove(nextList);\n      }\n\n      return paras;\n    }\n    /**\n     * @method releaseList\n     *\n     * @param {Array[]} clustereds\n     * @param {Boolean} isEscapseToBody\n     * @return {Node[]}\n     */\n\n  }, {\n    key: \"releaseList\",\n    value: function releaseList(clustereds, isEscapseToBody) {\n      var _this4 = this;\n\n      var releasedParas = [];\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(clustereds, function (idx, paras) {\n        var head = lists.head(paras);\n        var last = lists.last(paras);\n        var headList = isEscapseToBody ? dom.lastAncestor(head, dom.isList) : head.parentNode;\n        var parentItem = headList.parentNode;\n\n        if (headList.parentNode.nodeName === 'LI') {\n          paras.map(function (para) {\n            var newList = _this4.findNextSiblings(para);\n\n            if (parentItem.nextSibling) {\n              parentItem.parentNode.insertBefore(para, parentItem.nextSibling);\n            } else {\n              parentItem.parentNode.appendChild(para);\n            }\n\n            if (newList.length) {\n              _this4.wrapList(newList, headList.nodeName);\n\n              para.appendChild(newList[0].parentNode);\n            }\n          });\n\n          if (headList.children.length === 0) {\n            parentItem.removeChild(headList);\n          }\n\n          if (parentItem.childNodes.length === 0) {\n            parentItem.parentNode.removeChild(parentItem);\n          }\n        } else {\n          var lastList = headList.childNodes.length > 1 ? dom.splitTree(headList, {\n            node: last.parentNode,\n            offset: dom.position(last) + 1\n          }, {\n            isSkipPaddingBlankHTML: true\n          }) : null;\n          var middleList = dom.splitTree(headList, {\n            node: head.parentNode,\n            offset: dom.position(head)\n          }, {\n            isSkipPaddingBlankHTML: true\n          });\n          paras = isEscapseToBody ? dom.listDescendant(middleList, dom.isLi) : lists.from(middleList.childNodes).filter(dom.isLi); // LI to P\n\n          if (isEscapseToBody || !dom.isList(headList.parentNode)) {\n            paras = paras.map(function (para) {\n              return dom.replace(para, 'P');\n            });\n          }\n\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(lists.from(paras).reverse(), function (idx, para) {\n            dom.insertAfter(para, headList);\n          }); // remove empty lists\n\n          var rootLists = lists.compact([headList, middleList, lastList]);\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(rootLists, function (idx, rootList) {\n            var listNodes = [rootList].concat(dom.listDescendant(rootList, dom.isList));\n            external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(listNodes.reverse(), function (idx, listNode) {\n              if (!dom.nodeLength(listNode)) {\n                dom.remove(listNode, true);\n              }\n            });\n          });\n        }\n\n        releasedParas = releasedParas.concat(paras);\n      });\n      return releasedParas;\n    }\n    /**\n     * @method appendToPrevious\n     *\n     * Appends list to previous list item, if\n     * none exist it wraps the list in a new list item.\n     *\n     * @param {HTMLNode} ListItem\n     * @return {HTMLNode}\n     */\n\n  }, {\n    key: \"appendToPrevious\",\n    value: function appendToPrevious(node) {\n      return node.previousSibling ? dom.appendChildNodes(node.previousSibling, [node]) : this.wrapList([node], 'LI');\n    }\n    /**\n     * @method findList\n     *\n     * Finds an existing list in list item\n     *\n     * @param {HTMLNode} ListItem\n     * @return {Array[]}\n     */\n\n  }, {\n    key: \"findList\",\n    value: function findList(node) {\n      return node ? lists.find(node.children, function (child) {\n        return ['OL', 'UL'].indexOf(child.nodeName) > -1;\n      }) : null;\n    }\n    /**\n     * @method findNextSiblings\n     *\n     * Finds all list item siblings that follow it\n     *\n     * @param {HTMLNode} ListItem\n     * @return {HTMLNode}\n     */\n\n  }, {\n    key: \"findNextSiblings\",\n    value: function findNextSiblings(node) {\n      var siblings = [];\n\n      while (node.nextSibling) {\n        siblings.push(node.nextSibling);\n        node = node.nextSibling;\n      }\n\n      return siblings;\n    }\n  }]);\n\n  return Bullet;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/editing/Typing.js\nfunction Typing_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Typing_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Typing_createClass(Constructor, protoProps, staticProps) { if (protoProps) Typing_defineProperties(Constructor.prototype, protoProps); if (staticProps) Typing_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n/**\n * @class editing.Typing\n *\n * Typing\n *\n */\n\nvar Typing_Typing = /*#__PURE__*/function () {\n  function Typing(context) {\n    Typing_classCallCheck(this, Typing);\n\n    // a Bullet instance to toggle lists off\n    this.bullet = new Bullet_Bullet();\n    this.options = context.options;\n  }\n  /**\n   * insert tab\n   *\n   * @param {WrappedRange} rng\n   * @param {Number} tabsize\n   */\n\n\n  Typing_createClass(Typing, [{\n    key: \"insertTab\",\n    value: function insertTab(rng, tabsize) {\n      var tab = dom.createText(new Array(tabsize + 1).join(dom.NBSP_CHAR));\n      rng = rng.deleteContents();\n      rng.insertNode(tab, true);\n      rng = range.create(tab, tabsize);\n      rng.select();\n    }\n    /**\n     * insert paragraph\n     *\n     * @param {jQuery} $editable\n     * @param {WrappedRange} rng Can be used in unit tests to \"mock\" the range\n     *\n     * blockquoteBreakingLevel\n     *   0 - No break, the new paragraph remains inside the quote\n     *   1 - Break the first blockquote in the ancestors list\n     *   2 - Break all blockquotes, so that the new paragraph is not quoted (this is the default)\n     */\n\n  }, {\n    key: \"insertParagraph\",\n    value: function insertParagraph(editable, rng) {\n      rng = rng || range.create(editable); // deleteContents on range.\n\n      rng = rng.deleteContents(); // Wrap range if it needs to be wrapped by paragraph\n\n      rng = rng.wrapBodyInlineWithPara(); // finding paragraph\n\n      var splitRoot = dom.ancestor(rng.sc, dom.isPara);\n      var nextPara; // on paragraph: split paragraph\n\n      if (splitRoot) {\n        // if it is an empty line with li\n        if (dom.isLi(splitRoot) && (dom.isEmpty(splitRoot) || dom.deepestChildIsEmpty(splitRoot))) {\n          // toggle UL/OL and escape\n          this.bullet.toggleList(splitRoot.parentNode.nodeName);\n          return;\n        } else {\n          var blockquote = null;\n\n          if (this.options.blockquoteBreakingLevel === 1) {\n            blockquote = dom.ancestor(splitRoot, dom.isBlockquote);\n          } else if (this.options.blockquoteBreakingLevel === 2) {\n            blockquote = dom.lastAncestor(splitRoot, dom.isBlockquote);\n          }\n\n          if (blockquote) {\n            // We're inside a blockquote and options ask us to break it\n            nextPara = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(dom.emptyPara)[0]; // If the split is right before a <br>, remove it so that there's no \"empty line\"\n            // after the split in the new blockquote created\n\n            if (dom.isRightEdgePoint(rng.getStartPoint()) && dom.isBR(rng.sc.nextSibling)) {\n              external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(rng.sc.nextSibling).remove();\n            }\n\n            var split = dom.splitTree(blockquote, rng.getStartPoint(), {\n              isDiscardEmptySplits: true\n            });\n\n            if (split) {\n              split.parentNode.insertBefore(nextPara, split);\n            } else {\n              dom.insertAfter(nextPara, blockquote); // There's no split if we were at the end of the blockquote\n            }\n          } else {\n            nextPara = dom.splitTree(splitRoot, rng.getStartPoint()); // not a blockquote, just insert the paragraph\n\n            var emptyAnchors = dom.listDescendant(splitRoot, dom.isEmptyAnchor);\n            emptyAnchors = emptyAnchors.concat(dom.listDescendant(nextPara, dom.isEmptyAnchor));\n            external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(emptyAnchors, function (idx, anchor) {\n              dom.remove(anchor);\n            }); // replace empty heading, pre or custom-made styleTag with P tag\n\n            if ((dom.isHeading(nextPara) || dom.isPre(nextPara) || dom.isCustomStyleTag(nextPara)) && dom.isEmpty(nextPara)) {\n              nextPara = dom.replace(nextPara, 'p');\n            }\n          }\n        } // no paragraph: insert empty paragraph\n\n      } else {\n        var next = rng.sc.childNodes[rng.so];\n        nextPara = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(dom.emptyPara)[0];\n\n        if (next) {\n          rng.sc.insertBefore(nextPara, next);\n        } else {\n          rng.sc.appendChild(nextPara);\n        }\n      }\n\n      range.create(nextPara, 0).normalize().select().scrollIntoView(editable);\n    }\n  }]);\n\n  return Typing;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/editing/Table.js\nfunction Table_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Table_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Table_createClass(Constructor, protoProps, staticProps) { if (protoProps) Table_defineProperties(Constructor.prototype, protoProps); if (staticProps) Table_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n/**\n * @class Create a virtual table to create what actions to do in change.\n * @param {object} startPoint Cell selected to apply change.\n * @param {enum} where  Where change will be applied Row or Col. Use enum: TableResultAction.where\n * @param {enum} action Action to be applied. Use enum: TableResultAction.requestAction\n * @param {object} domTable Dom element of table to make changes.\n */\n\nvar TableResultAction = function TableResultAction(startPoint, where, action, domTable) {\n  var _startPoint = {\n    'colPos': 0,\n    'rowPos': 0\n  };\n  var _virtualTable = [];\n  var _actionCellList = []; /// ///////////////////////////////////////////\n  // Private functions\n  /// ///////////////////////////////////////////\n\n  /**\n   * Set the startPoint of action.\n   */\n\n  function setStartPoint() {\n    if (!startPoint || !startPoint.tagName || startPoint.tagName.toLowerCase() !== 'td' && startPoint.tagName.toLowerCase() !== 'th') {\n      // Impossible to identify start Cell point\n      return;\n    }\n\n    _startPoint.colPos = startPoint.cellIndex;\n\n    if (!startPoint.parentElement || !startPoint.parentElement.tagName || startPoint.parentElement.tagName.toLowerCase() !== 'tr') {\n      // Impossible to identify start Row point\n      return;\n    }\n\n    _startPoint.rowPos = startPoint.parentElement.rowIndex;\n  }\n  /**\n   * Define virtual table position info object.\n   *\n   * @param {int} rowIndex Index position in line of virtual table.\n   * @param {int} cellIndex Index position in column of virtual table.\n   * @param {object} baseRow Row affected by this position.\n   * @param {object} baseCell Cell affected by this position.\n   * @param {bool} isSpan Inform if it is an span cell/row.\n   */\n\n\n  function setVirtualTablePosition(rowIndex, cellIndex, baseRow, baseCell, isRowSpan, isColSpan, isVirtualCell) {\n    var objPosition = {\n      'baseRow': baseRow,\n      'baseCell': baseCell,\n      'isRowSpan': isRowSpan,\n      'isColSpan': isColSpan,\n      'isVirtual': isVirtualCell\n    };\n\n    if (!_virtualTable[rowIndex]) {\n      _virtualTable[rowIndex] = [];\n    }\n\n    _virtualTable[rowIndex][cellIndex] = objPosition;\n  }\n  /**\n   * Create action cell object.\n   *\n   * @param {object} virtualTableCellObj Object of specific position on virtual table.\n   * @param {enum} resultAction Action to be applied in that item.\n   */\n\n\n  function getActionCell(virtualTableCellObj, resultAction, virtualRowPosition, virtualColPosition) {\n    return {\n      'baseCell': virtualTableCellObj.baseCell,\n      'action': resultAction,\n      'virtualTable': {\n        'rowIndex': virtualRowPosition,\n        'cellIndex': virtualColPosition\n      }\n    };\n  }\n  /**\n   * Recover free index of row to append Cell.\n   *\n   * @param {int} rowIndex Index of row to find free space.\n   * @param {int} cellIndex Index of cell to find free space in table.\n   */\n\n\n  function recoverCellIndex(rowIndex, cellIndex) {\n    if (!_virtualTable[rowIndex]) {\n      return cellIndex;\n    }\n\n    if (!_virtualTable[rowIndex][cellIndex]) {\n      return cellIndex;\n    }\n\n    var newCellIndex = cellIndex;\n\n    while (_virtualTable[rowIndex][newCellIndex]) {\n      newCellIndex++;\n\n      if (!_virtualTable[rowIndex][newCellIndex]) {\n        return newCellIndex;\n      }\n    }\n  }\n  /**\n   * Recover info about row and cell and add information to virtual table.\n   *\n   * @param {object} row Row to recover information.\n   * @param {object} cell Cell to recover information.\n   */\n\n\n  function addCellInfoToVirtual(row, cell) {\n    var cellIndex = recoverCellIndex(row.rowIndex, cell.cellIndex);\n    var cellHasColspan = cell.colSpan > 1;\n    var cellHasRowspan = cell.rowSpan > 1;\n    var isThisSelectedCell = row.rowIndex === _startPoint.rowPos && cell.cellIndex === _startPoint.colPos;\n    setVirtualTablePosition(row.rowIndex, cellIndex, row, cell, cellHasRowspan, cellHasColspan, false); // Add span rows to virtual Table.\n\n    var rowspanNumber = cell.attributes.rowSpan ? parseInt(cell.attributes.rowSpan.value, 10) : 0;\n\n    if (rowspanNumber > 1) {\n      for (var rp = 1; rp < rowspanNumber; rp++) {\n        var rowspanIndex = row.rowIndex + rp;\n        adjustStartPoint(rowspanIndex, cellIndex, cell, isThisSelectedCell);\n        setVirtualTablePosition(rowspanIndex, cellIndex, row, cell, true, cellHasColspan, true);\n      }\n    } // Add span cols to virtual table.\n\n\n    var colspanNumber = cell.attributes.colSpan ? parseInt(cell.attributes.colSpan.value, 10) : 0;\n\n    if (colspanNumber > 1) {\n      for (var cp = 1; cp < colspanNumber; cp++) {\n        var cellspanIndex = recoverCellIndex(row.rowIndex, cellIndex + cp);\n        adjustStartPoint(row.rowIndex, cellspanIndex, cell, isThisSelectedCell);\n        setVirtualTablePosition(row.rowIndex, cellspanIndex, row, cell, cellHasRowspan, true, true);\n      }\n    }\n  }\n  /**\n   * Process validation and adjust of start point if needed\n   *\n   * @param {int} rowIndex\n   * @param {int} cellIndex\n   * @param {object} cell\n   * @param {bool} isSelectedCell\n   */\n\n\n  function adjustStartPoint(rowIndex, cellIndex, cell, isSelectedCell) {\n    if (rowIndex === _startPoint.rowPos && _startPoint.colPos >= cell.cellIndex && cell.cellIndex <= cellIndex && !isSelectedCell) {\n      _startPoint.colPos++;\n    }\n  }\n  /**\n   * Create virtual table of cells with all cells, including span cells.\n   */\n\n\n  function createVirtualTable() {\n    var rows = domTable.rows;\n\n    for (var rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n      var cells = rows[rowIndex].cells;\n\n      for (var cellIndex = 0; cellIndex < cells.length; cellIndex++) {\n        addCellInfoToVirtual(rows[rowIndex], cells[cellIndex]);\n      }\n    }\n  }\n  /**\n   * Get action to be applied on the cell.\n   *\n   * @param {object} cell virtual table cell to apply action\n   */\n\n\n  function getDeleteResultActionToCell(cell) {\n    switch (where) {\n      case TableResultAction.where.Column:\n        if (cell.isColSpan) {\n          return TableResultAction.resultAction.SubtractSpanCount;\n        }\n\n        break;\n\n      case TableResultAction.where.Row:\n        if (!cell.isVirtual && cell.isRowSpan) {\n          return TableResultAction.resultAction.AddCell;\n        } else if (cell.isRowSpan) {\n          return TableResultAction.resultAction.SubtractSpanCount;\n        }\n\n        break;\n    }\n\n    return TableResultAction.resultAction.RemoveCell;\n  }\n  /**\n   * Get action to be applied on the cell.\n   *\n   * @param {object} cell virtual table cell to apply action\n   */\n\n\n  function getAddResultActionToCell(cell) {\n    switch (where) {\n      case TableResultAction.where.Column:\n        if (cell.isColSpan) {\n          return TableResultAction.resultAction.SumSpanCount;\n        } else if (cell.isRowSpan && cell.isVirtual) {\n          return TableResultAction.resultAction.Ignore;\n        }\n\n        break;\n\n      case TableResultAction.where.Row:\n        if (cell.isRowSpan) {\n          return TableResultAction.resultAction.SumSpanCount;\n        } else if (cell.isColSpan && cell.isVirtual) {\n          return TableResultAction.resultAction.Ignore;\n        }\n\n        break;\n    }\n\n    return TableResultAction.resultAction.AddCell;\n  }\n\n  function init() {\n    setStartPoint();\n    createVirtualTable();\n  } /// ///////////////////////////////////////////\n  // Public functions\n  /// ///////////////////////////////////////////\n\n  /**\n   * Recover array os what to do in table.\n   */\n\n\n  this.getActionList = function () {\n    var fixedRow = where === TableResultAction.where.Row ? _startPoint.rowPos : -1;\n    var fixedCol = where === TableResultAction.where.Column ? _startPoint.colPos : -1;\n    var actualPosition = 0;\n    var canContinue = true;\n\n    while (canContinue) {\n      var rowPosition = fixedRow >= 0 ? fixedRow : actualPosition;\n      var colPosition = fixedCol >= 0 ? fixedCol : actualPosition;\n      var row = _virtualTable[rowPosition];\n\n      if (!row) {\n        canContinue = false;\n        return _actionCellList;\n      }\n\n      var cell = row[colPosition];\n\n      if (!cell) {\n        canContinue = false;\n        return _actionCellList;\n      } // Define action to be applied in this cell\n\n\n      var resultAction = TableResultAction.resultAction.Ignore;\n\n      switch (action) {\n        case TableResultAction.requestAction.Add:\n          resultAction = getAddResultActionToCell(cell);\n          break;\n\n        case TableResultAction.requestAction.Delete:\n          resultAction = getDeleteResultActionToCell(cell);\n          break;\n      }\n\n      _actionCellList.push(getActionCell(cell, resultAction, rowPosition, colPosition));\n\n      actualPosition++;\n    }\n\n    return _actionCellList;\n  };\n\n  init();\n};\n/**\n*\n* Where action occours enum.\n*/\n\n\nTableResultAction.where = {\n  'Row': 0,\n  'Column': 1\n};\n/**\n*\n* Requested action to apply enum.\n*/\n\nTableResultAction.requestAction = {\n  'Add': 0,\n  'Delete': 1\n};\n/**\n*\n* Result action to be executed enum.\n*/\n\nTableResultAction.resultAction = {\n  'Ignore': 0,\n  'SubtractSpanCount': 1,\n  'RemoveCell': 2,\n  'AddCell': 3,\n  'SumSpanCount': 4\n};\n/**\n *\n * @class editing.Table\n *\n * Table\n *\n */\n\nvar Table_Table = /*#__PURE__*/function () {\n  function Table() {\n    Table_classCallCheck(this, Table);\n  }\n\n  Table_createClass(Table, [{\n    key: \"tab\",\n\n    /**\n     * handle tab key\n     *\n     * @param {WrappedRange} rng\n     * @param {Boolean} isShift\n     */\n    value: function tab(rng, isShift) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var table = dom.ancestor(cell, dom.isTable);\n      var cells = dom.listDescendant(table, dom.isCell);\n      var nextCell = lists[isShift ? 'prev' : 'next'](cells, cell);\n\n      if (nextCell) {\n        range.create(nextCell, 0).select();\n      }\n    }\n    /**\n     * Add a new row\n     *\n     * @param {WrappedRange} rng\n     * @param {String} position (top/bottom)\n     * @return {Node}\n     */\n\n  }, {\n    key: \"addRow\",\n    value: function addRow(rng, position) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var currentTr = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell).closest('tr');\n      var trAttributes = this.recoverAttributes(currentTr);\n      var html = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<tr' + trAttributes + '></tr>');\n      var vTable = new TableResultAction(cell, TableResultAction.where.Row, TableResultAction.requestAction.Add, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(currentTr).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var idCell = 0; idCell < actions.length; idCell++) {\n        var currentCell = actions[idCell];\n        var tdAttributes = this.recoverAttributes(currentCell.baseCell);\n\n        switch (currentCell.action) {\n          case TableResultAction.resultAction.AddCell:\n            html.append('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            break;\n\n          case TableResultAction.resultAction.SumSpanCount:\n            {\n              if (position === 'top') {\n                var baseCellTr = currentCell.baseCell.parent;\n                var isTopFromRowSpan = (!baseCellTr ? 0 : currentCell.baseCell.closest('tr').rowIndex) <= currentTr[0].rowIndex;\n\n                if (isTopFromRowSpan) {\n                  var newTd = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div></div>').append(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<td' + tdAttributes + '>' + dom.blank + '</td>').removeAttr('rowspan')).html();\n                  html.append(newTd);\n                  break;\n                }\n              }\n\n              var rowspanNumber = parseInt(currentCell.baseCell.rowSpan, 10);\n              rowspanNumber++;\n              currentCell.baseCell.setAttribute('rowSpan', rowspanNumber);\n            }\n            break;\n        }\n      }\n\n      if (position === 'top') {\n        currentTr.before(html);\n      } else {\n        var cellHasRowspan = cell.rowSpan > 1;\n\n        if (cellHasRowspan) {\n          var lastTrIndex = currentTr[0].rowIndex + (cell.rowSpan - 2);\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(currentTr).parent().find('tr')[lastTrIndex]).after(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(html));\n          return;\n        }\n\n        currentTr.after(html);\n      }\n    }\n    /**\n     * Add a new col\n     *\n     * @param {WrappedRange} rng\n     * @param {String} position (left/right)\n     * @return {Node}\n     */\n\n  }, {\n    key: \"addCol\",\n    value: function addCol(rng, position) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var row = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell).closest('tr');\n      var rowsGroup = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(row).siblings();\n      rowsGroup.push(row);\n      var vTable = new TableResultAction(cell, TableResultAction.where.Column, TableResultAction.requestAction.Add, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(row).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {\n        var currentCell = actions[actionIndex];\n        var tdAttributes = this.recoverAttributes(currentCell.baseCell);\n\n        switch (currentCell.action) {\n          case TableResultAction.resultAction.AddCell:\n            if (position === 'right') {\n              external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(currentCell.baseCell).after('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            } else {\n              external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(currentCell.baseCell).before('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            }\n\n            break;\n\n          case TableResultAction.resultAction.SumSpanCount:\n            if (position === 'right') {\n              var colspanNumber = parseInt(currentCell.baseCell.colSpan, 10);\n              colspanNumber++;\n              currentCell.baseCell.setAttribute('colSpan', colspanNumber);\n            } else {\n              external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(currentCell.baseCell).before('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            }\n\n            break;\n        }\n      }\n    }\n    /*\n    * Copy attributes from element.\n    *\n    * @param {object} Element to recover attributes.\n    * @return {string} Copied string elements.\n    */\n\n  }, {\n    key: \"recoverAttributes\",\n    value: function recoverAttributes(el) {\n      var resultStr = '';\n\n      if (!el) {\n        return resultStr;\n      }\n\n      var attrList = el.attributes || [];\n\n      for (var i = 0; i < attrList.length; i++) {\n        if (attrList[i].name.toLowerCase() === 'id') {\n          continue;\n        }\n\n        if (attrList[i].specified) {\n          resultStr += ' ' + attrList[i].name + '=\\'' + attrList[i].value + '\\'';\n        }\n      }\n\n      return resultStr;\n    }\n    /**\n     * Delete current row\n     *\n     * @param {WrappedRange} rng\n     * @return {Node}\n     */\n\n  }, {\n    key: \"deleteRow\",\n    value: function deleteRow(rng) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var row = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell).closest('tr');\n      var cellPos = row.children('td, th').index(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell));\n      var rowPos = row[0].rowIndex;\n      var vTable = new TableResultAction(cell, TableResultAction.where.Row, TableResultAction.requestAction.Delete, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(row).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {\n        if (!actions[actionIndex]) {\n          continue;\n        }\n\n        var baseCell = actions[actionIndex].baseCell;\n        var virtualPosition = actions[actionIndex].virtualTable;\n        var hasRowspan = baseCell.rowSpan && baseCell.rowSpan > 1;\n        var rowspanNumber = hasRowspan ? parseInt(baseCell.rowSpan, 10) : 0;\n\n        switch (actions[actionIndex].action) {\n          case TableResultAction.resultAction.Ignore:\n            continue;\n\n          case TableResultAction.resultAction.AddCell:\n            {\n              var nextRow = row.next('tr')[0];\n\n              if (!nextRow) {\n                continue;\n              }\n\n              var cloneRow = row[0].cells[cellPos];\n\n              if (hasRowspan) {\n                if (rowspanNumber > 2) {\n                  rowspanNumber--;\n                  nextRow.insertBefore(cloneRow, nextRow.cells[cellPos]);\n                  nextRow.cells[cellPos].setAttribute('rowSpan', rowspanNumber);\n                  nextRow.cells[cellPos].innerHTML = '';\n                } else if (rowspanNumber === 2) {\n                  nextRow.insertBefore(cloneRow, nextRow.cells[cellPos]);\n                  nextRow.cells[cellPos].removeAttribute('rowSpan');\n                  nextRow.cells[cellPos].innerHTML = '';\n                }\n              }\n            }\n            continue;\n\n          case TableResultAction.resultAction.SubtractSpanCount:\n            if (hasRowspan) {\n              if (rowspanNumber > 2) {\n                rowspanNumber--;\n                baseCell.setAttribute('rowSpan', rowspanNumber);\n\n                if (virtualPosition.rowIndex !== rowPos && baseCell.cellIndex === cellPos) {\n                  baseCell.innerHTML = '';\n                }\n              } else if (rowspanNumber === 2) {\n                baseCell.removeAttribute('rowSpan');\n\n                if (virtualPosition.rowIndex !== rowPos && baseCell.cellIndex === cellPos) {\n                  baseCell.innerHTML = '';\n                }\n              }\n            }\n\n            continue;\n\n          case TableResultAction.resultAction.RemoveCell:\n            // Do not need remove cell because row will be deleted.\n            continue;\n        }\n      }\n\n      row.remove();\n    }\n    /**\n     * Delete current col\n     *\n     * @param {WrappedRange} rng\n     * @return {Node}\n     */\n\n  }, {\n    key: \"deleteCol\",\n    value: function deleteCol(rng) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var row = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell).closest('tr');\n      var cellPos = row.children('td, th').index(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell));\n      var vTable = new TableResultAction(cell, TableResultAction.where.Column, TableResultAction.requestAction.Delete, external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(row).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {\n        if (!actions[actionIndex]) {\n          continue;\n        }\n\n        switch (actions[actionIndex].action) {\n          case TableResultAction.resultAction.Ignore:\n            continue;\n\n          case TableResultAction.resultAction.SubtractSpanCount:\n            {\n              var baseCell = actions[actionIndex].baseCell;\n              var hasColspan = baseCell.colSpan && baseCell.colSpan > 1;\n\n              if (hasColspan) {\n                var colspanNumber = baseCell.colSpan ? parseInt(baseCell.colSpan, 10) : 0;\n\n                if (colspanNumber > 2) {\n                  colspanNumber--;\n                  baseCell.setAttribute('colSpan', colspanNumber);\n\n                  if (baseCell.cellIndex === cellPos) {\n                    baseCell.innerHTML = '';\n                  }\n                } else if (colspanNumber === 2) {\n                  baseCell.removeAttribute('colSpan');\n\n                  if (baseCell.cellIndex === cellPos) {\n                    baseCell.innerHTML = '';\n                  }\n                }\n              }\n            }\n            continue;\n\n          case TableResultAction.resultAction.RemoveCell:\n            dom.remove(actions[actionIndex].baseCell, true);\n            continue;\n        }\n      }\n    }\n    /**\n     * create empty table element\n     *\n     * @param {Number} rowCount\n     * @param {Number} colCount\n     * @return {Node}\n     */\n\n  }, {\n    key: \"createTable\",\n    value: function createTable(colCount, rowCount, options) {\n      var tds = [];\n      var tdHTML;\n\n      for (var idxCol = 0; idxCol < colCount; idxCol++) {\n        tds.push('<td>' + dom.blank + '</td>');\n      }\n\n      tdHTML = tds.join('');\n      var trs = [];\n      var trHTML;\n\n      for (var idxRow = 0; idxRow < rowCount; idxRow++) {\n        trs.push('<tr>' + tdHTML + '</tr>');\n      }\n\n      trHTML = trs.join('');\n      var $table = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<table>' + trHTML + '</table>');\n\n      if (options && options.tableClassName) {\n        $table.addClass(options.tableClassName);\n      }\n\n      return $table[0];\n    }\n    /**\n     * Delete current table\n     *\n     * @param {WrappedRange} rng\n     * @return {Node}\n     */\n\n  }, {\n    key: \"deleteTable\",\n    value: function deleteTable(rng) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(cell).closest('table').remove();\n    }\n  }]);\n\n  return Table;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Editor.js\nfunction Editor_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Editor_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Editor_createClass(Constructor, protoProps, staticProps) { if (protoProps) Editor_defineProperties(Constructor.prototype, protoProps); if (staticProps) Editor_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar KEY_BOGUS = 'bogus';\n/**\n * @class Editor\n */\n\nvar Editor_Editor = /*#__PURE__*/function () {\n  function Editor(context) {\n    var _this = this;\n\n    Editor_classCallCheck(this, Editor);\n\n    this.context = context;\n    this.$note = context.layoutInfo.note;\n    this.$editor = context.layoutInfo.editor;\n    this.$editable = context.layoutInfo.editable;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n    this.editable = this.$editable[0];\n    this.lastRange = null;\n    this.snapshot = null;\n    this.style = new Style_Style();\n    this.table = new Table_Table();\n    this.typing = new Typing_Typing(context);\n    this.bullet = new Bullet_Bullet();\n    this.history = new History_History(context);\n    this.context.memo('help.escape', this.lang.help.escape);\n    this.context.memo('help.undo', this.lang.help.undo);\n    this.context.memo('help.redo', this.lang.help.redo);\n    this.context.memo('help.tab', this.lang.help.tab);\n    this.context.memo('help.untab', this.lang.help.untab);\n    this.context.memo('help.insertParagraph', this.lang.help.insertParagraph);\n    this.context.memo('help.insertOrderedList', this.lang.help.insertOrderedList);\n    this.context.memo('help.insertUnorderedList', this.lang.help.insertUnorderedList);\n    this.context.memo('help.indent', this.lang.help.indent);\n    this.context.memo('help.outdent', this.lang.help.outdent);\n    this.context.memo('help.formatPara', this.lang.help.formatPara);\n    this.context.memo('help.insertHorizontalRule', this.lang.help.insertHorizontalRule);\n    this.context.memo('help.fontName', this.lang.help.fontName); // native commands(with execCommand), generate function for execCommand\n\n    var commands = ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'formatBlock', 'removeFormat', 'backColor'];\n\n    for (var idx = 0, len = commands.length; idx < len; idx++) {\n      this[commands[idx]] = function (sCmd) {\n        return function (value) {\n          _this.beforeCommand();\n\n          document.execCommand(sCmd, false, value);\n\n          _this.afterCommand(true);\n        };\n      }(commands[idx]);\n\n      this.context.memo('help.' + commands[idx], this.lang.help[commands[idx]]);\n    }\n\n    this.fontName = this.wrapCommand(function (value) {\n      return _this.fontStyling('font-family', env.validFontName(value));\n    });\n    this.fontSize = this.wrapCommand(function (value) {\n      var unit = _this.currentStyle()['font-size-unit'];\n\n      return _this.fontStyling('font-size', value + unit);\n    });\n    this.fontSizeUnit = this.wrapCommand(function (value) {\n      var size = _this.currentStyle()['font-size'];\n\n      return _this.fontStyling('font-size', size + value);\n    });\n\n    for (var _idx = 1; _idx <= 6; _idx++) {\n      this['formatH' + _idx] = function (idx) {\n        return function () {\n          _this.formatBlock('H' + idx);\n        };\n      }(_idx);\n\n      this.context.memo('help.formatH' + _idx, this.lang.help['formatH' + _idx]);\n    }\n\n    this.insertParagraph = this.wrapCommand(function () {\n      _this.typing.insertParagraph(_this.editable);\n    });\n    this.insertOrderedList = this.wrapCommand(function () {\n      _this.bullet.insertOrderedList(_this.editable);\n    });\n    this.insertUnorderedList = this.wrapCommand(function () {\n      _this.bullet.insertUnorderedList(_this.editable);\n    });\n    this.indent = this.wrapCommand(function () {\n      _this.bullet.indent(_this.editable);\n    });\n    this.outdent = this.wrapCommand(function () {\n      _this.bullet.outdent(_this.editable);\n    });\n    /**\n     * insertNode\n     * insert node\n     * @param {Node} node\n     */\n\n    this.insertNode = this.wrapCommand(function (node) {\n      if (_this.isLimited(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(node).text().length)) {\n        return;\n      }\n\n      var rng = _this.getLastRange();\n\n      rng.insertNode(node);\n\n      _this.setLastRange(range.createFromNodeAfter(node).select());\n    });\n    /**\n     * insert text\n     * @param {String} text\n     */\n\n    this.insertText = this.wrapCommand(function (text) {\n      if (_this.isLimited(text.length)) {\n        return;\n      }\n\n      var rng = _this.getLastRange();\n\n      var textNode = rng.insertNode(dom.createText(text));\n\n      _this.setLastRange(range.create(textNode, dom.nodeLength(textNode)).select());\n    });\n    /**\n     * paste HTML\n     * @param {String} markup\n     */\n\n    this.pasteHTML = this.wrapCommand(function (markup) {\n      if (_this.isLimited(markup.length)) {\n        return;\n      }\n\n      markup = _this.context.invoke('codeview.purify', markup);\n\n      var contents = _this.getLastRange().pasteHTML(markup);\n\n      _this.setLastRange(range.createFromNodeAfter(lists.last(contents)).select());\n    });\n    /**\n     * formatBlock\n     *\n     * @param {String} tagName\n     */\n\n    this.formatBlock = this.wrapCommand(function (tagName, $target) {\n      var onApplyCustomStyle = _this.options.callbacks.onApplyCustomStyle;\n\n      if (onApplyCustomStyle) {\n        onApplyCustomStyle.call(_this, $target, _this.context, _this.onFormatBlock);\n      } else {\n        _this.onFormatBlock(tagName, $target);\n      }\n    });\n    /**\n     * insert horizontal rule\n     */\n\n    this.insertHorizontalRule = this.wrapCommand(function () {\n      var hrNode = _this.getLastRange().insertNode(dom.create('HR'));\n\n      if (hrNode.nextSibling) {\n        _this.setLastRange(range.create(hrNode.nextSibling, 0).normalize().select());\n      }\n    });\n    /**\n     * lineHeight\n     * @param {String} value\n     */\n\n    this.lineHeight = this.wrapCommand(function (value) {\n      _this.style.stylePara(_this.getLastRange(), {\n        lineHeight: value\n      });\n    });\n    /**\n     * create link (command)\n     *\n     * @param {Object} linkInfo\n     */\n\n    this.createLink = this.wrapCommand(function (linkInfo) {\n      var linkUrl = linkInfo.url;\n      var linkText = linkInfo.text;\n      var isNewWindow = linkInfo.isNewWindow;\n      var checkProtocol = linkInfo.checkProtocol;\n\n      var rng = linkInfo.range || _this.getLastRange();\n\n      var additionalTextLength = linkText.length - rng.toString().length;\n\n      if (additionalTextLength > 0 && _this.isLimited(additionalTextLength)) {\n        return;\n      }\n\n      var isTextChanged = rng.toString() !== linkText; // handle spaced urls from input\n\n      if (typeof linkUrl === 'string') {\n        linkUrl = linkUrl.trim();\n      }\n\n      if (_this.options.onCreateLink) {\n        linkUrl = _this.options.onCreateLink(linkUrl);\n      } else if (checkProtocol) {\n        // if url doesn't have any protocol and not even a relative or a label, use http:// as default\n        linkUrl = /^([A-Za-z][A-Za-z0-9+-.]*\\:|#|\\/)/.test(linkUrl) ? linkUrl : _this.options.defaultProtocol + linkUrl;\n      }\n\n      var anchors = [];\n\n      if (isTextChanged) {\n        rng = rng.deleteContents();\n        var anchor = rng.insertNode(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<A>' + linkText + '</A>')[0]);\n        anchors.push(anchor);\n      } else {\n        anchors = _this.style.styleNodes(rng, {\n          nodeName: 'A',\n          expandClosestSibling: true,\n          onlyPartialContains: true\n        });\n      }\n\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(anchors, function (idx, anchor) {\n        external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(anchor).attr('href', linkUrl);\n\n        if (isNewWindow) {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(anchor).attr('target', '_blank');\n        } else {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(anchor).removeAttr('target');\n        }\n      });\n\n      _this.setLastRange(_this.createRangeFromList(anchors).select());\n    });\n    /**\n     * setting color\n     *\n     * @param {Object} sObjColor  color code\n     * @param {String} sObjColor.foreColor foreground color\n     * @param {String} sObjColor.backColor background color\n     */\n\n    this.color = this.wrapCommand(function (colorInfo) {\n      var foreColor = colorInfo.foreColor;\n      var backColor = colorInfo.backColor;\n\n      if (foreColor) {\n        document.execCommand('foreColor', false, foreColor);\n      }\n\n      if (backColor) {\n        document.execCommand('backColor', false, backColor);\n      }\n    });\n    /**\n     * Set foreground color\n     *\n     * @param {String} colorCode foreground color code\n     */\n\n    this.foreColor = this.wrapCommand(function (colorInfo) {\n      document.execCommand('foreColor', false, colorInfo);\n    });\n    /**\n     * insert Table\n     *\n     * @param {String} dimension of table (ex : \"5x5\")\n     */\n\n    this.insertTable = this.wrapCommand(function (dim) {\n      var dimension = dim.split('x');\n\n      var rng = _this.getLastRange().deleteContents();\n\n      rng.insertNode(_this.table.createTable(dimension[0], dimension[1], _this.options));\n    });\n    /**\n     * remove media object and Figure Elements if media object is img with Figure.\n     */\n\n    this.removeMedia = this.wrapCommand(function () {\n      var $target = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(_this.restoreTarget()).parent();\n\n      if ($target.closest('figure').length) {\n        $target.closest('figure').remove();\n      } else {\n        $target = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(_this.restoreTarget()).detach();\n      }\n\n      _this.context.triggerEvent('media.delete', $target, _this.$editable);\n    });\n    /**\n     * float me\n     *\n     * @param {String} value\n     */\n\n    this.floatMe = this.wrapCommand(function (value) {\n      var $target = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(_this.restoreTarget());\n      $target.toggleClass('note-float-left', value === 'left');\n      $target.toggleClass('note-float-right', value === 'right');\n      $target.css('float', value === 'none' ? '' : value);\n    });\n    /**\n     * resize overlay element\n     * @param {String} value\n     */\n\n    this.resize = this.wrapCommand(function (value) {\n      var $target = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(_this.restoreTarget());\n      value = parseFloat(value);\n\n      if (value === 0) {\n        $target.css('width', '');\n      } else {\n        $target.css({\n          width: value * 100 + '%',\n          height: ''\n        });\n      }\n    });\n  }\n\n  Editor_createClass(Editor, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var _this2 = this;\n\n      // bind custom events\n      this.$editable.on('keydown', function (event) {\n        if (event.keyCode === core_key.code.ENTER) {\n          _this2.context.triggerEvent('enter', event);\n        }\n\n        _this2.context.triggerEvent('keydown', event); // keep a snapshot to limit text on input event\n\n\n        _this2.snapshot = _this2.history.makeSnapshot();\n        _this2.hasKeyShortCut = false;\n\n        if (!event.isDefaultPrevented()) {\n          if (_this2.options.shortcuts) {\n            _this2.hasKeyShortCut = _this2.handleKeyMap(event);\n          } else {\n            _this2.preventDefaultEditableShortCuts(event);\n          }\n        }\n\n        if (_this2.isLimited(1, event)) {\n          var lastRange = _this2.getLastRange();\n\n          if (lastRange.eo - lastRange.so === 0) {\n            return false;\n          }\n        }\n\n        _this2.setLastRange(); // record undo in the key event except keyMap.\n\n\n        if (_this2.options.recordEveryKeystroke) {\n          if (_this2.hasKeyShortCut === false) {\n            _this2.history.recordUndo();\n          }\n        }\n      }).on('keyup', function (event) {\n        _this2.setLastRange();\n\n        _this2.context.triggerEvent('keyup', event);\n      }).on('focus', function (event) {\n        _this2.setLastRange();\n\n        _this2.context.triggerEvent('focus', event);\n      }).on('blur', function (event) {\n        _this2.context.triggerEvent('blur', event);\n      }).on('mousedown', function (event) {\n        _this2.context.triggerEvent('mousedown', event);\n      }).on('mouseup', function (event) {\n        _this2.setLastRange();\n\n        _this2.history.recordUndo();\n\n        _this2.context.triggerEvent('mouseup', event);\n      }).on('scroll', function (event) {\n        _this2.context.triggerEvent('scroll', event);\n      }).on('paste', function (event) {\n        _this2.setLastRange();\n\n        _this2.context.triggerEvent('paste', event);\n      }).on('input', function () {\n        // To limit composition characters (e.g. Korean)\n        if (_this2.isLimited(0) && _this2.snapshot) {\n          _this2.history.applySnapshot(_this2.snapshot);\n        }\n      });\n      this.$editable.attr('spellcheck', this.options.spellCheck);\n      this.$editable.attr('autocorrect', this.options.spellCheck);\n\n      if (this.options.disableGrammar) {\n        this.$editable.attr('data-gramm', false);\n      } // init content before set event\n\n\n      this.$editable.html(dom.html(this.$note) || dom.emptyPara);\n      this.$editable.on(env.inputEventName, func.debounce(function () {\n        _this2.context.triggerEvent('change', _this2.$editable.html(), _this2.$editable);\n      }, 10));\n      this.$editable.on('focusin', function (event) {\n        _this2.context.triggerEvent('focusin', event);\n      }).on('focusout', function (event) {\n        _this2.context.triggerEvent('focusout', event);\n      });\n\n      if (this.options.airMode) {\n        if (this.options.overrideContextMenu) {\n          this.$editor.on('contextmenu', function (event) {\n            _this2.context.triggerEvent('contextmenu', event);\n\n            return false;\n          });\n        }\n      } else {\n        if (this.options.width) {\n          this.$editor.outerWidth(this.options.width);\n        }\n\n        if (this.options.height) {\n          this.$editable.outerHeight(this.options.height);\n        }\n\n        if (this.options.maxHeight) {\n          this.$editable.css('max-height', this.options.maxHeight);\n        }\n\n        if (this.options.minHeight) {\n          this.$editable.css('min-height', this.options.minHeight);\n        }\n      }\n\n      this.history.recordUndo();\n      this.setLastRange();\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$editable.off();\n    }\n  }, {\n    key: \"handleKeyMap\",\n    value: function handleKeyMap(event) {\n      var keyMap = this.options.keyMap[env.isMac ? 'mac' : 'pc'];\n      var keys = [];\n\n      if (event.metaKey) {\n        keys.push('CMD');\n      }\n\n      if (event.ctrlKey && !event.altKey) {\n        keys.push('CTRL');\n      }\n\n      if (event.shiftKey) {\n        keys.push('SHIFT');\n      }\n\n      var keyName = core_key.nameFromCode[event.keyCode];\n\n      if (keyName) {\n        keys.push(keyName);\n      }\n\n      var eventName = keyMap[keys.join('+')];\n\n      if (keyName === 'TAB' && !this.options.tabDisable) {\n        this.afterCommand();\n      } else if (eventName) {\n        if (this.context.invoke(eventName) !== false) {\n          event.preventDefault(); // if keyMap action was invoked\n\n          return true;\n        }\n      } else if (core_key.isEdit(event.keyCode)) {\n        this.afterCommand();\n      }\n\n      return false;\n    }\n  }, {\n    key: \"preventDefaultEditableShortCuts\",\n    value: function preventDefaultEditableShortCuts(event) {\n      // B(Bold, 66) / I(Italic, 73) / U(Underline, 85)\n      if ((event.ctrlKey || event.metaKey) && lists.contains([66, 73, 85], event.keyCode)) {\n        event.preventDefault();\n      }\n    }\n  }, {\n    key: \"isLimited\",\n    value: function isLimited(pad, event) {\n      pad = pad || 0;\n\n      if (typeof event !== 'undefined') {\n        if (core_key.isMove(event.keyCode) || core_key.isNavigation(event.keyCode) || event.ctrlKey || event.metaKey || lists.contains([core_key.code.BACKSPACE, core_key.code.DELETE], event.keyCode)) {\n          return false;\n        }\n      }\n\n      if (this.options.maxTextLength > 0) {\n        if (this.$editable.text().length + pad > this.options.maxTextLength) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n    /**\n     * create range\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"createRange\",\n    value: function createRange() {\n      this.focus();\n      this.setLastRange();\n      return this.getLastRange();\n    }\n    /**\n     * create a new range from the list of elements\n     *\n     * @param {list} dom element list\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"createRangeFromList\",\n    value: function createRangeFromList(lst) {\n      var startRange = range.createFromNodeBefore(lists.head(lst));\n      var startPoint = startRange.getStartPoint();\n      var endRange = range.createFromNodeAfter(lists.last(lst));\n      var endPoint = endRange.getEndPoint();\n      return range.create(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);\n    }\n    /**\n     * set the last range\n     *\n     * if given rng is exist, set rng as the last range\n     * or create a new range at the end of the document\n     *\n     * @param {WrappedRange} rng\n     */\n\n  }, {\n    key: \"setLastRange\",\n    value: function setLastRange(rng) {\n      if (rng) {\n        this.lastRange = rng;\n      } else {\n        this.lastRange = range.create(this.editable);\n\n        if (external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.lastRange.sc).closest('.note-editable').length === 0) {\n          this.lastRange = range.createFromBodyElement(this.editable);\n        }\n      }\n    }\n    /**\n     * get the last range\n     *\n     * if there is a saved last range, return it\n     * or create a new range and return it\n     *\n     * @return {WrappedRange}\n     */\n\n  }, {\n    key: \"getLastRange\",\n    value: function getLastRange() {\n      if (!this.lastRange) {\n        this.setLastRange();\n      }\n\n      return this.lastRange;\n    }\n    /**\n     * saveRange\n     *\n     * save current range\n     *\n     * @param {Boolean} [thenCollapse=false]\n     */\n\n  }, {\n    key: \"saveRange\",\n    value: function saveRange(thenCollapse) {\n      if (thenCollapse) {\n        this.getLastRange().collapse().select();\n      }\n    }\n    /**\n     * restoreRange\n     *\n     * restore lately range\n     */\n\n  }, {\n    key: \"restoreRange\",\n    value: function restoreRange() {\n      if (this.lastRange) {\n        this.lastRange.select();\n        this.focus();\n      }\n    }\n  }, {\n    key: \"saveTarget\",\n    value: function saveTarget(node) {\n      this.$editable.data('target', node);\n    }\n  }, {\n    key: \"clearTarget\",\n    value: function clearTarget() {\n      this.$editable.removeData('target');\n    }\n  }, {\n    key: \"restoreTarget\",\n    value: function restoreTarget() {\n      return this.$editable.data('target');\n    }\n    /**\n     * currentStyle\n     *\n     * current style\n     * @return {Object|Boolean} unfocus\n     */\n\n  }, {\n    key: \"currentStyle\",\n    value: function currentStyle() {\n      var rng = range.create();\n\n      if (rng) {\n        rng = rng.normalize();\n      }\n\n      return rng ? this.style.current(rng) : this.style.fromNode(this.$editable);\n    }\n    /**\n     * style from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */\n\n  }, {\n    key: \"styleFromNode\",\n    value: function styleFromNode($node) {\n      return this.style.fromNode($node);\n    }\n    /**\n     * undo\n     */\n\n  }, {\n    key: \"undo\",\n    value: function undo() {\n      this.context.triggerEvent('before.command', this.$editable.html());\n      this.history.undo();\n      this.context.triggerEvent('change', this.$editable.html(), this.$editable);\n    }\n    /*\n    * commit\n    */\n\n  }, {\n    key: \"commit\",\n    value: function commit() {\n      this.context.triggerEvent('before.command', this.$editable.html());\n      this.history.commit();\n      this.context.triggerEvent('change', this.$editable.html(), this.$editable);\n    }\n    /**\n     * redo\n     */\n\n  }, {\n    key: \"redo\",\n    value: function redo() {\n      this.context.triggerEvent('before.command', this.$editable.html());\n      this.history.redo();\n      this.context.triggerEvent('change', this.$editable.html(), this.$editable);\n    }\n    /**\n     * before command\n     */\n\n  }, {\n    key: \"beforeCommand\",\n    value: function beforeCommand() {\n      this.context.triggerEvent('before.command', this.$editable.html()); // Set styleWithCSS before run a command\n\n      document.execCommand('styleWithCSS', false, this.options.styleWithCSS); // keep focus on editable before command execution\n\n      this.focus();\n    }\n    /**\n     * after command\n     * @param {Boolean} isPreventTrigger\n     */\n\n  }, {\n    key: \"afterCommand\",\n    value: function afterCommand(isPreventTrigger) {\n      this.normalizeContent();\n      this.history.recordUndo();\n\n      if (!isPreventTrigger) {\n        this.context.triggerEvent('change', this.$editable.html(), this.$editable);\n      }\n    }\n    /**\n     * handle tab key\n     */\n\n  }, {\n    key: \"tab\",\n    value: function tab() {\n      var rng = this.getLastRange();\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.table.tab(rng);\n      } else {\n        if (this.options.tabSize === 0) {\n          return false;\n        }\n\n        if (!this.isLimited(this.options.tabSize)) {\n          this.beforeCommand();\n          this.typing.insertTab(rng, this.options.tabSize);\n          this.afterCommand();\n        }\n      }\n    }\n    /**\n     * handle shift+tab key\n     */\n\n  }, {\n    key: \"untab\",\n    value: function untab() {\n      var rng = this.getLastRange();\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.table.tab(rng, true);\n      } else {\n        if (this.options.tabSize === 0) {\n          return false;\n        }\n      }\n    }\n    /**\n     * run given function between beforeCommand and afterCommand\n     */\n\n  }, {\n    key: \"wrapCommand\",\n    value: function wrapCommand(fn) {\n      return function () {\n        this.beforeCommand();\n        fn.apply(this, arguments);\n        this.afterCommand();\n      };\n    }\n    /**\n     * insert image\n     *\n     * @param {String} src\n     * @param {String|Function} param\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"insertImage\",\n    value: function insertImage(src, param) {\n      var _this3 = this;\n\n      return createImage(src, param).then(function ($image) {\n        _this3.beforeCommand();\n\n        if (typeof param === 'function') {\n          param($image);\n        } else {\n          if (typeof param === 'string') {\n            $image.attr('data-filename', param);\n          }\n\n          $image.css('width', Math.min(_this3.$editable.width(), $image.width()));\n        }\n\n        $image.show();\n\n        _this3.getLastRange().insertNode($image[0]);\n\n        _this3.setLastRange(range.createFromNodeAfter($image[0]).select());\n\n        _this3.afterCommand();\n      }).fail(function (e) {\n        _this3.context.triggerEvent('image.upload.error', e);\n      });\n    }\n    /**\n     * insertImages\n     * @param {File[]} files\n     */\n\n  }, {\n    key: \"insertImagesAsDataURL\",\n    value: function insertImagesAsDataURL(files) {\n      var _this4 = this;\n\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(files, function (idx, file) {\n        var filename = file.name;\n\n        if (_this4.options.maximumImageFileSize && _this4.options.maximumImageFileSize < file.size) {\n          _this4.context.triggerEvent('image.upload.error', _this4.lang.image.maximumFileSizeError);\n        } else {\n          readFileAsDataURL(file).then(function (dataURL) {\n            return _this4.insertImage(dataURL, filename);\n          }).fail(function () {\n            _this4.context.triggerEvent('image.upload.error');\n          });\n        }\n      });\n    }\n    /**\n     * insertImagesOrCallback\n     * @param {File[]} files\n     */\n\n  }, {\n    key: \"insertImagesOrCallback\",\n    value: function insertImagesOrCallback(files) {\n      var callbacks = this.options.callbacks; // If onImageUpload set,\n\n      if (callbacks.onImageUpload) {\n        this.context.triggerEvent('image.upload', files); // else insert Image as dataURL\n      } else {\n        this.insertImagesAsDataURL(files);\n      }\n    }\n    /**\n     * return selected plain text\n     * @return {String} text\n     */\n\n  }, {\n    key: \"getSelectedText\",\n    value: function getSelectedText() {\n      var rng = this.getLastRange(); // if range on anchor, expand range with anchor\n\n      if (rng.isOnAnchor()) {\n        rng = range.createFromNode(dom.ancestor(rng.sc, dom.isAnchor));\n      }\n\n      return rng.toString();\n    }\n  }, {\n    key: \"onFormatBlock\",\n    value: function onFormatBlock(tagName, $target) {\n      // [workaround] for MSIE, IE need `<`\n      document.execCommand('FormatBlock', false, env.isMSIE ? '<' + tagName + '>' : tagName); // support custom class\n\n      if ($target && $target.length) {\n        // find the exact element has given tagName\n        if ($target[0].tagName.toUpperCase() !== tagName.toUpperCase()) {\n          $target = $target.find(tagName);\n        }\n\n        if ($target && $target.length) {\n          var className = $target[0].className || '';\n\n          if (className) {\n            var currentRange = this.createRange();\n            var $parent = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()([currentRange.sc, currentRange.ec]).closest(tagName);\n            $parent.addClass(className);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"formatPara\",\n    value: function formatPara() {\n      this.formatBlock('P');\n    }\n  }, {\n    key: \"fontStyling\",\n    value: function fontStyling(target, value) {\n      var rng = this.getLastRange();\n\n      if (rng !== '') {\n        var spans = this.style.styleNodes(rng);\n        this.$editor.find('.note-status-output').html('');\n        external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(spans).css(target, value); // [workaround] added styled bogus span for style\n        //  - also bogus character needed for cursor position\n\n        if (rng.isCollapsed()) {\n          var firstSpan = lists.head(spans);\n\n          if (firstSpan && !dom.nodeLength(firstSpan)) {\n            firstSpan.innerHTML = dom.ZERO_WIDTH_NBSP_CHAR;\n            range.createFromNode(firstSpan.firstChild).select();\n            this.setLastRange();\n            this.$editable.data(KEY_BOGUS, firstSpan);\n          }\n        } else {\n          this.setLastRange(this.createRangeFromList(spans).select());\n        }\n      } else {\n        var noteStatusOutput = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.now();\n        this.$editor.find('.note-status-output').html('<div id=\"note-status-output-' + noteStatusOutput + '\" class=\"alert alert-info\">' + this.lang.output.noSelection + '</div>');\n        setTimeout(function () {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('#note-status-output-' + noteStatusOutput).remove();\n        }, 5000);\n      }\n    }\n    /**\n     * unlink\n     *\n     * @type command\n     */\n\n  }, {\n    key: \"unlink\",\n    value: function unlink() {\n      var rng = this.getLastRange();\n\n      if (rng.isOnAnchor()) {\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\n        rng = range.createFromNode(anchor);\n        rng.select();\n        this.setLastRange();\n        this.beforeCommand();\n        document.execCommand('unlink');\n        this.afterCommand();\n      }\n    }\n    /**\n     * returns link info\n     *\n     * @return {Object}\n     * @return {WrappedRange} return.range\n     * @return {String} return.text\n     * @return {Boolean} [return.isNewWindow=true]\n     * @return {String} [return.url=\"\"]\n     */\n\n  }, {\n    key: \"getLinkInfo\",\n    value: function getLinkInfo() {\n      var rng = this.getLastRange().expand(dom.isAnchor); // Get the first anchor on range(for edit).\n\n      var $anchor = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(lists.head(rng.nodes(dom.isAnchor)));\n      var linkInfo = {\n        range: rng,\n        text: rng.toString(),\n        url: $anchor.length ? $anchor.attr('href') : ''\n      }; // When anchor exists,\n\n      if ($anchor.length) {\n        // Set isNewWindow by checking its target.\n        linkInfo.isNewWindow = $anchor.attr('target') === '_blank';\n      }\n\n      return linkInfo;\n    }\n  }, {\n    key: \"addRow\",\n    value: function addRow(position) {\n      var rng = this.getLastRange(this.$editable);\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.beforeCommand();\n        this.table.addRow(rng, position);\n        this.afterCommand();\n      }\n    }\n  }, {\n    key: \"addCol\",\n    value: function addCol(position) {\n      var rng = this.getLastRange(this.$editable);\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.beforeCommand();\n        this.table.addCol(rng, position);\n        this.afterCommand();\n      }\n    }\n  }, {\n    key: \"deleteRow\",\n    value: function deleteRow() {\n      var rng = this.getLastRange(this.$editable);\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.beforeCommand();\n        this.table.deleteRow(rng);\n        this.afterCommand();\n      }\n    }\n  }, {\n    key: \"deleteCol\",\n    value: function deleteCol() {\n      var rng = this.getLastRange(this.$editable);\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.beforeCommand();\n        this.table.deleteCol(rng);\n        this.afterCommand();\n      }\n    }\n  }, {\n    key: \"deleteTable\",\n    value: function deleteTable() {\n      var rng = this.getLastRange(this.$editable);\n\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        this.beforeCommand();\n        this.table.deleteTable(rng);\n        this.afterCommand();\n      }\n    }\n    /**\n     * @param {Position} pos\n     * @param {jQuery} $target - target element\n     * @param {Boolean} [bKeepRatio] - keep ratio\n     */\n\n  }, {\n    key: \"resizeTo\",\n    value: function resizeTo(pos, $target, bKeepRatio) {\n      var imageSize;\n\n      if (bKeepRatio) {\n        var newRatio = pos.y / pos.x;\n        var ratio = $target.data('ratio');\n        imageSize = {\n          width: ratio > newRatio ? pos.x : pos.y / ratio,\n          height: ratio > newRatio ? pos.x * ratio : pos.y\n        };\n      } else {\n        imageSize = {\n          width: pos.x,\n          height: pos.y\n        };\n      }\n\n      $target.css(imageSize);\n    }\n    /**\n     * returns whether editable area has focus or not.\n     */\n\n  }, {\n    key: \"hasFocus\",\n    value: function hasFocus() {\n      return this.$editable.is(':focus');\n    }\n    /**\n     * set focus\n     */\n\n  }, {\n    key: \"focus\",\n    value: function focus() {\n      // [workaround] Screen will move when page is scolled in IE.\n      //  - do focus when not focused\n      if (!this.hasFocus()) {\n        this.$editable.focus();\n      }\n    }\n    /**\n     * returns whether contents is empty or not.\n     * @return {Boolean}\n     */\n\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return dom.isEmpty(this.$editable[0]) || dom.emptyPara === this.$editable.html();\n    }\n    /**\n     * Removes all contents and restores the editable instance to an _emptyPara_.\n     */\n\n  }, {\n    key: \"empty\",\n    value: function empty() {\n      this.context.invoke('code', dom.emptyPara);\n    }\n    /**\n     * normalize content\n     */\n\n  }, {\n    key: \"normalizeContent\",\n    value: function normalizeContent() {\n      this.$editable[0].normalize();\n    }\n  }]);\n\n  return Editor;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Clipboard.js\nfunction Clipboard_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Clipboard_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Clipboard_createClass(Constructor, protoProps, staticProps) { if (protoProps) Clipboard_defineProperties(Constructor.prototype, protoProps); if (staticProps) Clipboard_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar Clipboard_Clipboard = /*#__PURE__*/function () {\n  function Clipboard(context) {\n    Clipboard_classCallCheck(this, Clipboard);\n\n    this.context = context;\n    this.$editable = context.layoutInfo.editable;\n  }\n\n  Clipboard_createClass(Clipboard, [{\n    key: \"initialize\",\n    value: function initialize() {\n      this.$editable.on('paste', this.pasteByEvent.bind(this));\n    }\n    /**\n     * paste by clipboard event\n     *\n     * @param {Event} event\n     */\n\n  }, {\n    key: \"pasteByEvent\",\n    value: function pasteByEvent(event) {\n      var _this = this;\n\n      var clipboardData = event.originalEvent.clipboardData;\n\n      if (clipboardData && clipboardData.items && clipboardData.items.length) {\n        var item = clipboardData.items.length > 1 ? clipboardData.items[1] : lists.head(clipboardData.items);\n\n        if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {\n          // paste img file\n          this.context.invoke('editor.insertImagesOrCallback', [item.getAsFile()]);\n          event.preventDefault();\n        } else if (item.kind === 'string') {\n          // paste text with maxTextLength check\n          if (this.context.invoke('editor.isLimited', clipboardData.getData('Text').length)) {\n            event.preventDefault();\n          }\n        }\n      } else if (window.clipboardData) {\n        // for IE\n        var text = window.clipboardData.getData('text');\n\n        if (this.context.invoke('editor.isLimited', text.length)) {\n          event.preventDefault();\n        }\n      } // Call editor.afterCommand after proceeding default event handler\n\n\n      setTimeout(function () {\n        _this.context.invoke('editor.afterCommand');\n      }, 10);\n    }\n  }]);\n\n  return Clipboard;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Dropzone.js\nfunction Dropzone_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Dropzone_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Dropzone_createClass(Constructor, protoProps, staticProps) { if (protoProps) Dropzone_defineProperties(Constructor.prototype, protoProps); if (staticProps) Dropzone_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar Dropzone_Dropzone = /*#__PURE__*/function () {\n  function Dropzone(context) {\n    Dropzone_classCallCheck(this, Dropzone);\n\n    this.context = context;\n    this.$eventListener = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document);\n    this.$editor = context.layoutInfo.editor;\n    this.$editable = context.layoutInfo.editable;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n    this.documentEventHandlers = {};\n    this.$dropzone = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(['<div class=\"note-dropzone\">', '<div class=\"note-dropzone-message\"></div>', '</div>'].join('')).prependTo(this.$editor);\n  }\n  /**\n   * attach Drag and Drop Events\n   */\n\n\n  Dropzone_createClass(Dropzone, [{\n    key: \"initialize\",\n    value: function initialize() {\n      if (this.options.disableDragAndDrop) {\n        // prevent default drop event\n        this.documentEventHandlers.onDrop = function (e) {\n          e.preventDefault();\n        }; // do not consider outside of dropzone\n\n\n        this.$eventListener = this.$dropzone;\n        this.$eventListener.on('drop', this.documentEventHandlers.onDrop);\n      } else {\n        this.attachDragAndDropEvent();\n      }\n    }\n    /**\n     * attach Drag and Drop Events\n     */\n\n  }, {\n    key: \"attachDragAndDropEvent\",\n    value: function attachDragAndDropEvent() {\n      var _this = this;\n\n      var collection = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()();\n      var $dropzoneMessage = this.$dropzone.find('.note-dropzone-message');\n\n      this.documentEventHandlers.onDragenter = function (e) {\n        var isCodeview = _this.context.invoke('codeview.isActivated');\n\n        var hasEditorSize = _this.$editor.width() > 0 && _this.$editor.height() > 0;\n\n        if (!isCodeview && !collection.length && hasEditorSize) {\n          _this.$editor.addClass('dragover');\n\n          _this.$dropzone.width(_this.$editor.width());\n\n          _this.$dropzone.height(_this.$editor.height());\n\n          $dropzoneMessage.text(_this.lang.image.dragImageHere);\n        }\n\n        collection = collection.add(e.target);\n      };\n\n      this.documentEventHandlers.onDragleave = function (e) {\n        collection = collection.not(e.target); // If nodeName is BODY, then just make it over (fix for IE)\n\n        if (!collection.length || e.target.nodeName === 'BODY') {\n          collection = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()();\n\n          _this.$editor.removeClass('dragover');\n        }\n      };\n\n      this.documentEventHandlers.onDrop = function () {\n        collection = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()();\n\n        _this.$editor.removeClass('dragover');\n      }; // show dropzone on dragenter when dragging a object to document\n      // -but only if the editor is visible, i.e. has a positive width and height\n\n\n      this.$eventListener.on('dragenter', this.documentEventHandlers.onDragenter).on('dragleave', this.documentEventHandlers.onDragleave).on('drop', this.documentEventHandlers.onDrop); // change dropzone's message on hover.\n\n      this.$dropzone.on('dragenter', function () {\n        _this.$dropzone.addClass('hover');\n\n        $dropzoneMessage.text(_this.lang.image.dropImage);\n      }).on('dragleave', function () {\n        _this.$dropzone.removeClass('hover');\n\n        $dropzoneMessage.text(_this.lang.image.dragImageHere);\n      }); // attach dropImage\n\n      this.$dropzone.on('drop', function (event) {\n        var dataTransfer = event.originalEvent.dataTransfer; // stop the browser from opening the dropped content\n\n        event.preventDefault();\n\n        if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\n          _this.$editable.focus();\n\n          _this.context.invoke('editor.insertImagesOrCallback', dataTransfer.files);\n        } else {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(dataTransfer.types, function (idx, type) {\n            // skip moz-specific types\n            if (type.toLowerCase().indexOf('_moz_') > -1) {\n              return;\n            }\n\n            var content = dataTransfer.getData(type);\n\n            if (type.toLowerCase().indexOf('text') > -1) {\n              _this.context.invoke('editor.pasteHTML', content);\n            } else {\n              external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(content).each(function (idx, item) {\n                _this.context.invoke('editor.insertNode', item);\n              });\n            }\n          });\n        }\n      }).on('dragover', false); // prevent default dragover event\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var _this2 = this;\n\n      Object.keys(this.documentEventHandlers).forEach(function (key) {\n        _this2.$eventListener.off(key.substr(2).toLowerCase(), _this2.documentEventHandlers[key]);\n      });\n      this.documentEventHandlers = {};\n    }\n  }]);\n\n  return Dropzone;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Codeview.js\nfunction _createForOfIteratorHelper(o) { if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (o = _unsupportedIterableToArray(o))) { var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var it, normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(n); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction Codeview_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Codeview_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Codeview_createClass(Constructor, protoProps, staticProps) { if (protoProps) Codeview_defineProperties(Constructor.prototype, protoProps); if (staticProps) Codeview_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n/**\n * @class Codeview\n */\n\nvar Codeview_CodeView = /*#__PURE__*/function () {\n  function CodeView(context) {\n    Codeview_classCallCheck(this, CodeView);\n\n    this.context = context;\n    this.$editor = context.layoutInfo.editor;\n    this.$editable = context.layoutInfo.editable;\n    this.$codable = context.layoutInfo.codable;\n    this.options = context.options;\n    this.CodeMirrorConstructor = window.CodeMirror;\n\n    if (this.options.codemirror.CodeMirrorConstructor) {\n      this.CodeMirrorConstructor = this.options.codemirror.CodeMirrorConstructor;\n    }\n  }\n\n  Codeview_createClass(CodeView, [{\n    key: \"sync\",\n    value: function sync(html) {\n      var isCodeview = this.isActivated();\n      var CodeMirror = this.CodeMirrorConstructor;\n\n      if (isCodeview) {\n        if (html) {\n          if (CodeMirror) {\n            this.$codable.data('cmEditor').getDoc().setValue(html);\n          } else {\n            this.$codable.val(html);\n          }\n        } else {\n          if (CodeMirror) {\n            this.$codable.data('cmEditor').save();\n          }\n        }\n      }\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this = this;\n\n      this.$codable.on('keyup', function (event) {\n        if (event.keyCode === core_key.code.ESCAPE) {\n          _this.deactivate();\n        }\n      });\n    }\n    /**\n     * @return {Boolean}\n     */\n\n  }, {\n    key: \"isActivated\",\n    value: function isActivated() {\n      return this.$editor.hasClass('codeview');\n    }\n    /**\n     * toggle codeview\n     */\n\n  }, {\n    key: \"toggle\",\n    value: function toggle() {\n      if (this.isActivated()) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n\n      this.context.triggerEvent('codeview.toggled');\n    }\n    /**\n     * purify input value\n     * @param value\n     * @returns {*}\n     */\n\n  }, {\n    key: \"purify\",\n    value: function purify(value) {\n      if (this.options.codeviewFilter) {\n        // filter code view regex\n        value = value.replace(this.options.codeviewFilterRegex, ''); // allow specific iframe tag\n\n        if (this.options.codeviewIframeFilter) {\n          var whitelist = this.options.codeviewIframeWhitelistSrc.concat(this.options.codeviewIframeWhitelistSrcBase);\n          value = value.replace(/(<iframe.*?>.*?(?:<\\/iframe>)?)/gi, function (tag) {\n            // remove if src attribute is duplicated\n            if (/<.+src(?==?('|\"|\\s)?)[\\s\\S]+src(?=('|\"|\\s)?)[^>]*?>/i.test(tag)) {\n              return '';\n            }\n\n            var _iterator = _createForOfIteratorHelper(whitelist),\n                _step;\n\n            try {\n              for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                var src = _step.value;\n\n                // pass if src is trusted\n                if (new RegExp('src=\"(https?:)?\\/\\/' + src.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&') + '\\/(.+)\"').test(tag)) {\n                  return tag;\n                }\n              }\n            } catch (err) {\n              _iterator.e(err);\n            } finally {\n              _iterator.f();\n            }\n\n            return '';\n          });\n        }\n      }\n\n      return value;\n    }\n    /**\n     * activate code view\n     */\n\n  }, {\n    key: \"activate\",\n    value: function activate() {\n      var _this2 = this;\n\n      var CodeMirror = this.CodeMirrorConstructor;\n      this.$codable.val(dom.html(this.$editable, this.options.prettifyHtml));\n      this.$codable.height(this.$editable.height());\n      this.context.invoke('toolbar.updateCodeview', true);\n      this.context.invoke('airPopover.updateCodeview', true);\n      this.$editor.addClass('codeview');\n      this.$codable.focus(); // activate CodeMirror as codable\n\n      if (CodeMirror) {\n        var cmEditor = CodeMirror.fromTextArea(this.$codable[0], this.options.codemirror); // CodeMirror TernServer\n\n        if (this.options.codemirror.tern) {\n          var server = new CodeMirror.TernServer(this.options.codemirror.tern);\n          cmEditor.ternServer = server;\n          cmEditor.on('cursorActivity', function (cm) {\n            server.updateArgHints(cm);\n          });\n        }\n\n        cmEditor.on('blur', function (event) {\n          _this2.context.triggerEvent('blur.codeview', cmEditor.getValue(), event);\n        });\n        cmEditor.on('change', function () {\n          _this2.context.triggerEvent('change.codeview', cmEditor.getValue(), cmEditor);\n        }); // CodeMirror hasn't Padding.\n\n        cmEditor.setSize(null, this.$editable.outerHeight());\n        this.$codable.data('cmEditor', cmEditor);\n      } else {\n        this.$codable.on('blur', function (event) {\n          _this2.context.triggerEvent('blur.codeview', _this2.$codable.val(), event);\n        });\n        this.$codable.on('input', function () {\n          _this2.context.triggerEvent('change.codeview', _this2.$codable.val(), _this2.$codable);\n        });\n      }\n    }\n    /**\n     * deactivate code view\n     */\n\n  }, {\n    key: \"deactivate\",\n    value: function deactivate() {\n      var CodeMirror = this.CodeMirrorConstructor; // deactivate CodeMirror as codable\n\n      if (CodeMirror) {\n        var cmEditor = this.$codable.data('cmEditor');\n        this.$codable.val(cmEditor.getValue());\n        cmEditor.toTextArea();\n      }\n\n      var value = this.purify(dom.value(this.$codable, this.options.prettifyHtml) || dom.emptyPara);\n      var isChange = this.$editable.html() !== value;\n      this.$editable.html(value);\n      this.$editable.height(this.options.height ? this.$codable.height() : 'auto');\n      this.$editor.removeClass('codeview');\n\n      if (isChange) {\n        this.context.triggerEvent('change', this.$editable.html(), this.$editable);\n      }\n\n      this.$editable.focus();\n      this.context.invoke('toolbar.updateCodeview', false);\n      this.context.invoke('airPopover.updateCodeview', false);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      if (this.isActivated()) {\n        this.deactivate();\n      }\n    }\n  }]);\n\n  return CodeView;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Statusbar.js\nfunction Statusbar_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Statusbar_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Statusbar_createClass(Constructor, protoProps, staticProps) { if (protoProps) Statusbar_defineProperties(Constructor.prototype, protoProps); if (staticProps) Statusbar_defineProperties(Constructor, staticProps); return Constructor; }\n\n\nvar EDITABLE_PADDING = 24;\n\nvar Statusbar_Statusbar = /*#__PURE__*/function () {\n  function Statusbar(context) {\n    Statusbar_classCallCheck(this, Statusbar);\n\n    this.$document = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document);\n    this.$statusbar = context.layoutInfo.statusbar;\n    this.$editable = context.layoutInfo.editable;\n    this.options = context.options;\n  }\n\n  Statusbar_createClass(Statusbar, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var _this = this;\n\n      if (this.options.airMode || this.options.disableResizeEditor) {\n        this.destroy();\n        return;\n      }\n\n      this.$statusbar.on('mousedown', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        var editableTop = _this.$editable.offset().top - _this.$document.scrollTop();\n\n        var onMouseMove = function onMouseMove(event) {\n          var height = event.clientY - (editableTop + EDITABLE_PADDING);\n          height = _this.options.minheight > 0 ? Math.max(height, _this.options.minheight) : height;\n          height = _this.options.maxHeight > 0 ? Math.min(height, _this.options.maxHeight) : height;\n\n          _this.$editable.height(height);\n        };\n\n        _this.$document.on('mousemove', onMouseMove).one('mouseup', function () {\n          _this.$document.off('mousemove', onMouseMove);\n        });\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$statusbar.off();\n      this.$statusbar.addClass('locked');\n    }\n  }]);\n\n  return Statusbar;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Fullscreen.js\nfunction Fullscreen_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Fullscreen_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Fullscreen_createClass(Constructor, protoProps, staticProps) { if (protoProps) Fullscreen_defineProperties(Constructor.prototype, protoProps); if (staticProps) Fullscreen_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar Fullscreen_Fullscreen = /*#__PURE__*/function () {\n  function Fullscreen(context) {\n    var _this = this;\n\n    Fullscreen_classCallCheck(this, Fullscreen);\n\n    this.context = context;\n    this.$editor = context.layoutInfo.editor;\n    this.$toolbar = context.layoutInfo.toolbar;\n    this.$editable = context.layoutInfo.editable;\n    this.$codable = context.layoutInfo.codable;\n    this.$window = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(window);\n    this.$scrollbar = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('html, body');\n\n    this.onResize = function () {\n      _this.resizeTo({\n        h: _this.$window.height() - _this.$toolbar.outerHeight()\n      });\n    };\n  }\n\n  Fullscreen_createClass(Fullscreen, [{\n    key: \"resizeTo\",\n    value: function resizeTo(size) {\n      this.$editable.css('height', size.h);\n      this.$codable.css('height', size.h);\n\n      if (this.$codable.data('cmeditor')) {\n        this.$codable.data('cmeditor').setsize(null, size.h);\n      }\n    }\n    /**\n     * toggle fullscreen\n     */\n\n  }, {\n    key: \"toggle\",\n    value: function toggle() {\n      this.$editor.toggleClass('fullscreen');\n\n      if (this.isFullscreen()) {\n        this.$editable.data('orgHeight', this.$editable.css('height'));\n        this.$editable.data('orgMaxHeight', this.$editable.css('maxHeight'));\n        this.$editable.css('maxHeight', '');\n        this.$window.on('resize', this.onResize).trigger('resize');\n        this.$scrollbar.css('overflow', 'hidden');\n      } else {\n        this.$window.off('resize', this.onResize);\n        this.resizeTo({\n          h: this.$editable.data('orgHeight')\n        });\n        this.$editable.css('maxHeight', this.$editable.css('orgMaxHeight'));\n        this.$scrollbar.css('overflow', 'visible');\n      }\n\n      this.context.invoke('toolbar.updateFullscreen', this.isFullscreen());\n    }\n  }, {\n    key: \"isFullscreen\",\n    value: function isFullscreen() {\n      return this.$editor.hasClass('fullscreen');\n    }\n  }]);\n\n  return Fullscreen;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Handle.js\nfunction Handle_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Handle_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Handle_createClass(Constructor, protoProps, staticProps) { if (protoProps) Handle_defineProperties(Constructor.prototype, protoProps); if (staticProps) Handle_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\nvar Handle_Handle = /*#__PURE__*/function () {\n  function Handle(context) {\n    var _this = this;\n\n    Handle_classCallCheck(this, Handle);\n\n    this.context = context;\n    this.$document = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document);\n    this.$editingArea = context.layoutInfo.editingArea;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n    this.events = {\n      'summernote.mousedown': function summernoteMousedown(we, e) {\n        if (_this.update(e.target, e)) {\n          e.preventDefault();\n        }\n      },\n      'summernote.keyup summernote.scroll summernote.change summernote.dialog.shown': function summernoteKeyupSummernoteScrollSummernoteChangeSummernoteDialogShown() {\n        _this.update();\n      },\n      'summernote.disable summernote.blur': function summernoteDisableSummernoteBlur() {\n        _this.hide();\n      },\n      'summernote.codeview.toggled': function summernoteCodeviewToggled() {\n        _this.update();\n      }\n    };\n  }\n\n  Handle_createClass(Handle, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var _this2 = this;\n\n      this.$handle = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(['<div class=\"note-handle\">', '<div class=\"note-control-selection\">', '<div class=\"note-control-selection-bg\"></div>', '<div class=\"note-control-holder note-control-nw\"></div>', '<div class=\"note-control-holder note-control-ne\"></div>', '<div class=\"note-control-holder note-control-sw\"></div>', '<div class=\"', this.options.disableResizeImage ? 'note-control-holder' : 'note-control-sizing', ' note-control-se\"></div>', this.options.disableResizeImage ? '' : '<div class=\"note-control-selection-info\"></div>', '</div>', '</div>'].join('')).prependTo(this.$editingArea);\n      this.$handle.on('mousedown', function (event) {\n        if (dom.isControlSizing(event.target)) {\n          event.preventDefault();\n          event.stopPropagation();\n\n          var $target = _this2.$handle.find('.note-control-selection').data('target');\n\n          var posStart = $target.offset();\n\n          var scrollTop = _this2.$document.scrollTop();\n\n          var onMouseMove = function onMouseMove(event) {\n            _this2.context.invoke('editor.resizeTo', {\n              x: event.clientX - posStart.left,\n              y: event.clientY - (posStart.top - scrollTop)\n            }, $target, !event.shiftKey);\n\n            _this2.update($target[0], event);\n          };\n\n          _this2.$document.on('mousemove', onMouseMove).one('mouseup', function (e) {\n            e.preventDefault();\n\n            _this2.$document.off('mousemove', onMouseMove);\n\n            _this2.context.invoke('editor.afterCommand');\n          });\n\n          if (!$target.data('ratio')) {\n            // original ratio.\n            $target.data('ratio', $target.height() / $target.width());\n          }\n        }\n      }); // Listen for scrolling on the handle overlay.\n\n      this.$handle.on('wheel', function (e) {\n        e.preventDefault();\n\n        _this2.update();\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$handle.remove();\n    }\n  }, {\n    key: \"update\",\n    value: function update(target, event) {\n      if (this.context.isDisabled()) {\n        return false;\n      }\n\n      var isImage = dom.isImg(target);\n      var $selection = this.$handle.find('.note-control-selection');\n      this.context.invoke('imagePopover.update', target, event);\n\n      if (isImage) {\n        var $image = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(target);\n        var position = $image.position();\n        var pos = {\n          left: position.left + parseInt($image.css('marginLeft'), 10),\n          top: position.top + parseInt($image.css('marginTop'), 10)\n        }; // exclude margin\n\n        var imageSize = {\n          w: $image.outerWidth(false),\n          h: $image.outerHeight(false)\n        };\n        $selection.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top,\n          width: imageSize.w,\n          height: imageSize.h\n        }).data('target', $image); // save current image element.\n\n        var origImageObj = new Image();\n        origImageObj.src = $image.attr('src');\n        var sizingText = imageSize.w + 'x' + imageSize.h + ' (' + this.lang.image.original + ': ' + origImageObj.width + 'x' + origImageObj.height + ')';\n        $selection.find('.note-control-selection-info').text(sizingText);\n        this.context.invoke('editor.saveTarget', target);\n      } else {\n        this.hide();\n      }\n\n      return isImage;\n    }\n    /**\n     * hide\n     *\n     * @param {jQuery} $handle\n     */\n\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.context.invoke('editor.clearTarget');\n      this.$handle.children().hide();\n    }\n  }]);\n\n  return Handle;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/AutoLink.js\nfunction AutoLink_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction AutoLink_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction AutoLink_createClass(Constructor, protoProps, staticProps) { if (protoProps) AutoLink_defineProperties(Constructor.prototype, protoProps); if (staticProps) AutoLink_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\nvar defaultScheme = 'http://';\nvar linkPattern = /^([A-Za-z][A-Za-z0-9+-.]*\\:[\\/]{2}|tel:|mailto:[A-Z0-9._%+-]+@)?(www\\.)?(.+)$/i;\n\nvar AutoLink_AutoLink = /*#__PURE__*/function () {\n  function AutoLink(context) {\n    var _this = this;\n\n    AutoLink_classCallCheck(this, AutoLink);\n\n    this.context = context;\n    this.options = context.options;\n    this.events = {\n      'summernote.keyup': function summernoteKeyup(we, e) {\n        if (!e.isDefaultPrevented()) {\n          _this.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function summernoteKeydown(we, e) {\n        _this.handleKeydown(e);\n      }\n    };\n  }\n\n  AutoLink_createClass(AutoLink, [{\n    key: \"initialize\",\n    value: function initialize() {\n      this.lastWordRange = null;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.lastWordRange = null;\n    }\n  }, {\n    key: \"replace\",\n    value: function replace() {\n      if (!this.lastWordRange) {\n        return;\n      }\n\n      var keyword = this.lastWordRange.toString();\n      var match = keyword.match(linkPattern);\n\n      if (match && (match[1] || match[2])) {\n        var link = match[1] ? keyword : defaultScheme + keyword;\n        var urlText = this.options.showDomainOnlyForAutolink ? keyword.replace(/^(?:https?:\\/\\/)?(?:tel?:?)?(?:mailto?:?)?(?:www\\.)?/i, '').split('/')[0] : keyword;\n        var node = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<a />').html(urlText).attr('href', link)[0];\n\n        if (this.context.options.linkTargetBlank) {\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(node).attr('target', '_blank');\n        }\n\n        this.lastWordRange.insertNode(node);\n        this.lastWordRange = null;\n        this.context.invoke('editor.focus');\n      }\n    }\n  }, {\n    key: \"handleKeydown\",\n    value: function handleKeydown(e) {\n      if (lists.contains([core_key.code.ENTER, core_key.code.SPACE], e.keyCode)) {\n        var wordRange = this.context.invoke('editor.createRange').getWordRange();\n        this.lastWordRange = wordRange;\n      }\n    }\n  }, {\n    key: \"handleKeyup\",\n    value: function handleKeyup(e) {\n      if (lists.contains([core_key.code.ENTER, core_key.code.SPACE], e.keyCode)) {\n        this.replace();\n      }\n    }\n  }]);\n\n  return AutoLink;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/AutoSync.js\nfunction AutoSync_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction AutoSync_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction AutoSync_createClass(Constructor, protoProps, staticProps) { if (protoProps) AutoSync_defineProperties(Constructor.prototype, protoProps); if (staticProps) AutoSync_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n/**\n * textarea auto sync.\n */\n\nvar AutoSync_AutoSync = /*#__PURE__*/function () {\n  function AutoSync(context) {\n    var _this = this;\n\n    AutoSync_classCallCheck(this, AutoSync);\n\n    this.$note = context.layoutInfo.note;\n    this.events = {\n      'summernote.change': function summernoteChange() {\n        _this.$note.val(context.invoke('code'));\n      }\n    };\n  }\n\n  AutoSync_createClass(AutoSync, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return dom.isTextarea(this.$note[0]);\n    }\n  }]);\n\n  return AutoSync;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/AutoReplace.js\nfunction AutoReplace_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction AutoReplace_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction AutoReplace_createClass(Constructor, protoProps, staticProps) { if (protoProps) AutoReplace_defineProperties(Constructor.prototype, protoProps); if (staticProps) AutoReplace_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\nvar AutoReplace_AutoReplace = /*#__PURE__*/function () {\n  function AutoReplace(context) {\n    var _this = this;\n\n    AutoReplace_classCallCheck(this, AutoReplace);\n\n    this.context = context;\n    this.options = context.options.replace || {};\n    this.keys = [core_key.code.ENTER, core_key.code.SPACE, core_key.code.PERIOD, core_key.code.COMMA, core_key.code.SEMICOLON, core_key.code.SLASH];\n    this.previousKeydownCode = null;\n    this.events = {\n      'summernote.keyup': function summernoteKeyup(we, e) {\n        if (!e.isDefaultPrevented()) {\n          _this.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function summernoteKeydown(we, e) {\n        _this.handleKeydown(e);\n      }\n    };\n  }\n\n  AutoReplace_createClass(AutoReplace, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return !!this.options.match;\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      this.lastWord = null;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.lastWord = null;\n    }\n  }, {\n    key: \"replace\",\n    value: function replace() {\n      if (!this.lastWord) {\n        return;\n      }\n\n      var self = this;\n      var keyword = this.lastWord.toString();\n      this.options.match(keyword, function (match) {\n        if (match) {\n          var node = '';\n\n          if (typeof match === 'string') {\n            node = dom.createText(match);\n          } else if (match instanceof jQuery) {\n            node = match[0];\n          } else if (match instanceof Node) {\n            node = match;\n          }\n\n          if (!node) return;\n          self.lastWord.insertNode(node);\n          self.lastWord = null;\n          self.context.invoke('editor.focus');\n        }\n      });\n    }\n  }, {\n    key: \"handleKeydown\",\n    value: function handleKeydown(e) {\n      // this forces it to remember the last whole word, even if multiple termination keys are pressed\n      // before the previous key is let go.\n      if (this.previousKeydownCode && lists.contains(this.keys, this.previousKeydownCode)) {\n        this.previousKeydownCode = e.keyCode;\n        return;\n      }\n\n      if (lists.contains(this.keys, e.keyCode)) {\n        var wordRange = this.context.invoke('editor.createRange').getWordRange();\n        this.lastWord = wordRange;\n      }\n\n      this.previousKeydownCode = e.keyCode;\n    }\n  }, {\n    key: \"handleKeyup\",\n    value: function handleKeyup(e) {\n      if (lists.contains(this.keys, e.keyCode)) {\n        this.replace();\n      }\n    }\n  }]);\n\n  return AutoReplace;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Placeholder.js\nfunction Placeholder_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Placeholder_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Placeholder_createClass(Constructor, protoProps, staticProps) { if (protoProps) Placeholder_defineProperties(Constructor.prototype, protoProps); if (staticProps) Placeholder_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar Placeholder_Placeholder = /*#__PURE__*/function () {\n  function Placeholder(context) {\n    var _this = this;\n\n    Placeholder_classCallCheck(this, Placeholder);\n\n    this.context = context;\n    this.$editingArea = context.layoutInfo.editingArea;\n    this.options = context.options;\n\n    if (this.options.inheritPlaceholder === true) {\n      // get placeholder value from the original element\n      this.options.placeholder = this.context.$note.attr('placeholder') || this.options.placeholder;\n    }\n\n    this.events = {\n      'summernote.init summernote.change': function summernoteInitSummernoteChange() {\n        _this.update();\n      },\n      'summernote.codeview.toggled': function summernoteCodeviewToggled() {\n        _this.update();\n      }\n    };\n  }\n\n  Placeholder_createClass(Placeholder, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return !!this.options.placeholder;\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this2 = this;\n\n      this.$placeholder = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div class=\"note-placeholder\">');\n      this.$placeholder.on('click', function () {\n        _this2.context.invoke('focus');\n      }).html(this.options.placeholder).prependTo(this.$editingArea);\n      this.update();\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$placeholder.remove();\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var isShow = !this.context.invoke('codeview.isActivated') && this.context.invoke('editor.isEmpty');\n      this.$placeholder.toggle(isShow);\n    }\n  }]);\n\n  return Placeholder;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Buttons.js\nfunction Buttons_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Buttons_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Buttons_createClass(Constructor, protoProps, staticProps) { if (protoProps) Buttons_defineProperties(Constructor.prototype, protoProps); if (staticProps) Buttons_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\nvar Buttons_Buttons = /*#__PURE__*/function () {\n  function Buttons(context) {\n    Buttons_classCallCheck(this, Buttons);\n\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.context = context;\n    this.$toolbar = context.layoutInfo.toolbar;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n    this.invertedKeyMap = func.invertObject(this.options.keyMap[env.isMac ? 'mac' : 'pc']);\n  }\n\n  Buttons_createClass(Buttons, [{\n    key: \"representShortcut\",\n    value: function representShortcut(editorMethod) {\n      var shortcut = this.invertedKeyMap[editorMethod];\n\n      if (!this.options.shortcuts || !shortcut) {\n        return '';\n      }\n\n      if (env.isMac) {\n        shortcut = shortcut.replace('CMD', '⌘').replace('SHIFT', '⇧');\n      }\n\n      shortcut = shortcut.replace('BACKSLASH', '\\\\').replace('SLASH', '/').replace('LEFTBRACKET', '[').replace('RIGHTBRACKET', ']');\n      return ' (' + shortcut + ')';\n    }\n  }, {\n    key: \"button\",\n    value: function button(o) {\n      if (!this.options.tooltip && o.tooltip) {\n        delete o.tooltip;\n      }\n\n      o.container = this.options.container;\n      return this.ui.button(o);\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      this.addToolbarButtons();\n      this.addImagePopoverButtons();\n      this.addLinkPopoverButtons();\n      this.addTablePopoverButtons();\n      this.fontInstalledMap = {};\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      delete this.fontInstalledMap;\n    }\n  }, {\n    key: \"isFontInstalled\",\n    value: function isFontInstalled(name) {\n      if (!Object.prototype.hasOwnProperty.call(this.fontInstalledMap, name)) {\n        this.fontInstalledMap[name] = env.isFontInstalled(name) || lists.contains(this.options.fontNamesIgnoreCheck, name);\n      }\n\n      return this.fontInstalledMap[name];\n    }\n  }, {\n    key: \"isFontDeservedToAdd\",\n    value: function isFontDeservedToAdd(name) {\n      name = name.toLowerCase();\n      return name !== '' && this.isFontInstalled(name) && env.genericFontFamilies.indexOf(name) === -1;\n    }\n  }, {\n    key: \"colorPalette\",\n    value: function colorPalette(className, tooltip, backColor, foreColor) {\n      var _this = this;\n\n      return this.ui.buttonGroup({\n        className: 'note-color ' + className,\n        children: [this.button({\n          className: 'note-current-color-button',\n          contents: this.ui.icon(this.options.icons.font + ' note-recent-color'),\n          tooltip: tooltip,\n          click: function click(e) {\n            var $button = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(e.currentTarget);\n\n            if (backColor && foreColor) {\n              _this.context.invoke('editor.color', {\n                backColor: $button.attr('data-backColor'),\n                foreColor: $button.attr('data-foreColor')\n              });\n            } else if (backColor) {\n              _this.context.invoke('editor.color', {\n                backColor: $button.attr('data-backColor')\n              });\n            } else if (foreColor) {\n              _this.context.invoke('editor.color', {\n                foreColor: $button.attr('data-foreColor')\n              });\n            }\n          },\n          callback: function callback($button) {\n            var $recentColor = $button.find('.note-recent-color');\n\n            if (backColor) {\n              $recentColor.css('background-color', _this.options.colorButton.backColor);\n              $button.attr('data-backColor', _this.options.colorButton.backColor);\n            }\n\n            if (foreColor) {\n              $recentColor.css('color', _this.options.colorButton.foreColor);\n              $button.attr('data-foreColor', _this.options.colorButton.foreColor);\n            } else {\n              $recentColor.css('color', 'transparent');\n            }\n          }\n        }), this.button({\n          className: 'dropdown-toggle',\n          contents: this.ui.dropdownButtonContents('', this.options),\n          tooltip: this.lang.color.more,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), this.ui.dropdown({\n          items: (backColor ? ['<div class=\"note-palette\">', '<div class=\"note-palette-title\">' + this.lang.color.background + '</div>', '<div>', '<button type=\"button\" class=\"note-color-reset btn btn-light btn-default\" data-event=\"backColor\" data-value=\"transparent\">', this.lang.color.transparent, '</button>', '</div>', '<div class=\"note-holder\" data-event=\"backColor\"><!-- back colors --></div>', '<div>', '<button type=\"button\" class=\"note-color-select btn btn-light btn-default\" data-event=\"openPalette\" data-value=\"backColorPicker\">', this.lang.color.cpSelect, '</button>', '<input type=\"color\" id=\"backColorPicker\" class=\"note-btn note-color-select-btn\" value=\"' + this.options.colorButton.backColor + '\" data-event=\"backColorPalette\">', '</div>', '<div class=\"note-holder-custom\" id=\"backColorPalette\" data-event=\"backColor\"></div>', '</div>'].join('') : '') + (foreColor ? ['<div class=\"note-palette\">', '<div class=\"note-palette-title\">' + this.lang.color.foreground + '</div>', '<div>', '<button type=\"button\" class=\"note-color-reset btn btn-light btn-default\" data-event=\"removeFormat\" data-value=\"foreColor\">', this.lang.color.resetToDefault, '</button>', '</div>', '<div class=\"note-holder\" data-event=\"foreColor\"><!-- fore colors --></div>', '<div>', '<button type=\"button\" class=\"note-color-select btn btn-light btn-default\" data-event=\"openPalette\" data-value=\"foreColorPicker\">', this.lang.color.cpSelect, '</button>', '<input type=\"color\" id=\"foreColorPicker\" class=\"note-btn note-color-select-btn\" value=\"' + this.options.colorButton.foreColor + '\" data-event=\"foreColorPalette\">', '</div>', // Fix missing Div, Commented to find easily if it's wrong\n          '<div class=\"note-holder-custom\" id=\"foreColorPalette\" data-event=\"foreColor\"></div>', '</div>'].join('') : ''),\n          callback: function callback($dropdown) {\n            $dropdown.find('.note-holder').each(function (idx, item) {\n              var $holder = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item);\n              $holder.append(_this.ui.palette({\n                colors: _this.options.colors,\n                colorsName: _this.options.colorsName,\n                eventName: $holder.data('event'),\n                container: _this.options.container,\n                tooltip: _this.options.tooltip\n              }).render());\n            });\n            /* TODO: do we have to record recent custom colors within cookies? */\n\n            var customColors = [['#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF']];\n            $dropdown.find('.note-holder-custom').each(function (idx, item) {\n              var $holder = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item);\n              $holder.append(_this.ui.palette({\n                colors: customColors,\n                colorsName: customColors,\n                eventName: $holder.data('event'),\n                container: _this.options.container,\n                tooltip: _this.options.tooltip\n              }).render());\n            });\n            $dropdown.find('input[type=color]').each(function (idx, item) {\n              external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item).change(function () {\n                var $chip = $dropdown.find('#' + external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this).data('event')).find('.note-color-btn').first();\n                var color = this.value.toUpperCase();\n                $chip.css('background-color', color).attr('aria-label', color).attr('data-value', color).attr('data-original-title', color);\n                $chip.click();\n              });\n            });\n          },\n          click: function click(event) {\n            event.stopPropagation();\n            var $parent = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('.' + className).find('.note-dropdown-menu');\n            var $button = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(event.target);\n            var eventName = $button.data('event');\n            var value = $button.attr('data-value');\n\n            if (eventName === 'openPalette') {\n              var $picker = $parent.find('#' + value);\n              var $palette = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()($parent.find('#' + $picker.data('event')).find('.note-color-row')[0]); // Shift palette chips\n\n              var $chip = $palette.find('.note-color-btn').last().detach(); // Set chip attributes\n\n              var color = $picker.val();\n              $chip.css('background-color', color).attr('aria-label', color).attr('data-value', color).attr('data-original-title', color);\n              $palette.prepend($chip);\n              $picker.click();\n            } else {\n              if (lists.contains(['backColor', 'foreColor'], eventName)) {\n                var key = eventName === 'backColor' ? 'background-color' : 'color';\n                var $color = $button.closest('.note-color').find('.note-recent-color');\n                var $currentButton = $button.closest('.note-color').find('.note-current-color-button');\n                $color.css(key, value);\n                $currentButton.attr('data-' + eventName, value);\n              }\n\n              _this.context.invoke('editor.' + eventName, value);\n            }\n          }\n        })]\n      }).render();\n    }\n  }, {\n    key: \"addToolbarButtons\",\n    value: function addToolbarButtons() {\n      var _this2 = this;\n\n      this.context.memo('button.style', function () {\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents(_this2.ui.icon(_this2.options.icons.magic), _this2.options),\n          tooltip: _this2.lang.style.style,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdown({\n          className: 'dropdown-style',\n          items: _this2.options.styleTags,\n          title: _this2.lang.style.style,\n          template: function template(item) {\n            // TBD: need to be simplified\n            if (typeof item === 'string') {\n              item = {\n                tag: item,\n                title: Object.prototype.hasOwnProperty.call(_this2.lang.style, item) ? _this2.lang.style[item] : item\n              };\n            }\n\n            var tag = item.tag;\n            var title = item.title;\n            var style = item.style ? ' style=\"' + item.style + '\" ' : '';\n            var className = item.className ? ' class=\"' + item.className + '\"' : '';\n            return '<' + tag + style + className + '>' + title + '</' + tag + '>';\n          },\n          click: _this2.context.createInvokeHandler('editor.formatBlock')\n        })]).render();\n      });\n\n      var _loop = function _loop(styleIdx, styleLen) {\n        var item = _this2.options.styleTags[styleIdx];\n\n        _this2.context.memo('button.style.' + item, function () {\n          return _this2.button({\n            className: 'note-btn-style-' + item,\n            contents: '<div data-value=\"' + item + '\">' + item.toUpperCase() + '</div>',\n            tooltip: _this2.lang.style[item],\n            click: _this2.context.createInvokeHandler('editor.formatBlock')\n          }).render();\n        });\n      };\n\n      for (var styleIdx = 0, styleLen = this.options.styleTags.length; styleIdx < styleLen; styleIdx++) {\n        _loop(styleIdx, styleLen);\n      }\n\n      this.context.memo('button.bold', function () {\n        return _this2.button({\n          className: 'note-btn-bold',\n          contents: _this2.ui.icon(_this2.options.icons.bold),\n          tooltip: _this2.lang.font.bold + _this2.representShortcut('bold'),\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.bold')\n        }).render();\n      });\n      this.context.memo('button.italic', function () {\n        return _this2.button({\n          className: 'note-btn-italic',\n          contents: _this2.ui.icon(_this2.options.icons.italic),\n          tooltip: _this2.lang.font.italic + _this2.representShortcut('italic'),\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.italic')\n        }).render();\n      });\n      this.context.memo('button.underline', function () {\n        return _this2.button({\n          className: 'note-btn-underline',\n          contents: _this2.ui.icon(_this2.options.icons.underline),\n          tooltip: _this2.lang.font.underline + _this2.representShortcut('underline'),\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.underline')\n        }).render();\n      });\n      this.context.memo('button.clear', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.eraser),\n          tooltip: _this2.lang.font.clear + _this2.representShortcut('removeFormat'),\n          click: _this2.context.createInvokeHandler('editor.removeFormat')\n        }).render();\n      });\n      this.context.memo('button.strikethrough', function () {\n        return _this2.button({\n          className: 'note-btn-strikethrough',\n          contents: _this2.ui.icon(_this2.options.icons.strikethrough),\n          tooltip: _this2.lang.font.strikethrough + _this2.representShortcut('strikethrough'),\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.strikethrough')\n        }).render();\n      });\n      this.context.memo('button.superscript', function () {\n        return _this2.button({\n          className: 'note-btn-superscript',\n          contents: _this2.ui.icon(_this2.options.icons.superscript),\n          tooltip: _this2.lang.font.superscript,\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.superscript')\n        }).render();\n      });\n      this.context.memo('button.subscript', function () {\n        return _this2.button({\n          className: 'note-btn-subscript',\n          contents: _this2.ui.icon(_this2.options.icons.subscript),\n          tooltip: _this2.lang.font.subscript,\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.subscript')\n        }).render();\n      });\n      this.context.memo('button.fontname', function () {\n        var styleInfo = _this2.context.invoke('editor.currentStyle');\n\n        if (_this2.options.addDefaultFonts) {\n          // Add 'default' fonts into the fontnames array if not exist\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(styleInfo['font-family'].split(','), function (idx, fontname) {\n            fontname = fontname.trim().replace(/['\"]+/g, '');\n\n            if (_this2.isFontDeservedToAdd(fontname)) {\n              if (_this2.options.fontNames.indexOf(fontname) === -1) {\n                _this2.options.fontNames.push(fontname);\n              }\n            }\n          });\n        }\n\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents('<span class=\"note-current-fontname\"></span>', _this2.options),\n          tooltip: _this2.lang.font.name,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdownCheck({\n          className: 'dropdown-fontname',\n          checkClassName: _this2.options.icons.menuCheck,\n          items: _this2.options.fontNames.filter(_this2.isFontInstalled.bind(_this2)),\n          title: _this2.lang.font.name,\n          template: function template(item) {\n            return '<span style=\"font-family: ' + env.validFontName(item) + '\">' + item + '</span>';\n          },\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.fontName')\n        })]).render();\n      });\n      this.context.memo('button.fontsize', function () {\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents('<span class=\"note-current-fontsize\"></span>', _this2.options),\n          tooltip: _this2.lang.font.size,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdownCheck({\n          className: 'dropdown-fontsize',\n          checkClassName: _this2.options.icons.menuCheck,\n          items: _this2.options.fontSizes,\n          title: _this2.lang.font.size,\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.fontSize')\n        })]).render();\n      });\n      this.context.memo('button.fontsizeunit', function () {\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents('<span class=\"note-current-fontsizeunit\"></span>', _this2.options),\n          tooltip: _this2.lang.font.sizeunit,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdownCheck({\n          className: 'dropdown-fontsizeunit',\n          checkClassName: _this2.options.icons.menuCheck,\n          items: _this2.options.fontSizeUnits,\n          title: _this2.lang.font.sizeunit,\n          click: _this2.context.createInvokeHandlerAndUpdateState('editor.fontSizeUnit')\n        })]).render();\n      });\n      this.context.memo('button.color', function () {\n        return _this2.colorPalette('note-color-all', _this2.lang.color.recent, true, true);\n      });\n      this.context.memo('button.forecolor', function () {\n        return _this2.colorPalette('note-color-fore', _this2.lang.color.foreground, false, true);\n      });\n      this.context.memo('button.backcolor', function () {\n        return _this2.colorPalette('note-color-back', _this2.lang.color.background, true, false);\n      });\n      this.context.memo('button.ul', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.unorderedlist),\n          tooltip: _this2.lang.lists.unordered + _this2.representShortcut('insertUnorderedList'),\n          click: _this2.context.createInvokeHandler('editor.insertUnorderedList')\n        }).render();\n      });\n      this.context.memo('button.ol', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.orderedlist),\n          tooltip: _this2.lang.lists.ordered + _this2.representShortcut('insertOrderedList'),\n          click: _this2.context.createInvokeHandler('editor.insertOrderedList')\n        }).render();\n      });\n      var justifyLeft = this.button({\n        contents: this.ui.icon(this.options.icons.alignLeft),\n        tooltip: this.lang.paragraph.left + this.representShortcut('justifyLeft'),\n        click: this.context.createInvokeHandler('editor.justifyLeft')\n      });\n      var justifyCenter = this.button({\n        contents: this.ui.icon(this.options.icons.alignCenter),\n        tooltip: this.lang.paragraph.center + this.representShortcut('justifyCenter'),\n        click: this.context.createInvokeHandler('editor.justifyCenter')\n      });\n      var justifyRight = this.button({\n        contents: this.ui.icon(this.options.icons.alignRight),\n        tooltip: this.lang.paragraph.right + this.representShortcut('justifyRight'),\n        click: this.context.createInvokeHandler('editor.justifyRight')\n      });\n      var justifyFull = this.button({\n        contents: this.ui.icon(this.options.icons.alignJustify),\n        tooltip: this.lang.paragraph.justify + this.representShortcut('justifyFull'),\n        click: this.context.createInvokeHandler('editor.justifyFull')\n      });\n      var outdent = this.button({\n        contents: this.ui.icon(this.options.icons.outdent),\n        tooltip: this.lang.paragraph.outdent + this.representShortcut('outdent'),\n        click: this.context.createInvokeHandler('editor.outdent')\n      });\n      var indent = this.button({\n        contents: this.ui.icon(this.options.icons.indent),\n        tooltip: this.lang.paragraph.indent + this.representShortcut('indent'),\n        click: this.context.createInvokeHandler('editor.indent')\n      });\n      this.context.memo('button.justifyLeft', func.invoke(justifyLeft, 'render'));\n      this.context.memo('button.justifyCenter', func.invoke(justifyCenter, 'render'));\n      this.context.memo('button.justifyRight', func.invoke(justifyRight, 'render'));\n      this.context.memo('button.justifyFull', func.invoke(justifyFull, 'render'));\n      this.context.memo('button.outdent', func.invoke(outdent, 'render'));\n      this.context.memo('button.indent', func.invoke(indent, 'render'));\n      this.context.memo('button.paragraph', function () {\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents(_this2.ui.icon(_this2.options.icons.alignLeft), _this2.options),\n          tooltip: _this2.lang.paragraph.paragraph,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdown([_this2.ui.buttonGroup({\n          className: 'note-align',\n          children: [justifyLeft, justifyCenter, justifyRight, justifyFull]\n        }), _this2.ui.buttonGroup({\n          className: 'note-list',\n          children: [outdent, indent]\n        })])]).render();\n      });\n      this.context.memo('button.height', function () {\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents(_this2.ui.icon(_this2.options.icons.textHeight), _this2.options),\n          tooltip: _this2.lang.font.height,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdownCheck({\n          items: _this2.options.lineHeights,\n          checkClassName: _this2.options.icons.menuCheck,\n          className: 'dropdown-line-height',\n          title: _this2.lang.font.height,\n          click: _this2.context.createInvokeHandler('editor.lineHeight')\n        })]).render();\n      });\n      this.context.memo('button.table', function () {\n        return _this2.ui.buttonGroup([_this2.button({\n          className: 'dropdown-toggle',\n          contents: _this2.ui.dropdownButtonContents(_this2.ui.icon(_this2.options.icons.table), _this2.options),\n          tooltip: _this2.lang.table.table,\n          data: {\n            toggle: 'dropdown'\n          }\n        }), _this2.ui.dropdown({\n          title: _this2.lang.table.table,\n          className: 'note-table',\n          items: ['<div class=\"note-dimension-picker\">', '<div class=\"note-dimension-picker-mousecatcher\" data-event=\"insertTable\" data-value=\"1x1\"></div>', '<div class=\"note-dimension-picker-highlighted\"></div>', '<div class=\"note-dimension-picker-unhighlighted\"></div>', '</div>', '<div class=\"note-dimension-display\">1 x 1</div>'].join('')\n        })], {\n          callback: function callback($node) {\n            var $catcher = $node.find('.note-dimension-picker-mousecatcher');\n            $catcher.css({\n              width: _this2.options.insertTableMaxSize.col + 'em',\n              height: _this2.options.insertTableMaxSize.row + 'em'\n            }).mousedown(_this2.context.createInvokeHandler('editor.insertTable')).on('mousemove', _this2.tableMoveHandler.bind(_this2));\n          }\n        }).render();\n      });\n      this.context.memo('button.link', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.link),\n          tooltip: _this2.lang.link.link + _this2.representShortcut('linkDialog.show'),\n          click: _this2.context.createInvokeHandler('linkDialog.show')\n        }).render();\n      });\n      this.context.memo('button.picture', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.picture),\n          tooltip: _this2.lang.image.image,\n          click: _this2.context.createInvokeHandler('imageDialog.show')\n        }).render();\n      });\n      this.context.memo('button.video', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.video),\n          tooltip: _this2.lang.video.video,\n          click: _this2.context.createInvokeHandler('videoDialog.show')\n        }).render();\n      });\n      this.context.memo('button.hr', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.minus),\n          tooltip: _this2.lang.hr.insert + _this2.representShortcut('insertHorizontalRule'),\n          click: _this2.context.createInvokeHandler('editor.insertHorizontalRule')\n        }).render();\n      });\n      this.context.memo('button.fullscreen', function () {\n        return _this2.button({\n          className: 'btn-fullscreen note-codeview-keep',\n          contents: _this2.ui.icon(_this2.options.icons.arrowsAlt),\n          tooltip: _this2.lang.options.fullscreen,\n          click: _this2.context.createInvokeHandler('fullscreen.toggle')\n        }).render();\n      });\n      this.context.memo('button.codeview', function () {\n        return _this2.button({\n          className: 'btn-codeview note-codeview-keep',\n          contents: _this2.ui.icon(_this2.options.icons.code),\n          tooltip: _this2.lang.options.codeview,\n          click: _this2.context.createInvokeHandler('codeview.toggle')\n        }).render();\n      });\n      this.context.memo('button.redo', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.redo),\n          tooltip: _this2.lang.history.redo + _this2.representShortcut('redo'),\n          click: _this2.context.createInvokeHandler('editor.redo')\n        }).render();\n      });\n      this.context.memo('button.undo', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.undo),\n          tooltip: _this2.lang.history.undo + _this2.representShortcut('undo'),\n          click: _this2.context.createInvokeHandler('editor.undo')\n        }).render();\n      });\n      this.context.memo('button.help', function () {\n        return _this2.button({\n          contents: _this2.ui.icon(_this2.options.icons.question),\n          tooltip: _this2.lang.options.help,\n          click: _this2.context.createInvokeHandler('helpDialog.show')\n        }).render();\n      });\n    }\n    /**\n     * image: [\n     *   ['imageResize', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],\n     *   ['float', ['floatLeft', 'floatRight', 'floatNone']],\n     *   ['remove', ['removeMedia']],\n     * ],\n     */\n\n  }, {\n    key: \"addImagePopoverButtons\",\n    value: function addImagePopoverButtons() {\n      var _this3 = this;\n\n      // Image Size Buttons\n      this.context.memo('button.resizeFull', function () {\n        return _this3.button({\n          contents: '<span class=\"note-fontsize-10\">100%</span>',\n          tooltip: _this3.lang.image.resizeFull,\n          click: _this3.context.createInvokeHandler('editor.resize', '1')\n        }).render();\n      });\n      this.context.memo('button.resizeHalf', function () {\n        return _this3.button({\n          contents: '<span class=\"note-fontsize-10\">50%</span>',\n          tooltip: _this3.lang.image.resizeHalf,\n          click: _this3.context.createInvokeHandler('editor.resize', '0.5')\n        }).render();\n      });\n      this.context.memo('button.resizeQuarter', function () {\n        return _this3.button({\n          contents: '<span class=\"note-fontsize-10\">25%</span>',\n          tooltip: _this3.lang.image.resizeQuarter,\n          click: _this3.context.createInvokeHandler('editor.resize', '0.25')\n        }).render();\n      });\n      this.context.memo('button.resizeNone', function () {\n        return _this3.button({\n          contents: _this3.ui.icon(_this3.options.icons.rollback),\n          tooltip: _this3.lang.image.resizeNone,\n          click: _this3.context.createInvokeHandler('editor.resize', '0')\n        }).render();\n      }); // Float Buttons\n\n      this.context.memo('button.floatLeft', function () {\n        return _this3.button({\n          contents: _this3.ui.icon(_this3.options.icons.floatLeft),\n          tooltip: _this3.lang.image.floatLeft,\n          click: _this3.context.createInvokeHandler('editor.floatMe', 'left')\n        }).render();\n      });\n      this.context.memo('button.floatRight', function () {\n        return _this3.button({\n          contents: _this3.ui.icon(_this3.options.icons.floatRight),\n          tooltip: _this3.lang.image.floatRight,\n          click: _this3.context.createInvokeHandler('editor.floatMe', 'right')\n        }).render();\n      });\n      this.context.memo('button.floatNone', function () {\n        return _this3.button({\n          contents: _this3.ui.icon(_this3.options.icons.rollback),\n          tooltip: _this3.lang.image.floatNone,\n          click: _this3.context.createInvokeHandler('editor.floatMe', 'none')\n        }).render();\n      }); // Remove Buttons\n\n      this.context.memo('button.removeMedia', function () {\n        return _this3.button({\n          contents: _this3.ui.icon(_this3.options.icons.trash),\n          tooltip: _this3.lang.image.remove,\n          click: _this3.context.createInvokeHandler('editor.removeMedia')\n        }).render();\n      });\n    }\n  }, {\n    key: \"addLinkPopoverButtons\",\n    value: function addLinkPopoverButtons() {\n      var _this4 = this;\n\n      this.context.memo('button.linkDialogShow', function () {\n        return _this4.button({\n          contents: _this4.ui.icon(_this4.options.icons.link),\n          tooltip: _this4.lang.link.edit,\n          click: _this4.context.createInvokeHandler('linkDialog.show')\n        }).render();\n      });\n      this.context.memo('button.unlink', function () {\n        return _this4.button({\n          contents: _this4.ui.icon(_this4.options.icons.unlink),\n          tooltip: _this4.lang.link.unlink,\n          click: _this4.context.createInvokeHandler('editor.unlink')\n        }).render();\n      });\n    }\n    /**\n     * table : [\n     *  ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],\n     *  ['delete', ['deleteRow', 'deleteCol', 'deleteTable']]\n     * ],\n     */\n\n  }, {\n    key: \"addTablePopoverButtons\",\n    value: function addTablePopoverButtons() {\n      var _this5 = this;\n\n      this.context.memo('button.addRowUp', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.rowAbove),\n          tooltip: _this5.lang.table.addRowAbove,\n          click: _this5.context.createInvokeHandler('editor.addRow', 'top')\n        }).render();\n      });\n      this.context.memo('button.addRowDown', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.rowBelow),\n          tooltip: _this5.lang.table.addRowBelow,\n          click: _this5.context.createInvokeHandler('editor.addRow', 'bottom')\n        }).render();\n      });\n      this.context.memo('button.addColLeft', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.colBefore),\n          tooltip: _this5.lang.table.addColLeft,\n          click: _this5.context.createInvokeHandler('editor.addCol', 'left')\n        }).render();\n      });\n      this.context.memo('button.addColRight', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.colAfter),\n          tooltip: _this5.lang.table.addColRight,\n          click: _this5.context.createInvokeHandler('editor.addCol', 'right')\n        }).render();\n      });\n      this.context.memo('button.deleteRow', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.rowRemove),\n          tooltip: _this5.lang.table.delRow,\n          click: _this5.context.createInvokeHandler('editor.deleteRow')\n        }).render();\n      });\n      this.context.memo('button.deleteCol', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.colRemove),\n          tooltip: _this5.lang.table.delCol,\n          click: _this5.context.createInvokeHandler('editor.deleteCol')\n        }).render();\n      });\n      this.context.memo('button.deleteTable', function () {\n        return _this5.button({\n          className: 'btn-md',\n          contents: _this5.ui.icon(_this5.options.icons.trash),\n          tooltip: _this5.lang.table.delTable,\n          click: _this5.context.createInvokeHandler('editor.deleteTable')\n        }).render();\n      });\n    }\n  }, {\n    key: \"build\",\n    value: function build($container, groups) {\n      for (var groupIdx = 0, groupLen = groups.length; groupIdx < groupLen; groupIdx++) {\n        var group = groups[groupIdx];\n        var groupName = Array.isArray(group) ? group[0] : group;\n        var buttons = Array.isArray(group) ? group.length === 1 ? [group[0]] : group[1] : [group];\n        var $group = this.ui.buttonGroup({\n          className: 'note-' + groupName\n        }).render();\n\n        for (var idx = 0, len = buttons.length; idx < len; idx++) {\n          var btn = this.context.memo('button.' + buttons[idx]);\n\n          if (btn) {\n            $group.append(typeof btn === 'function' ? btn(this.context) : btn);\n          }\n        }\n\n        $group.appendTo($container);\n      }\n    }\n    /**\n     * @param {jQuery} [$container]\n     */\n\n  }, {\n    key: \"updateCurrentStyle\",\n    value: function updateCurrentStyle($container) {\n      var _this6 = this;\n\n      var $cont = $container || this.$toolbar;\n      var styleInfo = this.context.invoke('editor.currentStyle');\n      this.updateBtnStates($cont, {\n        '.note-btn-bold': function noteBtnBold() {\n          return styleInfo['font-bold'] === 'bold';\n        },\n        '.note-btn-italic': function noteBtnItalic() {\n          return styleInfo['font-italic'] === 'italic';\n        },\n        '.note-btn-underline': function noteBtnUnderline() {\n          return styleInfo['font-underline'] === 'underline';\n        },\n        '.note-btn-subscript': function noteBtnSubscript() {\n          return styleInfo['font-subscript'] === 'subscript';\n        },\n        '.note-btn-superscript': function noteBtnSuperscript() {\n          return styleInfo['font-superscript'] === 'superscript';\n        },\n        '.note-btn-strikethrough': function noteBtnStrikethrough() {\n          return styleInfo['font-strikethrough'] === 'strikethrough';\n        }\n      });\n\n      if (styleInfo['font-family']) {\n        var fontNames = styleInfo['font-family'].split(',').map(function (name) {\n          return name.replace(/[\\'\\\"]/g, '').replace(/\\s+$/, '').replace(/^\\s+/, '');\n        });\n        var fontName = lists.find(fontNames, this.isFontInstalled.bind(this));\n        $cont.find('.dropdown-fontname a').each(function (idx, item) {\n          var $item = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item); // always compare string to avoid creating another func.\n\n          var isChecked = $item.data('value') + '' === fontName + '';\n          $item.toggleClass('checked', isChecked);\n        });\n        $cont.find('.note-current-fontname').text(fontName).css('font-family', fontName);\n      }\n\n      if (styleInfo['font-size']) {\n        var fontSize = styleInfo['font-size'];\n        $cont.find('.dropdown-fontsize a').each(function (idx, item) {\n          var $item = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item); // always compare with string to avoid creating another func.\n\n          var isChecked = $item.data('value') + '' === fontSize + '';\n          $item.toggleClass('checked', isChecked);\n        });\n        $cont.find('.note-current-fontsize').text(fontSize);\n        var fontSizeUnit = styleInfo['font-size-unit'];\n        $cont.find('.dropdown-fontsizeunit a').each(function (idx, item) {\n          var $item = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item);\n          var isChecked = $item.data('value') + '' === fontSizeUnit + '';\n          $item.toggleClass('checked', isChecked);\n        });\n        $cont.find('.note-current-fontsizeunit').text(fontSizeUnit);\n      }\n\n      if (styleInfo['line-height']) {\n        var lineHeight = styleInfo['line-height'];\n        $cont.find('.dropdown-line-height li a').each(function (idx, item) {\n          // always compare with string to avoid creating another func.\n          var isChecked = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(item).data('value') + '' === lineHeight + '';\n          _this6.className = isChecked ? 'checked' : '';\n        });\n      }\n    }\n  }, {\n    key: \"updateBtnStates\",\n    value: function updateBtnStates($container, infos) {\n      var _this7 = this;\n\n      external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.each(infos, function (selector, pred) {\n        _this7.ui.toggleBtnActive($container.find(selector), pred());\n      });\n    }\n  }, {\n    key: \"tableMoveHandler\",\n    value: function tableMoveHandler(event) {\n      var PX_PER_EM = 18;\n      var $picker = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(event.target.parentNode); // target is mousecatcher\n\n      var $dimensionDisplay = $picker.next();\n      var $catcher = $picker.find('.note-dimension-picker-mousecatcher');\n      var $highlighted = $picker.find('.note-dimension-picker-highlighted');\n      var $unhighlighted = $picker.find('.note-dimension-picker-unhighlighted');\n      var posOffset; // HTML5 with jQuery - e.offsetX is undefined in Firefox\n\n      if (event.offsetX === undefined) {\n        var posCatcher = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(event.target).offset();\n        posOffset = {\n          x: event.pageX - posCatcher.left,\n          y: event.pageY - posCatcher.top\n        };\n      } else {\n        posOffset = {\n          x: event.offsetX,\n          y: event.offsetY\n        };\n      }\n\n      var dim = {\n        c: Math.ceil(posOffset.x / PX_PER_EM) || 1,\n        r: Math.ceil(posOffset.y / PX_PER_EM) || 1\n      };\n      $highlighted.css({\n        width: dim.c + 'em',\n        height: dim.r + 'em'\n      });\n      $catcher.data('value', dim.c + 'x' + dim.r);\n\n      if (dim.c > 3 && dim.c < this.options.insertTableMaxSize.col) {\n        $unhighlighted.css({\n          width: dim.c + 1 + 'em'\n        });\n      }\n\n      if (dim.r > 3 && dim.r < this.options.insertTableMaxSize.row) {\n        $unhighlighted.css({\n          height: dim.r + 1 + 'em'\n        });\n      }\n\n      $dimensionDisplay.html(dim.c + ' x ' + dim.r);\n    }\n  }]);\n\n  return Buttons;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/Toolbar.js\nfunction Toolbar_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Toolbar_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction Toolbar_createClass(Constructor, protoProps, staticProps) { if (protoProps) Toolbar_defineProperties(Constructor.prototype, protoProps); if (staticProps) Toolbar_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar Toolbar_Toolbar = /*#__PURE__*/function () {\n  function Toolbar(context) {\n    Toolbar_classCallCheck(this, Toolbar);\n\n    this.context = context;\n    this.$window = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(window);\n    this.$document = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document);\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.$note = context.layoutInfo.note;\n    this.$editor = context.layoutInfo.editor;\n    this.$toolbar = context.layoutInfo.toolbar;\n    this.$editable = context.layoutInfo.editable;\n    this.$statusbar = context.layoutInfo.statusbar;\n    this.options = context.options;\n    this.isFollowing = false;\n    this.followScroll = this.followScroll.bind(this);\n  }\n\n  Toolbar_createClass(Toolbar, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return !this.options.airMode;\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this = this;\n\n      this.options.toolbar = this.options.toolbar || [];\n\n      if (!this.options.toolbar.length) {\n        this.$toolbar.hide();\n      } else {\n        this.context.invoke('buttons.build', this.$toolbar, this.options.toolbar);\n      }\n\n      if (this.options.toolbarContainer) {\n        this.$toolbar.appendTo(this.options.toolbarContainer);\n      }\n\n      this.changeContainer(false);\n      this.$note.on('summernote.keyup summernote.mouseup summernote.change', function () {\n        _this.context.invoke('buttons.updateCurrentStyle');\n      });\n      this.context.invoke('buttons.updateCurrentStyle');\n\n      if (this.options.followingToolbar) {\n        this.$window.on('scroll resize', this.followScroll);\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$toolbar.children().remove();\n\n      if (this.options.followingToolbar) {\n        this.$window.off('scroll resize', this.followScroll);\n      }\n    }\n  }, {\n    key: \"followScroll\",\n    value: function followScroll() {\n      if (this.$editor.hasClass('fullscreen')) {\n        return false;\n      }\n\n      var editorHeight = this.$editor.outerHeight();\n      var editorWidth = this.$editor.width();\n      var toolbarHeight = this.$toolbar.height();\n      var statusbarHeight = this.$statusbar.height(); // check if the web app is currently using another static bar\n\n      var otherBarHeight = 0;\n\n      if (this.options.otherStaticBar) {\n        otherBarHeight = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.options.otherStaticBar).outerHeight();\n      }\n\n      var currentOffset = this.$document.scrollTop();\n      var editorOffsetTop = this.$editor.offset().top;\n      var editorOffsetBottom = editorOffsetTop + editorHeight;\n      var activateOffset = editorOffsetTop - otherBarHeight;\n      var deactivateOffsetBottom = editorOffsetBottom - otherBarHeight - toolbarHeight - statusbarHeight;\n\n      if (!this.isFollowing && currentOffset > activateOffset && currentOffset < deactivateOffsetBottom - toolbarHeight) {\n        this.isFollowing = true;\n        this.$editable.css({\n          marginTop: this.$toolbar.outerHeight()\n        });\n        this.$toolbar.css({\n          position: 'fixed',\n          top: otherBarHeight,\n          width: editorWidth,\n          zIndex: 1000\n        });\n      } else if (this.isFollowing && (currentOffset < activateOffset || currentOffset > deactivateOffsetBottom)) {\n        this.isFollowing = false;\n        this.$toolbar.css({\n          position: 'relative',\n          top: 0,\n          width: '100%',\n          zIndex: 'auto'\n        });\n        this.$editable.css({\n          marginTop: ''\n        });\n      }\n    }\n  }, {\n    key: \"changeContainer\",\n    value: function changeContainer(isFullscreen) {\n      if (isFullscreen) {\n        this.$toolbar.prependTo(this.$editor);\n      } else {\n        if (this.options.toolbarContainer) {\n          this.$toolbar.appendTo(this.options.toolbarContainer);\n        }\n      }\n\n      if (this.options.followingToolbar) {\n        this.followScroll();\n      }\n    }\n  }, {\n    key: \"updateFullscreen\",\n    value: function updateFullscreen(isFullscreen) {\n      this.ui.toggleBtnActive(this.$toolbar.find('.btn-fullscreen'), isFullscreen);\n      this.changeContainer(isFullscreen);\n    }\n  }, {\n    key: \"updateCodeview\",\n    value: function updateCodeview(isCodeview) {\n      this.ui.toggleBtnActive(this.$toolbar.find('.btn-codeview'), isCodeview);\n\n      if (isCodeview) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n    }\n  }, {\n    key: \"activate\",\n    value: function activate(isIncludeCodeview) {\n      var $btn = this.$toolbar.find('button');\n\n      if (!isIncludeCodeview) {\n        $btn = $btn.not('.note-codeview-keep');\n      }\n\n      this.ui.toggleBtn($btn, true);\n    }\n  }, {\n    key: \"deactivate\",\n    value: function deactivate(isIncludeCodeview) {\n      var $btn = this.$toolbar.find('button');\n\n      if (!isIncludeCodeview) {\n        $btn = $btn.not('.note-codeview-keep');\n      }\n\n      this.ui.toggleBtn($btn, false);\n    }\n  }]);\n\n  return Toolbar;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/LinkDialog.js\nfunction LinkDialog_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction LinkDialog_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction LinkDialog_createClass(Constructor, protoProps, staticProps) { if (protoProps) LinkDialog_defineProperties(Constructor.prototype, protoProps); if (staticProps) LinkDialog_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\nvar LinkDialog_LinkDialog = /*#__PURE__*/function () {\n  function LinkDialog(context) {\n    LinkDialog_classCallCheck(this, LinkDialog);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.$body = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document.body);\n    this.$editor = context.layoutInfo.editor;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n    context.memo('help.linkDialog.show', this.options.langInfo.help['linkDialog.show']);\n  }\n\n  LinkDialog_createClass(LinkDialog, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var $container = this.options.dialogsInBody ? this.$body : this.options.container;\n      var body = ['<div class=\"form-group note-form-group\">', \"<label for=\\\"note-dialog-link-txt-\".concat(this.options.id, \"\\\" class=\\\"note-form-label\\\">\").concat(this.lang.link.textToDisplay, \"</label>\"), \"<input id=\\\"note-dialog-link-txt-\".concat(this.options.id, \"\\\" class=\\\"note-link-text form-control note-form-control note-input\\\" type=\\\"text\\\"/>\"), '</div>', '<div class=\"form-group note-form-group\">', \"<label for=\\\"note-dialog-link-url-\".concat(this.options.id, \"\\\" class=\\\"note-form-label\\\">\").concat(this.lang.link.url, \"</label>\"), \"<input id=\\\"note-dialog-link-url-\".concat(this.options.id, \"\\\" class=\\\"note-link-url form-control note-form-control note-input\\\" type=\\\"text\\\" value=\\\"http://\\\"/>\"), '</div>', !this.options.disableLinkTarget ? external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div/>').append(this.ui.checkbox({\n        className: 'sn-checkbox-open-in-new-window',\n        text: this.lang.link.openInNewWindow,\n        checked: true\n      }).render()).html() : '', external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div/>').append(this.ui.checkbox({\n        className: 'sn-checkbox-use-protocol',\n        text: this.lang.link.useProtocol,\n        checked: true\n      }).render()).html()].join('');\n      var buttonClass = 'btn btn-primary note-btn note-btn-primary note-link-btn';\n      var footer = \"<input type=\\\"button\\\" href=\\\"#\\\" class=\\\"\".concat(buttonClass, \"\\\" value=\\\"\").concat(this.lang.link.insert, \"\\\" disabled>\");\n      this.$dialog = this.ui.dialog({\n        className: 'link-dialog',\n        title: this.lang.link.insert,\n        fade: this.options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    }\n  }, {\n    key: \"bindEnterKey\",\n    value: function bindEnterKey($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === core_key.code.ENTER) {\n          event.preventDefault();\n          $btn.trigger('click');\n        }\n      });\n    }\n    /**\n     * toggle update button\n     */\n\n  }, {\n    key: \"toggleLinkBtn\",\n    value: function toggleLinkBtn($linkBtn, $linkText, $linkUrl) {\n      this.ui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\n    }\n    /**\n     * Show link dialog and set event handlers on dialog controls.\n     *\n     * @param {Object} linkInfo\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"showLinkDialog\",\n    value: function showLinkDialog(linkInfo) {\n      var _this = this;\n\n      return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.Deferred(function (deferred) {\n        var $linkText = _this.$dialog.find('.note-link-text');\n\n        var $linkUrl = _this.$dialog.find('.note-link-url');\n\n        var $linkBtn = _this.$dialog.find('.note-link-btn');\n\n        var $openInNewWindow = _this.$dialog.find('.sn-checkbox-open-in-new-window input[type=checkbox]');\n\n        var $useProtocol = _this.$dialog.find('.sn-checkbox-use-protocol input[type=checkbox]');\n\n        _this.ui.onDialogShown(_this.$dialog, function () {\n          _this.context.triggerEvent('dialog.shown'); // If no url was given and given text is valid URL then copy that into URL Field\n\n\n          if (!linkInfo.url && func.isValidUrl(linkInfo.text)) {\n            linkInfo.url = linkInfo.text;\n          }\n\n          $linkText.on('input paste propertychange', function () {\n            // If linktext was modified by input events,\n            // cloning text from linkUrl will be stopped.\n            linkInfo.text = $linkText.val();\n\n            _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n          }).val(linkInfo.text);\n          $linkUrl.on('input paste propertychange', function () {\n            // Display same text on `Text to display` as default\n            // when linktext has no text\n            if (!linkInfo.text) {\n              $linkText.val($linkUrl.val());\n            }\n\n            _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n          }).val(linkInfo.url);\n\n          if (!env.isSupportTouch) {\n            $linkUrl.trigger('focus');\n          }\n\n          _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n\n          _this.bindEnterKey($linkUrl, $linkBtn);\n\n          _this.bindEnterKey($linkText, $linkBtn);\n\n          var isNewWindowChecked = linkInfo.isNewWindow !== undefined ? linkInfo.isNewWindow : _this.context.options.linkTargetBlank;\n          $openInNewWindow.prop('checked', isNewWindowChecked);\n          var useProtocolChecked = linkInfo.url ? false : _this.context.options.useProtocol;\n          $useProtocol.prop('checked', useProtocolChecked);\n          $linkBtn.one('click', function (event) {\n            event.preventDefault();\n            deferred.resolve({\n              range: linkInfo.range,\n              url: $linkUrl.val(),\n              text: $linkText.val(),\n              isNewWindow: $openInNewWindow.is(':checked'),\n              checkProtocol: $useProtocol.is(':checked')\n            });\n\n            _this.ui.hideDialog(_this.$dialog);\n          });\n        });\n\n        _this.ui.onDialogHidden(_this.$dialog, function () {\n          // detach events\n          $linkText.off();\n          $linkUrl.off();\n          $linkBtn.off();\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        _this.ui.showDialog(_this.$dialog);\n      }).promise();\n    }\n    /**\n     * @param {Object} layoutInfo\n     */\n\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this2 = this;\n\n      var linkInfo = this.context.invoke('editor.getLinkInfo');\n      this.context.invoke('editor.saveRange');\n      this.showLinkDialog(linkInfo).then(function (linkInfo) {\n        _this2.context.invoke('editor.restoreRange');\n\n        _this2.context.invoke('editor.createLink', linkInfo);\n      }).fail(function () {\n        _this2.context.invoke('editor.restoreRange');\n      });\n    }\n  }]);\n\n  return LinkDialog;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/LinkPopover.js\nfunction LinkPopover_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction LinkPopover_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction LinkPopover_createClass(Constructor, protoProps, staticProps) { if (protoProps) LinkPopover_defineProperties(Constructor.prototype, protoProps); if (staticProps) LinkPopover_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\nvar LinkPopover_LinkPopover = /*#__PURE__*/function () {\n  function LinkPopover(context) {\n    var _this = this;\n\n    LinkPopover_classCallCheck(this, LinkPopover);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.options = context.options;\n    this.events = {\n      'summernote.keyup summernote.mouseup summernote.change summernote.scroll': function summernoteKeyupSummernoteMouseupSummernoteChangeSummernoteScroll() {\n        _this.update();\n      },\n      'summernote.disable summernote.dialog.shown summernote.blur': function summernoteDisableSummernoteDialogShownSummernoteBlur() {\n        _this.hide();\n      }\n    };\n  }\n\n  LinkPopover_createClass(LinkPopover, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return !lists.isEmpty(this.options.popover.link);\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      this.$popover = this.ui.popover({\n        className: 'note-link-popover',\n        callback: function callback($node) {\n          var $content = $node.find('.popover-content,.note-popover-content');\n          $content.prepend('<span><a target=\"_blank\"></a>&nbsp;</span>');\n        }\n      }).render().appendTo(this.options.container);\n      var $content = this.$popover.find('.popover-content,.note-popover-content');\n      this.context.invoke('buttons.build', $content, this.options.popover.link);\n      this.$popover.on('mousedown', function (e) {\n        e.preventDefault();\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$popover.remove();\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      // Prevent focusing on editable when invoke('code') is executed\n      if (!this.context.invoke('editor.hasFocus')) {\n        this.hide();\n        return;\n      }\n\n      var rng = this.context.invoke('editor.getLastRange');\n\n      if (rng.isCollapsed() && rng.isOnAnchor()) {\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\n        var href = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(anchor).attr('href');\n        this.$popover.find('a').attr('href', href).text(href);\n        var pos = dom.posFromPlaceholder(anchor);\n        var containerOffset = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.options.container).offset();\n        pos.top -= containerOffset.top;\n        pos.left -= containerOffset.left;\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.$popover.hide();\n    }\n  }]);\n\n  return LinkPopover;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/ImageDialog.js\nfunction ImageDialog_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction ImageDialog_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction ImageDialog_createClass(Constructor, protoProps, staticProps) { if (protoProps) ImageDialog_defineProperties(Constructor.prototype, protoProps); if (staticProps) ImageDialog_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\nvar ImageDialog_ImageDialog = /*#__PURE__*/function () {\n  function ImageDialog(context) {\n    ImageDialog_classCallCheck(this, ImageDialog);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.$body = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document.body);\n    this.$editor = context.layoutInfo.editor;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n  }\n\n  ImageDialog_createClass(ImageDialog, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var imageLimitation = '';\n\n      if (this.options.maximumImageFileSize) {\n        var unit = Math.floor(Math.log(this.options.maximumImageFileSize) / Math.log(1024));\n        var readableSize = (this.options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 + ' ' + ' KMGTP'[unit] + 'B';\n        imageLimitation = \"<small>\".concat(this.lang.image.maximumFileSize + ' : ' + readableSize, \"</small>\");\n      }\n\n      var $container = this.options.dialogsInBody ? this.$body : this.options.container;\n      var body = ['<div class=\"form-group note-form-group note-group-select-from-files\">', '<label for=\"note-dialog-image-file-' + this.options.id + '\" class=\"note-form-label\">' + this.lang.image.selectFromFiles + '</label>', '<input id=\"note-dialog-image-file-' + this.options.id + '\" class=\"note-image-input form-control-file note-form-control note-input\" ', ' type=\"file\" name=\"files\" accept=\"image/*\" multiple=\"multiple\"/>', imageLimitation, '</div>', '<div class=\"form-group note-group-image-url\">', '<label for=\"note-dialog-image-url-' + this.options.id + '\" class=\"note-form-label\">' + this.lang.image.url + '</label>', '<input id=\"note-dialog-image-url-' + this.options.id + '\" class=\"note-image-url form-control note-form-control note-input\" type=\"text\"/>', '</div>'].join('');\n      var buttonClass = 'btn btn-primary note-btn note-btn-primary note-image-btn';\n      var footer = \"<input type=\\\"button\\\" href=\\\"#\\\" class=\\\"\".concat(buttonClass, \"\\\" value=\\\"\").concat(this.lang.image.insert, \"\\\" disabled>\");\n      this.$dialog = this.ui.dialog({\n        title: this.lang.image.insert,\n        fade: this.options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    }\n  }, {\n    key: \"bindEnterKey\",\n    value: function bindEnterKey($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === core_key.code.ENTER) {\n          event.preventDefault();\n          $btn.trigger('click');\n        }\n      });\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this = this;\n\n      this.context.invoke('editor.saveRange');\n      this.showImageDialog().then(function (data) {\n        // [workaround] hide dialog before restore range for IE range focus\n        _this.ui.hideDialog(_this.$dialog);\n\n        _this.context.invoke('editor.restoreRange');\n\n        if (typeof data === 'string') {\n          // image url\n          // If onImageLinkInsert set,\n          if (_this.options.callbacks.onImageLinkInsert) {\n            _this.context.triggerEvent('image.link.insert', data);\n          } else {\n            _this.context.invoke('editor.insertImage', data);\n          }\n        } else {\n          // array of files\n          _this.context.invoke('editor.insertImagesOrCallback', data);\n        }\n      }).fail(function () {\n        _this.context.invoke('editor.restoreRange');\n      });\n    }\n    /**\n     * show image dialog\n     *\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"showImageDialog\",\n    value: function showImageDialog() {\n      var _this2 = this;\n\n      return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.Deferred(function (deferred) {\n        var $imageInput = _this2.$dialog.find('.note-image-input');\n\n        var $imageUrl = _this2.$dialog.find('.note-image-url');\n\n        var $imageBtn = _this2.$dialog.find('.note-image-btn');\n\n        _this2.ui.onDialogShown(_this2.$dialog, function () {\n          _this2.context.triggerEvent('dialog.shown'); // Cloning imageInput to clear element.\n\n\n          $imageInput.replaceWith($imageInput.clone().on('change', function (event) {\n            deferred.resolve(event.target.files || event.target.value);\n          }).val(''));\n          $imageUrl.on('input paste propertychange', function () {\n            _this2.ui.toggleBtn($imageBtn, $imageUrl.val());\n          }).val('');\n\n          if (!env.isSupportTouch) {\n            $imageUrl.trigger('focus');\n          }\n\n          $imageBtn.click(function (event) {\n            event.preventDefault();\n            deferred.resolve($imageUrl.val());\n          });\n\n          _this2.bindEnterKey($imageUrl, $imageBtn);\n        });\n\n        _this2.ui.onDialogHidden(_this2.$dialog, function () {\n          $imageInput.off();\n          $imageUrl.off();\n          $imageBtn.off();\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        _this2.ui.showDialog(_this2.$dialog);\n      });\n    }\n  }]);\n\n  return ImageDialog;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/ImagePopover.js\nfunction ImagePopover_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction ImagePopover_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction ImagePopover_createClass(Constructor, protoProps, staticProps) { if (protoProps) ImagePopover_defineProperties(Constructor.prototype, protoProps); if (staticProps) ImagePopover_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n/**\n * Image popover module\n *  mouse events that show/hide popover will be handled by Handle.js.\n *  Handle.js will receive the events and invoke 'imagePopover.update'.\n */\n\nvar ImagePopover_ImagePopover = /*#__PURE__*/function () {\n  function ImagePopover(context) {\n    var _this = this;\n\n    ImagePopover_classCallCheck(this, ImagePopover);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.editable = context.layoutInfo.editable[0];\n    this.options = context.options;\n    this.events = {\n      'summernote.disable summernote.blur': function summernoteDisableSummernoteBlur() {\n        _this.hide();\n      }\n    };\n  }\n\n  ImagePopover_createClass(ImagePopover, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return !lists.isEmpty(this.options.popover.image);\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      this.$popover = this.ui.popover({\n        className: 'note-image-popover'\n      }).render().appendTo(this.options.container);\n      var $content = this.$popover.find('.popover-content,.note-popover-content');\n      this.context.invoke('buttons.build', $content, this.options.popover.image);\n      this.$popover.on('mousedown', function (e) {\n        e.preventDefault();\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$popover.remove();\n    }\n  }, {\n    key: \"update\",\n    value: function update(target, event) {\n      if (dom.isImg(target)) {\n        var position = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(target).offset();\n        var containerOffset = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.options.container).offset();\n        var pos = {};\n\n        if (this.options.popatmouse) {\n          pos.left = event.pageX - 20;\n          pos.top = event.pageY;\n        } else {\n          pos = position;\n        }\n\n        pos.top -= containerOffset.top;\n        pos.left -= containerOffset.left;\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.$popover.hide();\n    }\n  }]);\n\n  return ImagePopover;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/TablePopover.js\nfunction TablePopover_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction TablePopover_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction TablePopover_createClass(Constructor, protoProps, staticProps) { if (protoProps) TablePopover_defineProperties(Constructor.prototype, protoProps); if (staticProps) TablePopover_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\nvar TablePopover_TablePopover = /*#__PURE__*/function () {\n  function TablePopover(context) {\n    var _this = this;\n\n    TablePopover_classCallCheck(this, TablePopover);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.options = context.options;\n    this.events = {\n      'summernote.mousedown': function summernoteMousedown(we, e) {\n        _this.update(e.target);\n      },\n      'summernote.keyup summernote.scroll summernote.change': function summernoteKeyupSummernoteScrollSummernoteChange() {\n        _this.update();\n      },\n      'summernote.disable summernote.blur': function summernoteDisableSummernoteBlur() {\n        _this.hide();\n      }\n    };\n  }\n\n  TablePopover_createClass(TablePopover, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return !lists.isEmpty(this.options.popover.table);\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      this.$popover = this.ui.popover({\n        className: 'note-table-popover'\n      }).render().appendTo(this.options.container);\n      var $content = this.$popover.find('.popover-content,.note-popover-content');\n      this.context.invoke('buttons.build', $content, this.options.popover.table); // [workaround] Disable Firefox's default table editor\n\n      if (env.isFF) {\n        document.execCommand('enableInlineTableEditing', false, false);\n      }\n\n      this.$popover.on('mousedown', function (e) {\n        e.preventDefault();\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$popover.remove();\n    }\n  }, {\n    key: \"update\",\n    value: function update(target) {\n      if (this.context.isDisabled()) {\n        return false;\n      }\n\n      var isCell = dom.isCell(target);\n\n      if (isCell) {\n        var pos = dom.posFromPlaceholder(target);\n        var containerOffset = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.options.container).offset();\n        pos.top -= containerOffset.top;\n        pos.left -= containerOffset.left;\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n\n      return isCell;\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.$popover.hide();\n    }\n  }]);\n\n  return TablePopover;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/VideoDialog.js\nfunction VideoDialog_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction VideoDialog_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction VideoDialog_createClass(Constructor, protoProps, staticProps) { if (protoProps) VideoDialog_defineProperties(Constructor.prototype, protoProps); if (staticProps) VideoDialog_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\nvar VideoDialog_VideoDialog = /*#__PURE__*/function () {\n  function VideoDialog(context) {\n    VideoDialog_classCallCheck(this, VideoDialog);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.$body = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document.body);\n    this.$editor = context.layoutInfo.editor;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n  }\n\n  VideoDialog_createClass(VideoDialog, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var $container = this.options.dialogsInBody ? this.$body : this.options.container;\n      var body = ['<div class=\"form-group note-form-group row-fluid\">', \"<label for=\\\"note-dialog-video-url-\".concat(this.options.id, \"\\\" class=\\\"note-form-label\\\">\").concat(this.lang.video.url, \" <small class=\\\"text-muted\\\">\").concat(this.lang.video.providers, \"</small></label>\"), \"<input id=\\\"note-dialog-video-url-\".concat(this.options.id, \"\\\" class=\\\"note-video-url form-control note-form-control note-input\\\" type=\\\"text\\\"/>\"), '</div>'].join('');\n      var buttonClass = 'btn btn-primary note-btn note-btn-primary note-video-btn';\n      var footer = \"<input type=\\\"button\\\" href=\\\"#\\\" class=\\\"\".concat(buttonClass, \"\\\" value=\\\"\").concat(this.lang.video.insert, \"\\\" disabled>\");\n      this.$dialog = this.ui.dialog({\n        title: this.lang.video.insert,\n        fade: this.options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    }\n  }, {\n    key: \"bindEnterKey\",\n    value: function bindEnterKey($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === core_key.code.ENTER) {\n          event.preventDefault();\n          $btn.trigger('click');\n        }\n      });\n    }\n  }, {\n    key: \"createVideoNode\",\n    value: function createVideoNode(url) {\n      // video url patterns(youtube, instagram, vimeo, dailymotion, youku, mp4, ogg, webm)\n      var ytRegExp = /\\/\\/(?:(?:www|m)\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))([\\w|-]{11})(?:(?:[\\?&]t=)(\\S+))?$/;\n      var ytRegExpForStart = /^(?:(\\d+)h)?(?:(\\d+)m)?(?:(\\d+)s)?$/;\n      var ytMatch = url.match(ytRegExp);\n      var igRegExp = /(?:www\\.|\\/\\/)instagram\\.com\\/p\\/(.[a-zA-Z0-9_-]*)/;\n      var igMatch = url.match(igRegExp);\n      var vRegExp = /\\/\\/vine\\.co\\/v\\/([a-zA-Z0-9]+)/;\n      var vMatch = url.match(vRegExp);\n      var vimRegExp = /\\/\\/(player\\.)?vimeo\\.com\\/([a-z]*\\/)*(\\d+)[?]?.*/;\n      var vimMatch = url.match(vimRegExp);\n      var dmRegExp = /.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/;\n      var dmMatch = url.match(dmRegExp);\n      var youkuRegExp = /\\/\\/v\\.youku\\.com\\/v_show\\/id_(\\w+)=*\\.html/;\n      var youkuMatch = url.match(youkuRegExp);\n      var qqRegExp = /\\/\\/v\\.qq\\.com.*?vid=(.+)/;\n      var qqMatch = url.match(qqRegExp);\n      var qqRegExp2 = /\\/\\/v\\.qq\\.com\\/x?\\/?(page|cover).*?\\/([^\\/]+)\\.html\\??.*/;\n      var qqMatch2 = url.match(qqRegExp2);\n      var mp4RegExp = /^.+.(mp4|m4v)$/;\n      var mp4Match = url.match(mp4RegExp);\n      var oggRegExp = /^.+.(ogg|ogv)$/;\n      var oggMatch = url.match(oggRegExp);\n      var webmRegExp = /^.+.(webm)$/;\n      var webmMatch = url.match(webmRegExp);\n      var fbRegExp = /(?:www\\.|\\/\\/)facebook\\.com\\/([^\\/]+)\\/videos\\/([0-9]+)/;\n      var fbMatch = url.match(fbRegExp);\n      var $video;\n\n      if (ytMatch && ytMatch[1].length === 11) {\n        var youtubeId = ytMatch[1];\n        var start = 0;\n\n        if (typeof ytMatch[2] !== 'undefined') {\n          var ytMatchForStart = ytMatch[2].match(ytRegExpForStart);\n\n          if (ytMatchForStart) {\n            for (var n = [3600, 60, 1], i = 0, r = n.length; i < r; i++) {\n              start += typeof ytMatchForStart[i + 1] !== 'undefined' ? n[i] * parseInt(ytMatchForStart[i + 1], 10) : 0;\n            }\n          }\n        }\n\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe>').attr('frameborder', 0).attr('src', '//www.youtube.com/embed/' + youtubeId + (start > 0 ? '?start=' + start : '')).attr('width', '640').attr('height', '360');\n      } else if (igMatch && igMatch[0].length) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe>').attr('frameborder', 0).attr('src', 'https://instagram.com/p/' + igMatch[1] + '/embed/').attr('width', '612').attr('height', '710').attr('scrolling', 'no').attr('allowtransparency', 'true');\n      } else if (vMatch && vMatch[0].length) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe>').attr('frameborder', 0).attr('src', vMatch[0] + '/embed/simple').attr('width', '600').attr('height', '600').attr('class', 'vine-embed');\n      } else if (vimMatch && vimMatch[3].length) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('frameborder', 0).attr('src', '//player.vimeo.com/video/' + vimMatch[3]).attr('width', '640').attr('height', '360');\n      } else if (dmMatch && dmMatch[2].length) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe>').attr('frameborder', 0).attr('src', '//www.dailymotion.com/embed/video/' + dmMatch[2]).attr('width', '640').attr('height', '360');\n      } else if (youkuMatch && youkuMatch[1].length) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('frameborder', 0).attr('height', '498').attr('width', '510').attr('src', '//player.youku.com/embed/' + youkuMatch[1]);\n      } else if (qqMatch && qqMatch[1].length || qqMatch2 && qqMatch2[2].length) {\n        var vid = qqMatch && qqMatch[1].length ? qqMatch[1] : qqMatch2[2];\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('frameborder', 0).attr('height', '310').attr('width', '500').attr('src', 'https://v.qq.com/txp/iframe/player.html?vid=' + vid + '&amp;auto=0');\n      } else if (mp4Match || oggMatch || webmMatch) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<video controls>').attr('src', url).attr('width', '640').attr('height', '360');\n      } else if (fbMatch && fbMatch[0].length) {\n        $video = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<iframe>').attr('frameborder', 0).attr('src', 'https://www.facebook.com/plugins/video.php?href=' + encodeURIComponent(fbMatch[0]) + '&show_text=0&width=560').attr('width', '560').attr('height', '301').attr('scrolling', 'no').attr('allowtransparency', 'true');\n      } else {\n        // this is not a known video link. Now what, Cat? Now what?\n        return false;\n      }\n\n      $video.addClass('note-video-clip');\n      return $video[0];\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this = this;\n\n      var text = this.context.invoke('editor.getSelectedText');\n      this.context.invoke('editor.saveRange');\n      this.showVideoDialog(text).then(function (url) {\n        // [workaround] hide dialog before restore range for IE range focus\n        _this.ui.hideDialog(_this.$dialog);\n\n        _this.context.invoke('editor.restoreRange'); // build node\n\n\n        var $node = _this.createVideoNode(url);\n\n        if ($node) {\n          // insert video node\n          _this.context.invoke('editor.insertNode', $node);\n        }\n      }).fail(function () {\n        _this.context.invoke('editor.restoreRange');\n      });\n    }\n    /**\n     * show video dialog\n     *\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"showVideoDialog\",\n    value: function showVideoDialog()\n    /* text */\n    {\n      var _this2 = this;\n\n      return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.Deferred(function (deferred) {\n        var $videoUrl = _this2.$dialog.find('.note-video-url');\n\n        var $videoBtn = _this2.$dialog.find('.note-video-btn');\n\n        _this2.ui.onDialogShown(_this2.$dialog, function () {\n          _this2.context.triggerEvent('dialog.shown');\n\n          $videoUrl.on('input paste propertychange', function () {\n            _this2.ui.toggleBtn($videoBtn, $videoUrl.val());\n          });\n\n          if (!env.isSupportTouch) {\n            $videoUrl.trigger('focus');\n          }\n\n          $videoBtn.click(function (event) {\n            event.preventDefault();\n            deferred.resolve($videoUrl.val());\n          });\n\n          _this2.bindEnterKey($videoUrl, $videoBtn);\n        });\n\n        _this2.ui.onDialogHidden(_this2.$dialog, function () {\n          $videoUrl.off();\n          $videoBtn.off();\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        _this2.ui.showDialog(_this2.$dialog);\n      });\n    }\n  }]);\n\n  return VideoDialog;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/HelpDialog.js\nfunction HelpDialog_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction HelpDialog_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction HelpDialog_createClass(Constructor, protoProps, staticProps) { if (protoProps) HelpDialog_defineProperties(Constructor.prototype, protoProps); if (staticProps) HelpDialog_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\nvar HelpDialog_HelpDialog = /*#__PURE__*/function () {\n  function HelpDialog(context) {\n    HelpDialog_classCallCheck(this, HelpDialog);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.$body = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(document.body);\n    this.$editor = context.layoutInfo.editor;\n    this.options = context.options;\n    this.lang = this.options.langInfo;\n  }\n\n  HelpDialog_createClass(HelpDialog, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var $container = this.options.dialogsInBody ? this.$body : this.options.container;\n      var body = ['<p class=\"text-center\">', '<a href=\"http://summernote.org/\" target=\"_blank\">Summernote 0.8.18</a> · ', '<a href=\"https://github.com/summernote/summernote\" target=\"_blank\">Project</a> · ', '<a href=\"https://github.com/summernote/summernote/issues\" target=\"_blank\">Issues</a>', '</p>'].join('');\n      this.$dialog = this.ui.dialog({\n        title: this.lang.options.help,\n        fade: this.options.dialogsFade,\n        body: this.createShortcutList(),\n        footer: body,\n        callback: function callback($node) {\n          $node.find('.modal-body,.note-modal-body').css({\n            'max-height': 300,\n            'overflow': 'scroll'\n          });\n        }\n      }).render().appendTo($container);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    }\n  }, {\n    key: \"createShortcutList\",\n    value: function createShortcutList() {\n      var _this = this;\n\n      var keyMap = this.options.keyMap[env.isMac ? 'mac' : 'pc'];\n      return Object.keys(keyMap).map(function (key) {\n        var command = keyMap[key];\n        var $row = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div><div class=\"help-list-item\"></div></div>');\n        $row.append(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<label><kbd>' + key + '</kdb></label>').css({\n          'width': 180,\n          'margin-right': 10\n        })).append(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<span/>').html(_this.context.memo('help.' + command) || command));\n        return $row.html();\n      }).join('');\n    }\n    /**\n     * show help dialog\n     *\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"showHelpDialog\",\n    value: function showHelpDialog() {\n      var _this2 = this;\n\n      return external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.Deferred(function (deferred) {\n        _this2.ui.onDialogShown(_this2.$dialog, function () {\n          _this2.context.triggerEvent('dialog.shown');\n\n          deferred.resolve();\n        });\n\n        _this2.ui.showDialog(_this2.$dialog);\n      }).promise();\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this3 = this;\n\n      this.context.invoke('editor.saveRange');\n      this.showHelpDialog().then(function () {\n        _this3.context.invoke('editor.restoreRange');\n      });\n    }\n  }]);\n\n  return HelpDialog;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/AirPopover.js\nfunction AirPopover_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction AirPopover_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction AirPopover_createClass(Constructor, protoProps, staticProps) { if (protoProps) AirPopover_defineProperties(Constructor.prototype, protoProps); if (staticProps) AirPopover_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar AIRMODE_POPOVER_X_OFFSET = -5;\nvar AIRMODE_POPOVER_Y_OFFSET = 5;\n\nvar AirPopover_AirPopover = /*#__PURE__*/function () {\n  function AirPopover(context) {\n    var _this = this;\n\n    AirPopover_classCallCheck(this, AirPopover);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.options = context.options;\n    this.hidable = true;\n    this.onContextmenu = false;\n    this.pageX = null;\n    this.pageY = null;\n    this.events = {\n      'summernote.contextmenu': function summernoteContextmenu(e) {\n        if (_this.options.editing) {\n          e.preventDefault();\n          e.stopPropagation();\n          _this.onContextmenu = true;\n\n          _this.update(true);\n        }\n      },\n      'summernote.mousedown': function summernoteMousedown(we, e) {\n        _this.pageX = e.pageX;\n        _this.pageY = e.pageY;\n      },\n      'summernote.keyup summernote.mouseup summernote.scroll': function summernoteKeyupSummernoteMouseupSummernoteScroll(we, e) {\n        if (_this.options.editing && !_this.onContextmenu) {\n          _this.pageX = e.pageX;\n          _this.pageY = e.pageY;\n\n          _this.update();\n        }\n\n        _this.onContextmenu = false;\n      },\n      'summernote.disable summernote.change summernote.dialog.shown summernote.blur': function summernoteDisableSummernoteChangeSummernoteDialogShownSummernoteBlur() {\n        _this.hide();\n      },\n      'summernote.focusout': function summernoteFocusout() {\n        if (!_this.$popover.is(':active,:focus')) {\n          _this.hide();\n        }\n      }\n    };\n  }\n\n  AirPopover_createClass(AirPopover, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return this.options.airMode && !lists.isEmpty(this.options.popover.air);\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this2 = this;\n\n      this.$popover = this.ui.popover({\n        className: 'note-air-popover'\n      }).render().appendTo(this.options.container);\n      var $content = this.$popover.find('.popover-content');\n      this.context.invoke('buttons.build', $content, this.options.popover.air); // disable hiding this popover preemptively by 'summernote.blur' event.\n\n      this.$popover.on('mousedown', function () {\n        _this2.hidable = false;\n      }); // (re-)enable hiding after 'summernote.blur' has been handled (aka. ignored).\n\n      this.$popover.on('mouseup', function () {\n        _this2.hidable = true;\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$popover.remove();\n    }\n  }, {\n    key: \"update\",\n    value: function update(forcelyOpen) {\n      var styleInfo = this.context.invoke('editor.currentStyle');\n\n      if (styleInfo.range && (!styleInfo.range.isCollapsed() || forcelyOpen)) {\n        var rect = {\n          left: this.pageX,\n          top: this.pageY\n        };\n        var containerOffset = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.options.container).offset();\n        rect.top -= containerOffset.top;\n        rect.left -= containerOffset.left;\n        this.$popover.css({\n          display: 'block',\n          left: Math.max(rect.left, 0) + AIRMODE_POPOVER_X_OFFSET,\n          top: rect.top + AIRMODE_POPOVER_Y_OFFSET\n        });\n        this.context.invoke('buttons.updateCurrentStyle', this.$popover);\n      } else {\n        this.hide();\n      }\n    }\n  }, {\n    key: \"updateCodeview\",\n    value: function updateCodeview(isCodeview) {\n      this.ui.toggleBtnActive(this.$popover.find('.btn-codeview'), isCodeview);\n\n      if (isCodeview) {\n        this.hide();\n      }\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      if (this.hidable) {\n        this.$popover.hide();\n      }\n    }\n  }]);\n\n  return AirPopover;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/module/HintPopover.js\nfunction HintPopover_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction HintPopover_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction HintPopover_createClass(Constructor, protoProps, staticProps) { if (protoProps) HintPopover_defineProperties(Constructor.prototype, protoProps); if (staticProps) HintPopover_defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\nvar POPOVER_DIST = 5;\n\nvar HintPopover_HintPopover = /*#__PURE__*/function () {\n  function HintPopover(context) {\n    var _this = this;\n\n    HintPopover_classCallCheck(this, HintPopover);\n\n    this.context = context;\n    this.ui = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.ui;\n    this.$editable = context.layoutInfo.editable;\n    this.options = context.options;\n    this.hint = this.options.hint || [];\n    this.direction = this.options.hintDirection || 'bottom';\n    this.hints = Array.isArray(this.hint) ? this.hint : [this.hint];\n    this.events = {\n      'summernote.keyup': function summernoteKeyup(we, e) {\n        if (!e.isDefaultPrevented()) {\n          _this.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function summernoteKeydown(we, e) {\n        _this.handleKeydown(e);\n      },\n      'summernote.disable summernote.dialog.shown summernote.blur': function summernoteDisableSummernoteDialogShownSummernoteBlur() {\n        _this.hide();\n      }\n    };\n  }\n\n  HintPopover_createClass(HintPopover, [{\n    key: \"shouldInitialize\",\n    value: function shouldInitialize() {\n      return this.hints.length > 0;\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this2 = this;\n\n      this.lastWordRange = null;\n      this.matchingWord = null;\n      this.$popover = this.ui.popover({\n        className: 'note-hint-popover',\n        hideArrow: true,\n        direction: ''\n      }).render().appendTo(this.options.container);\n      this.$popover.hide();\n      this.$content = this.$popover.find('.popover-content,.note-popover-content');\n      this.$content.on('click', '.note-hint-item', function (e) {\n        _this2.$content.find('.active').removeClass('active');\n\n        external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(e.currentTarget).addClass('active');\n\n        _this2.replace();\n      });\n      this.$popover.on('mousedown', function (e) {\n        e.preventDefault();\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.$popover.remove();\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem($item) {\n      this.$content.find('.active').removeClass('active');\n      $item.addClass('active');\n      this.$content[0].scrollTop = $item[0].offsetTop - this.$content.innerHeight() / 2;\n    }\n  }, {\n    key: \"moveDown\",\n    value: function moveDown() {\n      var $current = this.$content.find('.note-hint-item.active');\n      var $next = $current.next();\n\n      if ($next.length) {\n        this.selectItem($next);\n      } else {\n        var $nextGroup = $current.parent().next();\n\n        if (!$nextGroup.length) {\n          $nextGroup = this.$content.find('.note-hint-group').first();\n        }\n\n        this.selectItem($nextGroup.find('.note-hint-item').first());\n      }\n    }\n  }, {\n    key: \"moveUp\",\n    value: function moveUp() {\n      var $current = this.$content.find('.note-hint-item.active');\n      var $prev = $current.prev();\n\n      if ($prev.length) {\n        this.selectItem($prev);\n      } else {\n        var $prevGroup = $current.parent().prev();\n\n        if (!$prevGroup.length) {\n          $prevGroup = this.$content.find('.note-hint-group').last();\n        }\n\n        this.selectItem($prevGroup.find('.note-hint-item').last());\n      }\n    }\n  }, {\n    key: \"replace\",\n    value: function replace() {\n      var $item = this.$content.find('.note-hint-item.active');\n\n      if ($item.length) {\n        var node = this.nodeFromItem($item); // If matchingWord length = 0 -> capture OK / open hint / but as mention capture \"\" (\\w*)\n\n        if (this.matchingWord !== null && this.matchingWord.length === 0) {\n          this.lastWordRange.so = this.lastWordRange.eo; // Else si > 0 and normal case -> adjust range \"before\" for correct position of insertion\n        } else if (this.matchingWord !== null && this.matchingWord.length > 0 && !this.lastWordRange.isCollapsed()) {\n          var rangeCompute = this.lastWordRange.eo - this.lastWordRange.so - this.matchingWord.length;\n\n          if (rangeCompute > 0) {\n            this.lastWordRange.so += rangeCompute;\n          }\n        }\n\n        this.lastWordRange.insertNode(node);\n\n        if (this.options.hintSelect === 'next') {\n          var blank = document.createTextNode('');\n          external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(node).after(blank);\n          range.createFromNodeBefore(blank).select();\n        } else {\n          range.createFromNodeAfter(node).select();\n        }\n\n        this.lastWordRange = null;\n        this.hide();\n        this.context.invoke('editor.focus');\n      }\n    }\n  }, {\n    key: \"nodeFromItem\",\n    value: function nodeFromItem($item) {\n      var hint = this.hints[$item.data('index')];\n      var item = $item.data('item');\n      var node = hint.content ? hint.content(item) : item;\n\n      if (typeof node === 'string') {\n        node = dom.createText(node);\n      }\n\n      return node;\n    }\n  }, {\n    key: \"createItemTemplates\",\n    value: function createItemTemplates(hintIdx, items) {\n      var hint = this.hints[hintIdx];\n      return items.map(function (item\n      /*, idx */\n      ) {\n        var $item = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div class=\"note-hint-item\"/>');\n        $item.append(hint.template ? hint.template(item) : item + '');\n        $item.data({\n          'index': hintIdx,\n          'item': item\n        });\n        return $item;\n      });\n    }\n  }, {\n    key: \"handleKeydown\",\n    value: function handleKeydown(e) {\n      if (!this.$popover.is(':visible')) {\n        return;\n      }\n\n      if (e.keyCode === core_key.code.ENTER) {\n        e.preventDefault();\n        this.replace();\n      } else if (e.keyCode === core_key.code.UP) {\n        e.preventDefault();\n        this.moveUp();\n      } else if (e.keyCode === core_key.code.DOWN) {\n        e.preventDefault();\n        this.moveDown();\n      }\n    }\n  }, {\n    key: \"searchKeyword\",\n    value: function searchKeyword(index, keyword, callback) {\n      var hint = this.hints[index];\n\n      if (hint && hint.match.test(keyword) && hint.search) {\n        var matches = hint.match.exec(keyword);\n        this.matchingWord = matches[0];\n        hint.search(matches[1], callback);\n      } else {\n        callback();\n      }\n    }\n  }, {\n    key: \"createGroup\",\n    value: function createGroup(idx, keyword) {\n      var _this3 = this;\n\n      var $group = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()('<div class=\"note-hint-group note-hint-group-' + idx + '\"></div>');\n      this.searchKeyword(idx, keyword, function (items) {\n        items = items || [];\n\n        if (items.length) {\n          $group.html(_this3.createItemTemplates(idx, items));\n\n          _this3.show();\n        }\n      });\n      return $group;\n    }\n  }, {\n    key: \"handleKeyup\",\n    value: function handleKeyup(e) {\n      var _this4 = this;\n\n      if (!lists.contains([core_key.code.ENTER, core_key.code.UP, core_key.code.DOWN], e.keyCode)) {\n        var _range = this.context.invoke('editor.getLastRange');\n\n        var wordRange, keyword;\n\n        if (this.options.hintMode === 'words') {\n          wordRange = _range.getWordsRange(_range);\n          keyword = wordRange.toString();\n          this.hints.forEach(function (hint) {\n            if (hint.match.test(keyword)) {\n              wordRange = _range.getWordsMatchRange(hint.match);\n              return false;\n            }\n          });\n\n          if (!wordRange) {\n            this.hide();\n            return;\n          }\n\n          keyword = wordRange.toString();\n        } else {\n          wordRange = _range.getWordRange();\n          keyword = wordRange.toString();\n        }\n\n        if (this.hints.length && keyword) {\n          this.$content.empty();\n          var bnd = func.rect2bnd(lists.last(wordRange.getClientRects()));\n          var containerOffset = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(this.options.container).offset();\n\n          if (bnd) {\n            bnd.top -= containerOffset.top;\n            bnd.left -= containerOffset.left;\n            this.$popover.hide();\n            this.lastWordRange = wordRange;\n            this.hints.forEach(function (hint, idx) {\n              if (hint.match.test(keyword)) {\n                _this4.createGroup(idx, keyword).appendTo(_this4.$content);\n              }\n            }); // select first .note-hint-item\n\n            this.$content.find('.note-hint-item:first').addClass('active'); // set position for popover after group is created\n\n            if (this.direction === 'top') {\n              this.$popover.css({\n                left: bnd.left,\n                top: bnd.top - this.$popover.outerHeight() - POPOVER_DIST\n              });\n            } else {\n              this.$popover.css({\n                left: bnd.left,\n                top: bnd.top + bnd.height + POPOVER_DIST\n              });\n            }\n          }\n        } else {\n          this.hide();\n        }\n      }\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.$popover.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.$popover.hide();\n    }\n  }]);\n\n  return HintPopover;\n}();\n\n\n// CONCATENATED MODULE: ./src/js/base/settings.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nexternal_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote, {\n  version: '0.8.18',\n  plugins: {},\n  dom: dom,\n  range: range,\n  lists: lists,\n  options: {\n    langInfo: external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote.lang['en-US'],\n    editing: true,\n    modules: {\n      'editor': Editor_Editor,\n      'clipboard': Clipboard_Clipboard,\n      'dropzone': Dropzone_Dropzone,\n      'codeview': Codeview_CodeView,\n      'statusbar': Statusbar_Statusbar,\n      'fullscreen': Fullscreen_Fullscreen,\n      'handle': Handle_Handle,\n      // FIXME: HintPopover must be front of autolink\n      //  - Script error about range when Enter key is pressed on hint popover\n      'hintPopover': HintPopover_HintPopover,\n      'autoLink': AutoLink_AutoLink,\n      'autoSync': AutoSync_AutoSync,\n      'autoReplace': AutoReplace_AutoReplace,\n      'placeholder': Placeholder_Placeholder,\n      'buttons': Buttons_Buttons,\n      'toolbar': Toolbar_Toolbar,\n      'linkDialog': LinkDialog_LinkDialog,\n      'linkPopover': LinkPopover_LinkPopover,\n      'imageDialog': ImageDialog_ImageDialog,\n      'imagePopover': ImagePopover_ImagePopover,\n      'tablePopover': TablePopover_TablePopover,\n      'videoDialog': VideoDialog_VideoDialog,\n      'helpDialog': HelpDialog_HelpDialog,\n      'airPopover': AirPopover_AirPopover\n    },\n    buttons: {},\n    lang: 'en-US',\n    followingToolbar: false,\n    toolbarPosition: 'top',\n    otherStaticBar: '',\n    // toolbar\n    codeviewKeepButton: false,\n    toolbar: [['style', ['style']], ['font', ['bold', 'underline', 'clear']], ['fontname', ['fontname']], ['color', ['color']], ['para', ['ul', 'ol', 'paragraph']], ['table', ['table']], ['insert', ['link', 'picture', 'video']], ['view', ['fullscreen', 'codeview', 'help']]],\n    // popover\n    popatmouse: true,\n    popover: {\n      image: [['resize', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']], ['float', ['floatLeft', 'floatRight', 'floatNone']], ['remove', ['removeMedia']]],\n      link: [['link', ['linkDialogShow', 'unlink']]],\n      table: [['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']], ['delete', ['deleteRow', 'deleteCol', 'deleteTable']]],\n      air: [['color', ['color']], ['font', ['bold', 'underline', 'clear']], ['para', ['ul', 'paragraph']], ['table', ['table']], ['insert', ['link', 'picture']], ['view', ['fullscreen', 'codeview']]]\n    },\n    // air mode: inline editor\n    airMode: false,\n    overrideContextMenu: false,\n    // TBD\n    width: null,\n    height: null,\n    linkTargetBlank: true,\n    useProtocol: true,\n    defaultProtocol: 'http://',\n    focus: false,\n    tabDisabled: false,\n    tabSize: 4,\n    styleWithCSS: false,\n    shortcuts: true,\n    textareaAutoSync: true,\n    tooltip: 'auto',\n    container: null,\n    maxTextLength: 0,\n    blockquoteBreakingLevel: 2,\n    spellCheck: true,\n    disableGrammar: false,\n    placeholder: null,\n    inheritPlaceholder: false,\n    // TODO: need to be documented\n    recordEveryKeystroke: false,\n    historyLimit: 200,\n    // TODO: need to be documented\n    showDomainOnlyForAutolink: false,\n    // TODO: need to be documented\n    hintMode: 'word',\n    hintSelect: 'after',\n    hintDirection: 'bottom',\n    styleTags: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande', 'Tahoma', 'Times New Roman', 'Verdana'],\n    fontNamesIgnoreCheck: [],\n    addDefaultFonts: true,\n    fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],\n    fontSizeUnits: ['px', 'pt'],\n    // pallete colors(n x n)\n    colors: [['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F7F7', '#FFFFFF'], ['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'], ['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'], ['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'], ['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'], ['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'], ['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'], ['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031']],\n    // http://chir.ag/projects/name-that-color/\n    colorsName: [['Black', 'Tundora', 'Dove Gray', 'Star Dust', 'Pale Slate', 'Gallery', 'Alabaster', 'White'], ['Red', 'Orange Peel', 'Yellow', 'Green', 'Cyan', 'Blue', 'Electric Violet', 'Magenta'], ['Azalea', 'Karry', 'Egg White', 'Zanah', 'Botticelli', 'Tropical Blue', 'Mischka', 'Twilight'], ['Tonys Pink', 'Peach Orange', 'Cream Brulee', 'Sprout', 'Casper', 'Perano', 'Cold Purple', 'Careys Pink'], ['Mandy', 'Rajah', 'Dandelion', 'Olivine', 'Gulf Stream', 'Viking', 'Blue Marguerite', 'Puce'], ['Guardsman Red', 'Fire Bush', 'Golden Dream', 'Chelsea Cucumber', 'Smalt Blue', 'Boston Blue', 'Butterfly Bush', 'Cadillac'], ['Sangria', 'Mai Tai', 'Buddha Gold', 'Forest Green', 'Eden', 'Venice Blue', 'Meteorite', 'Claret'], ['Rosewood', 'Cinnamon', 'Olive', 'Parsley', 'Tiber', 'Midnight Blue', 'Valentino', 'Loulou']],\n    colorButton: {\n      foreColor: '#000000',\n      backColor: '#FFFF00'\n    },\n    lineHeights: ['1.0', '1.2', '1.4', '1.5', '1.6', '1.8', '2.0', '3.0'],\n    tableClassName: 'table table-bordered',\n    insertTableMaxSize: {\n      col: 10,\n      row: 10\n    },\n    // By default, dialogs are attached in container.\n    dialogsInBody: false,\n    dialogsFade: false,\n    maximumImageFileSize: null,\n    callbacks: {\n      onBeforeCommand: null,\n      onBlur: null,\n      onBlurCodeview: null,\n      onChange: null,\n      onChangeCodeview: null,\n      onDialogShown: null,\n      onEnter: null,\n      onFocus: null,\n      onImageLinkInsert: null,\n      onImageUpload: null,\n      onImageUploadError: null,\n      onInit: null,\n      onKeydown: null,\n      onKeyup: null,\n      onMousedown: null,\n      onMouseup: null,\n      onPaste: null,\n      onScroll: null\n    },\n    codemirror: {\n      mode: 'text/html',\n      htmlMode: true,\n      lineNumbers: true\n    },\n    codeviewFilter: false,\n    codeviewFilterRegex: /<\\/*(?:applet|b(?:ase|gsound|link)|embed|frame(?:set)?|ilayer|l(?:ayer|ink)|meta|object|s(?:cript|tyle)|t(?:itle|extarea)|xml)[^>]*?>/gi,\n    codeviewIframeFilter: true,\n    codeviewIframeWhitelistSrc: [],\n    codeviewIframeWhitelistSrcBase: ['www.youtube.com', 'www.youtube-nocookie.com', 'www.facebook.com', 'vine.co', 'instagram.com', 'player.vimeo.com', 'www.dailymotion.com', 'player.youku.com', 'v.qq.com'],\n    keyMap: {\n      pc: {\n        'ESC': 'escape',\n        'ENTER': 'insertParagraph',\n        'CTRL+Z': 'undo',\n        'CTRL+Y': 'redo',\n        'TAB': 'tab',\n        'SHIFT+TAB': 'untab',\n        'CTRL+B': 'bold',\n        'CTRL+I': 'italic',\n        'CTRL+U': 'underline',\n        'CTRL+SHIFT+S': 'strikethrough',\n        'CTRL+BACKSLASH': 'removeFormat',\n        'CTRL+SHIFT+L': 'justifyLeft',\n        'CTRL+SHIFT+E': 'justifyCenter',\n        'CTRL+SHIFT+R': 'justifyRight',\n        'CTRL+SHIFT+J': 'justifyFull',\n        'CTRL+SHIFT+NUM7': 'insertUnorderedList',\n        'CTRL+SHIFT+NUM8': 'insertOrderedList',\n        'CTRL+LEFTBRACKET': 'outdent',\n        'CTRL+RIGHTBRACKET': 'indent',\n        'CTRL+NUM0': 'formatPara',\n        'CTRL+NUM1': 'formatH1',\n        'CTRL+NUM2': 'formatH2',\n        'CTRL+NUM3': 'formatH3',\n        'CTRL+NUM4': 'formatH4',\n        'CTRL+NUM5': 'formatH5',\n        'CTRL+NUM6': 'formatH6',\n        'CTRL+ENTER': 'insertHorizontalRule',\n        'CTRL+K': 'linkDialog.show'\n      },\n      mac: {\n        'ESC': 'escape',\n        'ENTER': 'insertParagraph',\n        'CMD+Z': 'undo',\n        'CMD+SHIFT+Z': 'redo',\n        'TAB': 'tab',\n        'SHIFT+TAB': 'untab',\n        'CMD+B': 'bold',\n        'CMD+I': 'italic',\n        'CMD+U': 'underline',\n        'CMD+SHIFT+S': 'strikethrough',\n        'CMD+BACKSLASH': 'removeFormat',\n        'CMD+SHIFT+L': 'justifyLeft',\n        'CMD+SHIFT+E': 'justifyCenter',\n        'CMD+SHIFT+R': 'justifyRight',\n        'CMD+SHIFT+J': 'justifyFull',\n        'CMD+SHIFT+NUM7': 'insertUnorderedList',\n        'CMD+SHIFT+NUM8': 'insertOrderedList',\n        'CMD+LEFTBRACKET': 'outdent',\n        'CMD+RIGHTBRACKET': 'indent',\n        'CMD+NUM0': 'formatPara',\n        'CMD+NUM1': 'formatH1',\n        'CMD+NUM2': 'formatH2',\n        'CMD+NUM3': 'formatH3',\n        'CMD+NUM4': 'formatH4',\n        'CMD+NUM5': 'formatH5',\n        'CMD+NUM6': 'formatH6',\n        'CMD+ENTER': 'insertHorizontalRule',\n        'CMD+K': 'linkDialog.show'\n      }\n    },\n    icons: {\n      'align': 'note-icon-align',\n      'alignCenter': 'note-icon-align-center',\n      'alignJustify': 'note-icon-align-justify',\n      'alignLeft': 'note-icon-align-left',\n      'alignRight': 'note-icon-align-right',\n      'rowBelow': 'note-icon-row-below',\n      'colBefore': 'note-icon-col-before',\n      'colAfter': 'note-icon-col-after',\n      'rowAbove': 'note-icon-row-above',\n      'rowRemove': 'note-icon-row-remove',\n      'colRemove': 'note-icon-col-remove',\n      'indent': 'note-icon-align-indent',\n      'outdent': 'note-icon-align-outdent',\n      'arrowsAlt': 'note-icon-arrows-alt',\n      'bold': 'note-icon-bold',\n      'caret': 'note-icon-caret',\n      'circle': 'note-icon-circle',\n      'close': 'note-icon-close',\n      'code': 'note-icon-code',\n      'eraser': 'note-icon-eraser',\n      'floatLeft': 'note-icon-float-left',\n      'floatRight': 'note-icon-float-right',\n      'font': 'note-icon-font',\n      'frame': 'note-icon-frame',\n      'italic': 'note-icon-italic',\n      'link': 'note-icon-link',\n      'unlink': 'note-icon-chain-broken',\n      'magic': 'note-icon-magic',\n      'menuCheck': 'note-icon-menu-check',\n      'minus': 'note-icon-minus',\n      'orderedlist': 'note-icon-orderedlist',\n      'pencil': 'note-icon-pencil',\n      'picture': 'note-icon-picture',\n      'question': 'note-icon-question',\n      'redo': 'note-icon-redo',\n      'rollback': 'note-icon-rollback',\n      'square': 'note-icon-square',\n      'strikethrough': 'note-icon-strikethrough',\n      'subscript': 'note-icon-subscript',\n      'superscript': 'note-icon-superscript',\n      'table': 'note-icon-table',\n      'textHeight': 'note-icon-text-height',\n      'trash': 'note-icon-trash',\n      'underline': 'note-icon-underline',\n      'undo': 'note-icon-undo',\n      'unorderedlist': 'note-icon-unorderedlist',\n      'video': 'note-icon-video'\n    }\n  }\n});\n\n/***/ }),\n\n/***/ 4:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n\n/***/ 52:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: external {\"root\":\"jQuery\",\"commonjs2\":\"jquery\",\"commonjs\":\"jquery\",\"amd\":\"jquery\"}\nvar external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_ = __webpack_require__(0);\nvar external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default = /*#__PURE__*/__webpack_require__.n(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_);\n\n// EXTERNAL MODULE: ./src/js/base/renderer.js\nvar renderer = __webpack_require__(1);\n\n// CONCATENATED MODULE: ./src/js/bs3/ui.js\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n\n\nvar editor = renderer[\"a\" /* default */].create('<div class=\"note-editor note-frame panel panel-default\"/>');\nvar toolbar = renderer[\"a\" /* default */].create('<div class=\"panel-heading note-toolbar\" role=\"toolbar\"/>');\nvar editingArea = renderer[\"a\" /* default */].create('<div class=\"note-editing-area\"/>');\nvar codable = renderer[\"a\" /* default */].create('<textarea class=\"note-codable\" aria-multiline=\"true\"/>');\nvar editable = renderer[\"a\" /* default */].create('<div class=\"note-editable\" contentEditable=\"true\" role=\"textbox\" aria-multiline=\"true\"/>');\nvar statusbar = renderer[\"a\" /* default */].create(['<output class=\"note-status-output\" role=\"status\" aria-live=\"polite\"></output>', '<div class=\"note-statusbar\" role=\"status\">', '<div class=\"note-resizebar\" aria-label=\"Resize\">', '<div class=\"note-icon-bar\"></div>', '<div class=\"note-icon-bar\"></div>', '<div class=\"note-icon-bar\"></div>', '</div>', '</div>'].join(''));\nvar airEditor = renderer[\"a\" /* default */].create('<div class=\"note-editor note-airframe\"/>');\nvar airEditable = renderer[\"a\" /* default */].create(['<div class=\"note-editable\" contentEditable=\"true\" role=\"textbox\" aria-multiline=\"true\"></div>', '<output class=\"note-status-output\" role=\"status\" aria-live=\"polite\"></output>'].join(''));\nvar buttonGroup = renderer[\"a\" /* default */].create('<div class=\"note-btn-group btn-group\">');\nvar dropdown = renderer[\"a\" /* default */].create('<ul class=\"note-dropdown-menu dropdown-menu\">', function ($node, options) {\n  var markup = Array.isArray(options.items) ? options.items.map(function (item) {\n    var value = typeof item === 'string' ? item : item.value || '';\n    var content = options.template ? options.template(item) : item;\n    var option = _typeof(item) === 'object' ? item.option : undefined;\n    var dataValue = 'data-value=\"' + value + '\"';\n    var dataOption = option !== undefined ? ' data-option=\"' + option + '\"' : '';\n    return '<li aria-label=\"' + value + '\"><a href=\"#\" ' + (dataValue + dataOption) + '>' + content + '</a></li>';\n  }).join('') : options.items;\n  $node.html(markup).attr({\n    'aria-label': options.title\n  });\n\n  if (options && options.codeviewKeepButton) {\n    $node.addClass('note-codeview-keep');\n  }\n});\n\nvar dropdownButtonContents = function dropdownButtonContents(contents, options) {\n  return contents + ' ' + icon(options.icons.caret, 'span');\n};\n\nvar dropdownCheck = renderer[\"a\" /* default */].create('<ul class=\"note-dropdown-menu dropdown-menu note-check\">', function ($node, options) {\n  var markup = Array.isArray(options.items) ? options.items.map(function (item) {\n    var value = typeof item === 'string' ? item : item.value || '';\n    var content = options.template ? options.template(item) : item;\n    return '<li aria-label=\"' + item + '\"><a href=\"#\" data-value=\"' + value + '\">' + icon(options.checkClassName) + ' ' + content + '</a></li>';\n  }).join('') : options.items;\n  $node.html(markup).attr({\n    'aria-label': options.title\n  });\n\n  if (options && options.codeviewKeepButton) {\n    $node.addClass('note-codeview-keep');\n  }\n});\nvar dialog = renderer[\"a\" /* default */].create('<div class=\"modal note-modal\" aria-hidden=\"false\" tabindex=\"-1\" role=\"dialog\"/>', function ($node, options) {\n  if (options.fade) {\n    $node.addClass('fade');\n  }\n\n  $node.attr({\n    'aria-label': options.title\n  });\n  $node.html(['<div class=\"modal-dialog\">', '<div class=\"modal-content\">', options.title ? '<div class=\"modal-header\">' + '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" aria-hidden=\"true\">&times;</button>' + '<h4 class=\"modal-title\">' + options.title + '</h4>' + '</div>' : '', '<div class=\"modal-body\">' + options.body + '</div>', options.footer ? '<div class=\"modal-footer\">' + options.footer + '</div>' : '', '</div>', '</div>'].join(''));\n});\nvar popover = renderer[\"a\" /* default */].create(['<div class=\"note-popover popover in\">', '<div class=\"arrow\"></div>', '<div class=\"popover-content note-children-container\"></div>', '</div>'].join(''), function ($node, options) {\n  var direction = typeof options.direction !== 'undefined' ? options.direction : 'bottom';\n  $node.addClass(direction);\n\n  if (options.hideArrow) {\n    $node.find('.arrow').hide();\n  }\n});\nvar ui_checkbox = renderer[\"a\" /* default */].create('<div class=\"checkbox\"></div>', function ($node, options) {\n  $node.html(['<label' + (options.id ? ' for=\"note-' + options.id + '\"' : '') + '>', '<input type=\"checkbox\"' + (options.id ? ' id=\"note-' + options.id + '\"' : ''), options.checked ? ' checked' : '', ' aria-checked=\"' + (options.checked ? 'true' : 'false') + '\"/>', options.text ? options.text : '', '</label>'].join(''));\n});\n\nvar icon = function icon(iconClassName, tagName) {\n  tagName = tagName || 'i';\n  return '<' + tagName + ' class=\"' + iconClassName + '\"></' + tagName + '>';\n};\n\nvar ui_ui = function ui(editorOptions) {\n  return {\n    editor: editor,\n    toolbar: toolbar,\n    editingArea: editingArea,\n    codable: codable,\n    editable: editable,\n    statusbar: statusbar,\n    airEditor: airEditor,\n    airEditable: airEditable,\n    buttonGroup: buttonGroup,\n    dropdown: dropdown,\n    dropdownButtonContents: dropdownButtonContents,\n    dropdownCheck: dropdownCheck,\n    dialog: dialog,\n    popover: popover,\n    checkbox: ui_checkbox,\n    icon: icon,\n    options: editorOptions,\n    palette: function palette($node, options) {\n      return renderer[\"a\" /* default */].create('<div class=\"note-color-palette\"/>', function ($node, options) {\n        var contents = [];\n\n        for (var row = 0, rowSize = options.colors.length; row < rowSize; row++) {\n          var eventName = options.eventName;\n          var colors = options.colors[row];\n          var colorsName = options.colorsName[row];\n          var buttons = [];\n\n          for (var col = 0, colSize = colors.length; col < colSize; col++) {\n            var color = colors[col];\n            var colorName = colorsName[col];\n            buttons.push(['<button type=\"button\" class=\"note-color-btn\"', 'style=\"background-color:', color, '\" ', 'data-event=\"', eventName, '\" ', 'data-value=\"', color, '\" ', 'title=\"', colorName, '\" ', 'aria-label=\"', colorName, '\" ', 'data-toggle=\"button\" tabindex=\"-1\"></button>'].join(''));\n          }\n\n          contents.push('<div class=\"note-color-row\">' + buttons.join('') + '</div>');\n        }\n\n        $node.html(contents.join(''));\n\n        if (options.tooltip) {\n          $node.find('.note-color-btn').tooltip({\n            container: options.container || editorOptions.container,\n            trigger: 'hover',\n            placement: 'bottom'\n          });\n        }\n      })($node, options);\n    },\n    button: function button($node, options) {\n      return renderer[\"a\" /* default */].create('<button type=\"button\" class=\"note-btn btn btn-default btn-sm\" tabindex=\"-1\">', function ($node, options) {\n        if (options && options.tooltip) {\n          $node.attr({\n            title: options.tooltip,\n            'aria-label': options.tooltip\n          }).tooltip({\n            container: options.container || editorOptions.container,\n            trigger: 'hover',\n            placement: 'bottom'\n          }).on('click', function (e) {\n            external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default()(e.currentTarget).tooltip('hide');\n          });\n        }\n\n        if (options && options.codeviewButton) {\n          $node.addClass('note-codeview-keep');\n        }\n      })($node, options);\n    },\n    toggleBtn: function toggleBtn($btn, isEnable) {\n      $btn.toggleClass('disabled', !isEnable);\n      $btn.attr('disabled', !isEnable);\n    },\n    toggleBtnActive: function toggleBtnActive($btn, isActive) {\n      $btn.toggleClass('active', isActive);\n    },\n    onDialogShown: function onDialogShown($dialog, handler) {\n      $dialog.one('shown.bs.modal', handler);\n    },\n    onDialogHidden: function onDialogHidden($dialog, handler) {\n      $dialog.one('hidden.bs.modal', handler);\n    },\n    showDialog: function showDialog($dialog) {\n      $dialog.modal('show');\n    },\n    hideDialog: function hideDialog($dialog) {\n      $dialog.modal('hide');\n    },\n    createLayout: function createLayout($note) {\n      var $editor = (editorOptions.airMode ? airEditor([editingArea([codable(), airEditable()])]) : editorOptions.toolbarPosition === 'bottom' ? editor([editingArea([codable(), editable()]), toolbar(), statusbar()]) : editor([toolbar(), editingArea([codable(), editable()]), statusbar()])).render();\n      $editor.insertAfter($note);\n      return {\n        note: $note,\n        editor: $editor,\n        toolbar: $editor.find('.note-toolbar'),\n        editingArea: $editor.find('.note-editing-area'),\n        editable: $editor.find('.note-editable'),\n        codable: $editor.find('.note-codable'),\n        statusbar: $editor.find('.note-statusbar')\n      };\n    },\n    removeLayout: function removeLayout($note, layoutInfo) {\n      $note.html(layoutInfo.editable.html());\n      layoutInfo.editor.remove();\n      $note.show();\n    }\n  };\n};\n\n/* harmony default export */ var bs3_ui = (ui_ui);\n// EXTERNAL MODULE: ./src/js/base/settings.js + 37 modules\nvar settings = __webpack_require__(3);\n\n// EXTERNAL MODULE: ./src/styles/summernote-bs3.scss\nvar summernote_bs3 = __webpack_require__(4);\n\n// CONCATENATED MODULE: ./src/js/bs3/settings.js\n\n\n\n\nexternal_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote = external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.extend(external_root_jQuery_commonjs2_jquery_commonjs_jquery_amd_jquery_default.a.summernote, {\n  ui_template: bs3_ui,\n  \"interface\": 'bs3'\n});\n\n/***/ })\n\n/******/ });\n});\n//# sourceMappingURL=summernote.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieE44MS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9zdW1tZXJub3RlL2Rpc3Qvc3VtbWVybm90ZS5qcz9jNGRmIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogXG4gKiBTdXBlciBzaW1wbGUgd3lzaXd5ZyBlZGl0b3IgdjAuOC4xOFxuICogaHR0cHM6Ly9zdW1tZXJub3RlLm9yZ1xuICogXG4gKiBcbiAqIENvcHlyaWdodCAyMDEzLSBBbGFuIEhvbmcuIGFuZCBvdGhlciBjb250cmlidXRvcnNcbiAqIHN1bW1lcm5vdGUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuXG4gKiBcbiAqIERhdGU6IDIwMjAtMDUtMjBUMTY6NDdaXG4gKiBcbiAqL1xuKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwianF1ZXJ5XCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcImpxdWVyeVwiXSwgZmFjdG9yeSk7XG5cdGVsc2Uge1xuXHRcdHZhciBhID0gdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnID8gZmFjdG9yeShyZXF1aXJlKFwianF1ZXJ5XCIpKSA6IGZhY3Rvcnkocm9vdFtcImpRdWVyeVwiXSk7XG5cdFx0Zm9yKHZhciBpIGluIGEpICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldO1xuXHR9XG59KSh3aW5kb3csIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXykge1xucmV0dXJuIC8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0aTogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9XG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4vKioqKioqLyBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4vKioqKioqLyBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4vKioqKioqLyBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbi8qKioqKiovIFx0XHR9XG4vKioqKioqLyBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuLyoqKioqKi8gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8qKioqKiovIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4vKioqKioqLyBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuLyoqKioqKi8gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4vKioqKioqLyBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4vKioqKioqLyBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbi8qKioqKiovIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuLyoqKioqKi8gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbi8qKioqKiovIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4vKioqKioqLyBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuLyoqKioqKi8gXHRcdHJldHVybiBucztcbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuLyoqKioqKi8gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuLyoqKioqKi8gXHRcdHJldHVybiBnZXR0ZXI7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gNTIpO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoe1xuXG4vKioqLyAwOlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5tb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXztcblxuLyoqKi8gfSksXG5cbi8qKiovIDE6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIGpxdWVyeV9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBqcXVlcnlfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihqcXVlcnlfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyk7XG5mdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBcIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mXCI7IGlmICh0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cbnZhciBSZW5kZXJlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlbmRlcmVyKG1hcmt1cCwgY2hpbGRyZW4sIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlbmRlcmVyKTtcblxuICAgIHRoaXMubWFya3VwID0gbWFya3VwO1xuICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhSZW5kZXJlciwgW3tcbiAgICBrZXk6IFwicmVuZGVyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigkcGFyZW50KSB7XG4gICAgICB2YXIgJG5vZGUgPSBqcXVlcnlfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX19kZWZhdWx0KCkodGhpcy5tYXJrdXApO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5jb250ZW50cykge1xuICAgICAgICAkbm9kZS5odG1sKHRoaXMub3B0aW9ucy5jb250ZW50cyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmNsYXNzTmFtZSkge1xuICAgICAgICAkbm9kZS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuY2xhc3NOYW1lKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuZGF0YSkge1xuICAgICAgICBqcXVlcnlfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX19kZWZhdWx0LmEuZWFjaCh0aGlzLm9wdGlvbnMuZGF0YSwgZnVuY3Rpb24gKGssIHYpIHtcbiAgICAgICAgICAkbm9kZS5hdHRyKCdkYXRhLScgKyBrLCB2KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmNsaWNrKSB7XG4gICAgICAgICRub2RlLm9uKCdjbGljaycsIHRoaXMub3B0aW9ucy5jbGljayk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgIHZhciAkY29udGFpbmVyID0gJG5vZGUuZmluZCgnLm5vdGUtY2hpbGRyZW4tY29udGFpbmVyJyk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICBjaGlsZC5yZW5kZXIoJGNvbnRhaW5lci5sZW5ndGggPyAkY29udGFpbmVyIDogJG5vZGUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjaygkbm9kZSwgdGhpcy5vcHRpb25zKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmNhbGxiYWNrKCRub2RlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCRwYXJlbnQpIHtcbiAgICAgICAgJHBhcmVudC5hcHBlbmQoJG5vZGUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gJG5vZGU7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFJlbmRlcmVyO1xufSgpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIF9fd2VicGFja19leHBvcnRzX19bXCJhXCJdID0gKHtcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUobWFya3VwLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IF90eXBlb2YoYXJndW1lbnRzWzFdKSA9PT0gJ29iamVjdCcgPyBhcmd1bWVudHNbMV0gOiBhcmd1bWVudHNbMF07XG4gICAgICB2YXIgY2hpbGRyZW4gPSBBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkgPyBhcmd1bWVudHNbMF0gOiBbXTtcblxuICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGlsZHJlbikge1xuICAgICAgICBjaGlsZHJlbiA9IG9wdGlvbnMuY2hpbGRyZW47XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgUmVuZGVyZXIobWFya3VwLCBjaGlsZHJlbiwgb3B0aW9ucywgY2FsbGJhY2spO1xuICAgIH07XG4gIH1cbn0pO1xuXG4vKioqLyB9KSxcblxuLyoqKi8gMjpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKF9fd2VicGFja19hbWRfb3B0aW9uc19fKSB7LyogZ2xvYmFscyBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXyAqL1xubW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXztcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIHt9KSlcblxuLyoqKi8gfSksXG5cbi8qKiovIDM6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsIHtcInJvb3RcIjpcImpRdWVyeVwiLFwiY29tbW9uanMyXCI6XCJqcXVlcnlcIixcImNvbW1vbmpzXCI6XCJqcXVlcnlcIixcImFtZFwiOlwianF1ZXJ5XCJ9XG52YXIgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xudmFyIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV8pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL3N1bW1lcm5vdGUtZW4tVVMuanNcblxuZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUgfHwge1xuICBsYW5nOiB7fVxufTtcbmV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmV4dGVuZChleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLmxhbmcsIHtcbiAgJ2VuLVVTJzoge1xuICAgIGZvbnQ6IHtcbiAgICAgIGJvbGQ6ICdCb2xkJyxcbiAgICAgIGl0YWxpYzogJ0l0YWxpYycsXG4gICAgICB1bmRlcmxpbmU6ICdVbmRlcmxpbmUnLFxuICAgICAgY2xlYXI6ICdSZW1vdmUgRm9udCBTdHlsZScsXG4gICAgICBoZWlnaHQ6ICdMaW5lIEhlaWdodCcsXG4gICAgICBuYW1lOiAnRm9udCBGYW1pbHknLFxuICAgICAgc3RyaWtldGhyb3VnaDogJ1N0cmlrZXRocm91Z2gnLFxuICAgICAgc3Vic2NyaXB0OiAnU3Vic2NyaXB0JyxcbiAgICAgIHN1cGVyc2NyaXB0OiAnU3VwZXJzY3JpcHQnLFxuICAgICAgc2l6ZTogJ0ZvbnQgU2l6ZScsXG4gICAgICBzaXpldW5pdDogJ0ZvbnQgU2l6ZSBVbml0J1xuICAgIH0sXG4gICAgaW1hZ2U6IHtcbiAgICAgIGltYWdlOiAnUGljdHVyZScsXG4gICAgICBpbnNlcnQ6ICdJbnNlcnQgSW1hZ2UnLFxuICAgICAgcmVzaXplRnVsbDogJ1Jlc2l6ZSBmdWxsJyxcbiAgICAgIHJlc2l6ZUhhbGY6ICdSZXNpemUgaGFsZicsXG4gICAgICByZXNpemVRdWFydGVyOiAnUmVzaXplIHF1YXJ0ZXInLFxuICAgICAgcmVzaXplTm9uZTogJ09yaWdpbmFsIHNpemUnLFxuICAgICAgZmxvYXRMZWZ0OiAnRmxvYXQgTGVmdCcsXG4gICAgICBmbG9hdFJpZ2h0OiAnRmxvYXQgUmlnaHQnLFxuICAgICAgZmxvYXROb25lOiAnUmVtb3ZlIGZsb2F0JyxcbiAgICAgIHNoYXBlUm91bmRlZDogJ1NoYXBlOiBSb3VuZGVkJyxcbiAgICAgIHNoYXBlQ2lyY2xlOiAnU2hhcGU6IENpcmNsZScsXG4gICAgICBzaGFwZVRodW1ibmFpbDogJ1NoYXBlOiBUaHVtYm5haWwnLFxuICAgICAgc2hhcGVOb25lOiAnU2hhcGU6IE5vbmUnLFxuICAgICAgZHJhZ0ltYWdlSGVyZTogJ0RyYWcgaW1hZ2Ugb3IgdGV4dCBoZXJlJyxcbiAgICAgIGRyb3BJbWFnZTogJ0Ryb3AgaW1hZ2Ugb3IgVGV4dCcsXG4gICAgICBzZWxlY3RGcm9tRmlsZXM6ICdTZWxlY3QgZnJvbSBmaWxlcycsXG4gICAgICBtYXhpbXVtRmlsZVNpemU6ICdNYXhpbXVtIGZpbGUgc2l6ZScsXG4gICAgICBtYXhpbXVtRmlsZVNpemVFcnJvcjogJ01heGltdW0gZmlsZSBzaXplIGV4Y2VlZGVkLicsXG4gICAgICB1cmw6ICdJbWFnZSBVUkwnLFxuICAgICAgcmVtb3ZlOiAnUmVtb3ZlIEltYWdlJyxcbiAgICAgIG9yaWdpbmFsOiAnT3JpZ2luYWwnXG4gICAgfSxcbiAgICB2aWRlbzoge1xuICAgICAgdmlkZW86ICdWaWRlbycsXG4gICAgICB2aWRlb0xpbms6ICdWaWRlbyBMaW5rJyxcbiAgICAgIGluc2VydDogJ0luc2VydCBWaWRlbycsXG4gICAgICB1cmw6ICdWaWRlbyBVUkwnLFxuICAgICAgcHJvdmlkZXJzOiAnKFlvdVR1YmUsIFZpbWVvLCBWaW5lLCBJbnN0YWdyYW0sIERhaWx5TW90aW9uIG9yIFlvdWt1KSdcbiAgICB9LFxuICAgIGxpbms6IHtcbiAgICAgIGxpbms6ICdMaW5rJyxcbiAgICAgIGluc2VydDogJ0luc2VydCBMaW5rJyxcbiAgICAgIHVubGluazogJ1VubGluaycsXG4gICAgICBlZGl0OiAnRWRpdCcsXG4gICAgICB0ZXh0VG9EaXNwbGF5OiAnVGV4dCB0byBkaXNwbGF5JyxcbiAgICAgIHVybDogJ1RvIHdoYXQgVVJMIHNob3VsZCB0aGlzIGxpbmsgZ28/JyxcbiAgICAgIG9wZW5Jbk5ld1dpbmRvdzogJ09wZW4gaW4gbmV3IHdpbmRvdycsXG4gICAgICB1c2VQcm90b2NvbDogJ1VzZSBkZWZhdWx0IHByb3RvY29sJ1xuICAgIH0sXG4gICAgdGFibGU6IHtcbiAgICAgIHRhYmxlOiAnVGFibGUnLFxuICAgICAgYWRkUm93QWJvdmU6ICdBZGQgcm93IGFib3ZlJyxcbiAgICAgIGFkZFJvd0JlbG93OiAnQWRkIHJvdyBiZWxvdycsXG4gICAgICBhZGRDb2xMZWZ0OiAnQWRkIGNvbHVtbiBsZWZ0JyxcbiAgICAgIGFkZENvbFJpZ2h0OiAnQWRkIGNvbHVtbiByaWdodCcsXG4gICAgICBkZWxSb3c6ICdEZWxldGUgcm93JyxcbiAgICAgIGRlbENvbDogJ0RlbGV0ZSBjb2x1bW4nLFxuICAgICAgZGVsVGFibGU6ICdEZWxldGUgdGFibGUnXG4gICAgfSxcbiAgICBocjoge1xuICAgICAgaW5zZXJ0OiAnSW5zZXJ0IEhvcml6b250YWwgUnVsZSdcbiAgICB9LFxuICAgIHN0eWxlOiB7XG4gICAgICBzdHlsZTogJ1N0eWxlJyxcbiAgICAgIHA6ICdOb3JtYWwnLFxuICAgICAgYmxvY2txdW90ZTogJ1F1b3RlJyxcbiAgICAgIHByZTogJ0NvZGUnLFxuICAgICAgaDE6ICdIZWFkZXIgMScsXG4gICAgICBoMjogJ0hlYWRlciAyJyxcbiAgICAgIGgzOiAnSGVhZGVyIDMnLFxuICAgICAgaDQ6ICdIZWFkZXIgNCcsXG4gICAgICBoNTogJ0hlYWRlciA1JyxcbiAgICAgIGg2OiAnSGVhZGVyIDYnXG4gICAgfSxcbiAgICBsaXN0czoge1xuICAgICAgdW5vcmRlcmVkOiAnVW5vcmRlcmVkIGxpc3QnLFxuICAgICAgb3JkZXJlZDogJ09yZGVyZWQgbGlzdCdcbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGhlbHA6ICdIZWxwJyxcbiAgICAgIGZ1bGxzY3JlZW46ICdGdWxsIFNjcmVlbicsXG4gICAgICBjb2RldmlldzogJ0NvZGUgVmlldydcbiAgICB9LFxuICAgIHBhcmFncmFwaDoge1xuICAgICAgcGFyYWdyYXBoOiAnUGFyYWdyYXBoJyxcbiAgICAgIG91dGRlbnQ6ICdPdXRkZW50JyxcbiAgICAgIGluZGVudDogJ0luZGVudCcsXG4gICAgICBsZWZ0OiAnQWxpZ24gbGVmdCcsXG4gICAgICBjZW50ZXI6ICdBbGlnbiBjZW50ZXInLFxuICAgICAgcmlnaHQ6ICdBbGlnbiByaWdodCcsXG4gICAgICBqdXN0aWZ5OiAnSnVzdGlmeSBmdWxsJ1xuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIHJlY2VudDogJ1JlY2VudCBDb2xvcicsXG4gICAgICBtb3JlOiAnTW9yZSBDb2xvcicsXG4gICAgICBiYWNrZ3JvdW5kOiAnQmFja2dyb3VuZCBDb2xvcicsXG4gICAgICBmb3JlZ3JvdW5kOiAnVGV4dCBDb2xvcicsXG4gICAgICB0cmFuc3BhcmVudDogJ1RyYW5zcGFyZW50JyxcbiAgICAgIHNldFRyYW5zcGFyZW50OiAnU2V0IHRyYW5zcGFyZW50JyxcbiAgICAgIHJlc2V0OiAnUmVzZXQnLFxuICAgICAgcmVzZXRUb0RlZmF1bHQ6ICdSZXNldCB0byBkZWZhdWx0JyxcbiAgICAgIGNwU2VsZWN0OiAnU2VsZWN0J1xuICAgIH0sXG4gICAgc2hvcnRjdXQ6IHtcbiAgICAgIHNob3J0Y3V0czogJ0tleWJvYXJkIHNob3J0Y3V0cycsXG4gICAgICBjbG9zZTogJ0Nsb3NlJyxcbiAgICAgIHRleHRGb3JtYXR0aW5nOiAnVGV4dCBmb3JtYXR0aW5nJyxcbiAgICAgIGFjdGlvbjogJ0FjdGlvbicsXG4gICAgICBwYXJhZ3JhcGhGb3JtYXR0aW5nOiAnUGFyYWdyYXBoIGZvcm1hdHRpbmcnLFxuICAgICAgZG9jdW1lbnRTdHlsZTogJ0RvY3VtZW50IFN0eWxlJyxcbiAgICAgIGV4dHJhS2V5czogJ0V4dHJhIGtleXMnXG4gICAgfSxcbiAgICBoZWxwOiB7XG4gICAgICAnZXNjYXBlJzogJ0VzY2FwZScsXG4gICAgICAnaW5zZXJ0UGFyYWdyYXBoJzogJ0luc2VydCBQYXJhZ3JhcGgnLFxuICAgICAgJ3VuZG8nOiAnVW5kbyB0aGUgbGFzdCBjb21tYW5kJyxcbiAgICAgICdyZWRvJzogJ1JlZG8gdGhlIGxhc3QgY29tbWFuZCcsXG4gICAgICAndGFiJzogJ1RhYicsXG4gICAgICAndW50YWInOiAnVW50YWInLFxuICAgICAgJ2JvbGQnOiAnU2V0IGEgYm9sZCBzdHlsZScsXG4gICAgICAnaXRhbGljJzogJ1NldCBhIGl0YWxpYyBzdHlsZScsXG4gICAgICAndW5kZXJsaW5lJzogJ1NldCBhIHVuZGVybGluZSBzdHlsZScsXG4gICAgICAnc3RyaWtldGhyb3VnaCc6ICdTZXQgYSBzdHJpa2V0aHJvdWdoIHN0eWxlJyxcbiAgICAgICdyZW1vdmVGb3JtYXQnOiAnQ2xlYW4gYSBzdHlsZScsXG4gICAgICAnanVzdGlmeUxlZnQnOiAnU2V0IGxlZnQgYWxpZ24nLFxuICAgICAgJ2p1c3RpZnlDZW50ZXInOiAnU2V0IGNlbnRlciBhbGlnbicsXG4gICAgICAnanVzdGlmeVJpZ2h0JzogJ1NldCByaWdodCBhbGlnbicsXG4gICAgICAnanVzdGlmeUZ1bGwnOiAnU2V0IGZ1bGwgYWxpZ24nLFxuICAgICAgJ2luc2VydFVub3JkZXJlZExpc3QnOiAnVG9nZ2xlIHVub3JkZXJlZCBsaXN0JyxcbiAgICAgICdpbnNlcnRPcmRlcmVkTGlzdCc6ICdUb2dnbGUgb3JkZXJlZCBsaXN0JyxcbiAgICAgICdvdXRkZW50JzogJ091dGRlbnQgb24gY3VycmVudCBwYXJhZ3JhcGgnLFxuICAgICAgJ2luZGVudCc6ICdJbmRlbnQgb24gY3VycmVudCBwYXJhZ3JhcGgnLFxuICAgICAgJ2Zvcm1hdFBhcmEnOiAnQ2hhbmdlIGN1cnJlbnQgYmxvY2tcXCdzIGZvcm1hdCBhcyBhIHBhcmFncmFwaChQIHRhZyknLFxuICAgICAgJ2Zvcm1hdEgxJzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDEnLFxuICAgICAgJ2Zvcm1hdEgyJzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDInLFxuICAgICAgJ2Zvcm1hdEgzJzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDMnLFxuICAgICAgJ2Zvcm1hdEg0JzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDQnLFxuICAgICAgJ2Zvcm1hdEg1JzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDUnLFxuICAgICAgJ2Zvcm1hdEg2JzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDYnLFxuICAgICAgJ2luc2VydEhvcml6b250YWxSdWxlJzogJ0luc2VydCBob3Jpem9udGFsIHJ1bGUnLFxuICAgICAgJ2xpbmtEaWFsb2cuc2hvdyc6ICdTaG93IExpbmsgRGlhbG9nJ1xuICAgIH0sXG4gICAgaGlzdG9yeToge1xuICAgICAgdW5kbzogJ1VuZG8nLFxuICAgICAgcmVkbzogJ1JlZG8nXG4gICAgfSxcbiAgICBzcGVjaWFsQ2hhcjoge1xuICAgICAgc3BlY2lhbENoYXI6ICdTUEVDSUFMIENIQVJBQ1RFUlMnLFxuICAgICAgc2VsZWN0OiAnU2VsZWN0IFNwZWNpYWwgY2hhcmFjdGVycydcbiAgICB9LFxuICAgIG91dHB1dDoge1xuICAgICAgbm9TZWxlY3Rpb246ICdObyBTZWxlY3Rpb24gTWFkZSEnXG4gICAgfVxuICB9XG59KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvY29yZS9lbnYuanNcblxudmFyIGlzU3VwcG9ydEFtZCA9IHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgX193ZWJwYWNrX3JlcXVpcmVfXygyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG4vKipcbiAqIHJldHVybnMgd2hldGhlciBmb250IGlzIGluc3RhbGxlZCBvciBub3QuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGZvbnROYW1lXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cbnZhciBnZW5lcmljRm9udEZhbWlsaWVzID0gWydzYW5zLXNlcmlmJywgJ3NlcmlmJywgJ21vbm9zcGFjZScsICdjdXJzaXZlJywgJ2ZhbnRhc3knXTtcblxuZnVuY3Rpb24gdmFsaWRGb250TmFtZShmb250TmFtZSkge1xuICByZXR1cm4gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuaW5BcnJheShmb250TmFtZS50b0xvd2VyQ2FzZSgpLCBnZW5lcmljRm9udEZhbWlsaWVzKSA9PT0gLTEgPyBcIidcIi5jb25jYXQoZm9udE5hbWUsIFwiJ1wiKSA6IGZvbnROYW1lO1xufVxuXG5mdW5jdGlvbiBlbnZfaXNGb250SW5zdGFsbGVkKGZvbnROYW1lKSB7XG4gIHZhciB0ZXN0Rm9udE5hbWUgPSBmb250TmFtZSA9PT0gJ0NvbWljIFNhbnMgTVMnID8gJ0NvdXJpZXIgTmV3JyA6ICdDb21pYyBTYW5zIE1TJztcbiAgdmFyIHRlc3RUZXh0ID0gJ21tbW1tbW1tbW13d3d3dyc7XG4gIHZhciB0ZXN0U2l6ZSA9ICcyMDBweCc7XG4gIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgY29udGV4dC5mb250ID0gdGVzdFNpemUgKyBcIiAnXCIgKyB0ZXN0Rm9udE5hbWUgKyBcIidcIjtcbiAgdmFyIG9yaWdpbmFsV2lkdGggPSBjb250ZXh0Lm1lYXN1cmVUZXh0KHRlc3RUZXh0KS53aWR0aDtcbiAgY29udGV4dC5mb250ID0gdGVzdFNpemUgKyAnICcgKyB2YWxpZEZvbnROYW1lKGZvbnROYW1lKSArICcsIFwiJyArIHRlc3RGb250TmFtZSArICdcIic7XG4gIHZhciB3aWR0aCA9IGNvbnRleHQubWVhc3VyZVRleHQodGVzdFRleHQpLndpZHRoO1xuICByZXR1cm4gb3JpZ2luYWxXaWR0aCAhPT0gd2lkdGg7XG59XG5cbnZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xudmFyIGlzTVNJRSA9IC9NU0lFfFRyaWRlbnQvaS50ZXN0KHVzZXJBZ2VudCk7XG52YXIgYnJvd3NlclZlcnNpb247XG5cbmlmIChpc01TSUUpIHtcbiAgdmFyIG1hdGNoZXMgPSAvTVNJRSAoXFxkK1suXVxcZCspLy5leGVjKHVzZXJBZ2VudCk7XG5cbiAgaWYgKG1hdGNoZXMpIHtcbiAgICBicm93c2VyVmVyc2lvbiA9IHBhcnNlRmxvYXQobWF0Y2hlc1sxXSk7XG4gIH1cblxuICBtYXRjaGVzID0gL1RyaWRlbnRcXC8uKnJ2OihbMC05XXsxLH1bLjAtOV17MCx9KS8uZXhlYyh1c2VyQWdlbnQpO1xuXG4gIGlmIChtYXRjaGVzKSB7XG4gICAgYnJvd3NlclZlcnNpb24gPSBwYXJzZUZsb2F0KG1hdGNoZXNbMV0pO1xuICB9XG59XG5cbnZhciBpc0VkZ2UgPSAvRWRnZVxcL1xcZCsvLnRlc3QodXNlckFnZW50KTtcbnZhciBpc1N1cHBvcnRUb3VjaCA9ICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyB8fCBuYXZpZ2F0b3IuTWF4VG91Y2hQb2ludHMgPiAwIHx8IG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzID4gMDsgLy8gW3dvcmthcm91bmRdIElFIGRvZXNuJ3QgaGF2ZSBpbnB1dCBldmVudHMgZm9yIGNvbnRlbnRFZGl0YWJsZVxuLy8gLSBzZWU6IGh0dHBzOi8vZ29vLmdsLzRiZkl2QVxuXG52YXIgaW5wdXRFdmVudE5hbWUgPSBpc01TSUUgPyAnRE9NQ2hhcmFjdGVyRGF0YU1vZGlmaWVkIERPTVN1YnRyZWVNb2RpZmllZCBET01Ob2RlSW5zZXJ0ZWQnIDogJ2lucHV0Jztcbi8qKlxuICogQGNsYXNzIGNvcmUuZW52XG4gKlxuICogT2JqZWN0IHdoaWNoIGNoZWNrIHBsYXRmb3JtIGFuZCBhZ2VudFxuICpcbiAqIEBzaW5nbGV0b25cbiAqIEBhbHRlcm5hdGVDbGFzc05hbWUgZW52XG4gKi9cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZW52ID0gKHtcbiAgaXNNYWM6IG5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoJ01hYycpID4gLTEsXG4gIGlzTVNJRTogaXNNU0lFLFxuICBpc0VkZ2U6IGlzRWRnZSxcbiAgaXNGRjogIWlzRWRnZSAmJiAvZmlyZWZveC9pLnRlc3QodXNlckFnZW50KSxcbiAgaXNQaGFudG9tOiAvUGhhbnRvbUpTL2kudGVzdCh1c2VyQWdlbnQpLFxuICBpc1dlYmtpdDogIWlzRWRnZSAmJiAvd2Via2l0L2kudGVzdCh1c2VyQWdlbnQpLFxuICBpc0Nocm9tZTogIWlzRWRnZSAmJiAvY2hyb21lL2kudGVzdCh1c2VyQWdlbnQpLFxuICBpc1NhZmFyaTogIWlzRWRnZSAmJiAvc2FmYXJpL2kudGVzdCh1c2VyQWdlbnQpICYmICEvY2hyb21lL2kudGVzdCh1c2VyQWdlbnQpLFxuICBicm93c2VyVmVyc2lvbjogYnJvd3NlclZlcnNpb24sXG4gIGpxdWVyeVZlcnNpb246IHBhcnNlRmxvYXQoZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZm4uanF1ZXJ5KSxcbiAgaXNTdXBwb3J0QW1kOiBpc1N1cHBvcnRBbWQsXG4gIGlzU3VwcG9ydFRvdWNoOiBpc1N1cHBvcnRUb3VjaCxcbiAgaXNGb250SW5zdGFsbGVkOiBlbnZfaXNGb250SW5zdGFsbGVkLFxuICBpc1czQ1JhbmdlU3VwcG9ydDogISFkb2N1bWVudC5jcmVhdGVSYW5nZSxcbiAgaW5wdXRFdmVudE5hbWU6IGlucHV0RXZlbnROYW1lLFxuICBnZW5lcmljRm9udEZhbWlsaWVzOiBnZW5lcmljRm9udEZhbWlsaWVzLFxuICB2YWxpZEZvbnROYW1lOiB2YWxpZEZvbnROYW1lXG59KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvY29yZS9mdW5jLmpzXG5cbi8qKlxuICogQGNsYXNzIGNvcmUuZnVuY1xuICpcbiAqIGZ1bmMgdXRpbHMgKGZvciBoaWdoLW9yZGVyIGZ1bmMncyBhcmcpXG4gKlxuICogQHNpbmdsZXRvblxuICogQGFsdGVybmF0ZUNsYXNzTmFtZSBmdW5jXG4gKi9cblxuZnVuY3Rpb24gZXEoaXRlbUEpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtQikge1xuICAgIHJldHVybiBpdGVtQSA9PT0gaXRlbUI7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGVxMihpdGVtQSwgaXRlbUIpIHtcbiAgcmV0dXJuIGl0ZW1BID09PSBpdGVtQjtcbn1cblxuZnVuY3Rpb24gcGVxMihwcm9wTmFtZSkge1xuICByZXR1cm4gZnVuY3Rpb24gKGl0ZW1BLCBpdGVtQikge1xuICAgIHJldHVybiBpdGVtQVtwcm9wTmFtZV0gPT09IGl0ZW1CW3Byb3BOYW1lXTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gb2soKSB7XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBmYWlsKCkge1xuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIG5vdChmKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICFmLmFwcGx5KGYsIGFyZ3VtZW50cyk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGFuZChmQSwgZkIpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgcmV0dXJuIGZBKGl0ZW0pICYmIGZCKGl0ZW0pO1xuICB9O1xufVxuXG5mdW5jdGlvbiBmdW5jX3NlbGYoYSkge1xuICByZXR1cm4gYTtcbn1cblxuZnVuY3Rpb24gZnVuY19pbnZva2Uob2JqLCBtZXRob2QpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmd1bWVudHMpO1xuICB9O1xufVxuXG52YXIgaWRDb3VudGVyID0gMDtcbi8qKlxuICogcmVzZXQgZ2xvYmFsbHktdW5pcXVlIGlkXG4gKlxuICovXG5cbmZ1bmN0aW9uIHJlc2V0VW5pcXVlSWQoKSB7XG4gIGlkQ291bnRlciA9IDA7XG59XG4vKipcbiAqIGdlbmVyYXRlIGEgZ2xvYmFsbHktdW5pcXVlIGlkXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IFtwcmVmaXhdXG4gKi9cblxuXG5mdW5jdGlvbiB1bmlxdWVJZChwcmVmaXgpIHtcbiAgdmFyIGlkID0gKytpZENvdW50ZXIgKyAnJztcbiAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7XG59XG4vKipcbiAqIHJldHVybnMgYm5kIChib3VuZHMpIGZyb20gcmVjdFxuICpcbiAqIC0gSUUgQ29tcGF0aWJpbGl0eSBJc3N1ZTogaHR0cDovL2dvby5nbC9zUkxPQW9cbiAqIC0gU2Nyb2xsIElzc3VlOiBodHRwOi8vZ29vLmdsL3NOalVjXG4gKlxuICogQHBhcmFtIHtSZWN0fSByZWN0XG4gKiBAcmV0dXJuIHtPYmplY3R9IGJvdW5kc1xuICogQHJldHVybiB7TnVtYmVyfSBib3VuZHMudG9wXG4gKiBAcmV0dXJuIHtOdW1iZXJ9IGJvdW5kcy5sZWZ0XG4gKiBAcmV0dXJuIHtOdW1iZXJ9IGJvdW5kcy53aWR0aFxuICogQHJldHVybiB7TnVtYmVyfSBib3VuZHMuaGVpZ2h0XG4gKi9cblxuXG5mdW5jdGlvbiByZWN0MmJuZChyZWN0KSB7XG4gIHZhciAkZG9jdW1lbnQgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShkb2N1bWVudCk7XG4gIHJldHVybiB7XG4gICAgdG9wOiByZWN0LnRvcCArICRkb2N1bWVudC5zY3JvbGxUb3AoKSxcbiAgICBsZWZ0OiByZWN0LmxlZnQgKyAkZG9jdW1lbnQuc2Nyb2xsTGVmdCgpLFxuICAgIHdpZHRoOiByZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0LFxuICAgIGhlaWdodDogcmVjdC5ib3R0b20gLSByZWN0LnRvcFxuICB9O1xufVxuLyoqXG4gKiByZXR1cm5zIGEgY29weSBvZiB0aGUgb2JqZWN0IHdoZXJlIHRoZSBrZXlzIGhhdmUgYmVjb21lIHRoZSB2YWx1ZXMgYW5kIHRoZSB2YWx1ZXMgdGhlIGtleXMuXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqXG4gKiBAcmV0dXJuIHtPYmplY3R9XG4gKi9cblxuXG5mdW5jdGlvbiBpbnZlcnRPYmplY3Qob2JqKSB7XG4gIHZhciBpbnZlcnRlZCA9IHt9O1xuXG4gIGZvciAodmFyIGtleSBpbiBvYmopIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgaW52ZXJ0ZWRbb2JqW2tleV1dID0ga2V5O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpbnZlcnRlZDtcbn1cbi8qKlxuICogQHBhcmFtIHtTdHJpbmd9IG5hbWVzcGFjZVxuICogQHBhcmFtIHtTdHJpbmd9IFtwcmVmaXhdXG4gKiBAcmV0dXJuIHtTdHJpbmd9XG4gKi9cblxuXG5mdW5jdGlvbiBuYW1lc3BhY2VUb0NhbWVsKG5hbWVzcGFjZSwgcHJlZml4KSB7XG4gIHByZWZpeCA9IHByZWZpeCB8fCAnJztcbiAgcmV0dXJuIHByZWZpeCArIG5hbWVzcGFjZS5zcGxpdCgnLicpLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgIHJldHVybiBuYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHJpbmcoMSk7XG4gIH0pLmpvaW4oJycpO1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90XG4gKiBiZSB0cmlnZ2VyZWQuIFRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhZnRlciBpdCBzdG9wcyBiZWluZyBjYWxsZWQgZm9yXG4gKiBOIG1pbGxpc2Vjb25kcy4gSWYgYGltbWVkaWF0ZWAgaXMgcGFzc2VkLCB0cmlnZ2VyIHRoZSBmdW5jdGlvbiBvbiB0aGVcbiAqIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jXG4gKiBAcGFyYW0ge051bWJlcn0gd2FpdFxuICogQHBhcmFtIHtCb29sZWFufSBpbW1lZGlhdGVcbiAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICovXG5cblxuZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7XG4gIHZhciB0aW1lb3V0O1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjb250ZXh0ID0gdGhpcztcbiAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcblxuICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uIGxhdGVyKCkge1xuICAgICAgdGltZW91dCA9IG51bGw7XG5cbiAgICAgIGlmICghaW1tZWRpYXRlKSB7XG4gICAgICAgIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG5cbiAgICBpZiAoY2FsbE5vdykge1xuICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9XG4gIH07XG59XG4vKipcbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gdXJsXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cblxuZnVuY3Rpb24gaXNWYWxpZFVybCh1cmwpIHtcbiAgdmFyIGV4cHJlc3Npb24gPSAvWy1hLXpBLVowLTlAOiUuX1xcK34jPV17MiwyNTZ9XFwuW2Etel17Miw2fVxcYihbLWEtekEtWjAtOUA6JV9cXCsufiM/Ji8vPV0qKS9naTtcbiAgcmV0dXJuIGV4cHJlc3Npb24udGVzdCh1cmwpO1xufVxuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBmdW5jID0gKHtcbiAgZXE6IGVxLFxuICBlcTI6IGVxMixcbiAgcGVxMjogcGVxMixcbiAgb2s6IG9rLFxuICBmYWlsOiBmYWlsLFxuICBzZWxmOiBmdW5jX3NlbGYsXG4gIG5vdDogbm90LFxuICBhbmQ6IGFuZCxcbiAgaW52b2tlOiBmdW5jX2ludm9rZSxcbiAgcmVzZXRVbmlxdWVJZDogcmVzZXRVbmlxdWVJZCxcbiAgdW5pcXVlSWQ6IHVuaXF1ZUlkLFxuICByZWN0MmJuZDogcmVjdDJibmQsXG4gIGludmVydE9iamVjdDogaW52ZXJ0T2JqZWN0LFxuICBuYW1lc3BhY2VUb0NhbWVsOiBuYW1lc3BhY2VUb0NhbWVsLFxuICBkZWJvdW5jZTogZGVib3VuY2UsXG4gIGlzVmFsaWRVcmw6IGlzVmFsaWRVcmxcbn0pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9jb3JlL2xpc3RzLmpzXG5cbi8qKlxuICogcmV0dXJucyB0aGUgZmlyc3QgaXRlbSBvZiBhbiBhcnJheS5cbiAqXG4gKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICovXG5cbmZ1bmN0aW9uIGxpc3RzX2hlYWQoYXJyYXkpIHtcbiAgcmV0dXJuIGFycmF5WzBdO1xufVxuLyoqXG4gKiByZXR1cm5zIHRoZSBsYXN0IGl0ZW0gb2YgYW4gYXJyYXkuXG4gKlxuICogQHBhcmFtIHtBcnJheX0gYXJyYXlcbiAqL1xuXG5cbmZ1bmN0aW9uIGxpc3RzX2xhc3QoYXJyYXkpIHtcbiAgcmV0dXJuIGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdO1xufVxuLyoqXG4gKiByZXR1cm5zIGV2ZXJ5dGhpbmcgYnV0IHRoZSBsYXN0IGVudHJ5IG9mIHRoZSBhcnJheS5cbiAqXG4gKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICovXG5cblxuZnVuY3Rpb24gaW5pdGlhbChhcnJheSkge1xuICByZXR1cm4gYXJyYXkuc2xpY2UoMCwgYXJyYXkubGVuZ3RoIC0gMSk7XG59XG4vKipcbiAqIHJldHVybnMgdGhlIHJlc3Qgb2YgdGhlIGl0ZW1zIGluIGFuIGFycmF5LlxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5XG4gKi9cblxuXG5mdW5jdGlvbiB0YWlsKGFycmF5KSB7XG4gIHJldHVybiBhcnJheS5zbGljZSgxKTtcbn1cbi8qKlxuICogcmV0dXJucyBpdGVtIG9mIGFycmF5XG4gKi9cblxuXG5mdW5jdGlvbiBmaW5kKGFycmF5LCBwcmVkKSB7XG4gIGZvciAodmFyIGlkeCA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaWR4IDwgbGVuOyBpZHgrKykge1xuICAgIHZhciBpdGVtID0gYXJyYXlbaWR4XTtcblxuICAgIGlmIChwcmVkKGl0ZW0pKSB7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG4gIH1cbn1cbi8qKlxuICogcmV0dXJucyB0cnVlIGlmIGFsbCBvZiB0aGUgdmFsdWVzIGluIHRoZSBhcnJheSBwYXNzIHRoZSBwcmVkaWNhdGUgdHJ1dGggdGVzdC5cbiAqL1xuXG5cbmZ1bmN0aW9uIGxpc3RzX2FsbChhcnJheSwgcHJlZCkge1xuICBmb3IgKHZhciBpZHggPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGlkeCA8IGxlbjsgaWR4KyspIHtcbiAgICBpZiAoIXByZWQoYXJyYXlbaWR4XSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogcmV0dXJucyB0cnVlIGlmIHRoZSB2YWx1ZSBpcyBwcmVzZW50IGluIHRoZSBsaXN0LlxuICovXG5cblxuZnVuY3Rpb24gY29udGFpbnMoYXJyYXksIGl0ZW0pIHtcbiAgaWYgKGFycmF5ICYmIGFycmF5Lmxlbmd0aCAmJiBpdGVtKSB7XG4gICAgaWYgKGFycmF5LmluZGV4T2YpIHtcbiAgICAgIHJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0pICE9PSAtMTtcbiAgICB9IGVsc2UgaWYgKGFycmF5LmNvbnRhaW5zKSB7XG4gICAgICAvLyBgRE9NVG9rZW5MaXN0YCBkb2Vzbid0IGltcGxlbWVudCBgLmluZGV4T2ZgLCBidXQgaXQgaW1wbGVtZW50cyBgLmNvbnRhaW5zYFxuICAgICAgcmV0dXJuIGFycmF5LmNvbnRhaW5zKGl0ZW0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cbi8qKlxuICogZ2V0IHN1bSBmcm9tIGEgbGlzdFxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IC0gYXJyYXlcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIC0gaXRlcmF0b3JcbiAqL1xuXG5cbmZ1bmN0aW9uIHN1bShhcnJheSwgZm4pIHtcbiAgZm4gPSBmbiB8fCBmdW5jLnNlbGY7XG4gIHJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIHYpIHtcbiAgICByZXR1cm4gbWVtbyArIGZuKHYpO1xuICB9LCAwKTtcbn1cbi8qKlxuICogcmV0dXJucyBhIGNvcHkgb2YgdGhlIGNvbGxlY3Rpb24gd2l0aCBhcnJheSB0eXBlLlxuICogQHBhcmFtIHtDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIC0gY29sbGVjdGlvbiBlZykgbm9kZS5jaGlsZE5vZGVzLCAuLi5cbiAqL1xuXG5cbmZ1bmN0aW9uIGZyb20oY29sbGVjdGlvbikge1xuICB2YXIgcmVzdWx0ID0gW107XG4gIHZhciBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDtcbiAgdmFyIGlkeCA9IC0xO1xuXG4gIHdoaWxlICgrK2lkeCA8IGxlbmd0aCkge1xuICAgIHJlc3VsdFtpZHhdID0gY29sbGVjdGlvbltpZHhdO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbi8qKlxuICogcmV0dXJucyB3aGV0aGVyIGxpc3QgaXMgZW1wdHkgb3Igbm90XG4gKi9cblxuXG5mdW5jdGlvbiBsaXN0c19pc0VtcHR5KGFycmF5KSB7XG4gIHJldHVybiAhYXJyYXkgfHwgIWFycmF5Lmxlbmd0aDtcbn1cbi8qKlxuICogY2x1c3RlciBlbGVtZW50cyBieSBwcmVkaWNhdGUgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHtBcnJheX0gYXJyYXkgLSBhcnJheVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBwcmVkaWNhdGUgZnVuY3Rpb24gZm9yIGNsdXN0ZXIgcnVsZVxuICogQHBhcmFtIHtBcnJheVtdfVxuICovXG5cblxuZnVuY3Rpb24gY2x1c3RlckJ5KGFycmF5LCBmbikge1xuICBpZiAoIWFycmF5Lmxlbmd0aCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHZhciBhVGFpbCA9IHRhaWwoYXJyYXkpO1xuICByZXR1cm4gYVRhaWwucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCB2KSB7XG4gICAgdmFyIGFMYXN0ID0gbGlzdHNfbGFzdChtZW1vKTtcblxuICAgIGlmIChmbihsaXN0c19sYXN0KGFMYXN0KSwgdikpIHtcbiAgICAgIGFMYXN0W2FMYXN0Lmxlbmd0aF0gPSB2O1xuICAgIH0gZWxzZSB7XG4gICAgICBtZW1vW21lbW8ubGVuZ3RoXSA9IFt2XTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWVtbztcbiAgfSwgW1tsaXN0c19oZWFkKGFycmF5KV1dKTtcbn1cbi8qKlxuICogcmV0dXJucyBhIGNvcHkgb2YgdGhlIGFycmF5IHdpdGggYWxsIGZhbHNlIHZhbHVlcyByZW1vdmVkXG4gKlxuICogQHBhcmFtIHtBcnJheX0gYXJyYXkgLSBhcnJheVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBwcmVkaWNhdGUgZnVuY3Rpb24gZm9yIGNsdXN0ZXIgcnVsZVxuICovXG5cblxuZnVuY3Rpb24gY29tcGFjdChhcnJheSkge1xuICB2YXIgYVJlc3VsdCA9IFtdO1xuXG4gIGZvciAodmFyIGlkeCA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaWR4IDwgbGVuOyBpZHgrKykge1xuICAgIGlmIChhcnJheVtpZHhdKSB7XG4gICAgICBhUmVzdWx0LnB1c2goYXJyYXlbaWR4XSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGFSZXN1bHQ7XG59XG4vKipcbiAqIHByb2R1Y2VzIGEgZHVwbGljYXRlLWZyZWUgdmVyc2lvbiBvZiB0aGUgYXJyYXlcbiAqXG4gKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICovXG5cblxuZnVuY3Rpb24gdW5pcXVlKGFycmF5KSB7XG4gIHZhciByZXN1bHRzID0gW107XG5cbiAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gYXJyYXkubGVuZ3RoOyBpZHggPCBsZW47IGlkeCsrKSB7XG4gICAgaWYgKCFjb250YWlucyhyZXN1bHRzLCBhcnJheVtpZHhdKSkge1xuICAgICAgcmVzdWx0cy5wdXNoKGFycmF5W2lkeF0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHRzO1xufVxuLyoqXG4gKiByZXR1cm5zIG5leHQgaXRlbS5cbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5XG4gKi9cblxuXG5mdW5jdGlvbiBsaXN0c19uZXh0KGFycmF5LCBpdGVtKSB7XG4gIGlmIChhcnJheSAmJiBhcnJheS5sZW5ndGggJiYgaXRlbSkge1xuICAgIHZhciBpZHggPSBhcnJheS5pbmRleE9mKGl0ZW0pO1xuICAgIHJldHVybiBpZHggPT09IC0xID8gbnVsbCA6IGFycmF5W2lkeCArIDFdO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIHJldHVybnMgcHJldiBpdGVtLlxuICogQHBhcmFtIHtBcnJheX0gYXJyYXlcbiAqL1xuXG5cbmZ1bmN0aW9uIHByZXYoYXJyYXksIGl0ZW0pIHtcbiAgaWYgKGFycmF5ICYmIGFycmF5Lmxlbmd0aCAmJiBpdGVtKSB7XG4gICAgdmFyIGlkeCA9IGFycmF5LmluZGV4T2YoaXRlbSk7XG4gICAgcmV0dXJuIGlkeCA9PT0gLTEgPyBudWxsIDogYXJyYXlbaWR4IC0gMV07XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogQGNsYXNzIGNvcmUubGlzdFxuICpcbiAqIGxpc3QgdXRpbHNcbiAqXG4gKiBAc2luZ2xldG9uXG4gKiBAYWx0ZXJuYXRlQ2xhc3NOYW1lIGxpc3RcbiAqL1xuXG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGxpc3RzID0gKHtcbiAgaGVhZDogbGlzdHNfaGVhZCxcbiAgbGFzdDogbGlzdHNfbGFzdCxcbiAgaW5pdGlhbDogaW5pdGlhbCxcbiAgdGFpbDogdGFpbCxcbiAgcHJldjogcHJldixcbiAgbmV4dDogbGlzdHNfbmV4dCxcbiAgZmluZDogZmluZCxcbiAgY29udGFpbnM6IGNvbnRhaW5zLFxuICBhbGw6IGxpc3RzX2FsbCxcbiAgc3VtOiBzdW0sXG4gIGZyb206IGZyb20sXG4gIGlzRW1wdHk6IGxpc3RzX2lzRW1wdHksXG4gIGNsdXN0ZXJCeTogY2x1c3RlckJ5LFxuICBjb21wYWN0OiBjb21wYWN0LFxuICB1bmlxdWU6IHVuaXF1ZVxufSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL2NvcmUvZG9tLmpzXG5cblxuXG5cbnZhciBOQlNQX0NIQVIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDE2MCk7XG52YXIgWkVST19XSURUSF9OQlNQX0NIQVIgPSBcIlxcdUZFRkZcIjtcbi8qKlxuICogQG1ldGhvZCBpc0VkaXRhYmxlXG4gKlxuICogcmV0dXJucyB3aGV0aGVyIG5vZGUgaXMgYG5vdGUtZWRpdGFibGVgIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuZnVuY3Rpb24gaXNFZGl0YWJsZShub2RlKSB7XG4gIHJldHVybiBub2RlICYmIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKG5vZGUpLmhhc0NsYXNzKCdub3RlLWVkaXRhYmxlJyk7XG59XG4vKipcbiAqIEBtZXRob2QgaXNDb250cm9sU2l6aW5nXG4gKlxuICogcmV0dXJucyB3aGV0aGVyIG5vZGUgaXMgYG5vdGUtY29udHJvbC1zaXppbmdgIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc0NvbnRyb2xTaXppbmcobm9kZSkge1xuICByZXR1cm4gbm9kZSAmJiBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShub2RlKS5oYXNDbGFzcygnbm90ZS1jb250cm9sLXNpemluZycpO1xufVxuLyoqXG4gKiBAbWV0aG9kIG1ha2VQcmVkQnlOb2RlTmFtZVxuICpcbiAqIHJldHVybnMgcHJlZGljYXRlIHdoaWNoIGp1ZGdlIHdoZXRoZXIgbm9kZU5hbWUgaXMgc2FtZVxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBub2RlTmFtZVxuICogQHJldHVybiB7RnVuY3Rpb259XG4gKi9cblxuXG5mdW5jdGlvbiBtYWtlUHJlZEJ5Tm9kZU5hbWUobm9kZU5hbWUpIHtcbiAgbm9kZU5hbWUgPSBub2RlTmFtZS50b1VwcGVyQ2FzZSgpO1xuICByZXR1cm4gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZSAmJiBub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5vZGVOYW1lO1xuICB9O1xufVxuLyoqXG4gKiBAbWV0aG9kIGlzVGV4dFxuICpcbiAqXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIG5vZGUncyB0eXBlIGlzIHRleHQoMylcbiAqL1xuXG5cbmZ1bmN0aW9uIGlzVGV4dChub2RlKSB7XG4gIHJldHVybiBub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IDM7XG59XG4vKipcbiAqIEBtZXRob2QgaXNFbGVtZW50XG4gKlxuICpcbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgbm9kZSdzIHR5cGUgaXMgZWxlbWVudCgxKVxuICovXG5cblxuZnVuY3Rpb24gaXNFbGVtZW50KG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMTtcbn1cbi8qKlxuICogZXgpIGJyLCBjb2wsIGVtYmVkLCBociwgaW1nLCBpbnB1dCwgLi4uXG4gKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL2h0bWwvd2cvZHJhZnRzL2h0bWwvbWFzdGVyL3N5bnRheC5odG1sI3ZvaWQtZWxlbWVudHNcbiAqL1xuXG5cbmZ1bmN0aW9uIGlzVm9pZChub2RlKSB7XG4gIHJldHVybiBub2RlICYmIC9eQlJ8XklNR3xeSFJ8XklGUkFNRXxeQlVUVE9OfF5JTlBVVHxeQVVESU98XlZJREVPfF5FTUJFRC8udGVzdChub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkpO1xufVxuXG5mdW5jdGlvbiBpc1BhcmEobm9kZSkge1xuICBpZiAoaXNFZGl0YWJsZShub2RlKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSAvLyBDaHJvbWUodjMxLjApLCBGRih2MjUuMC4xKSB1c2UgRElWIGZvciBwYXJhZ3JhcGhcblxuXG4gIHJldHVybiBub2RlICYmIC9eRElWfF5QfF5MSXxeSFsxLTddLy50ZXN0KG5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKSk7XG59XG5cbmZ1bmN0aW9uIGlzSGVhZGluZyhub2RlKSB7XG4gIHJldHVybiBub2RlICYmIC9eSFsxLTddLy50ZXN0KG5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKSk7XG59XG5cbnZhciBpc1ByZSA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnUFJFJyk7XG52YXIgaXNMaSA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnTEknKTtcblxuZnVuY3Rpb24gaXNQdXJlUGFyYShub2RlKSB7XG4gIHJldHVybiBpc1BhcmEobm9kZSkgJiYgIWlzTGkobm9kZSk7XG59XG5cbnZhciBpc1RhYmxlID0gbWFrZVByZWRCeU5vZGVOYW1lKCdUQUJMRScpO1xudmFyIGlzRGF0YSA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnREFUQScpO1xuXG5mdW5jdGlvbiBkb21faXNJbmxpbmUobm9kZSkge1xuICByZXR1cm4gIWlzQm9keUNvbnRhaW5lcihub2RlKSAmJiAhaXNMaXN0KG5vZGUpICYmICFpc0hyKG5vZGUpICYmICFpc1BhcmEobm9kZSkgJiYgIWlzVGFibGUobm9kZSkgJiYgIWlzQmxvY2txdW90ZShub2RlKSAmJiAhaXNEYXRhKG5vZGUpO1xufVxuXG5mdW5jdGlvbiBpc0xpc3Qobm9kZSkge1xuICByZXR1cm4gbm9kZSAmJiAvXlVMfF5PTC8udGVzdChub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkpO1xufVxuXG52YXIgaXNIciA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnSFInKTtcblxuZnVuY3Rpb24gZG9tX2lzQ2VsbChub2RlKSB7XG4gIHJldHVybiBub2RlICYmIC9eVER8XlRILy50ZXN0KG5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKSk7XG59XG5cbnZhciBpc0Jsb2NrcXVvdGUgPSBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0JMT0NLUVVPVEUnKTtcblxuZnVuY3Rpb24gaXNCb2R5Q29udGFpbmVyKG5vZGUpIHtcbiAgcmV0dXJuIGRvbV9pc0NlbGwobm9kZSkgfHwgaXNCbG9ja3F1b3RlKG5vZGUpIHx8IGlzRWRpdGFibGUobm9kZSk7XG59XG5cbnZhciBpc0FuY2hvciA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnQScpO1xuXG5mdW5jdGlvbiBpc1BhcmFJbmxpbmUobm9kZSkge1xuICByZXR1cm4gZG9tX2lzSW5saW5lKG5vZGUpICYmICEhZG9tX2FuY2VzdG9yKG5vZGUsIGlzUGFyYSk7XG59XG5cbmZ1bmN0aW9uIGlzQm9keUlubGluZShub2RlKSB7XG4gIHJldHVybiBkb21faXNJbmxpbmUobm9kZSkgJiYgIWRvbV9hbmNlc3Rvcihub2RlLCBpc1BhcmEpO1xufVxuXG52YXIgaXNCb2R5ID0gbWFrZVByZWRCeU5vZGVOYW1lKCdCT0RZJyk7XG4vKipcbiAqIHJldHVybnMgd2hldGhlciBub2RlQiBpcyBjbG9zZXN0IHNpYmxpbmcgb2Ygbm9kZUFcbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVBXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVCXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cbmZ1bmN0aW9uIGlzQ2xvc2VzdFNpYmxpbmcobm9kZUEsIG5vZGVCKSB7XG4gIHJldHVybiBub2RlQS5uZXh0U2libGluZyA9PT0gbm9kZUIgfHwgbm9kZUEucHJldmlvdXNTaWJsaW5nID09PSBub2RlQjtcbn1cbi8qKlxuICogcmV0dXJucyBhcnJheSBvZiBjbG9zZXN0IHNpYmxpbmdzIHdpdGggbm9kZVxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtmdW5jdGlvbn0gW3ByZWRdIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gKiBAcmV0dXJuIHtOb2RlW119XG4gKi9cblxuXG5mdW5jdGlvbiB3aXRoQ2xvc2VzdFNpYmxpbmdzKG5vZGUsIHByZWQpIHtcbiAgcHJlZCA9IHByZWQgfHwgZnVuYy5vaztcbiAgdmFyIHNpYmxpbmdzID0gW107XG5cbiAgaWYgKG5vZGUucHJldmlvdXNTaWJsaW5nICYmIHByZWQobm9kZS5wcmV2aW91c1NpYmxpbmcpKSB7XG4gICAgc2libGluZ3MucHVzaChub2RlLnByZXZpb3VzU2libGluZyk7XG4gIH1cblxuICBzaWJsaW5ncy5wdXNoKG5vZGUpO1xuXG4gIGlmIChub2RlLm5leHRTaWJsaW5nICYmIHByZWQobm9kZS5uZXh0U2libGluZykpIHtcbiAgICBzaWJsaW5ncy5wdXNoKG5vZGUubmV4dFNpYmxpbmcpO1xuICB9XG5cbiAgcmV0dXJuIHNpYmxpbmdzO1xufVxuLyoqXG4gKiBibGFuayBIVE1MIGZvciBjdXJzb3IgcG9zaXRpb25cbiAqIC0gW3dvcmthcm91bmRdIG9sZCBJRSBvbmx5IHdvcmtzIHdpdGggJm5ic3A7XG4gKiAtIFt3b3JrYXJvdW5kXSBJRTExIGFuZCBvdGhlciBicm93c2VyIHdvcmtzIHdpdGggYm9ndXMgYnJcbiAqL1xuXG5cbnZhciBibGFua0hUTUwgPSBlbnYuaXNNU0lFICYmIGVudi5icm93c2VyVmVyc2lvbiA8IDExID8gJyZuYnNwOycgOiAnPGJyPic7XG4vKipcbiAqIEBtZXRob2Qgbm9kZUxlbmd0aFxuICpcbiAqIHJldHVybnMgI3RleHQncyB0ZXh0IHNpemUgb3IgZWxlbWVudCdzIGNoaWxkTm9kZXMgc2l6ZVxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICovXG5cbmZ1bmN0aW9uIG5vZGVMZW5ndGgobm9kZSkge1xuICBpZiAoaXNUZXh0KG5vZGUpKSB7XG4gICAgcmV0dXJuIG5vZGUubm9kZVZhbHVlLmxlbmd0aDtcbiAgfVxuXG4gIGlmIChub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7XG4gIH1cblxuICByZXR1cm4gMDtcbn1cbi8qKlxuICogcmV0dXJucyB3aGV0aGVyIGRlZXBlc3QgY2hpbGQgbm9kZSBpcyBlbXB0eSBvciBub3QuXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cblxuZnVuY3Rpb24gZGVlcGVzdENoaWxkSXNFbXB0eShub2RlKSB7XG4gIGRvIHtcbiAgICBpZiAobm9kZS5maXJzdEVsZW1lbnRDaGlsZCA9PT0gbnVsbCB8fCBub2RlLmZpcnN0RWxlbWVudENoaWxkLmlubmVySFRNTCA9PT0gJycpIGJyZWFrO1xuICB9IHdoaWxlIChub2RlID0gbm9kZS5maXJzdEVsZW1lbnRDaGlsZCk7XG5cbiAgcmV0dXJuIGRvbV9pc0VtcHR5KG5vZGUpO1xufVxuLyoqXG4gKiByZXR1cm5zIHdoZXRoZXIgbm9kZSBpcyBlbXB0eSBvciBub3QuXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cblxuZnVuY3Rpb24gZG9tX2lzRW1wdHkobm9kZSkge1xuICB2YXIgbGVuID0gbm9kZUxlbmd0aChub2RlKTtcblxuICBpZiAobGVuID09PSAwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSBpZiAoIWlzVGV4dChub2RlKSAmJiBsZW4gPT09IDEgJiYgbm9kZS5pbm5lckhUTUwgPT09IGJsYW5rSFRNTCkge1xuICAgIC8vIGV4KSA8cD48YnI+PC9wPiwgPHNwYW4+PGJyPjwvc3Bhbj5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChsaXN0cy5hbGwobm9kZS5jaGlsZE5vZGVzLCBpc1RleHQpICYmIG5vZGUuaW5uZXJIVE1MID09PSAnJykge1xuICAgIC8vIGV4KSA8cD48L3A+LCA8c3Bhbj48L3NwYW4+XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIHBhZGRpbmcgYmxhbmtIVE1MIGlmIG5vZGUgaXMgZW1wdHkgKGZvciBjdXJzb3IgcG9zaXRpb24pXG4gKi9cblxuXG5mdW5jdGlvbiBwYWRkaW5nQmxhbmtIVE1MKG5vZGUpIHtcbiAgaWYgKCFpc1ZvaWQobm9kZSkgJiYgIW5vZGVMZW5ndGgobm9kZSkpIHtcbiAgICBub2RlLmlubmVySFRNTCA9IGJsYW5rSFRNTDtcbiAgfVxufVxuLyoqXG4gKiBmaW5kIG5lYXJlc3QgYW5jZXN0b3IgcHJlZGljYXRlIGhpdFxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZCAtIHByZWRpY2F0ZSBmdW5jdGlvblxuICovXG5cblxuZnVuY3Rpb24gZG9tX2FuY2VzdG9yKG5vZGUsIHByZWQpIHtcbiAgd2hpbGUgKG5vZGUpIHtcbiAgICBpZiAocHJlZChub2RlKSkge1xuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfVxuXG4gICAgaWYgKGlzRWRpdGFibGUobm9kZSkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogZmluZCBuZWFyZXN0IGFuY2VzdG9yIG9ubHkgc2luZ2xlIGNoaWxkIGJsb29kIGxpbmUgYW5kIHByZWRpY2F0ZSBoaXRcbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWQgLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAqL1xuXG5cbmZ1bmN0aW9uIHNpbmdsZUNoaWxkQW5jZXN0b3Iobm9kZSwgcHJlZCkge1xuICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXG4gIHdoaWxlIChub2RlKSB7XG4gICAgaWYgKG5vZGVMZW5ndGgobm9kZSkgIT09IDEpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChwcmVkKG5vZGUpKSB7XG4gICAgICByZXR1cm4gbm9kZTtcbiAgICB9XG5cbiAgICBpZiAoaXNFZGl0YWJsZShub2RlKSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiByZXR1cm5zIG5ldyBhcnJheSBvZiBhbmNlc3RvciBub2RlcyAodW50aWwgcHJlZGljYXRlIGhpdCkuXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb3B0aW9uYWxdIHByZWQgLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAqL1xuXG5cbmZ1bmN0aW9uIGxpc3RBbmNlc3Rvcihub2RlLCBwcmVkKSB7XG4gIHByZWQgPSBwcmVkIHx8IGZ1bmMuZmFpbDtcbiAgdmFyIGFuY2VzdG9ycyA9IFtdO1xuICBkb21fYW5jZXN0b3Iobm9kZSwgZnVuY3Rpb24gKGVsKSB7XG4gICAgaWYgKCFpc0VkaXRhYmxlKGVsKSkge1xuICAgICAgYW5jZXN0b3JzLnB1c2goZWwpO1xuICAgIH1cblxuICAgIHJldHVybiBwcmVkKGVsKTtcbiAgfSk7XG4gIHJldHVybiBhbmNlc3RvcnM7XG59XG4vKipcbiAqIGZpbmQgZmFydGhlc3QgYW5jZXN0b3IgcHJlZGljYXRlIGhpdFxuICovXG5cblxuZnVuY3Rpb24gbGFzdEFuY2VzdG9yKG5vZGUsIHByZWQpIHtcbiAgdmFyIGFuY2VzdG9ycyA9IGxpc3RBbmNlc3Rvcihub2RlKTtcbiAgcmV0dXJuIGxpc3RzLmxhc3QoYW5jZXN0b3JzLmZpbHRlcihwcmVkKSk7XG59XG4vKipcbiAqIHJldHVybnMgY29tbW9uIGFuY2VzdG9yIG5vZGUgYmV0d2VlbiB0d28gbm9kZXMuXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlQVxuICogQHBhcmFtIHtOb2RlfSBub2RlQlxuICovXG5cblxuZnVuY3Rpb24gZG9tX2NvbW1vbkFuY2VzdG9yKG5vZGVBLCBub2RlQikge1xuICB2YXIgYW5jZXN0b3JzID0gbGlzdEFuY2VzdG9yKG5vZGVBKTtcblxuICBmb3IgKHZhciBuID0gbm9kZUI7IG47IG4gPSBuLnBhcmVudE5vZGUpIHtcbiAgICBpZiAoYW5jZXN0b3JzLmluZGV4T2YobikgPiAtMSkgcmV0dXJuIG47XG4gIH1cblxuICByZXR1cm4gbnVsbDsgLy8gZGlmZmVyZW5jZSBkb2N1bWVudCBhcmVhXG59XG4vKipcbiAqIGxpc3RpbmcgYWxsIHByZXZpb3VzIHNpYmxpbmdzICh1bnRpbCBwcmVkaWNhdGUgaGl0KS5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25hbF0gcHJlZCAtIHByZWRpY2F0ZSBmdW5jdGlvblxuICovXG5cblxuZnVuY3Rpb24gbGlzdFByZXYobm9kZSwgcHJlZCkge1xuICBwcmVkID0gcHJlZCB8fCBmdW5jLmZhaWw7XG4gIHZhciBub2RlcyA9IFtdO1xuXG4gIHdoaWxlIChub2RlKSB7XG4gICAgaWYgKHByZWQobm9kZSkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIG5vZGVzLnB1c2gobm9kZSk7XG4gICAgbm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nO1xuICB9XG5cbiAgcmV0dXJuIG5vZGVzO1xufVxuLyoqXG4gKiBsaXN0aW5nIG5leHQgc2libGluZ3MgKHVudGlsIHByZWRpY2F0ZSBoaXQpLlxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRdIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gKi9cblxuXG5mdW5jdGlvbiBsaXN0TmV4dChub2RlLCBwcmVkKSB7XG4gIHByZWQgPSBwcmVkIHx8IGZ1bmMuZmFpbDtcbiAgdmFyIG5vZGVzID0gW107XG5cbiAgd2hpbGUgKG5vZGUpIHtcbiAgICBpZiAocHJlZChub2RlKSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgbm9kZXMucHVzaChub2RlKTtcbiAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgfVxuXG4gIHJldHVybiBub2Rlcztcbn1cbi8qKlxuICogbGlzdGluZyBkZXNjZW5kYW50IG5vZGVzXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZF0gLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAqL1xuXG5cbmZ1bmN0aW9uIGxpc3REZXNjZW5kYW50KG5vZGUsIHByZWQpIHtcbiAgdmFyIGRlc2NlbmRhbnRzID0gW107XG4gIHByZWQgPSBwcmVkIHx8IGZ1bmMub2s7IC8vIHN0YXJ0IERGUyhkZXB0aCBmaXJzdCBzZWFyY2gpIHdpdGggbm9kZVxuXG4gIChmdW5jdGlvbiBmbldhbGsoY3VycmVudCkge1xuICAgIGlmIChub2RlICE9PSBjdXJyZW50ICYmIHByZWQoY3VycmVudCkpIHtcbiAgICAgIGRlc2NlbmRhbnRzLnB1c2goY3VycmVudCk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gY3VycmVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaWR4IDwgbGVuOyBpZHgrKykge1xuICAgICAgZm5XYWxrKGN1cnJlbnQuY2hpbGROb2Rlc1tpZHhdKTtcbiAgICB9XG4gIH0pKG5vZGUpO1xuXG4gIHJldHVybiBkZXNjZW5kYW50cztcbn1cbi8qKlxuICogd3JhcCBub2RlIHdpdGggbmV3IHRhZy5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7Tm9kZX0gdGFnTmFtZSBvZiB3cmFwcGVyXG4gKiBAcmV0dXJuIHtOb2RlfSAtIHdyYXBwZXJcbiAqL1xuXG5cbmZ1bmN0aW9uIHdyYXAobm9kZSwgd3JhcHBlck5hbWUpIHtcbiAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTtcbiAgdmFyIHdyYXBwZXIgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnPCcgKyB3cmFwcGVyTmFtZSArICc+JylbMF07XG4gIHBhcmVudC5pbnNlcnRCZWZvcmUod3JhcHBlciwgbm9kZSk7XG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQobm9kZSk7XG4gIHJldHVybiB3cmFwcGVyO1xufVxuLyoqXG4gKiBpbnNlcnQgbm9kZSBhZnRlciBwcmVjZWRpbmdcbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7Tm9kZX0gcHJlY2VkaW5nIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gKi9cblxuXG5mdW5jdGlvbiBpbnNlcnRBZnRlcihub2RlLCBwcmVjZWRpbmcpIHtcbiAgdmFyIG5leHQgPSBwcmVjZWRpbmcubmV4dFNpYmxpbmc7XG4gIHZhciBwYXJlbnQgPSBwcmVjZWRpbmcucGFyZW50Tm9kZTtcblxuICBpZiAobmV4dCkge1xuICAgIHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgbmV4dCk7XG4gIH0gZWxzZSB7XG4gICAgcGFyZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuICB9XG5cbiAgcmV0dXJuIG5vZGU7XG59XG4vKipcbiAqIGFwcGVuZCBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7Q29sbGVjdGlvbn0gYUNoaWxkXG4gKi9cblxuXG5mdW5jdGlvbiBhcHBlbmRDaGlsZE5vZGVzKG5vZGUsIGFDaGlsZCkge1xuICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKGFDaGlsZCwgZnVuY3Rpb24gKGlkeCwgY2hpbGQpIHtcbiAgICBub2RlLmFwcGVuZENoaWxkKGNoaWxkKTtcbiAgfSk7XG4gIHJldHVybiBub2RlO1xufVxuLyoqXG4gKiByZXR1cm5zIHdoZXRoZXIgYm91bmRhcnlQb2ludCBpcyBsZWZ0IGVkZ2Ugb3Igbm90LlxuICpcbiAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc0xlZnRFZGdlUG9pbnQocG9pbnQpIHtcbiAgcmV0dXJuIHBvaW50Lm9mZnNldCA9PT0gMDtcbn1cbi8qKlxuICogcmV0dXJucyB3aGV0aGVyIGJvdW5kYXJ5UG9pbnQgaXMgcmlnaHQgZWRnZSBvciBub3QuXG4gKlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuXG5cbmZ1bmN0aW9uIGlzUmlnaHRFZGdlUG9pbnQocG9pbnQpIHtcbiAgcmV0dXJuIHBvaW50Lm9mZnNldCA9PT0gbm9kZUxlbmd0aChwb2ludC5ub2RlKTtcbn1cbi8qKlxuICogcmV0dXJucyB3aGV0aGVyIGJvdW5kYXJ5UG9pbnQgaXMgZWRnZSBvciBub3QuXG4gKlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuXG5cbmZ1bmN0aW9uIGlzRWRnZVBvaW50KHBvaW50KSB7XG4gIHJldHVybiBpc0xlZnRFZGdlUG9pbnQocG9pbnQpIHx8IGlzUmlnaHRFZGdlUG9pbnQocG9pbnQpO1xufVxuLyoqXG4gKiByZXR1cm5zIHdoZXRoZXIgbm9kZSBpcyBsZWZ0IGVkZ2Ugb2YgYW5jZXN0b3Igb3Igbm90LlxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvclxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuXG5cbmZ1bmN0aW9uIGRvbV9pc0xlZnRFZGdlT2Yobm9kZSwgYW5jZXN0b3IpIHtcbiAgd2hpbGUgKG5vZGUgJiYgbm9kZSAhPT0gYW5jZXN0b3IpIHtcbiAgICBpZiAoZG9tX3Bvc2l0aW9uKG5vZGUpICE9PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiByZXR1cm5zIHdoZXRoZXIgbm9kZSBpcyByaWdodCBlZGdlIG9mIGFuY2VzdG9yIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7Tm9kZX0gYW5jZXN0b3JcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc1JpZ2h0RWRnZU9mKG5vZGUsIGFuY2VzdG9yKSB7XG4gIGlmICghYW5jZXN0b3IpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB3aGlsZSAobm9kZSAmJiBub2RlICE9PSBhbmNlc3Rvcikge1xuICAgIGlmIChkb21fcG9zaXRpb24obm9kZSkgIT09IG5vZGVMZW5ndGgobm9kZS5wYXJlbnROb2RlKSAtIDEpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG4vKipcbiAqIHJldHVybnMgd2hldGhlciBwb2ludCBpcyBsZWZ0IGVkZ2Ugb2YgYW5jZXN0b3Igb3Igbm90LlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvclxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuXG5cbmZ1bmN0aW9uIGlzTGVmdEVkZ2VQb2ludE9mKHBvaW50LCBhbmNlc3Rvcikge1xuICByZXR1cm4gaXNMZWZ0RWRnZVBvaW50KHBvaW50KSAmJiBkb21faXNMZWZ0RWRnZU9mKHBvaW50Lm5vZGUsIGFuY2VzdG9yKTtcbn1cbi8qKlxuICogcmV0dXJucyB3aGV0aGVyIHBvaW50IGlzIHJpZ2h0IGVkZ2Ugb2YgYW5jZXN0b3Igb3Igbm90LlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvclxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuXG5cbmZ1bmN0aW9uIGlzUmlnaHRFZGdlUG9pbnRPZihwb2ludCwgYW5jZXN0b3IpIHtcbiAgcmV0dXJuIGlzUmlnaHRFZGdlUG9pbnQocG9pbnQpICYmIGlzUmlnaHRFZGdlT2YocG9pbnQubm9kZSwgYW5jZXN0b3IpO1xufVxuLyoqXG4gKiByZXR1cm5zIG9mZnNldCBmcm9tIHBhcmVudC5cbiAqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqL1xuXG5cbmZ1bmN0aW9uIGRvbV9wb3NpdGlvbihub2RlKSB7XG4gIHZhciBvZmZzZXQgPSAwO1xuXG4gIHdoaWxlIChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpIHtcbiAgICBvZmZzZXQgKz0gMTtcbiAgfVxuXG4gIHJldHVybiBvZmZzZXQ7XG59XG5cbmZ1bmN0aW9uIGhhc0NoaWxkcmVuKG5vZGUpIHtcbiAgcmV0dXJuICEhKG5vZGUgJiYgbm9kZS5jaGlsZE5vZGVzICYmIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGgpO1xufVxuLyoqXG4gKiByZXR1cm5zIHByZXZpb3VzIGJvdW5kYXJ5UG9pbnRcbiAqXG4gKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gKiBAcGFyYW0ge0Jvb2xlYW59IGlzU2tpcElubmVyT2Zmc2V0XG4gKiBAcmV0dXJuIHtCb3VuZGFyeVBvaW50fVxuICovXG5cblxuZnVuY3Rpb24gZG9tX3ByZXZQb2ludChwb2ludCwgaXNTa2lwSW5uZXJPZmZzZXQpIHtcbiAgdmFyIG5vZGU7XG4gIHZhciBvZmZzZXQ7XG5cbiAgaWYgKHBvaW50Lm9mZnNldCA9PT0gMCkge1xuICAgIGlmIChpc0VkaXRhYmxlKHBvaW50Lm5vZGUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBub2RlID0gcG9pbnQubm9kZS5wYXJlbnROb2RlO1xuICAgIG9mZnNldCA9IGRvbV9wb3NpdGlvbihwb2ludC5ub2RlKTtcbiAgfSBlbHNlIGlmIChoYXNDaGlsZHJlbihwb2ludC5ub2RlKSkge1xuICAgIG5vZGUgPSBwb2ludC5ub2RlLmNoaWxkTm9kZXNbcG9pbnQub2Zmc2V0IC0gMV07XG4gICAgb2Zmc2V0ID0gbm9kZUxlbmd0aChub2RlKTtcbiAgfSBlbHNlIHtcbiAgICBub2RlID0gcG9pbnQubm9kZTtcbiAgICBvZmZzZXQgPSBpc1NraXBJbm5lck9mZnNldCA/IDAgOiBwb2ludC5vZmZzZXQgLSAxO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBub2RlOiBub2RlLFxuICAgIG9mZnNldDogb2Zmc2V0XG4gIH07XG59XG4vKipcbiAqIHJldHVybnMgbmV4dCBib3VuZGFyeVBvaW50XG4gKlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHBhcmFtIHtCb29sZWFufSBpc1NraXBJbm5lck9mZnNldFxuICogQHJldHVybiB7Qm91bmRhcnlQb2ludH1cbiAqL1xuXG5cbmZ1bmN0aW9uIGRvbV9uZXh0UG9pbnQocG9pbnQsIGlzU2tpcElubmVyT2Zmc2V0KSB7XG4gIHZhciBub2RlLCBvZmZzZXQ7XG5cbiAgaWYgKG5vZGVMZW5ndGgocG9pbnQubm9kZSkgPT09IHBvaW50Lm9mZnNldCkge1xuICAgIGlmIChpc0VkaXRhYmxlKHBvaW50Lm5vZGUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICB2YXIgbmV4dFRleHROb2RlID0gZ2V0TmV4dFRleHROb2RlKHBvaW50Lm5vZGUpO1xuXG4gICAgaWYgKG5leHRUZXh0Tm9kZSkge1xuICAgICAgbm9kZSA9IG5leHRUZXh0Tm9kZTtcbiAgICAgIG9mZnNldCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5vZGUgPSBwb2ludC5ub2RlLnBhcmVudE5vZGU7XG4gICAgICBvZmZzZXQgPSBkb21fcG9zaXRpb24ocG9pbnQubm9kZSkgKyAxO1xuICAgIH1cbiAgfSBlbHNlIGlmIChoYXNDaGlsZHJlbihwb2ludC5ub2RlKSkge1xuICAgIG5vZGUgPSBwb2ludC5ub2RlLmNoaWxkTm9kZXNbcG9pbnQub2Zmc2V0XTtcbiAgICBvZmZzZXQgPSAwO1xuICB9IGVsc2Uge1xuICAgIG5vZGUgPSBwb2ludC5ub2RlO1xuICAgIG9mZnNldCA9IGlzU2tpcElubmVyT2Zmc2V0ID8gbm9kZUxlbmd0aChwb2ludC5ub2RlKSA6IHBvaW50Lm9mZnNldCArIDE7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5vZGU6IG5vZGUsXG4gICAgb2Zmc2V0OiBvZmZzZXRcbiAgfTtcbn1cbi8qKlxuICogcmV0dXJucyBuZXh0IGJvdW5kYXJ5UG9pbnQgd2l0aCBlbXB0eSBub2RlXG4gKlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHBhcmFtIHtCb29sZWFufSBpc1NraXBJbm5lck9mZnNldFxuICogQHJldHVybiB7Qm91bmRhcnlQb2ludH1cbiAqL1xuXG5cbmZ1bmN0aW9uIG5leHRQb2ludFdpdGhFbXB0eU5vZGUocG9pbnQsIGlzU2tpcElubmVyT2Zmc2V0KSB7XG4gIHZhciBub2RlLCBvZmZzZXQ7IC8vIGlmIG5vZGUgaXMgZW1wdHkgc3RyaW5nIG5vZGUsIHJldHVybiBjdXJyZW50IG5vZGUncyBzaWJsaW5nLlxuXG4gIGlmIChkb21faXNFbXB0eShwb2ludC5ub2RlKSkge1xuICAgIG5vZGUgPSBwb2ludC5ub2RlLm5leHRTaWJsaW5nO1xuICAgIG9mZnNldCA9IDA7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5vZGU6IG5vZGUsXG4gICAgICBvZmZzZXQ6IG9mZnNldFxuICAgIH07XG4gIH1cblxuICBpZiAobm9kZUxlbmd0aChwb2ludC5ub2RlKSA9PT0gcG9pbnQub2Zmc2V0KSB7XG4gICAgaWYgKGlzRWRpdGFibGUocG9pbnQubm9kZSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHZhciBuZXh0VGV4dE5vZGUgPSBnZXROZXh0VGV4dE5vZGUocG9pbnQubm9kZSk7XG5cbiAgICBpZiAobmV4dFRleHROb2RlKSB7XG4gICAgICBub2RlID0gbmV4dFRleHROb2RlO1xuICAgICAgb2Zmc2V0ID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZSA9IHBvaW50Lm5vZGUucGFyZW50Tm9kZTtcbiAgICAgIG9mZnNldCA9IGRvbV9wb3NpdGlvbihwb2ludC5ub2RlKSArIDE7XG4gICAgfSAvLyBpZiBuZXh0IG5vZGUgaXMgZWRpdGFibGUsIHJldHVybiBjdXJyZW50IG5vZGUncyBzaWJsaW5nIG5vZGUuXG5cblxuICAgIGlmIChpc0VkaXRhYmxlKG5vZGUpKSB7XG4gICAgICBub2RlID0gcG9pbnQubm9kZS5uZXh0U2libGluZztcbiAgICAgIG9mZnNldCA9IDA7XG4gICAgfVxuICB9IGVsc2UgaWYgKGhhc0NoaWxkcmVuKHBvaW50Lm5vZGUpKSB7XG4gICAgbm9kZSA9IHBvaW50Lm5vZGUuY2hpbGROb2Rlc1twb2ludC5vZmZzZXRdO1xuICAgIG9mZnNldCA9IDA7XG5cbiAgICBpZiAoZG9tX2lzRW1wdHkobm9kZSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBub2RlID0gcG9pbnQubm9kZTtcbiAgICBvZmZzZXQgPSBpc1NraXBJbm5lck9mZnNldCA/IG5vZGVMZW5ndGgocG9pbnQubm9kZSkgOiBwb2ludC5vZmZzZXQgKyAxO1xuXG4gICAgaWYgKGRvbV9pc0VtcHR5KG5vZGUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5vZGU6IG5vZGUsXG4gICAgb2Zmc2V0OiBvZmZzZXRcbiAgfTtcbn1cbi8qXG4qIHJldHVybnMgdGhlIG5leHQgVGV4dCBub2RlIGluZGV4IG9yIDAgaWYgbm90IGZvdW5kLlxuKi9cblxuXG5mdW5jdGlvbiBnZXROZXh0VGV4dE5vZGUoYWN0dWFsKSB7XG4gIGlmICghYWN0dWFsLm5leHRTaWJsaW5nKSByZXR1cm4gdW5kZWZpbmVkO1xuICBpZiAoYWN0dWFsLnBhcmVudCAhPT0gYWN0dWFsLm5leHRTaWJsaW5nLnBhcmVudCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgaWYgKGlzVGV4dChhY3R1YWwubmV4dFNpYmxpbmcpKSByZXR1cm4gYWN0dWFsLm5leHRTaWJsaW5nO1xuICByZXR1cm4gZ2V0TmV4dFRleHROb2RlKGFjdHVhbC5uZXh0U2libGluZyk7XG59XG4vKipcbiAqIHJldHVybnMgd2hldGhlciBwb2ludEEgYW5kIHBvaW50QiBpcyBzYW1lIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50QVxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludEJcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc1NhbWVQb2ludChwb2ludEEsIHBvaW50Qikge1xuICByZXR1cm4gcG9pbnRBLm5vZGUgPT09IHBvaW50Qi5ub2RlICYmIHBvaW50QS5vZmZzZXQgPT09IHBvaW50Qi5vZmZzZXQ7XG59XG4vKipcbiAqIHJldHVybnMgd2hldGhlciBwb2ludCBpcyB2aXNpYmxlIChjYW4gc2V0IGN1cnNvcikgb3Igbm90LlxuICpcbiAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc1Zpc2libGVQb2ludChwb2ludCkge1xuICBpZiAoaXNUZXh0KHBvaW50Lm5vZGUpIHx8ICFoYXNDaGlsZHJlbihwb2ludC5ub2RlKSB8fCBkb21faXNFbXB0eShwb2ludC5ub2RlKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdmFyIGxlZnROb2RlID0gcG9pbnQubm9kZS5jaGlsZE5vZGVzW3BvaW50Lm9mZnNldCAtIDFdO1xuICB2YXIgcmlnaHROb2RlID0gcG9pbnQubm9kZS5jaGlsZE5vZGVzW3BvaW50Lm9mZnNldF07XG5cbiAgaWYgKCghbGVmdE5vZGUgfHwgaXNWb2lkKGxlZnROb2RlKSkgJiYgKCFyaWdodE5vZGUgfHwgaXNWb2lkKHJpZ2h0Tm9kZSkpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIEBtZXRob2QgcHJldlBvaW50VXRpbFxuICpcbiAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRcbiAqIEByZXR1cm4ge0JvdW5kYXJ5UG9pbnR9XG4gKi9cblxuXG5mdW5jdGlvbiBwcmV2UG9pbnRVbnRpbChwb2ludCwgcHJlZCkge1xuICB3aGlsZSAocG9pbnQpIHtcbiAgICBpZiAocHJlZChwb2ludCkpIHtcbiAgICAgIHJldHVybiBwb2ludDtcbiAgICB9XG5cbiAgICBwb2ludCA9IGRvbV9wcmV2UG9pbnQocG9pbnQpO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIEBtZXRob2QgbmV4dFBvaW50VW50aWxcbiAqXG4gKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkXG4gKiBAcmV0dXJuIHtCb3VuZGFyeVBvaW50fVxuICovXG5cblxuZnVuY3Rpb24gbmV4dFBvaW50VW50aWwocG9pbnQsIHByZWQpIHtcbiAgd2hpbGUgKHBvaW50KSB7XG4gICAgaWYgKHByZWQocG9pbnQpKSB7XG4gICAgICByZXR1cm4gcG9pbnQ7XG4gICAgfVxuXG4gICAgcG9pbnQgPSBkb21fbmV4dFBvaW50KHBvaW50KTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiByZXR1cm5zIHdoZXRoZXIgcG9pbnQgaGFzIGNoYXJhY3RlciBvciBub3QuXG4gKlxuICogQHBhcmFtIHtQb2ludH0gcG9pbnRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc0NoYXJQb2ludChwb2ludCkge1xuICBpZiAoIWlzVGV4dChwb2ludC5ub2RlKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBjaCA9IHBvaW50Lm5vZGUubm9kZVZhbHVlLmNoYXJBdChwb2ludC5vZmZzZXQgLSAxKTtcbiAgcmV0dXJuIGNoICYmIGNoICE9PSAnICcgJiYgY2ggIT09IE5CU1BfQ0hBUjtcbn1cbi8qKlxuICogcmV0dXJucyB3aGV0aGVyIHBvaW50IGhhcyBzcGFjZSBvciBub3QuXG4gKlxuICogQHBhcmFtIHtQb2ludH0gcG9pbnRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cblxuXG5mdW5jdGlvbiBpc1NwYWNlUG9pbnQocG9pbnQpIHtcbiAgaWYgKCFpc1RleHQocG9pbnQubm9kZSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgY2ggPSBwb2ludC5ub2RlLm5vZGVWYWx1ZS5jaGFyQXQocG9pbnQub2Zmc2V0IC0gMSk7XG4gIHJldHVybiBjaCA9PT0gJyAnIHx8IGNoID09PSBOQlNQX0NIQVI7XG59XG4vKipcbiAqIEBtZXRob2Qgd2Fsa1BvaW50XG4gKlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBzdGFydFBvaW50XG4gKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IGVuZFBvaW50XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyXG4gKiBAcGFyYW0ge0Jvb2xlYW59IGlzU2tpcElubmVyT2Zmc2V0XG4gKi9cblxuXG5mdW5jdGlvbiB3YWxrUG9pbnQoc3RhcnRQb2ludCwgZW5kUG9pbnQsIGhhbmRsZXIsIGlzU2tpcElubmVyT2Zmc2V0KSB7XG4gIHZhciBwb2ludCA9IHN0YXJ0UG9pbnQ7XG5cbiAgd2hpbGUgKHBvaW50KSB7XG4gICAgaGFuZGxlcihwb2ludCk7XG5cbiAgICBpZiAoaXNTYW1lUG9pbnQocG9pbnQsIGVuZFBvaW50KSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgdmFyIGlzU2tpcE9mZnNldCA9IGlzU2tpcElubmVyT2Zmc2V0ICYmIHN0YXJ0UG9pbnQubm9kZSAhPT0gcG9pbnQubm9kZSAmJiBlbmRQb2ludC5ub2RlICE9PSBwb2ludC5ub2RlO1xuICAgIHBvaW50ID0gbmV4dFBvaW50V2l0aEVtcHR5Tm9kZShwb2ludCwgaXNTa2lwT2Zmc2V0KTtcbiAgfVxufVxuLyoqXG4gKiBAbWV0aG9kIG1ha2VPZmZzZXRQYXRoXG4gKlxuICogcmV0dXJuIG9mZnNldFBhdGgoYXJyYXkgb2Ygb2Zmc2V0KSBmcm9tIGFuY2VzdG9yXG4gKlxuICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvciAtIGFuY2VzdG9yIG5vZGVcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICovXG5cblxuZnVuY3Rpb24gbWFrZU9mZnNldFBhdGgoYW5jZXN0b3IsIG5vZGUpIHtcbiAgdmFyIGFuY2VzdG9ycyA9IGxpc3RBbmNlc3Rvcihub2RlLCBmdW5jLmVxKGFuY2VzdG9yKSk7XG4gIHJldHVybiBhbmNlc3RvcnMubWFwKGRvbV9wb3NpdGlvbikucmV2ZXJzZSgpO1xufVxuLyoqXG4gKiBAbWV0aG9kIGZyb21PZmZzZXRQYXRoXG4gKlxuICogcmV0dXJuIGVsZW1lbnQgZnJvbSBvZmZzZXRQYXRoKGFycmF5IG9mIG9mZnNldClcbiAqXG4gKiBAcGFyYW0ge05vZGV9IGFuY2VzdG9yIC0gYW5jZXN0b3Igbm9kZVxuICogQHBhcmFtIHthcnJheX0gb2Zmc2V0cyAtIG9mZnNldFBhdGhcbiAqL1xuXG5cbmZ1bmN0aW9uIGZyb21PZmZzZXRQYXRoKGFuY2VzdG9yLCBvZmZzZXRzKSB7XG4gIHZhciBjdXJyZW50ID0gYW5jZXN0b3I7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG9mZnNldHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBpZiAoY3VycmVudC5jaGlsZE5vZGVzLmxlbmd0aCA8PSBvZmZzZXRzW2ldKSB7XG4gICAgICBjdXJyZW50ID0gY3VycmVudC5jaGlsZE5vZGVzW2N1cnJlbnQuY2hpbGROb2Rlcy5sZW5ndGggLSAxXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VycmVudCA9IGN1cnJlbnQuY2hpbGROb2Rlc1tvZmZzZXRzW2ldXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gY3VycmVudDtcbn1cbi8qKlxuICogQG1ldGhvZCBzcGxpdE5vZGVcbiAqXG4gKiBzcGxpdCBlbGVtZW50IG9yICN0ZXh0XG4gKlxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5pc1NraXBQYWRkaW5nQmxhbmtIVE1MXSAtIGRlZmF1bHQ6IGZhbHNlXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmlzTm90U3BsaXRFZGdlUG9pbnRdIC0gZGVmYXVsdDogZmFsc2VcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaXNEaXNjYXJkRW1wdHlTcGxpdHNdIC0gZGVmYXVsdDogZmFsc2VcbiAqIEByZXR1cm4ge05vZGV9IHJpZ2h0IG5vZGUgb2YgYm91bmRhcnlQb2ludFxuICovXG5cblxuZnVuY3Rpb24gc3BsaXROb2RlKHBvaW50LCBvcHRpb25zKSB7XG4gIHZhciBpc1NraXBQYWRkaW5nQmxhbmtIVE1MID0gb3B0aW9ucyAmJiBvcHRpb25zLmlzU2tpcFBhZGRpbmdCbGFua0hUTUw7XG4gIHZhciBpc05vdFNwbGl0RWRnZVBvaW50ID0gb3B0aW9ucyAmJiBvcHRpb25zLmlzTm90U3BsaXRFZGdlUG9pbnQ7XG4gIHZhciBpc0Rpc2NhcmRFbXB0eVNwbGl0cyA9IG9wdGlvbnMgJiYgb3B0aW9ucy5pc0Rpc2NhcmRFbXB0eVNwbGl0cztcblxuICBpZiAoaXNEaXNjYXJkRW1wdHlTcGxpdHMpIHtcbiAgICBpc1NraXBQYWRkaW5nQmxhbmtIVE1MID0gdHJ1ZTtcbiAgfSAvLyBlZGdlIGNhc2VcblxuXG4gIGlmIChpc0VkZ2VQb2ludChwb2ludCkgJiYgKGlzVGV4dChwb2ludC5ub2RlKSB8fCBpc05vdFNwbGl0RWRnZVBvaW50KSkge1xuICAgIGlmIChpc0xlZnRFZGdlUG9pbnQocG9pbnQpKSB7XG4gICAgICByZXR1cm4gcG9pbnQubm9kZTtcbiAgICB9IGVsc2UgaWYgKGlzUmlnaHRFZGdlUG9pbnQocG9pbnQpKSB7XG4gICAgICByZXR1cm4gcG9pbnQubm9kZS5uZXh0U2libGluZztcbiAgICB9XG4gIH0gLy8gc3BsaXQgI3RleHRcblxuXG4gIGlmIChpc1RleHQocG9pbnQubm9kZSkpIHtcbiAgICByZXR1cm4gcG9pbnQubm9kZS5zcGxpdFRleHQocG9pbnQub2Zmc2V0KTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgY2hpbGROb2RlID0gcG9pbnQubm9kZS5jaGlsZE5vZGVzW3BvaW50Lm9mZnNldF07XG4gICAgdmFyIGNsb25lID0gaW5zZXJ0QWZ0ZXIocG9pbnQubm9kZS5jbG9uZU5vZGUoZmFsc2UpLCBwb2ludC5ub2RlKTtcbiAgICBhcHBlbmRDaGlsZE5vZGVzKGNsb25lLCBsaXN0TmV4dChjaGlsZE5vZGUpKTtcblxuICAgIGlmICghaXNTa2lwUGFkZGluZ0JsYW5rSFRNTCkge1xuICAgICAgcGFkZGluZ0JsYW5rSFRNTChwb2ludC5ub2RlKTtcbiAgICAgIHBhZGRpbmdCbGFua0hUTUwoY2xvbmUpO1xuICAgIH1cblxuICAgIGlmIChpc0Rpc2NhcmRFbXB0eVNwbGl0cykge1xuICAgICAgaWYgKGRvbV9pc0VtcHR5KHBvaW50Lm5vZGUpKSB7XG4gICAgICAgIHJlbW92ZShwb2ludC5ub2RlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRvbV9pc0VtcHR5KGNsb25lKSkge1xuICAgICAgICByZW1vdmUoY2xvbmUpO1xuICAgICAgICByZXR1cm4gcG9pbnQubm9kZS5uZXh0U2libGluZztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2xvbmU7XG4gIH1cbn1cbi8qKlxuICogQG1ldGhvZCBzcGxpdFRyZWVcbiAqXG4gKiBzcGxpdCB0cmVlIGJ5IHBvaW50XG4gKlxuICogQHBhcmFtIHtOb2RlfSByb290IC0gc3BsaXQgcm9vdFxuICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5pc1NraXBQYWRkaW5nQmxhbmtIVE1MXSAtIGRlZmF1bHQ6IGZhbHNlXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmlzTm90U3BsaXRFZGdlUG9pbnRdIC0gZGVmYXVsdDogZmFsc2VcbiAqIEByZXR1cm4ge05vZGV9IHJpZ2h0IG5vZGUgb2YgYm91bmRhcnlQb2ludFxuICovXG5cblxuZnVuY3Rpb24gc3BsaXRUcmVlKHJvb3QsIHBvaW50LCBvcHRpb25zKSB7XG4gIC8vIGV4KSBbI3RleHQsIDxzcGFuPiwgPHA+XVxuICB2YXIgYW5jZXN0b3JzID0gbGlzdEFuY2VzdG9yKHBvaW50Lm5vZGUsIGZ1bmMuZXEocm9vdCkpO1xuXG4gIGlmICghYW5jZXN0b3JzLmxlbmd0aCkge1xuICAgIHJldHVybiBudWxsO1xuICB9IGVsc2UgaWYgKGFuY2VzdG9ycy5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gc3BsaXROb2RlKHBvaW50LCBvcHRpb25zKTtcbiAgfVxuXG4gIHJldHVybiBhbmNlc3RvcnMucmVkdWNlKGZ1bmN0aW9uIChub2RlLCBwYXJlbnQpIHtcbiAgICBpZiAobm9kZSA9PT0gcG9pbnQubm9kZSkge1xuICAgICAgbm9kZSA9IHNwbGl0Tm9kZShwb2ludCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNwbGl0Tm9kZSh7XG4gICAgICBub2RlOiBwYXJlbnQsXG4gICAgICBvZmZzZXQ6IG5vZGUgPyBkb21fcG9zaXRpb24obm9kZSkgOiBub2RlTGVuZ3RoKHBhcmVudClcbiAgICB9LCBvcHRpb25zKTtcbiAgfSk7XG59XG4vKipcbiAqIHNwbGl0IHBvaW50XG4gKlxuICogQHBhcmFtIHtQb2ludH0gcG9pbnRcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNJbmxpbmVcbiAqIEByZXR1cm4ge09iamVjdH1cbiAqL1xuXG5cbmZ1bmN0aW9uIHNwbGl0UG9pbnQocG9pbnQsIGlzSW5saW5lKSB7XG4gIC8vIGZpbmQgc3BsaXRSb290LCBjb250YWluZXJcbiAgLy8gIC0gaW5saW5lOiBzcGxpdFJvb3QgaXMgYSBjaGlsZCBvZiBwYXJhZ3JhcGhcbiAgLy8gIC0gYmxvY2s6IHNwbGl0Um9vdCBpcyBhIGNoaWxkIG9mIGJvZHlDb250YWluZXJcbiAgdmFyIHByZWQgPSBpc0lubGluZSA/IGlzUGFyYSA6IGlzQm9keUNvbnRhaW5lcjtcbiAgdmFyIGFuY2VzdG9ycyA9IGxpc3RBbmNlc3Rvcihwb2ludC5ub2RlLCBwcmVkKTtcbiAgdmFyIHRvcEFuY2VzdG9yID0gbGlzdHMubGFzdChhbmNlc3RvcnMpIHx8IHBvaW50Lm5vZGU7XG4gIHZhciBzcGxpdFJvb3QsIGNvbnRhaW5lcjtcblxuICBpZiAocHJlZCh0b3BBbmNlc3RvcikpIHtcbiAgICBzcGxpdFJvb3QgPSBhbmNlc3RvcnNbYW5jZXN0b3JzLmxlbmd0aCAtIDJdO1xuICAgIGNvbnRhaW5lciA9IHRvcEFuY2VzdG9yO1xuICB9IGVsc2Uge1xuICAgIHNwbGl0Um9vdCA9IHRvcEFuY2VzdG9yO1xuICAgIGNvbnRhaW5lciA9IHNwbGl0Um9vdC5wYXJlbnROb2RlO1xuICB9IC8vIGlmIHNwbGl0Um9vdCBpcyBleGlzdHMsIHNwbGl0IHdpdGggc3BsaXRUcmVlXG5cblxuICB2YXIgcGl2b3QgPSBzcGxpdFJvb3QgJiYgc3BsaXRUcmVlKHNwbGl0Um9vdCwgcG9pbnQsIHtcbiAgICBpc1NraXBQYWRkaW5nQmxhbmtIVE1MOiBpc0lubGluZSxcbiAgICBpc05vdFNwbGl0RWRnZVBvaW50OiBpc0lubGluZVxuICB9KTsgLy8gaWYgY29udGFpbmVyIGlzIHBvaW50Lm5vZGUsIGZpbmQgcGl2b3Qgd2l0aCBwb2ludC5vZmZzZXRcblxuICBpZiAoIXBpdm90ICYmIGNvbnRhaW5lciA9PT0gcG9pbnQubm9kZSkge1xuICAgIHBpdm90ID0gcG9pbnQubm9kZS5jaGlsZE5vZGVzW3BvaW50Lm9mZnNldF07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHJpZ2h0Tm9kZTogcGl2b3QsXG4gICAgY29udGFpbmVyOiBjb250YWluZXJcbiAgfTtcbn1cblxuZnVuY3Rpb24gZG9tX2NyZWF0ZShub2RlTmFtZSkge1xuICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChub2RlTmFtZSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRleHQodGV4dCkge1xuICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCk7XG59XG4vKipcbiAqIEBtZXRob2QgcmVtb3ZlXG4gKlxuICogcmVtb3ZlIG5vZGUsIChpc1JlbW92ZUNoaWxkOiByZW1vdmUgY2hpbGQgb3Igbm90KVxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtCb29sZWFufSBpc1JlbW92ZUNoaWxkXG4gKi9cblxuXG5mdW5jdGlvbiByZW1vdmUobm9kZSwgaXNSZW1vdmVDaGlsZCkge1xuICBpZiAoIW5vZGUgfHwgIW5vZGUucGFyZW50Tm9kZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChub2RlLnJlbW92ZU5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5yZW1vdmVOb2RlKGlzUmVtb3ZlQ2hpbGQpO1xuICB9XG5cbiAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTtcblxuICBpZiAoIWlzUmVtb3ZlQ2hpbGQpIHtcbiAgICB2YXIgbm9kZXMgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIG5vZGVzLnB1c2gobm9kZS5jaGlsZE5vZGVzW2ldKTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBfaSA9IDAsIF9sZW4gPSBub2Rlcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShub2Rlc1tfaV0sIG5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKTtcbn1cbi8qKlxuICogQG1ldGhvZCByZW1vdmVXaGlsZVxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZFxuICovXG5cblxuZnVuY3Rpb24gcmVtb3ZlV2hpbGUobm9kZSwgcHJlZCkge1xuICB3aGlsZSAobm9kZSkge1xuICAgIGlmIChpc0VkaXRhYmxlKG5vZGUpIHx8ICFwcmVkKG5vZGUpKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuICAgIHJlbW92ZShub2RlKTtcbiAgICBub2RlID0gcGFyZW50O1xuICB9XG59XG4vKipcbiAqIEBtZXRob2QgcmVwbGFjZVxuICpcbiAqIHJlcGxhY2Ugbm9kZSB3aXRoIHByb3ZpZGVkIG5vZGVOYW1lXG4gKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcGFyYW0ge1N0cmluZ30gbm9kZU5hbWVcbiAqIEByZXR1cm4ge05vZGV9IC0gbmV3IG5vZGVcbiAqL1xuXG5cbmZ1bmN0aW9uIGRvbV9yZXBsYWNlKG5vZGUsIG5vZGVOYW1lKSB7XG4gIGlmIChub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5vZGVOYW1lLnRvVXBwZXJDYXNlKCkpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIHZhciBuZXdOb2RlID0gZG9tX2NyZWF0ZShub2RlTmFtZSk7XG5cbiAgaWYgKG5vZGUuc3R5bGUuY3NzVGV4dCkge1xuICAgIG5ld05vZGUuc3R5bGUuY3NzVGV4dCA9IG5vZGUuc3R5bGUuY3NzVGV4dDtcbiAgfVxuXG4gIGFwcGVuZENoaWxkTm9kZXMobmV3Tm9kZSwgbGlzdHMuZnJvbShub2RlLmNoaWxkTm9kZXMpKTtcbiAgaW5zZXJ0QWZ0ZXIobmV3Tm9kZSwgbm9kZSk7XG4gIHJlbW92ZShub2RlKTtcbiAgcmV0dXJuIG5ld05vZGU7XG59XG5cbnZhciBpc1RleHRhcmVhID0gbWFrZVByZWRCeU5vZGVOYW1lKCdURVhUQVJFQScpO1xuLyoqXG4gKiBAcGFyYW0ge2pRdWVyeX0gJG5vZGVcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gW3N0cmlwTGluZWJyZWFrc10gLSBkZWZhdWx0OiBmYWxzZVxuICovXG5cbmZ1bmN0aW9uIGRvbV92YWx1ZSgkbm9kZSwgc3RyaXBMaW5lYnJlYWtzKSB7XG4gIHZhciB2YWwgPSBpc1RleHRhcmVhKCRub2RlWzBdKSA/ICRub2RlLnZhbCgpIDogJG5vZGUuaHRtbCgpO1xuXG4gIGlmIChzdHJpcExpbmVicmVha3MpIHtcbiAgICByZXR1cm4gdmFsLnJlcGxhY2UoL1tcXG5cXHJdL2csICcnKTtcbiAgfVxuXG4gIHJldHVybiB2YWw7XG59XG4vKipcbiAqIEBtZXRob2QgaHRtbFxuICpcbiAqIGdldCB0aGUgSFRNTCBjb250ZW50cyBvZiBub2RlXG4gKlxuICogQHBhcmFtIHtqUXVlcnl9ICRub2RlXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtpc05ld2xpbmVPbkJsb2NrXVxuICovXG5cblxuZnVuY3Rpb24gZG9tX2h0bWwoJG5vZGUsIGlzTmV3bGluZU9uQmxvY2spIHtcbiAgdmFyIG1hcmt1cCA9IGRvbV92YWx1ZSgkbm9kZSk7XG5cbiAgaWYgKGlzTmV3bGluZU9uQmxvY2spIHtcbiAgICB2YXIgcmVnZXhUYWcgPSAvPChcXC8/KShcXGIoPyEhKVtePlxcc10qKSguKj8pKFxccypcXC8/PikvZztcbiAgICBtYXJrdXAgPSBtYXJrdXAucmVwbGFjZShyZWdleFRhZywgZnVuY3Rpb24gKG1hdGNoLCBlbmRTbGFzaCwgbmFtZSkge1xuICAgICAgbmFtZSA9IG5hbWUudG9VcHBlckNhc2UoKTtcbiAgICAgIHZhciBpc0VuZE9mSW5saW5lQ29udGFpbmVyID0gL15ESVZ8XlREfF5USHxeUHxeTEl8XkhbMS03XS8udGVzdChuYW1lKSAmJiAhIWVuZFNsYXNoO1xuICAgICAgdmFyIGlzQmxvY2tOb2RlID0gL15CTE9DS1FVT1RFfF5UQUJMRXxeVEJPRFl8XlRSfF5IUnxeVUx8Xk9MLy50ZXN0KG5hbWUpO1xuICAgICAgcmV0dXJuIG1hdGNoICsgKGlzRW5kT2ZJbmxpbmVDb250YWluZXIgfHwgaXNCbG9ja05vZGUgPyAnXFxuJyA6ICcnKTtcbiAgICB9KTtcbiAgICBtYXJrdXAgPSBtYXJrdXAudHJpbSgpO1xuICB9XG5cbiAgcmV0dXJuIG1hcmt1cDtcbn1cblxuZnVuY3Rpb24gcG9zRnJvbVBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyKSB7XG4gIHZhciAkcGxhY2Vob2xkZXIgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShwbGFjZWhvbGRlcik7XG4gIHZhciBwb3MgPSAkcGxhY2Vob2xkZXIub2Zmc2V0KCk7XG4gIHZhciBoZWlnaHQgPSAkcGxhY2Vob2xkZXIub3V0ZXJIZWlnaHQodHJ1ZSk7IC8vIGluY2x1ZGUgbWFyZ2luXG5cbiAgcmV0dXJuIHtcbiAgICBsZWZ0OiBwb3MubGVmdCxcbiAgICB0b3A6IHBvcy50b3AgKyBoZWlnaHRcbiAgfTtcbn1cblxuZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCRub2RlLCBldmVudHMpIHtcbiAgT2JqZWN0LmtleXMoZXZlbnRzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAkbm9kZS5vbihrZXksIGV2ZW50c1trZXldKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRldGFjaEV2ZW50cygkbm9kZSwgZXZlbnRzKSB7XG4gIE9iamVjdC5rZXlzKGV2ZW50cykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgJG5vZGUub2ZmKGtleSwgZXZlbnRzW2tleV0pO1xuICB9KTtcbn1cbi8qKlxuICogQG1ldGhvZCBpc0N1c3RvbVN0eWxlVGFnXG4gKlxuICogYXNzZXJ0IGlmIGEgbm9kZSBjb250YWlucyBhIFwibm90ZS1zdHlsZXRhZ1wiIGNsYXNzLFxuICogd2hpY2ggaW1wbGllcyB0aGF0J3MgYSBjdXN0b20tbWFkZSBzdHlsZSB0YWcgbm9kZVxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gYW4gSFRNTCBET00gbm9kZVxuICovXG5cblxuZnVuY3Rpb24gaXNDdXN0b21TdHlsZVRhZyhub2RlKSB7XG4gIHJldHVybiBub2RlICYmICFpc1RleHQobm9kZSkgJiYgbGlzdHMuY29udGFpbnMobm9kZS5jbGFzc0xpc3QsICdub3RlLXN0eWxldGFnJyk7XG59XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGRvbSA9ICh7XG4gIC8qKiBAcHJvcGVydHkge1N0cmluZ30gTkJTUF9DSEFSICovXG4gIE5CU1BfQ0hBUjogTkJTUF9DSEFSLFxuXG4gIC8qKiBAcHJvcGVydHkge1N0cmluZ30gWkVST19XSURUSF9OQlNQX0NIQVIgKi9cbiAgWkVST19XSURUSF9OQlNQX0NIQVI6IFpFUk9fV0lEVEhfTkJTUF9DSEFSLFxuXG4gIC8qKiBAcHJvcGVydHkge1N0cmluZ30gYmxhbmsgKi9cbiAgYmxhbms6IGJsYW5rSFRNTCxcblxuICAvKiogQHByb3BlcnR5IHtTdHJpbmd9IGVtcHR5UGFyYSAqL1xuICBlbXB0eVBhcmE6IFwiPHA+XCIuY29uY2F0KGJsYW5rSFRNTCwgXCI8L3A+XCIpLFxuICBtYWtlUHJlZEJ5Tm9kZU5hbWU6IG1ha2VQcmVkQnlOb2RlTmFtZSxcbiAgaXNFZGl0YWJsZTogaXNFZGl0YWJsZSxcbiAgaXNDb250cm9sU2l6aW5nOiBpc0NvbnRyb2xTaXppbmcsXG4gIGlzVGV4dDogaXNUZXh0LFxuICBpc0VsZW1lbnQ6IGlzRWxlbWVudCxcbiAgaXNWb2lkOiBpc1ZvaWQsXG4gIGlzUGFyYTogaXNQYXJhLFxuICBpc1B1cmVQYXJhOiBpc1B1cmVQYXJhLFxuICBpc0hlYWRpbmc6IGlzSGVhZGluZyxcbiAgaXNJbmxpbmU6IGRvbV9pc0lubGluZSxcbiAgaXNCbG9jazogZnVuYy5ub3QoZG9tX2lzSW5saW5lKSxcbiAgaXNCb2R5SW5saW5lOiBpc0JvZHlJbmxpbmUsXG4gIGlzQm9keTogaXNCb2R5LFxuICBpc1BhcmFJbmxpbmU6IGlzUGFyYUlubGluZSxcbiAgaXNQcmU6IGlzUHJlLFxuICBpc0xpc3Q6IGlzTGlzdCxcbiAgaXNUYWJsZTogaXNUYWJsZSxcbiAgaXNEYXRhOiBpc0RhdGEsXG4gIGlzQ2VsbDogZG9tX2lzQ2VsbCxcbiAgaXNCbG9ja3F1b3RlOiBpc0Jsb2NrcXVvdGUsXG4gIGlzQm9keUNvbnRhaW5lcjogaXNCb2R5Q29udGFpbmVyLFxuICBpc0FuY2hvcjogaXNBbmNob3IsXG4gIGlzRGl2OiBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0RJVicpLFxuICBpc0xpOiBpc0xpLFxuICBpc0JSOiBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0JSJyksXG4gIGlzU3BhbjogbWFrZVByZWRCeU5vZGVOYW1lKCdTUEFOJyksXG4gIGlzQjogbWFrZVByZWRCeU5vZGVOYW1lKCdCJyksXG4gIGlzVTogbWFrZVByZWRCeU5vZGVOYW1lKCdVJyksXG4gIGlzUzogbWFrZVByZWRCeU5vZGVOYW1lKCdTJyksXG4gIGlzSTogbWFrZVByZWRCeU5vZGVOYW1lKCdJJyksXG4gIGlzSW1nOiBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0lNRycpLFxuICBpc1RleHRhcmVhOiBpc1RleHRhcmVhLFxuICBkZWVwZXN0Q2hpbGRJc0VtcHR5OiBkZWVwZXN0Q2hpbGRJc0VtcHR5LFxuICBpc0VtcHR5OiBkb21faXNFbXB0eSxcbiAgaXNFbXB0eUFuY2hvcjogZnVuYy5hbmQoaXNBbmNob3IsIGRvbV9pc0VtcHR5KSxcbiAgaXNDbG9zZXN0U2libGluZzogaXNDbG9zZXN0U2libGluZyxcbiAgd2l0aENsb3Nlc3RTaWJsaW5nczogd2l0aENsb3Nlc3RTaWJsaW5ncyxcbiAgbm9kZUxlbmd0aDogbm9kZUxlbmd0aCxcbiAgaXNMZWZ0RWRnZVBvaW50OiBpc0xlZnRFZGdlUG9pbnQsXG4gIGlzUmlnaHRFZGdlUG9pbnQ6IGlzUmlnaHRFZGdlUG9pbnQsXG4gIGlzRWRnZVBvaW50OiBpc0VkZ2VQb2ludCxcbiAgaXNMZWZ0RWRnZU9mOiBkb21faXNMZWZ0RWRnZU9mLFxuICBpc1JpZ2h0RWRnZU9mOiBpc1JpZ2h0RWRnZU9mLFxuICBpc0xlZnRFZGdlUG9pbnRPZjogaXNMZWZ0RWRnZVBvaW50T2YsXG4gIGlzUmlnaHRFZGdlUG9pbnRPZjogaXNSaWdodEVkZ2VQb2ludE9mLFxuICBwcmV2UG9pbnQ6IGRvbV9wcmV2UG9pbnQsXG4gIG5leHRQb2ludDogZG9tX25leHRQb2ludCxcbiAgbmV4dFBvaW50V2l0aEVtcHR5Tm9kZTogbmV4dFBvaW50V2l0aEVtcHR5Tm9kZSxcbiAgaXNTYW1lUG9pbnQ6IGlzU2FtZVBvaW50LFxuICBpc1Zpc2libGVQb2ludDogaXNWaXNpYmxlUG9pbnQsXG4gIHByZXZQb2ludFVudGlsOiBwcmV2UG9pbnRVbnRpbCxcbiAgbmV4dFBvaW50VW50aWw6IG5leHRQb2ludFVudGlsLFxuICBpc0NoYXJQb2ludDogaXNDaGFyUG9pbnQsXG4gIGlzU3BhY2VQb2ludDogaXNTcGFjZVBvaW50LFxuICB3YWxrUG9pbnQ6IHdhbGtQb2ludCxcbiAgYW5jZXN0b3I6IGRvbV9hbmNlc3RvcixcbiAgc2luZ2xlQ2hpbGRBbmNlc3Rvcjogc2luZ2xlQ2hpbGRBbmNlc3RvcixcbiAgbGlzdEFuY2VzdG9yOiBsaXN0QW5jZXN0b3IsXG4gIGxhc3RBbmNlc3RvcjogbGFzdEFuY2VzdG9yLFxuICBsaXN0TmV4dDogbGlzdE5leHQsXG4gIGxpc3RQcmV2OiBsaXN0UHJldixcbiAgbGlzdERlc2NlbmRhbnQ6IGxpc3REZXNjZW5kYW50LFxuICBjb21tb25BbmNlc3RvcjogZG9tX2NvbW1vbkFuY2VzdG9yLFxuICB3cmFwOiB3cmFwLFxuICBpbnNlcnRBZnRlcjogaW5zZXJ0QWZ0ZXIsXG4gIGFwcGVuZENoaWxkTm9kZXM6IGFwcGVuZENoaWxkTm9kZXMsXG4gIHBvc2l0aW9uOiBkb21fcG9zaXRpb24sXG4gIGhhc0NoaWxkcmVuOiBoYXNDaGlsZHJlbixcbiAgbWFrZU9mZnNldFBhdGg6IG1ha2VPZmZzZXRQYXRoLFxuICBmcm9tT2Zmc2V0UGF0aDogZnJvbU9mZnNldFBhdGgsXG4gIHNwbGl0VHJlZTogc3BsaXRUcmVlLFxuICBzcGxpdFBvaW50OiBzcGxpdFBvaW50LFxuICBjcmVhdGU6IGRvbV9jcmVhdGUsXG4gIGNyZWF0ZVRleHQ6IGNyZWF0ZVRleHQsXG4gIHJlbW92ZTogcmVtb3ZlLFxuICByZW1vdmVXaGlsZTogcmVtb3ZlV2hpbGUsXG4gIHJlcGxhY2U6IGRvbV9yZXBsYWNlLFxuICBodG1sOiBkb21faHRtbCxcbiAgdmFsdWU6IGRvbV92YWx1ZSxcbiAgcG9zRnJvbVBsYWNlaG9sZGVyOiBwb3NGcm9tUGxhY2Vob2xkZXIsXG4gIGF0dGFjaEV2ZW50czogYXR0YWNoRXZlbnRzLFxuICBkZXRhY2hFdmVudHM6IGRldGFjaEV2ZW50cyxcbiAgaXNDdXN0b21TdHlsZVRhZzogaXNDdXN0b21TdHlsZVRhZ1xufSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL0NvbnRleHQuanNcbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxuXG5cbnZhciBDb250ZXh0X0NvbnRleHQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICAvKipcbiAgICogQHBhcmFtIHtqUXVlcnl9ICRub3RlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqL1xuICBmdW5jdGlvbiBDb250ZXh0KCRub3RlLCBvcHRpb25zKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRleHQpO1xuXG4gICAgdGhpcy4kbm90ZSA9ICRub3RlO1xuICAgIHRoaXMubWVtb3MgPSB7fTtcbiAgICB0aGlzLm1vZHVsZXMgPSB7fTtcbiAgICB0aGlzLmxheW91dEluZm8gPSB7fTtcbiAgICB0aGlzLm9wdGlvbnMgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5leHRlbmQodHJ1ZSwge30sIG9wdGlvbnMpOyAvLyBpbml0IHVpIHdpdGggb3B0aW9uc1xuXG4gICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZS51aSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUudWlfdGVtcGxhdGUodGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnVpID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZS51aTtcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgfVxuICAvKipcbiAgICogY3JlYXRlIGxheW91dCBhbmQgaW5pdGlhbGl6ZSBtb2R1bGVzIGFuZCBvdGhlciByZXNvdXJjZXNcbiAgICovXG5cblxuICBfY3JlYXRlQ2xhc3MoQ29udGV4dCwgW3tcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdGhpcy5sYXlvdXRJbmZvID0gdGhpcy51aS5jcmVhdGVMYXlvdXQodGhpcy4kbm90ZSk7XG5cbiAgICAgIHRoaXMuX2luaXRpYWxpemUoKTtcblxuICAgICAgdGhpcy4kbm90ZS5oaWRlKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogZGVzdHJveSBtb2R1bGVzIGFuZCBvdGhlciByZXNvdXJjZXMgYW5kIHJlbW92ZSBsYXlvdXRcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImRlc3Ryb3lcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHRoaXMuX2Rlc3Ryb3koKTtcblxuICAgICAgdGhpcy4kbm90ZS5yZW1vdmVEYXRhKCdzdW1tZXJub3RlJyk7XG4gICAgICB0aGlzLnVpLnJlbW92ZUxheW91dCh0aGlzLiRub3RlLCB0aGlzLmxheW91dEluZm8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBkZXN0b3J5IG1vZHVsZXMgYW5kIG90aGVyIHJlc291cmNlcyBhbmQgaW5pdGlhbGl6ZSBpdCBhZ2FpblxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicmVzZXRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICB2YXIgZGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQoKTtcbiAgICAgIHRoaXMuY29kZShkb20uZW1wdHlQYXJhKTtcblxuICAgICAgdGhpcy5fZGVzdHJveSgpO1xuXG4gICAgICB0aGlzLl9pbml0aWFsaXplKCk7XG5cbiAgICAgIGlmIChkaXNhYmxlZCkge1xuICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiX2luaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX2luaXRpYWxpemUoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAvLyBzZXQgb3duIGlkXG4gICAgICB0aGlzLm9wdGlvbnMuaWQgPSBmdW5jLnVuaXF1ZUlkKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLm5vdygpKTsgLy8gc2V0IGRlZmF1bHQgY29udGFpbmVyIGZvciB0b29sdGlwcywgcG9wb3ZlcnMsIGFuZCBkaWFsb2dzXG5cbiAgICAgIHRoaXMub3B0aW9ucy5jb250YWluZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyIHx8IHRoaXMubGF5b3V0SW5mby5lZGl0b3I7IC8vIGFkZCBvcHRpb25hbCBidXR0b25zXG5cbiAgICAgIHZhciBidXR0b25zID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMuYnV0dG9ucyk7XG4gICAgICBPYmplY3Qua2V5cyhidXR0b25zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgX3RoaXMubWVtbygnYnV0dG9uLicgKyBrZXksIGJ1dHRvbnNba2V5XSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBtb2R1bGVzID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMubW9kdWxlcywgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZS5wbHVnaW5zIHx8IHt9KTsgLy8gYWRkIGFuZCBpbml0aWFsaXplIG1vZHVsZXNcblxuICAgICAgT2JqZWN0LmtleXMobW9kdWxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF90aGlzLm1vZHVsZShrZXksIG1vZHVsZXNba2V5XSwgdHJ1ZSk7XG4gICAgICB9KTtcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMubW9kdWxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF90aGlzLmluaXRpYWxpemVNb2R1bGUoa2V5KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJfZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVzdHJveSgpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICAvLyBkZXN0cm95IG1vZHVsZXMgd2l0aCByZXZlcnNlZCBvcmRlclxuICAgICAgT2JqZWN0LmtleXModGhpcy5tb2R1bGVzKS5yZXZlcnNlKCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF90aGlzMi5yZW1vdmVNb2R1bGUoa2V5KTtcbiAgICAgIH0pO1xuICAgICAgT2JqZWN0LmtleXModGhpcy5tZW1vcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF90aGlzMi5yZW1vdmVNZW1vKGtleSk7XG4gICAgICB9KTsgLy8gdHJpZ2dlciBjdXN0b20gb25EZXN0cm95IGNhbGxiYWNrXG5cbiAgICAgIHRoaXMudHJpZ2dlckV2ZW50KCdkZXN0cm95JywgdGhpcyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImNvZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY29kZShodG1sKSB7XG4gICAgICB2YXIgaXNBY3RpdmF0ZWQgPSB0aGlzLmludm9rZSgnY29kZXZpZXcuaXNBY3RpdmF0ZWQnKTtcblxuICAgICAgaWYgKGh0bWwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmludm9rZSgnY29kZXZpZXcuc3luYycpO1xuICAgICAgICByZXR1cm4gaXNBY3RpdmF0ZWQgPyB0aGlzLmxheW91dEluZm8uY29kYWJsZS52YWwoKSA6IHRoaXMubGF5b3V0SW5mby5lZGl0YWJsZS5odG1sKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNBY3RpdmF0ZWQpIHtcbiAgICAgICAgICB0aGlzLmludm9rZSgnY29kZXZpZXcuc3luYycsIGh0bWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubGF5b3V0SW5mby5lZGl0YWJsZS5odG1sKGh0bWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy4kbm90ZS52YWwoaHRtbCk7XG4gICAgICAgIHRoaXMudHJpZ2dlckV2ZW50KCdjaGFuZ2UnLCBodG1sLCB0aGlzLmxheW91dEluZm8uZWRpdGFibGUpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpc0Rpc2FibGVkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGlzRGlzYWJsZWQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5sYXlvdXRJbmZvLmVkaXRhYmxlLmF0dHIoJ2NvbnRlbnRlZGl0YWJsZScpID09PSAnZmFsc2UnO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJlbmFibGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkge1xuICAgICAgdGhpcy5sYXlvdXRJbmZvLmVkaXRhYmxlLmF0dHIoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpO1xuICAgICAgdGhpcy5pbnZva2UoJ3Rvb2xiYXIuYWN0aXZhdGUnLCB0cnVlKTtcbiAgICAgIHRoaXMudHJpZ2dlckV2ZW50KCdkaXNhYmxlJywgZmFsc2UpO1xuICAgICAgdGhpcy5vcHRpb25zLmVkaXRpbmcgPSB0cnVlO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkaXNhYmxlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7XG4gICAgICAvLyBjbG9zZSBjb2RldmlldyBpZiBjb2RldmlldyBpcyBvcGVuZFxuICAgICAgaWYgKHRoaXMuaW52b2tlKCdjb2Rldmlldy5pc0FjdGl2YXRlZCcpKSB7XG4gICAgICAgIHRoaXMuaW52b2tlKCdjb2Rldmlldy5kZWFjdGl2YXRlJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubGF5b3V0SW5mby5lZGl0YWJsZS5hdHRyKCdjb250ZW50ZWRpdGFibGUnLCBmYWxzZSk7XG4gICAgICB0aGlzLm9wdGlvbnMuZWRpdGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5pbnZva2UoJ3Rvb2xiYXIuZGVhY3RpdmF0ZScsIHRydWUpO1xuICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoJ2Rpc2FibGUnLCB0cnVlKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwidHJpZ2dlckV2ZW50XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXJFdmVudCgpIHtcbiAgICAgIHZhciBuYW1lc3BhY2UgPSBsaXN0cy5oZWFkKGFyZ3VtZW50cyk7XG4gICAgICB2YXIgYXJncyA9IGxpc3RzLnRhaWwobGlzdHMuZnJvbShhcmd1bWVudHMpKTtcbiAgICAgIHZhciBjYWxsYmFjayA9IHRoaXMub3B0aW9ucy5jYWxsYmFja3NbZnVuYy5uYW1lc3BhY2VUb0NhbWVsKG5hbWVzcGFjZSwgJ29uJyldO1xuXG4gICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcy4kbm90ZVswXSwgYXJncyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuJG5vdGUudHJpZ2dlcignc3VtbWVybm90ZS4nICsgbmFtZXNwYWNlLCBhcmdzKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZU1vZHVsZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplTW9kdWxlKGtleSkge1xuICAgICAgdmFyIG1vZHVsZSA9IHRoaXMubW9kdWxlc1trZXldO1xuICAgICAgbW9kdWxlLnNob3VsZEluaXRpYWxpemUgPSBtb2R1bGUuc2hvdWxkSW5pdGlhbGl6ZSB8fCBmdW5jLm9rO1xuXG4gICAgICBpZiAoIW1vZHVsZS5zaG91bGRJbml0aWFsaXplKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBpbml0aWFsaXplIG1vZHVsZVxuXG5cbiAgICAgIGlmIChtb2R1bGUuaW5pdGlhbGl6ZSkge1xuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfSAvLyBhdHRhY2ggZXZlbnRzXG5cblxuICAgICAgaWYgKG1vZHVsZS5ldmVudHMpIHtcbiAgICAgICAgZG9tLmF0dGFjaEV2ZW50cyh0aGlzLiRub3RlLCBtb2R1bGUuZXZlbnRzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwibW9kdWxlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG1vZHVsZShrZXksIE1vZHVsZUNsYXNzLCB3aXRob3V0SW50aWFsaXplKSB7XG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2R1bGVzW2tleV07XG4gICAgICB9XG5cbiAgICAgIHRoaXMubW9kdWxlc1trZXldID0gbmV3IE1vZHVsZUNsYXNzKHRoaXMpO1xuXG4gICAgICBpZiAoIXdpdGhvdXRJbnRpYWxpemUpIHtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplTW9kdWxlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInJlbW92ZU1vZHVsZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVNb2R1bGUoa2V5KSB7XG4gICAgICB2YXIgbW9kdWxlID0gdGhpcy5tb2R1bGVzW2tleV07XG5cbiAgICAgIGlmIChtb2R1bGUuc2hvdWxkSW5pdGlhbGl6ZSgpKSB7XG4gICAgICAgIGlmIChtb2R1bGUuZXZlbnRzKSB7XG4gICAgICAgICAgZG9tLmRldGFjaEV2ZW50cyh0aGlzLiRub3RlLCBtb2R1bGUuZXZlbnRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2R1bGUuZGVzdHJveSkge1xuICAgICAgICAgIG1vZHVsZS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZGVsZXRlIHRoaXMubW9kdWxlc1trZXldO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJtZW1vXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG1lbW8oa2V5LCBvYmopIHtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1lbW9zW2tleV07XG4gICAgICB9XG5cbiAgICAgIHRoaXMubWVtb3Nba2V5XSA9IG9iajtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwicmVtb3ZlTWVtb1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVNZW1vKGtleSkge1xuICAgICAgaWYgKHRoaXMubWVtb3Nba2V5XSAmJiB0aGlzLm1lbW9zW2tleV0uZGVzdHJveSkge1xuICAgICAgICB0aGlzLm1lbW9zW2tleV0uZGVzdHJveSgpO1xuICAgICAgfVxuXG4gICAgICBkZWxldGUgdGhpcy5tZW1vc1trZXldO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTb21lIGJ1dHRvbnMgbmVlZCB0byBjaGFuZ2UgdGhlaXIgdmlzdWFsIHN0eWxlIGltbWVkaWF0ZWx5IG9uY2UgdGhleSBnZXQgcHJlc3NlZFxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY3JlYXRlSW52b2tlSGFuZGxlckFuZFVwZGF0ZVN0YXRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUludm9rZUhhbmRsZXJBbmRVcGRhdGVTdGF0ZShuYW1lc3BhY2UsIHZhbHVlKSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBfdGhpczMuY3JlYXRlSW52b2tlSGFuZGxlcihuYW1lc3BhY2UsIHZhbHVlKShldmVudCk7XG5cbiAgICAgICAgX3RoaXMzLmludm9rZSgnYnV0dG9ucy51cGRhdGVDdXJyZW50U3R5bGUnKTtcbiAgICAgIH07XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImNyZWF0ZUludm9rZUhhbmRsZXJcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlSW52b2tlSGFuZGxlcihuYW1lc3BhY2UsIHZhbHVlKSB7XG4gICAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgJHRhcmdldCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgX3RoaXM0Lmludm9rZShuYW1lc3BhY2UsIHZhbHVlIHx8ICR0YXJnZXQuY2xvc2VzdCgnW2RhdGEtdmFsdWVdJykuZGF0YSgndmFsdWUnKSwgJHRhcmdldCk7XG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpbnZva2VcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW52b2tlKCkge1xuICAgICAgdmFyIG5hbWVzcGFjZSA9IGxpc3RzLmhlYWQoYXJndW1lbnRzKTtcbiAgICAgIHZhciBhcmdzID0gbGlzdHMudGFpbChsaXN0cy5mcm9tKGFyZ3VtZW50cykpO1xuICAgICAgdmFyIHNwbGl0cyA9IG5hbWVzcGFjZS5zcGxpdCgnLicpO1xuICAgICAgdmFyIGhhc1NlcGFyYXRvciA9IHNwbGl0cy5sZW5ndGggPiAxO1xuICAgICAgdmFyIG1vZHVsZU5hbWUgPSBoYXNTZXBhcmF0b3IgJiYgbGlzdHMuaGVhZChzcGxpdHMpO1xuICAgICAgdmFyIG1ldGhvZE5hbWUgPSBoYXNTZXBhcmF0b3IgPyBsaXN0cy5sYXN0KHNwbGl0cykgOiBsaXN0cy5oZWFkKHNwbGl0cyk7XG4gICAgICB2YXIgbW9kdWxlID0gdGhpcy5tb2R1bGVzW21vZHVsZU5hbWUgfHwgJ2VkaXRvciddO1xuXG4gICAgICBpZiAoIW1vZHVsZU5hbWUgJiYgdGhpc1ttZXRob2ROYW1lXSkge1xuICAgICAgICByZXR1cm4gdGhpc1ttZXRob2ROYW1lXS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgIH0gZWxzZSBpZiAobW9kdWxlICYmIG1vZHVsZVttZXRob2ROYW1lXSAmJiBtb2R1bGUuc2hvdWxkSW5pdGlhbGl6ZSgpKSB7XG4gICAgICAgIHJldHVybiBtb2R1bGVbbWV0aG9kTmFtZV0uYXBwbHkobW9kdWxlLCBhcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQ29udGV4dDtcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9zdW1tZXJub3RlLmpzXG5cblxuXG5cbmV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmZuLmV4dGVuZCh7XG4gIC8qKlxuICAgKiBTdW1tZXJub3RlIEFQSVxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9XG4gICAqIEByZXR1cm4ge3RoaXN9XG4gICAqL1xuICBzdW1tZXJub3RlOiBmdW5jdGlvbiBzdW1tZXJub3RlKCkge1xuICAgIHZhciB0eXBlID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEudHlwZShsaXN0cy5oZWFkKGFyZ3VtZW50cykpO1xuICAgIHZhciBpc0V4dGVybmFsQVBJQ2FsbGVkID0gdHlwZSA9PT0gJ3N0cmluZyc7XG4gICAgdmFyIGhhc0luaXRPcHRpb25zID0gdHlwZSA9PT0gJ29iamVjdCc7XG4gICAgdmFyIG9wdGlvbnMgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5leHRlbmQoe30sIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUub3B0aW9ucywgaGFzSW5pdE9wdGlvbnMgPyBsaXN0cy5oZWFkKGFyZ3VtZW50cykgOiB7fSk7IC8vIFVwZGF0ZSBvcHRpb25zXG5cbiAgICBvcHRpb25zLmxhbmdJbmZvID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZXh0ZW5kKHRydWUsIHt9LCBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLmxhbmdbJ2VuLVVTJ10sIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUubGFuZ1tvcHRpb25zLmxhbmddKTtcbiAgICBvcHRpb25zLmljb25zID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZXh0ZW5kKHRydWUsIHt9LCBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLm9wdGlvbnMuaWNvbnMsIG9wdGlvbnMuaWNvbnMpO1xuICAgIG9wdGlvbnMudG9vbHRpcCA9IG9wdGlvbnMudG9vbHRpcCA9PT0gJ2F1dG8nID8gIWVudi5pc1N1cHBvcnRUb3VjaCA6IG9wdGlvbnMudG9vbHRpcDtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGlkeCwgbm90ZSkge1xuICAgICAgdmFyICRub3RlID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkobm90ZSk7XG5cbiAgICAgIGlmICghJG5vdGUuZGF0YSgnc3VtbWVybm90ZScpKSB7XG4gICAgICAgIHZhciBjb250ZXh0ID0gbmV3IENvbnRleHRfQ29udGV4dCgkbm90ZSwgb3B0aW9ucyk7XG4gICAgICAgICRub3RlLmRhdGEoJ3N1bW1lcm5vdGUnLCBjb250ZXh0KTtcbiAgICAgICAgJG5vdGUuZGF0YSgnc3VtbWVybm90ZScpLnRyaWdnZXJFdmVudCgnaW5pdCcsIGNvbnRleHQubGF5b3V0SW5mbyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdmFyICRub3RlID0gdGhpcy5maXJzdCgpO1xuXG4gICAgaWYgKCRub3RlLmxlbmd0aCkge1xuICAgICAgdmFyIGNvbnRleHQgPSAkbm90ZS5kYXRhKCdzdW1tZXJub3RlJyk7XG5cbiAgICAgIGlmIChpc0V4dGVybmFsQVBJQ2FsbGVkKSB7XG4gICAgICAgIHJldHVybiBjb250ZXh0Lmludm9rZS5hcHBseShjb250ZXh0LCBsaXN0cy5mcm9tKGFyZ3VtZW50cykpO1xuICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmZvY3VzKSB7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IuZm9jdXMnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL2NvcmUvcmFuZ2UuanNcbmZ1bmN0aW9uIHJhbmdlX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gcmFuZ2VfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIHJhbmdlX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgcmFuZ2VfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIHJhbmdlX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cblxuXG4vKipcbiAqIHJldHVybiBib3VuZGFyeVBvaW50IGZyb20gVGV4dFJhbmdlLCBpbnNwaXJlZCBieSBBbmR5IE5hJ3MgSHVza3lSYW5nZS5qc1xuICpcbiAqIEBwYXJhbSB7VGV4dFJhbmdlfSB0ZXh0UmFuZ2VcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNTdGFydFxuICogQHJldHVybiB7Qm91bmRhcnlQb2ludH1cbiAqXG4gKiBAc2VlIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9tczUzNTg3Mih2PXZzLjg1KS5hc3B4XG4gKi9cblxuZnVuY3Rpb24gdGV4dFJhbmdlVG9Qb2ludCh0ZXh0UmFuZ2UsIGlzU3RhcnQpIHtcbiAgdmFyIGNvbnRhaW5lciA9IHRleHRSYW5nZS5wYXJlbnRFbGVtZW50KCk7XG4gIHZhciBvZmZzZXQ7XG4gIHZhciB0ZXN0ZXIgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuICB2YXIgcHJldkNvbnRhaW5lcjtcbiAgdmFyIGNoaWxkTm9kZXMgPSBsaXN0cy5mcm9tKGNvbnRhaW5lci5jaGlsZE5vZGVzKTtcblxuICBmb3IgKG9mZnNldCA9IDA7IG9mZnNldCA8IGNoaWxkTm9kZXMubGVuZ3RoOyBvZmZzZXQrKykge1xuICAgIGlmIChkb20uaXNUZXh0KGNoaWxkTm9kZXNbb2Zmc2V0XSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIHRlc3Rlci5tb3ZlVG9FbGVtZW50VGV4dChjaGlsZE5vZGVzW29mZnNldF0pO1xuXG4gICAgaWYgKHRlc3Rlci5jb21wYXJlRW5kUG9pbnRzKCdTdGFydFRvU3RhcnQnLCB0ZXh0UmFuZ2UpID49IDApIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHByZXZDb250YWluZXIgPSBjaGlsZE5vZGVzW29mZnNldF07XG4gIH1cblxuICBpZiAob2Zmc2V0ICE9PSAwICYmIGRvbS5pc1RleHQoY2hpbGROb2Rlc1tvZmZzZXQgLSAxXSkpIHtcbiAgICB2YXIgdGV4dFJhbmdlU3RhcnQgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuICAgIHZhciBjdXJUZXh0Tm9kZSA9IG51bGw7XG4gICAgdGV4dFJhbmdlU3RhcnQubW92ZVRvRWxlbWVudFRleHQocHJldkNvbnRhaW5lciB8fCBjb250YWluZXIpO1xuICAgIHRleHRSYW5nZVN0YXJ0LmNvbGxhcHNlKCFwcmV2Q29udGFpbmVyKTtcbiAgICBjdXJUZXh0Tm9kZSA9IHByZXZDb250YWluZXIgPyBwcmV2Q29udGFpbmVyLm5leHRTaWJsaW5nIDogY29udGFpbmVyLmZpcnN0Q2hpbGQ7XG4gICAgdmFyIHBvaW50VGVzdGVyID0gdGV4dFJhbmdlLmR1cGxpY2F0ZSgpO1xuICAgIHBvaW50VGVzdGVyLnNldEVuZFBvaW50KCdTdGFydFRvU3RhcnQnLCB0ZXh0UmFuZ2VTdGFydCk7XG4gICAgdmFyIHRleHRDb3VudCA9IHBvaW50VGVzdGVyLnRleHQucmVwbGFjZSgvW1xcclxcbl0vZywgJycpLmxlbmd0aDtcblxuICAgIHdoaWxlICh0ZXh0Q291bnQgPiBjdXJUZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoICYmIGN1clRleHROb2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICB0ZXh0Q291bnQgLT0gY3VyVGV4dE5vZGUubm9kZVZhbHVlLmxlbmd0aDtcbiAgICAgIGN1clRleHROb2RlID0gY3VyVGV4dE5vZGUubmV4dFNpYmxpbmc7XG4gICAgfSAvLyBbd29ya2Fyb3VuZF0gZW5mb3JjZSBJRSB0byByZS1yZWZlcmVuY2UgY3VyVGV4dE5vZGUsIGhhY2tcblxuXG4gICAgdmFyIGR1bW15ID0gY3VyVGV4dE5vZGUubm9kZVZhbHVlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cbiAgICBpZiAoaXNTdGFydCAmJiBjdXJUZXh0Tm9kZS5uZXh0U2libGluZyAmJiBkb20uaXNUZXh0KGN1clRleHROb2RlLm5leHRTaWJsaW5nKSAmJiB0ZXh0Q291bnQgPT09IGN1clRleHROb2RlLm5vZGVWYWx1ZS5sZW5ndGgpIHtcbiAgICAgIHRleHRDb3VudCAtPSBjdXJUZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoO1xuICAgICAgY3VyVGV4dE5vZGUgPSBjdXJUZXh0Tm9kZS5uZXh0U2libGluZztcbiAgICB9XG5cbiAgICBjb250YWluZXIgPSBjdXJUZXh0Tm9kZTtcbiAgICBvZmZzZXQgPSB0ZXh0Q291bnQ7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNvbnQ6IGNvbnRhaW5lcixcbiAgICBvZmZzZXQ6IG9mZnNldFxuICB9O1xufVxuLyoqXG4gKiByZXR1cm4gVGV4dFJhbmdlIGZyb20gYm91bmRhcnkgcG9pbnQgKGluc3BpcmVkIGJ5IGdvb2dsZSBjbG9zdXJlLWxpYnJhcnkpXG4gKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gKiBAcmV0dXJuIHtUZXh0UmFuZ2V9XG4gKi9cblxuXG5mdW5jdGlvbiBwb2ludFRvVGV4dFJhbmdlKHBvaW50KSB7XG4gIHZhciB0ZXh0UmFuZ2VJbmZvID0gZnVuY3Rpb24gdGV4dFJhbmdlSW5mbyhjb250YWluZXIsIG9mZnNldCkge1xuICAgIHZhciBub2RlLCBpc0NvbGxhcHNlVG9TdGFydDtcblxuICAgIGlmIChkb20uaXNUZXh0KGNvbnRhaW5lcikpIHtcbiAgICAgIHZhciBwcmV2VGV4dE5vZGVzID0gZG9tLmxpc3RQcmV2KGNvbnRhaW5lciwgZnVuYy5ub3QoZG9tLmlzVGV4dCkpO1xuICAgICAgdmFyIHByZXZDb250YWluZXIgPSBsaXN0cy5sYXN0KHByZXZUZXh0Tm9kZXMpLnByZXZpb3VzU2libGluZztcbiAgICAgIG5vZGUgPSBwcmV2Q29udGFpbmVyIHx8IGNvbnRhaW5lci5wYXJlbnROb2RlO1xuICAgICAgb2Zmc2V0ICs9IGxpc3RzLnN1bShsaXN0cy50YWlsKHByZXZUZXh0Tm9kZXMpLCBkb20ubm9kZUxlbmd0aCk7XG4gICAgICBpc0NvbGxhcHNlVG9TdGFydCA9ICFwcmV2Q29udGFpbmVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBub2RlID0gY29udGFpbmVyLmNoaWxkTm9kZXNbb2Zmc2V0XSB8fCBjb250YWluZXI7XG5cbiAgICAgIGlmIChkb20uaXNUZXh0KG5vZGUpKSB7XG4gICAgICAgIHJldHVybiB0ZXh0UmFuZ2VJbmZvKG5vZGUsIDApO1xuICAgICAgfVxuXG4gICAgICBvZmZzZXQgPSAwO1xuICAgICAgaXNDb2xsYXBzZVRvU3RhcnQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgbm9kZTogbm9kZSxcbiAgICAgIGNvbGxhcHNlVG9TdGFydDogaXNDb2xsYXBzZVRvU3RhcnQsXG4gICAgICBvZmZzZXQ6IG9mZnNldFxuICAgIH07XG4gIH07XG5cbiAgdmFyIHRleHRSYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG4gIHZhciBpbmZvID0gdGV4dFJhbmdlSW5mbyhwb2ludC5ub2RlLCBwb2ludC5vZmZzZXQpO1xuICB0ZXh0UmFuZ2UubW92ZVRvRWxlbWVudFRleHQoaW5mby5ub2RlKTtcbiAgdGV4dFJhbmdlLmNvbGxhcHNlKGluZm8uY29sbGFwc2VUb1N0YXJ0KTtcbiAgdGV4dFJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgaW5mby5vZmZzZXQpO1xuICByZXR1cm4gdGV4dFJhbmdlO1xufVxuLyoqXG4gICAqIFdyYXBwZWQgUmFuZ2VcbiAgICpcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7Tm9kZX0gc2MgLSBzdGFydCBjb250YWluZXJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHNvIC0gc3RhcnQgb2Zmc2V0XG4gICAqIEBwYXJhbSB7Tm9kZX0gZWMgLSBlbmQgY29udGFpbmVyXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBlbyAtIGVuZCBvZmZzZXRcbiAgICovXG5cblxudmFyIHJhbmdlX1dyYXBwZWRSYW5nZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFdyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbykge1xuICAgIHJhbmdlX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdyYXBwZWRSYW5nZSk7XG5cbiAgICB0aGlzLnNjID0gc2M7XG4gICAgdGhpcy5zbyA9IHNvO1xuICAgIHRoaXMuZWMgPSBlYztcbiAgICB0aGlzLmVvID0gZW87IC8vIGlzT25FZGl0YWJsZToganVkZ2Ugd2hldGhlciByYW5nZSBpcyBvbiBlZGl0YWJsZSBvciBub3RcblxuICAgIHRoaXMuaXNPbkVkaXRhYmxlID0gdGhpcy5tYWtlSXNPbihkb20uaXNFZGl0YWJsZSk7IC8vIGlzT25MaXN0OiBqdWRnZSB3aGV0aGVyIHJhbmdlIGlzIG9uIGxpc3Qgbm9kZSBvciBub3RcblxuICAgIHRoaXMuaXNPbkxpc3QgPSB0aGlzLm1ha2VJc09uKGRvbS5pc0xpc3QpOyAvLyBpc09uQW5jaG9yOiBqdWRnZSB3aGV0aGVyIHJhbmdlIGlzIG9uIGFuY2hvciBub2RlIG9yIG5vdFxuXG4gICAgdGhpcy5pc09uQW5jaG9yID0gdGhpcy5tYWtlSXNPbihkb20uaXNBbmNob3IpOyAvLyBpc09uQ2VsbDoganVkZ2Ugd2hldGhlciByYW5nZSBpcyBvbiBjZWxsIG5vZGUgb3Igbm90XG5cbiAgICB0aGlzLmlzT25DZWxsID0gdGhpcy5tYWtlSXNPbihkb20uaXNDZWxsKTsgLy8gaXNPbkRhdGE6IGp1ZGdlIHdoZXRoZXIgcmFuZ2UgaXMgb24gZGF0YSBub2RlIG9yIG5vdFxuXG4gICAgdGhpcy5pc09uRGF0YSA9IHRoaXMubWFrZUlzT24oZG9tLmlzRGF0YSk7XG4gIH0gLy8gbmF0aXZlUmFuZ2U6IGdldCBuYXRpdmVSYW5nZSBmcm9tIHNjLCBzbywgZWMsIGVvXG5cblxuICByYW5nZV9jcmVhdGVDbGFzcyhXcmFwcGVkUmFuZ2UsIFt7XG4gICAga2V5OiBcIm5hdGl2ZVJhbmdlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG5hdGl2ZVJhbmdlKCkge1xuICAgICAgaWYgKGVudi5pc1czQ1JhbmdlU3VwcG9ydCkge1xuICAgICAgICB2YXIgdzNjUmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgICB3M2NSYW5nZS5zZXRTdGFydCh0aGlzLnNjLCB0aGlzLnNvKTtcbiAgICAgICAgdzNjUmFuZ2Uuc2V0RW5kKHRoaXMuZWMsIHRoaXMuZW8pO1xuICAgICAgICByZXR1cm4gdzNjUmFuZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdGV4dFJhbmdlID0gcG9pbnRUb1RleHRSYW5nZSh7XG4gICAgICAgICAgbm9kZTogdGhpcy5zYyxcbiAgICAgICAgICBvZmZzZXQ6IHRoaXMuc29cbiAgICAgICAgfSk7XG4gICAgICAgIHRleHRSYW5nZS5zZXRFbmRQb2ludCgnRW5kVG9FbmQnLCBwb2ludFRvVGV4dFJhbmdlKHtcbiAgICAgICAgICBub2RlOiB0aGlzLmVjLFxuICAgICAgICAgIG9mZnNldDogdGhpcy5lb1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB0ZXh0UmFuZ2U7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImdldFBvaW50c1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQb2ludHMoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzYzogdGhpcy5zYyxcbiAgICAgICAgc286IHRoaXMuc28sXG4gICAgICAgIGVjOiB0aGlzLmVjLFxuICAgICAgICBlbzogdGhpcy5lb1xuICAgICAgfTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0U3RhcnRQb2ludFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdGFydFBvaW50KCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbm9kZTogdGhpcy5zYyxcbiAgICAgICAgb2Zmc2V0OiB0aGlzLnNvXG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJnZXRFbmRQb2ludFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFbmRQb2ludCgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5vZGU6IHRoaXMuZWMsXG4gICAgICAgIG9mZnNldDogdGhpcy5lb1xuICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2VsZWN0IHVwZGF0ZSB2aXNpYmxlIHJhbmdlXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJzZWxlY3RcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0KCkge1xuICAgICAgdmFyIG5hdGl2ZVJuZyA9IHRoaXMubmF0aXZlUmFuZ2UoKTtcblxuICAgICAgaWYgKGVudi5pc1czQ1JhbmdlU3VwcG9ydCkge1xuICAgICAgICB2YXIgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7XG5cbiAgICAgICAgaWYgKHNlbGVjdGlvbi5yYW5nZUNvdW50ID4gMCkge1xuICAgICAgICAgIHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGVjdGlvbi5hZGRSYW5nZShuYXRpdmVSbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmF0aXZlUm5nLnNlbGVjdCgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogTW92ZXMgdGhlIHNjcm9sbGJhciB0byBzdGFydCBjb250YWluZXIoc2MpIG9mIGN1cnJlbnQgcmFuZ2VcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInNjcm9sbEludG9WaWV3XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNjcm9sbEludG9WaWV3KGNvbnRhaW5lcikge1xuICAgICAgdmFyIGhlaWdodCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGNvbnRhaW5lcikuaGVpZ2h0KCk7XG5cbiAgICAgIGlmIChjb250YWluZXIuc2Nyb2xsVG9wICsgaGVpZ2h0IDwgdGhpcy5zYy5vZmZzZXRUb3ApIHtcbiAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCArPSBNYXRoLmFicyhjb250YWluZXIuc2Nyb2xsVG9wICsgaGVpZ2h0IC0gdGhpcy5zYy5vZmZzZXRUb3ApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwibm9ybWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG5vcm1hbGl6ZSgpIHtcbiAgICAgIC8qKlxuICAgICAgICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICAgICAgICogQHBhcmFtIHtCb29sZWFufSBpc0xlZnRUb1JpZ2h0IC0gdHJ1ZTogcHJlZmVyIHRvIGNob29zZSByaWdodCBub2RlXG4gICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBmYWxzZTogcHJlZmVyIHRvIGNob29zZSBsZWZ0IG5vZGVcbiAgICAgICAqIEByZXR1cm4ge0JvdW5kYXJ5UG9pbnR9XG4gICAgICAgKi9cbiAgICAgIHZhciBnZXRWaXNpYmxlUG9pbnQgPSBmdW5jdGlvbiBnZXRWaXNpYmxlUG9pbnQocG9pbnQsIGlzTGVmdFRvUmlnaHQpIHtcbiAgICAgICAgaWYgKCFwb2ludCkge1xuICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgfSAvLyBKdXN0IHVzZSB0aGUgZ2l2ZW4gcG9pbnQgW1hYWDpBZGhvY11cbiAgICAgICAgLy8gIC0gY2FzZSAwMS4gaWYgdGhlIHBvaW50IGlzIG9uIHRoZSBtaWRkbGUgb2YgdGhlIG5vZGVcbiAgICAgICAgLy8gIC0gY2FzZSAwMi4gaWYgdGhlIHBvaW50IGlzIG9uIHRoZSByaWdodCBlZGdlIGFuZCBwcmVmZXIgdG8gY2hvb3NlIGxlZnQgbm9kZVxuICAgICAgICAvLyAgLSBjYXNlIDAzLiBpZiB0aGUgcG9pbnQgaXMgb24gdGhlIGxlZnQgZWRnZSBhbmQgcHJlZmVyIHRvIGNob29zZSByaWdodCBub2RlXG4gICAgICAgIC8vICAtIGNhc2UgMDQuIGlmIHRoZSBwb2ludCBpcyBvbiB0aGUgcmlnaHQgZWRnZSBhbmQgcHJlZmVyIHRvIGNob29zZSByaWdodCBub2RlIGJ1dCB0aGUgbm9kZSBpcyB2b2lkXG4gICAgICAgIC8vICAtIGNhc2UgMDUuIGlmIHRoZSBwb2ludCBpcyBvbiB0aGUgbGVmdCBlZGdlIGFuZCBwcmVmZXIgdG8gY2hvb3NlIGxlZnQgbm9kZSBidXQgdGhlIG5vZGUgaXMgdm9pZFxuICAgICAgICAvLyAgLSBjYXNlIDA2LiBpZiB0aGUgcG9pbnQgaXMgb24gdGhlIGJsb2NrIG5vZGUgYW5kIHRoZXJlIGlzIG5vIGNoaWxkcmVuXG5cblxuICAgICAgICBpZiAoZG9tLmlzVmlzaWJsZVBvaW50KHBvaW50KSkge1xuICAgICAgICAgIGlmICghZG9tLmlzRWRnZVBvaW50KHBvaW50KSB8fCBkb20uaXNSaWdodEVkZ2VQb2ludChwb2ludCkgJiYgIWlzTGVmdFRvUmlnaHQgfHwgZG9tLmlzTGVmdEVkZ2VQb2ludChwb2ludCkgJiYgaXNMZWZ0VG9SaWdodCB8fCBkb20uaXNSaWdodEVkZ2VQb2ludChwb2ludCkgJiYgaXNMZWZ0VG9SaWdodCAmJiBkb20uaXNWb2lkKHBvaW50Lm5vZGUubmV4dFNpYmxpbmcpIHx8IGRvbS5pc0xlZnRFZGdlUG9pbnQocG9pbnQpICYmICFpc0xlZnRUb1JpZ2h0ICYmIGRvbS5pc1ZvaWQocG9pbnQubm9kZS5wcmV2aW91c1NpYmxpbmcpIHx8IGRvbS5pc0Jsb2NrKHBvaW50Lm5vZGUpICYmIGRvbS5pc0VtcHR5KHBvaW50Lm5vZGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIHBvaW50IG9uIGJsb2NrJ3MgZWRnZVxuXG5cbiAgICAgICAgdmFyIGJsb2NrID0gZG9tLmFuY2VzdG9yKHBvaW50Lm5vZGUsIGRvbS5pc0Jsb2NrKTtcbiAgICAgICAgdmFyIGhhc1JpZ2h0Tm9kZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghaGFzUmlnaHROb2RlKSB7XG4gICAgICAgICAgdmFyIHByZXZQb2ludCA9IGRvbS5wcmV2UG9pbnQocG9pbnQpIHx8IHtcbiAgICAgICAgICAgIG5vZGU6IG51bGxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGhhc1JpZ2h0Tm9kZSA9IChkb20uaXNMZWZ0RWRnZVBvaW50T2YocG9pbnQsIGJsb2NrKSB8fCBkb20uaXNWb2lkKHByZXZQb2ludC5ub2RlKSkgJiYgIWlzTGVmdFRvUmlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaGFzTGVmdE5vZGUgPSBmYWxzZTtcblxuICAgICAgICBpZiAoIWhhc0xlZnROb2RlKSB7XG4gICAgICAgICAgdmFyIF9uZXh0UG9pbnQgPSBkb20ubmV4dFBvaW50KHBvaW50KSB8fCB7XG4gICAgICAgICAgICBub2RlOiBudWxsXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGhhc0xlZnROb2RlID0gKGRvbS5pc1JpZ2h0RWRnZVBvaW50T2YocG9pbnQsIGJsb2NrKSB8fCBkb20uaXNWb2lkKF9uZXh0UG9pbnQubm9kZSkpICYmIGlzTGVmdFRvUmlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGFzUmlnaHROb2RlIHx8IGhhc0xlZnROb2RlKSB7XG4gICAgICAgICAgLy8gcmV0dXJucyBwb2ludCBhbHJlYWR5IG9uIHZpc2libGUgcG9pbnRcbiAgICAgICAgICBpZiAoZG9tLmlzVmlzaWJsZVBvaW50KHBvaW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgICAgIH0gLy8gcmV2ZXJzZSBkaXJlY3Rpb25cblxuXG4gICAgICAgICAgaXNMZWZ0VG9SaWdodCA9ICFpc0xlZnRUb1JpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5leHRQb2ludCA9IGlzTGVmdFRvUmlnaHQgPyBkb20ubmV4dFBvaW50VW50aWwoZG9tLm5leHRQb2ludChwb2ludCksIGRvbS5pc1Zpc2libGVQb2ludCkgOiBkb20ucHJldlBvaW50VW50aWwoZG9tLnByZXZQb2ludChwb2ludCksIGRvbS5pc1Zpc2libGVQb2ludCk7XG4gICAgICAgIHJldHVybiBuZXh0UG9pbnQgfHwgcG9pbnQ7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZW5kUG9pbnQgPSBnZXRWaXNpYmxlUG9pbnQodGhpcy5nZXRFbmRQb2ludCgpLCBmYWxzZSk7XG4gICAgICB2YXIgc3RhcnRQb2ludCA9IHRoaXMuaXNDb2xsYXBzZWQoKSA/IGVuZFBvaW50IDogZ2V0VmlzaWJsZVBvaW50KHRoaXMuZ2V0U3RhcnRQb2ludCgpLCB0cnVlKTtcbiAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKHN0YXJ0UG9pbnQubm9kZSwgc3RhcnRQb2ludC5vZmZzZXQsIGVuZFBvaW50Lm5vZGUsIGVuZFBvaW50Lm9mZnNldCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJldHVybnMgbWF0Y2hlZCBub2RlcyBvbiByYW5nZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRdIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaW5jbHVkZUFuY2VzdG9yXVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZnVsbHlDb250YWluc11cbiAgICAgKiBAcmV0dXJuIHtOb2RlW119XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJub2Rlc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBub2RlcyhwcmVkLCBvcHRpb25zKSB7XG4gICAgICBwcmVkID0gcHJlZCB8fCBmdW5jLm9rO1xuICAgICAgdmFyIGluY2x1ZGVBbmNlc3RvciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5pbmNsdWRlQW5jZXN0b3I7XG4gICAgICB2YXIgZnVsbHlDb250YWlucyA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mdWxseUNvbnRhaW5zOyAvLyBUT0RPIGNvbXBhcmUgcG9pbnRzIGFuZCBzb3J0XG5cbiAgICAgIHZhciBzdGFydFBvaW50ID0gdGhpcy5nZXRTdGFydFBvaW50KCk7XG4gICAgICB2YXIgZW5kUG9pbnQgPSB0aGlzLmdldEVuZFBvaW50KCk7XG4gICAgICB2YXIgbm9kZXMgPSBbXTtcbiAgICAgIHZhciBsZWZ0RWRnZU5vZGVzID0gW107XG4gICAgICBkb20ud2Fsa1BvaW50KHN0YXJ0UG9pbnQsIGVuZFBvaW50LCBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgaWYgKGRvbS5pc0VkaXRhYmxlKHBvaW50Lm5vZGUpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vZGU7XG5cbiAgICAgICAgaWYgKGZ1bGx5Q29udGFpbnMpIHtcbiAgICAgICAgICBpZiAoZG9tLmlzTGVmdEVkZ2VQb2ludChwb2ludCkpIHtcbiAgICAgICAgICAgIGxlZnRFZGdlTm9kZXMucHVzaChwb2ludC5ub2RlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZG9tLmlzUmlnaHRFZGdlUG9pbnQocG9pbnQpICYmIGxpc3RzLmNvbnRhaW5zKGxlZnRFZGdlTm9kZXMsIHBvaW50Lm5vZGUpKSB7XG4gICAgICAgICAgICBub2RlID0gcG9pbnQubm9kZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaW5jbHVkZUFuY2VzdG9yKSB7XG4gICAgICAgICAgbm9kZSA9IGRvbS5hbmNlc3Rvcihwb2ludC5ub2RlLCBwcmVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBub2RlID0gcG9pbnQubm9kZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChub2RlICYmIHByZWQobm9kZSkpIHtcbiAgICAgICAgICBub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9LCB0cnVlKTtcbiAgICAgIHJldHVybiBsaXN0cy51bmlxdWUobm9kZXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIGNvbW1vbkFuY2VzdG9yIG9mIHJhbmdlXG4gICAgICogQHJldHVybiB7RWxlbWVudH0gLSBjb21tb25BbmNlc3RvclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY29tbW9uQW5jZXN0b3JcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY29tbW9uQW5jZXN0b3IoKSB7XG4gICAgICByZXR1cm4gZG9tLmNvbW1vbkFuY2VzdG9yKHRoaXMuc2MsIHRoaXMuZWMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIGV4cGFuZGVkIHJhbmdlIGJ5IHByZWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWQgLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJleHBhbmRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwYW5kKHByZWQpIHtcbiAgICAgIHZhciBzdGFydEFuY2VzdG9yID0gZG9tLmFuY2VzdG9yKHRoaXMuc2MsIHByZWQpO1xuICAgICAgdmFyIGVuZEFuY2VzdG9yID0gZG9tLmFuY2VzdG9yKHRoaXMuZWMsIHByZWQpO1xuXG4gICAgICBpZiAoIXN0YXJ0QW5jZXN0b3IgJiYgIWVuZEFuY2VzdG9yKSB7XG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKHRoaXMuc2MsIHRoaXMuc28sIHRoaXMuZWMsIHRoaXMuZW8pO1xuICAgICAgfVxuXG4gICAgICB2YXIgYm91bmRhcnlQb2ludHMgPSB0aGlzLmdldFBvaW50cygpO1xuXG4gICAgICBpZiAoc3RhcnRBbmNlc3Rvcikge1xuICAgICAgICBib3VuZGFyeVBvaW50cy5zYyA9IHN0YXJ0QW5jZXN0b3I7XG4gICAgICAgIGJvdW5kYXJ5UG9pbnRzLnNvID0gMDtcbiAgICAgIH1cblxuICAgICAgaWYgKGVuZEFuY2VzdG9yKSB7XG4gICAgICAgIGJvdW5kYXJ5UG9pbnRzLmVjID0gZW5kQW5jZXN0b3I7XG4gICAgICAgIGJvdW5kYXJ5UG9pbnRzLmVvID0gZG9tLm5vZGVMZW5ndGgoZW5kQW5jZXN0b3IpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShib3VuZGFyeVBvaW50cy5zYywgYm91bmRhcnlQb2ludHMuc28sIGJvdW5kYXJ5UG9pbnRzLmVjLCBib3VuZGFyeVBvaW50cy5lbyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNDb2xsYXBzZVRvU3RhcnRcbiAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJjb2xsYXBzZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb2xsYXBzZShpc0NvbGxhcHNlVG9TdGFydCkge1xuICAgICAgaWYgKGlzQ29sbGFwc2VUb1N0YXJ0KSB7XG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKHRoaXMuc2MsIHRoaXMuc28sIHRoaXMuc2MsIHRoaXMuc28pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBXcmFwcGVkUmFuZ2UodGhpcy5lYywgdGhpcy5lbywgdGhpcy5lYywgdGhpcy5lbyk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHNwbGl0VGV4dCBvbiByYW5nZVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwic3BsaXRUZXh0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNwbGl0VGV4dCgpIHtcbiAgICAgIHZhciBpc1NhbWVDb250YWluZXIgPSB0aGlzLnNjID09PSB0aGlzLmVjO1xuICAgICAgdmFyIGJvdW5kYXJ5UG9pbnRzID0gdGhpcy5nZXRQb2ludHMoKTtcblxuICAgICAgaWYgKGRvbS5pc1RleHQodGhpcy5lYykgJiYgIWRvbS5pc0VkZ2VQb2ludCh0aGlzLmdldEVuZFBvaW50KCkpKSB7XG4gICAgICAgIHRoaXMuZWMuc3BsaXRUZXh0KHRoaXMuZW8pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZG9tLmlzVGV4dCh0aGlzLnNjKSAmJiAhZG9tLmlzRWRnZVBvaW50KHRoaXMuZ2V0U3RhcnRQb2ludCgpKSkge1xuICAgICAgICBib3VuZGFyeVBvaW50cy5zYyA9IHRoaXMuc2Muc3BsaXRUZXh0KHRoaXMuc28pO1xuICAgICAgICBib3VuZGFyeVBvaW50cy5zbyA9IDA7XG5cbiAgICAgICAgaWYgKGlzU2FtZUNvbnRhaW5lcikge1xuICAgICAgICAgIGJvdW5kYXJ5UG9pbnRzLmVjID0gYm91bmRhcnlQb2ludHMuc2M7XG4gICAgICAgICAgYm91bmRhcnlQb2ludHMuZW8gPSB0aGlzLmVvIC0gdGhpcy5zbztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShib3VuZGFyeVBvaW50cy5zYywgYm91bmRhcnlQb2ludHMuc28sIGJvdW5kYXJ5UG9pbnRzLmVjLCBib3VuZGFyeVBvaW50cy5lbyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGRlbGV0ZSBjb250ZW50cyBvbiByYW5nZVxuICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImRlbGV0ZUNvbnRlbnRzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlbGV0ZUNvbnRlbnRzKCkge1xuICAgICAgaWYgKHRoaXMuaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgdmFyIHJuZyA9IHRoaXMuc3BsaXRUZXh0KCk7XG4gICAgICB2YXIgbm9kZXMgPSBybmcubm9kZXMobnVsbCwge1xuICAgICAgICBmdWxseUNvbnRhaW5zOiB0cnVlXG4gICAgICB9KTsgLy8gZmluZCBuZXcgY3Vyc29yIHBvaW50XG5cbiAgICAgIHZhciBwb2ludCA9IGRvbS5wcmV2UG9pbnRVbnRpbChybmcuZ2V0U3RhcnRQb2ludCgpLCBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgcmV0dXJuICFsaXN0cy5jb250YWlucyhub2RlcywgcG9pbnQubm9kZSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBlbXB0eVBhcmVudHMgPSBbXTtcbiAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmVhY2gobm9kZXMsIGZ1bmN0aW9uIChpZHgsIG5vZGUpIHtcbiAgICAgICAgLy8gZmluZCBlbXB0eSBwYXJlbnRzXG4gICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGU7XG5cbiAgICAgICAgaWYgKHBvaW50Lm5vZGUgIT09IHBhcmVudCAmJiBkb20ubm9kZUxlbmd0aChwYXJlbnQpID09PSAxKSB7XG4gICAgICAgICAgZW1wdHlQYXJlbnRzLnB1c2gocGFyZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvbS5yZW1vdmUobm9kZSwgZmFsc2UpO1xuICAgICAgfSk7IC8vIHJlbW92ZSBlbXB0eSBwYXJlbnRzXG5cbiAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmVhY2goZW1wdHlQYXJlbnRzLCBmdW5jdGlvbiAoaWR4LCBub2RlKSB7XG4gICAgICAgIGRvbS5yZW1vdmUobm9kZSwgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShwb2ludC5ub2RlLCBwb2ludC5vZmZzZXQsIHBvaW50Lm5vZGUsIHBvaW50Lm9mZnNldCkubm9ybWFsaXplKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIG1ha2VJc09uOiByZXR1cm4gaXNPbihwcmVkKSBmdW5jdGlvblxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwibWFrZUlzT25cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gbWFrZUlzT24ocHJlZCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFuY2VzdG9yID0gZG9tLmFuY2VzdG9yKHRoaXMuc2MsIHByZWQpO1xuICAgICAgICByZXR1cm4gISFhbmNlc3RvciAmJiBhbmNlc3RvciA9PT0gZG9tLmFuY2VzdG9yKHRoaXMuZWMsIHByZWQpO1xuICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZFxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJpc0xlZnRFZGdlT2ZcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNMZWZ0RWRnZU9mKHByZWQpIHtcbiAgICAgIGlmICghZG9tLmlzTGVmdEVkZ2VQb2ludCh0aGlzLmdldFN0YXJ0UG9pbnQoKSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB2YXIgbm9kZSA9IGRvbS5hbmNlc3Rvcih0aGlzLnNjLCBwcmVkKTtcbiAgICAgIHJldHVybiBub2RlICYmIGRvbS5pc0xlZnRFZGdlT2YodGhpcy5zYywgbm9kZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciByYW5nZSB3YXMgY29sbGFwc2VkIG9yIG5vdFxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiaXNDb2xsYXBzZWRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNDb2xsYXBzZWQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5zYyA9PT0gdGhpcy5lYyAmJiB0aGlzLnNvID09PSB0aGlzLmVvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB3cmFwIGlubGluZSBub2RlcyB3aGljaCBjaGlsZHJlbiBvZiBib2R5IHdpdGggcGFyYWdyYXBoXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJ3cmFwQm9keUlubGluZVdpdGhQYXJhXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHdyYXBCb2R5SW5saW5lV2l0aFBhcmEoKSB7XG4gICAgICBpZiAoZG9tLmlzQm9keUNvbnRhaW5lcih0aGlzLnNjKSAmJiBkb20uaXNFbXB0eSh0aGlzLnNjKSkge1xuICAgICAgICB0aGlzLnNjLmlubmVySFRNTCA9IGRvbS5lbXB0eVBhcmE7XG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKHRoaXMuc2MuZmlyc3RDaGlsZCwgMCwgdGhpcy5zYy5maXJzdENoaWxkLCAwKTtcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogW3dvcmthcm91bmRdIGZpcmVmb3ggb2Z0ZW4gY3JlYXRlIHJhbmdlIG9uIG5vdCB2aXNpYmxlIHBvaW50LiBzbyBub3JtYWxpemUgaGVyZS5cbiAgICAgICAqICAtIGZpcmVmb3g6IHw8cD50ZXh0PC9wPnxcbiAgICAgICAqICAtIGNocm9tZTogPHA+fHRleHR8PC9wPlxuICAgICAgICovXG5cblxuICAgICAgdmFyIHJuZyA9IHRoaXMubm9ybWFsaXplKCk7XG5cbiAgICAgIGlmIChkb20uaXNQYXJhSW5saW5lKHRoaXMuc2MpIHx8IGRvbS5pc1BhcmEodGhpcy5zYykpIHtcbiAgICAgICAgcmV0dXJuIHJuZztcbiAgICAgIH0gLy8gZmluZCBpbmxpbmUgdG9wIGFuY2VzdG9yXG5cblxuICAgICAgdmFyIHRvcEFuY2VzdG9yO1xuXG4gICAgICBpZiAoZG9tLmlzSW5saW5lKHJuZy5zYykpIHtcbiAgICAgICAgdmFyIGFuY2VzdG9ycyA9IGRvbS5saXN0QW5jZXN0b3Iocm5nLnNjLCBmdW5jLm5vdChkb20uaXNJbmxpbmUpKTtcbiAgICAgICAgdG9wQW5jZXN0b3IgPSBsaXN0cy5sYXN0KGFuY2VzdG9ycyk7XG5cbiAgICAgICAgaWYgKCFkb20uaXNJbmxpbmUodG9wQW5jZXN0b3IpKSB7XG4gICAgICAgICAgdG9wQW5jZXN0b3IgPSBhbmNlc3RvcnNbYW5jZXN0b3JzLmxlbmd0aCAtIDJdIHx8IHJuZy5zYy5jaGlsZE5vZGVzW3JuZy5zb107XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvcEFuY2VzdG9yID0gcm5nLnNjLmNoaWxkTm9kZXNbcm5nLnNvID4gMCA/IHJuZy5zbyAtIDEgOiAwXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRvcEFuY2VzdG9yKSB7XG4gICAgICAgIC8vIHNpYmxpbmdzIG5vdCBpbiBwYXJhZ3JhcGhcbiAgICAgICAgdmFyIGlubGluZVNpYmxpbmdzID0gZG9tLmxpc3RQcmV2KHRvcEFuY2VzdG9yLCBkb20uaXNQYXJhSW5saW5lKS5yZXZlcnNlKCk7XG4gICAgICAgIGlubGluZVNpYmxpbmdzID0gaW5saW5lU2libGluZ3MuY29uY2F0KGRvbS5saXN0TmV4dCh0b3BBbmNlc3Rvci5uZXh0U2libGluZywgZG9tLmlzUGFyYUlubGluZSkpOyAvLyB3cmFwIHdpdGggcGFyYWdyYXBoXG5cbiAgICAgICAgaWYgKGlubGluZVNpYmxpbmdzLmxlbmd0aCkge1xuICAgICAgICAgIHZhciBwYXJhID0gZG9tLndyYXAobGlzdHMuaGVhZChpbmxpbmVTaWJsaW5ncyksICdwJyk7XG4gICAgICAgICAgZG9tLmFwcGVuZENoaWxkTm9kZXMocGFyYSwgbGlzdHMudGFpbChpbmxpbmVTaWJsaW5ncykpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLm5vcm1hbGl6ZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBpbnNlcnQgbm9kZSBhdCBjdXJyZW50IGN1cnNvclxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHJldHVybiB7Tm9kZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImluc2VydE5vZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zZXJ0Tm9kZShub2RlKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcztcblxuICAgICAgaWYgKGRvbS5pc1RleHQobm9kZSkgfHwgZG9tLmlzSW5saW5lKG5vZGUpKSB7XG4gICAgICAgIHJuZyA9IHRoaXMud3JhcEJvZHlJbmxpbmVXaXRoUGFyYSgpLmRlbGV0ZUNvbnRlbnRzKCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBpbmZvID0gZG9tLnNwbGl0UG9pbnQocm5nLmdldFN0YXJ0UG9pbnQoKSwgZG9tLmlzSW5saW5lKG5vZGUpKTtcblxuICAgICAgaWYgKGluZm8ucmlnaHROb2RlKSB7XG4gICAgICAgIGluZm8ucmlnaHROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGluZm8ucmlnaHROb2RlKTtcblxuICAgICAgICBpZiAoZG9tLmlzRW1wdHkoaW5mby5yaWdodE5vZGUpICYmIGRvbS5pc1BhcmEobm9kZSkpIHtcbiAgICAgICAgICBpbmZvLnJpZ2h0Tm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGluZm8ucmlnaHROb2RlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5mby5jb250YWluZXIuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBpbnNlcnQgaHRtbCBhdCBjdXJyZW50IGN1cnNvclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicGFzdGVIVE1MXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHBhc3RlSFRNTChtYXJrdXApIHtcbiAgICAgIG1hcmt1cCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnRyaW0obWFya3VwKTtcbiAgICAgIHZhciBjb250ZW50c0NvbnRhaW5lciA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8ZGl2PjwvZGl2PicpLmh0bWwobWFya3VwKVswXTtcbiAgICAgIHZhciBjaGlsZE5vZGVzID0gbGlzdHMuZnJvbShjb250ZW50c0NvbnRhaW5lci5jaGlsZE5vZGVzKTsgLy8gY29uc3Qgcm5nID0gdGhpcy53cmFwQm9keUlubGluZVdpdGhQYXJhKCkuZGVsZXRlQ29udGVudHMoKTtcblxuICAgICAgdmFyIHJuZyA9IHRoaXM7XG4gICAgICB2YXIgcmV2ZXJzZWQgPSBmYWxzZTtcblxuICAgICAgaWYgKHJuZy5zbyA+PSAwKSB7XG4gICAgICAgIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLnJldmVyc2UoKTtcbiAgICAgICAgcmV2ZXJzZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5tYXAoZnVuY3Rpb24gKGNoaWxkTm9kZSkge1xuICAgICAgICByZXR1cm4gcm5nLmluc2VydE5vZGUoY2hpbGROb2RlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmV2ZXJzZWQpIHtcbiAgICAgICAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMucmV2ZXJzZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY2hpbGROb2RlcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogcmV0dXJucyB0ZXh0IGluIHJhbmdlXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJ0b1N0cmluZ1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICAgIHZhciBuYXRpdmVSbmcgPSB0aGlzLm5hdGl2ZVJhbmdlKCk7XG4gICAgICByZXR1cm4gZW52LmlzVzNDUmFuZ2VTdXBwb3J0ID8gbmF0aXZlUm5nLnRvU3RyaW5nKCkgOiBuYXRpdmVSbmcudGV4dDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogcmV0dXJucyByYW5nZSBmb3Igd29yZCBiZWZvcmUgY3Vyc29yXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtmaW5kQWZ0ZXJdIC0gZmluZCBhZnRlciBjdXJzb3IsIGRlZmF1bHQ6IGZhbHNlXG4gICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0V29yZFJhbmdlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldFdvcmRSYW5nZShmaW5kQWZ0ZXIpIHtcbiAgICAgIHZhciBlbmRQb2ludCA9IHRoaXMuZ2V0RW5kUG9pbnQoKTtcblxuICAgICAgaWYgKCFkb20uaXNDaGFyUG9pbnQoZW5kUG9pbnQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICB2YXIgc3RhcnRQb2ludCA9IGRvbS5wcmV2UG9pbnRVbnRpbChlbmRQb2ludCwgZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgIHJldHVybiAhZG9tLmlzQ2hhclBvaW50KHBvaW50KTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZmluZEFmdGVyKSB7XG4gICAgICAgIGVuZFBvaW50ID0gZG9tLm5leHRQb2ludFVudGlsKGVuZFBvaW50LCBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgICByZXR1cm4gIWRvbS5pc0NoYXJQb2ludChwb2ludCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzdGFydFBvaW50Lm5vZGUsIHN0YXJ0UG9pbnQub2Zmc2V0LCBlbmRQb2ludC5ub2RlLCBlbmRQb2ludC5vZmZzZXQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHJhbmdlIGZvciB3b3JkcyBiZWZvcmUgY3Vyc29yXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtmaW5kQWZ0ZXJdIC0gZmluZCBhZnRlciBjdXJzb3IsIGRlZmF1bHQ6IGZhbHNlXG4gICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0V29yZHNSYW5nZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRXb3Jkc1JhbmdlKGZpbmRBZnRlcikge1xuICAgICAgdmFyIGVuZFBvaW50ID0gdGhpcy5nZXRFbmRQb2ludCgpO1xuXG4gICAgICB2YXIgaXNOb3RUZXh0UG9pbnQgPSBmdW5jdGlvbiBpc05vdFRleHRQb2ludChwb2ludCkge1xuICAgICAgICByZXR1cm4gIWRvbS5pc0NoYXJQb2ludChwb2ludCkgJiYgIWRvbS5pc1NwYWNlUG9pbnQocG9pbnQpO1xuICAgICAgfTtcblxuICAgICAgaWYgKGlzTm90VGV4dFBvaW50KGVuZFBvaW50KSkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgdmFyIHN0YXJ0UG9pbnQgPSBkb20ucHJldlBvaW50VW50aWwoZW5kUG9pbnQsIGlzTm90VGV4dFBvaW50KTtcblxuICAgICAgaWYgKGZpbmRBZnRlcikge1xuICAgICAgICBlbmRQb2ludCA9IGRvbS5uZXh0UG9pbnRVbnRpbChlbmRQb2ludCwgaXNOb3RUZXh0UG9pbnQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzdGFydFBvaW50Lm5vZGUsIHN0YXJ0UG9pbnQub2Zmc2V0LCBlbmRQb2ludC5ub2RlLCBlbmRQb2ludC5vZmZzZXQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHJhbmdlIGZvciB3b3JkcyBiZWZvcmUgY3Vyc29yIHRoYXQgbWF0Y2ggd2l0aCBhIFJlZ2V4XG4gICAgICpcbiAgICAgKiBleGFtcGxlOlxuICAgICAqICByYW5nZTogJ2hpIEBQZXRlciBQYW4nXG4gICAgICogIHJlZ2V4OiAnL0BbYS16IF0rL2knXG4gICAgICogIHJldHVybiByYW5nZTogJ0BQZXRlciBQYW4nXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1JlZ0V4cH0gW3JlZ2V4XVxuICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZXxudWxsfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0V29yZHNNYXRjaFJhbmdlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldFdvcmRzTWF0Y2hSYW5nZShyZWdleCkge1xuICAgICAgdmFyIGVuZFBvaW50ID0gdGhpcy5nZXRFbmRQb2ludCgpO1xuICAgICAgdmFyIHN0YXJ0UG9pbnQgPSBkb20ucHJldlBvaW50VW50aWwoZW5kUG9pbnQsIGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgICBpZiAoIWRvbS5pc0NoYXJQb2ludChwb2ludCkgJiYgIWRvbS5pc1NwYWNlUG9pbnQocG9pbnQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcm5nID0gbmV3IFdyYXBwZWRSYW5nZShwb2ludC5ub2RlLCBwb2ludC5vZmZzZXQsIGVuZFBvaW50Lm5vZGUsIGVuZFBvaW50Lm9mZnNldCk7XG4gICAgICAgIHZhciByZXN1bHQgPSByZWdleC5leGVjKHJuZy50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdCAmJiByZXN1bHQuaW5kZXggPT09IDA7XG4gICAgICB9KTtcbiAgICAgIHZhciBybmcgPSBuZXcgV3JhcHBlZFJhbmdlKHN0YXJ0UG9pbnQubm9kZSwgc3RhcnRQb2ludC5vZmZzZXQsIGVuZFBvaW50Lm5vZGUsIGVuZFBvaW50Lm9mZnNldCk7XG4gICAgICB2YXIgdGV4dCA9IHJuZy50b1N0cmluZygpO1xuICAgICAgdmFyIHJlc3VsdCA9IHJlZ2V4LmV4ZWModGV4dCk7XG5cbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0WzBdLmxlbmd0aCA9PT0gdGV4dC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHJuZztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBjcmVhdGUgb2Zmc2V0UGF0aCBib29rbWFya1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBlZGl0YWJsZVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiYm9va21hcmtcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYm9va21hcmsoZWRpdGFibGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHM6IHtcbiAgICAgICAgICBwYXRoOiBkb20ubWFrZU9mZnNldFBhdGgoZWRpdGFibGUsIHRoaXMuc2MpLFxuICAgICAgICAgIG9mZnNldDogdGhpcy5zb1xuICAgICAgICB9LFxuICAgICAgICBlOiB7XG4gICAgICAgICAgcGF0aDogZG9tLm1ha2VPZmZzZXRQYXRoKGVkaXRhYmxlLCB0aGlzLmVjKSxcbiAgICAgICAgICBvZmZzZXQ6IHRoaXMuZW9cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogY3JlYXRlIG9mZnNldFBhdGggYm9va21hcmsgYmFzZSBvbiBwYXJhZ3JhcGhcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZVtdfSBwYXJhc1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicGFyYUJvb2ttYXJrXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHBhcmFCb29rbWFyayhwYXJhcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgczoge1xuICAgICAgICAgIHBhdGg6IGxpc3RzLnRhaWwoZG9tLm1ha2VPZmZzZXRQYXRoKGxpc3RzLmhlYWQocGFyYXMpLCB0aGlzLnNjKSksXG4gICAgICAgICAgb2Zmc2V0OiB0aGlzLnNvXG4gICAgICAgIH0sXG4gICAgICAgIGU6IHtcbiAgICAgICAgICBwYXRoOiBsaXN0cy50YWlsKGRvbS5tYWtlT2Zmc2V0UGF0aChsaXN0cy5sYXN0KHBhcmFzKSwgdGhpcy5lYykpLFxuICAgICAgICAgIG9mZnNldDogdGhpcy5lb1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBnZXRDbGllbnRSZWN0c1xuICAgICAqIEByZXR1cm4ge1JlY3RbXX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImdldENsaWVudFJlY3RzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldENsaWVudFJlY3RzKCkge1xuICAgICAgdmFyIG5hdGl2ZVJuZyA9IHRoaXMubmF0aXZlUmFuZ2UoKTtcbiAgICAgIHJldHVybiBuYXRpdmVSbmcuZ2V0Q2xpZW50UmVjdHMoKTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gV3JhcHBlZFJhbmdlO1xufSgpO1xuLyoqXG4gKiBEYXRhIHN0cnVjdHVyZVxuICogICogQm91bmRhcnlQb2ludDogYSBwb2ludCBvZiBkb20gdHJlZVxuICogICogQm91bmRhcnlQb2ludHM6IHR3byBib3VuZGFyeVBvaW50cyBjb3JyZXNwb25kaW5nIHRvIHRoZSBzdGFydCBhbmQgdGhlIGVuZCBvZiB0aGUgUmFuZ2VcbiAqXG4gKiBTZWUgdG8gaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTItVHJhdmVyc2FsLVJhbmdlL3Jhbmdlcy5odG1sI0xldmVsLTItUmFuZ2UtUG9zaXRpb25cbiAqL1xuXG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHJhbmdlID0gKHtcbiAgLyoqXG4gICAqIGNyZWF0ZSBSYW5nZSBPYmplY3QgRnJvbSBhcmd1bWVudHMgb3IgQnJvd3NlciBTZWxlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtIHtOb2RlfSBzYyAtIHN0YXJ0IGNvbnRhaW5lclxuICAgKiBAcGFyYW0ge051bWJlcn0gc28gLSBzdGFydCBvZmZzZXRcbiAgICogQHBhcmFtIHtOb2RlfSBlYyAtIGVuZCBjb250YWluZXJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGVvIC0gZW5kIG9mZnNldFxuICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAqL1xuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZShzYywgc28sIGVjLCBlbykge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSA0KSB7XG4gICAgICByZXR1cm4gbmV3IHJhbmdlX1dyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAvLyBjb2xsYXBzZWRcbiAgICAgIGVjID0gc2M7XG4gICAgICBlbyA9IHNvO1xuICAgICAgcmV0dXJuIG5ldyByYW5nZV9XcmFwcGVkUmFuZ2Uoc2MsIHNvLCBlYywgZW8pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgd3JhcHBlZFJhbmdlID0gdGhpcy5jcmVhdGVGcm9tU2VsZWN0aW9uKCk7XG5cbiAgICAgIGlmICghd3JhcHBlZFJhbmdlICYmIGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgdmFyIGJvZHlFbGVtZW50ID0gYXJndW1lbnRzWzBdO1xuXG4gICAgICAgIGlmIChkb20uaXNFZGl0YWJsZShib2R5RWxlbWVudCkpIHtcbiAgICAgICAgICBib2R5RWxlbWVudCA9IGJvZHlFbGVtZW50Lmxhc3RDaGlsZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUZyb21Cb2R5RWxlbWVudChib2R5RWxlbWVudCwgZG9tLmVtcHR5UGFyYSA9PT0gYXJndW1lbnRzWzBdLmlubmVySFRNTCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB3cmFwcGVkUmFuZ2U7XG4gICAgfVxuICB9LFxuICBjcmVhdGVGcm9tQm9keUVsZW1lbnQ6IGZ1bmN0aW9uIGNyZWF0ZUZyb21Cb2R5RWxlbWVudChib2R5RWxlbWVudCkge1xuICAgIHZhciBpc0NvbGxhcHNlVG9TdGFydCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7XG4gICAgdmFyIHdyYXBwZWRSYW5nZSA9IHRoaXMuY3JlYXRlRnJvbU5vZGUoYm9keUVsZW1lbnQpO1xuICAgIHJldHVybiB3cmFwcGVkUmFuZ2UuY29sbGFwc2UoaXNDb2xsYXBzZVRvU3RhcnQpO1xuICB9LFxuICBjcmVhdGVGcm9tU2VsZWN0aW9uOiBmdW5jdGlvbiBjcmVhdGVGcm9tU2VsZWN0aW9uKCkge1xuICAgIHZhciBzYywgc28sIGVjLCBlbztcblxuICAgIGlmIChlbnYuaXNXM0NSYW5nZVN1cHBvcnQpIHtcbiAgICAgIHZhciBzZWxlY3Rpb24gPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKTtcblxuICAgICAgaWYgKCFzZWxlY3Rpb24gfHwgc2VsZWN0aW9uLnJhbmdlQ291bnQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2UgaWYgKGRvbS5pc0JvZHkoc2VsZWN0aW9uLmFuY2hvck5vZGUpKSB7XG4gICAgICAgIC8vIEZpcmVmb3g6IHJldHVybnMgZW50aXJlIGJvZHkgYXMgcmFuZ2Ugb24gaW5pdGlhbGl6YXRpb24uXG4gICAgICAgIC8vIFdlIHdvbid0IG5ldmVyIG5lZWQgaXQuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmF0aXZlUm5nID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XG4gICAgICBzYyA9IG5hdGl2ZVJuZy5zdGFydENvbnRhaW5lcjtcbiAgICAgIHNvID0gbmF0aXZlUm5nLnN0YXJ0T2Zmc2V0O1xuICAgICAgZWMgPSBuYXRpdmVSbmcuZW5kQ29udGFpbmVyO1xuICAgICAgZW8gPSBuYXRpdmVSbmcuZW5kT2Zmc2V0O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJRTg6IFRleHRSYW5nZVxuICAgICAgdmFyIHRleHRSYW5nZSA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO1xuICAgICAgdmFyIHRleHRSYW5nZUVuZCA9IHRleHRSYW5nZS5kdXBsaWNhdGUoKTtcbiAgICAgIHRleHRSYW5nZUVuZC5jb2xsYXBzZShmYWxzZSk7XG4gICAgICB2YXIgdGV4dFJhbmdlU3RhcnQgPSB0ZXh0UmFuZ2U7XG4gICAgICB0ZXh0UmFuZ2VTdGFydC5jb2xsYXBzZSh0cnVlKTtcbiAgICAgIHZhciBzdGFydFBvaW50ID0gdGV4dFJhbmdlVG9Qb2ludCh0ZXh0UmFuZ2VTdGFydCwgdHJ1ZSk7XG4gICAgICB2YXIgZW5kUG9pbnQgPSB0ZXh0UmFuZ2VUb1BvaW50KHRleHRSYW5nZUVuZCwgZmFsc2UpOyAvLyBzYW1lIHZpc2libGUgcG9pbnQgY2FzZTogcmFuZ2Ugd2FzIGNvbGxhcHNlZC5cblxuICAgICAgaWYgKGRvbS5pc1RleHQoc3RhcnRQb2ludC5ub2RlKSAmJiBkb20uaXNMZWZ0RWRnZVBvaW50KHN0YXJ0UG9pbnQpICYmIGRvbS5pc1RleHROb2RlKGVuZFBvaW50Lm5vZGUpICYmIGRvbS5pc1JpZ2h0RWRnZVBvaW50KGVuZFBvaW50KSAmJiBlbmRQb2ludC5ub2RlLm5leHRTaWJsaW5nID09PSBzdGFydFBvaW50Lm5vZGUpIHtcbiAgICAgICAgc3RhcnRQb2ludCA9IGVuZFBvaW50O1xuICAgICAgfVxuXG4gICAgICBzYyA9IHN0YXJ0UG9pbnQuY29udDtcbiAgICAgIHNvID0gc3RhcnRQb2ludC5vZmZzZXQ7XG4gICAgICBlYyA9IGVuZFBvaW50LmNvbnQ7XG4gICAgICBlbyA9IGVuZFBvaW50Lm9mZnNldDtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IHJhbmdlX1dyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBtZXRob2RcbiAgICpcbiAgICogY3JlYXRlIFdyYXBwZWRSYW5nZSBmcm9tIG5vZGVcbiAgICpcbiAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICovXG4gIGNyZWF0ZUZyb21Ob2RlOiBmdW5jdGlvbiBjcmVhdGVGcm9tTm9kZShub2RlKSB7XG4gICAgdmFyIHNjID0gbm9kZTtcbiAgICB2YXIgc28gPSAwO1xuICAgIHZhciBlYyA9IG5vZGU7XG4gICAgdmFyIGVvID0gZG9tLm5vZGVMZW5ndGgoZWMpOyAvLyBicm93c2VycyBjYW4ndCB0YXJnZXQgYSBwaWN0dXJlIG9yIHZvaWQgbm9kZVxuXG4gICAgaWYgKGRvbS5pc1ZvaWQoc2MpKSB7XG4gICAgICBzbyA9IGRvbS5saXN0UHJldihzYykubGVuZ3RoIC0gMTtcbiAgICAgIHNjID0gc2MucGFyZW50Tm9kZTtcbiAgICB9XG5cbiAgICBpZiAoZG9tLmlzQlIoZWMpKSB7XG4gICAgICBlbyA9IGRvbS5saXN0UHJldihlYykubGVuZ3RoIC0gMTtcbiAgICAgIGVjID0gZWMucGFyZW50Tm9kZTtcbiAgICB9IGVsc2UgaWYgKGRvbS5pc1ZvaWQoZWMpKSB7XG4gICAgICBlbyA9IGRvbS5saXN0UHJldihlYykubGVuZ3RoO1xuICAgICAgZWMgPSBlYy5wYXJlbnROb2RlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNyZWF0ZShzYywgc28sIGVjLCBlbyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIGNyZWF0ZSBXcmFwcGVkUmFuZ2UgZnJvbSBub2RlIGFmdGVyIHBvc2l0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAqL1xuICBjcmVhdGVGcm9tTm9kZUJlZm9yZTogZnVuY3Rpb24gY3JlYXRlRnJvbU5vZGVCZWZvcmUobm9kZSkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZUZyb21Ob2RlKG5vZGUpLmNvbGxhcHNlKHRydWUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBjcmVhdGUgV3JhcHBlZFJhbmdlIGZyb20gbm9kZSBhZnRlciBwb3NpdGlvblxuICAgKlxuICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgKi9cbiAgY3JlYXRlRnJvbU5vZGVBZnRlcjogZnVuY3Rpb24gY3JlYXRlRnJvbU5vZGVBZnRlcihub2RlKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlRnJvbU5vZGUobm9kZSkuY29sbGFwc2UoKTtcbiAgfSxcblxuICAvKipcbiAgICogQG1ldGhvZFxuICAgKlxuICAgKiBjcmVhdGUgV3JhcHBlZFJhbmdlIGZyb20gYm9va21hcmtcbiAgICpcbiAgICogQHBhcmFtIHtOb2RlfSBlZGl0YWJsZVxuICAgKiBAcGFyYW0ge09iamVjdH0gYm9va21hcmtcbiAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgKi9cbiAgY3JlYXRlRnJvbUJvb2ttYXJrOiBmdW5jdGlvbiBjcmVhdGVGcm9tQm9va21hcmsoZWRpdGFibGUsIGJvb2ttYXJrKSB7XG4gICAgdmFyIHNjID0gZG9tLmZyb21PZmZzZXRQYXRoKGVkaXRhYmxlLCBib29rbWFyay5zLnBhdGgpO1xuICAgIHZhciBzbyA9IGJvb2ttYXJrLnMub2Zmc2V0O1xuICAgIHZhciBlYyA9IGRvbS5mcm9tT2Zmc2V0UGF0aChlZGl0YWJsZSwgYm9va21hcmsuZS5wYXRoKTtcbiAgICB2YXIgZW8gPSBib29rbWFyay5lLm9mZnNldDtcbiAgICByZXR1cm4gbmV3IHJhbmdlX1dyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBtZXRob2RcbiAgICpcbiAgICogY3JlYXRlIFdyYXBwZWRSYW5nZSBmcm9tIHBhcmFCb29rbWFya1xuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gYm9va21hcmtcbiAgICogQHBhcmFtIHtOb2RlW119IHBhcmFzXG4gICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICovXG4gIGNyZWF0ZUZyb21QYXJhQm9va21hcms6IGZ1bmN0aW9uIGNyZWF0ZUZyb21QYXJhQm9va21hcmsoYm9va21hcmssIHBhcmFzKSB7XG4gICAgdmFyIHNvID0gYm9va21hcmsucy5vZmZzZXQ7XG4gICAgdmFyIGVvID0gYm9va21hcmsuZS5vZmZzZXQ7XG4gICAgdmFyIHNjID0gZG9tLmZyb21PZmZzZXRQYXRoKGxpc3RzLmhlYWQocGFyYXMpLCBib29rbWFyay5zLnBhdGgpO1xuICAgIHZhciBlYyA9IGRvbS5mcm9tT2Zmc2V0UGF0aChsaXN0cy5sYXN0KHBhcmFzKSwgYm9va21hcmsuZS5wYXRoKTtcbiAgICByZXR1cm4gbmV3IHJhbmdlX1dyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gIH1cbn0pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9jb3JlL2tleS5qc1xuXG5cbnZhciBLRVlfTUFQID0ge1xuICAnQkFDS1NQQUNFJzogOCxcbiAgJ1RBQic6IDksXG4gICdFTlRFUic6IDEzLFxuICAnRVNDQVBFJzogMjcsXG4gICdTUEFDRSc6IDMyLFxuICAnREVMRVRFJzogNDYsXG4gIC8vIEFycm93XG4gICdMRUZUJzogMzcsXG4gICdVUCc6IDM4LFxuICAnUklHSFQnOiAzOSxcbiAgJ0RPV04nOiA0MCxcbiAgLy8gTnVtYmVyOiAwLTlcbiAgJ05VTTAnOiA0OCxcbiAgJ05VTTEnOiA0OSxcbiAgJ05VTTInOiA1MCxcbiAgJ05VTTMnOiA1MSxcbiAgJ05VTTQnOiA1MixcbiAgJ05VTTUnOiA1MyxcbiAgJ05VTTYnOiA1NCxcbiAgJ05VTTcnOiA1NSxcbiAgJ05VTTgnOiA1NixcbiAgLy8gQWxwaGFiZXQ6IGEtelxuICAnQic6IDY2LFxuICAnRSc6IDY5LFxuICAnSSc6IDczLFxuICAnSic6IDc0LFxuICAnSyc6IDc1LFxuICAnTCc6IDc2LFxuICAnUic6IDgyLFxuICAnUyc6IDgzLFxuICAnVSc6IDg1LFxuICAnVic6IDg2LFxuICAnWSc6IDg5LFxuICAnWic6IDkwLFxuICAnU0xBU0gnOiAxOTEsXG4gICdMRUZUQlJBQ0tFVCc6IDIxOSxcbiAgJ0JBQ0tTTEFTSCc6IDIyMCxcbiAgJ1JJR0hUQlJBQ0tFVCc6IDIyMSxcbiAgLy8gTmF2aWdhdGlvblxuICAnSE9NRSc6IDM2LFxuICAnRU5EJzogMzUsXG4gICdQQUdFVVAnOiAzMyxcbiAgJ1BBR0VET1dOJzogMzRcbn07XG4vKipcbiAqIEBjbGFzcyBjb3JlLmtleVxuICpcbiAqIE9iamVjdCBmb3Iga2V5Y29kZXMuXG4gKlxuICogQHNpbmdsZXRvblxuICogQGFsdGVybmF0ZUNsYXNzTmFtZSBrZXlcbiAqL1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBjb3JlX2tleSA9ICh7XG4gIC8qKlxuICAgKiBAbWV0aG9kIGlzRWRpdFxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0ga2V5Q29kZVxuICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgKi9cbiAgaXNFZGl0OiBmdW5jdGlvbiBpc0VkaXQoa2V5Q29kZSkge1xuICAgIHJldHVybiBsaXN0cy5jb250YWlucyhbS0VZX01BUC5CQUNLU1BBQ0UsIEtFWV9NQVAuVEFCLCBLRVlfTUFQLkVOVEVSLCBLRVlfTUFQLlNQQUNFLCBLRVlfTUFQLkRFTEVURV0sIGtleUNvZGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGlzTW92ZVxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0ga2V5Q29kZVxuICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgKi9cbiAgaXNNb3ZlOiBmdW5jdGlvbiBpc01vdmUoa2V5Q29kZSkge1xuICAgIHJldHVybiBsaXN0cy5jb250YWlucyhbS0VZX01BUC5MRUZULCBLRVlfTUFQLlVQLCBLRVlfTUFQLlJJR0hULCBLRVlfTUFQLkRPV05dLCBrZXlDb2RlKTtcbiAgfSxcblxuICAvKipcbiAgICogQG1ldGhvZCBpc05hdmlnYXRpb25cbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGtleUNvZGVcbiAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICovXG4gIGlzTmF2aWdhdGlvbjogZnVuY3Rpb24gaXNOYXZpZ2F0aW9uKGtleUNvZGUpIHtcbiAgICByZXR1cm4gbGlzdHMuY29udGFpbnMoW0tFWV9NQVAuSE9NRSwgS0VZX01BUC5FTkQsIEtFWV9NQVAuUEFHRVVQLCBLRVlfTUFQLlBBR0VET1dOXSwga2V5Q29kZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBuYW1lRnJvbUNvZGVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IG5hbWVGcm9tQ29kZS44IFwiQkFDS1NQQUNFXCJcbiAgICovXG4gIG5hbWVGcm9tQ29kZTogZnVuYy5pbnZlcnRPYmplY3QoS0VZX01BUCksXG4gIGNvZGU6IEtFWV9NQVBcbn0pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9jb3JlL2FzeW5jLmpzXG5cbi8qKlxuICogQG1ldGhvZCByZWFkRmlsZUFzRGF0YVVSTFxuICpcbiAqIHJlYWQgY29udGVudHMgb2YgZmlsZSBhcyByZXByZXNlbnRpbmcgVVJMXG4gKlxuICogQHBhcmFtIHtGaWxlfSBmaWxlXG4gKiBAcmV0dXJuIHtQcm9taXNlfSAtIHRoZW46IGRhdGFVcmxcbiAqL1xuXG5mdW5jdGlvbiByZWFkRmlsZUFzRGF0YVVSTChmaWxlKSB7XG4gIHJldHVybiBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5EZWZlcnJlZChmdW5jdGlvbiAoZGVmZXJyZWQpIHtcbiAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5leHRlbmQobmV3IEZpbGVSZWFkZXIoKSwge1xuICAgICAgb25sb2FkOiBmdW5jdGlvbiBvbmxvYWQoZSkge1xuICAgICAgICB2YXIgZGF0YVVSTCA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhVVJMKTtcbiAgICAgIH0sXG4gICAgICBvbmVycm9yOiBmdW5jdGlvbiBvbmVycm9yKGVycikge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICB9KS5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICB9KS5wcm9taXNlKCk7XG59XG4vKipcbiAqIEBtZXRob2QgY3JlYXRlSW1hZ2VcbiAqXG4gKiBjcmVhdGUgYDxpbWFnZT5gIGZyb20gdXJsIHN0cmluZ1xuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB1cmxcbiAqIEByZXR1cm4ge1Byb21pc2V9IC0gdGhlbjogJGltYWdlXG4gKi9cblxuZnVuY3Rpb24gY3JlYXRlSW1hZ2UodXJsKSB7XG4gIHJldHVybiBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5EZWZlcnJlZChmdW5jdGlvbiAoZGVmZXJyZWQpIHtcbiAgICB2YXIgJGltZyA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8aW1nPicpO1xuICAgICRpbWcub25lKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgJGltZy5vZmYoJ2Vycm9yIGFib3J0Jyk7XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKCRpbWcpO1xuICAgIH0pLm9uZSgnZXJyb3IgYWJvcnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAkaW1nLm9mZignbG9hZCcpLmRldGFjaCgpO1xuICAgICAgZGVmZXJyZWQucmVqZWN0KCRpbWcpO1xuICAgIH0pLmNzcyh7XG4gICAgICBkaXNwbGF5OiAnbm9uZSdcbiAgICB9KS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KS5hdHRyKCdzcmMnLCB1cmwpO1xuICB9KS5wcm9taXNlKCk7XG59XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL2VkaXRpbmcvSGlzdG9yeS5qc1xuZnVuY3Rpb24gSGlzdG9yeV9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEhpc3RvcnlfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIEhpc3RvcnlfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBIaXN0b3J5X2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBIaXN0b3J5X2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG52YXIgSGlzdG9yeV9IaXN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSGlzdG9yeShjb250ZXh0KSB7XG4gICAgSGlzdG9yeV9jbGFzc0NhbGxDaGVjayh0aGlzLCBIaXN0b3J5KTtcblxuICAgIHRoaXMuc3RhY2sgPSBbXTtcbiAgICB0aGlzLnN0YWNrT2Zmc2V0ID0gLTE7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLiRlZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZTtcbiAgICB0aGlzLmVkaXRhYmxlID0gdGhpcy4kZWRpdGFibGVbMF07XG4gIH1cblxuICBIaXN0b3J5X2NyZWF0ZUNsYXNzKEhpc3RvcnksIFt7XG4gICAga2V5OiBcIm1ha2VTbmFwc2hvdFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBtYWtlU25hcHNob3QoKSB7XG4gICAgICB2YXIgcm5nID0gcmFuZ2UuY3JlYXRlKHRoaXMuZWRpdGFibGUpO1xuICAgICAgdmFyIGVtcHR5Qm9va21hcmsgPSB7XG4gICAgICAgIHM6IHtcbiAgICAgICAgICBwYXRoOiBbXSxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfSxcbiAgICAgICAgZToge1xuICAgICAgICAgIHBhdGg6IFtdLFxuICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udGVudHM6IHRoaXMuJGVkaXRhYmxlLmh0bWwoKSxcbiAgICAgICAgYm9va21hcms6IHJuZyAmJiBybmcuaXNPbkVkaXRhYmxlKCkgPyBybmcuYm9va21hcmsodGhpcy5lZGl0YWJsZSkgOiBlbXB0eUJvb2ttYXJrXG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJhcHBseVNuYXBzaG90XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5U25hcHNob3Qoc25hcHNob3QpIHtcbiAgICAgIGlmIChzbmFwc2hvdC5jb250ZW50cyAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLiRlZGl0YWJsZS5odG1sKHNuYXBzaG90LmNvbnRlbnRzKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNuYXBzaG90LmJvb2ttYXJrICE9PSBudWxsKSB7XG4gICAgICAgIHJhbmdlLmNyZWF0ZUZyb21Cb29rbWFyayh0aGlzLmVkaXRhYmxlLCBzbmFwc2hvdC5ib29rbWFyaykuc2VsZWN0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICogQG1ldGhvZCByZXdpbmRcbiAgICAqIFJld2luZHMgdGhlIGhpc3Rvcnkgc3RhY2sgYmFjayB0byB0aGUgZmlyc3Qgc25hcHNob3QgdGFrZW4uXG4gICAgKiBMZWF2ZXMgdGhlIHN0YWNrIGludGFjdCwgc28gdGhhdCBcIlJlZG9cIiBjYW4gc3RpbGwgYmUgdXNlZC5cbiAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicmV3aW5kXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJld2luZCgpIHtcbiAgICAgIC8vIENyZWF0ZSBzbmFwIHNob3QgaWYgbm90IHlldCByZWNvcmRlZFxuICAgICAgaWYgKHRoaXMuJGVkaXRhYmxlLmh0bWwoKSAhPT0gdGhpcy5zdGFja1t0aGlzLnN0YWNrT2Zmc2V0XS5jb250ZW50cykge1xuICAgICAgICB0aGlzLnJlY29yZFVuZG8oKTtcbiAgICAgIH0gLy8gUmV0dXJuIHRvIHRoZSBmaXJzdCBhdmFpbGFibGUgc25hcHNob3QuXG5cblxuICAgICAgdGhpcy5zdGFja09mZnNldCA9IDA7IC8vIEFwcGx5IHRoYXQgc25hcHNob3QuXG5cbiAgICAgIHRoaXMuYXBwbHlTbmFwc2hvdCh0aGlzLnN0YWNrW3RoaXMuc3RhY2tPZmZzZXRdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgKiAgQG1ldGhvZCBjb21taXRcbiAgICAqICBSZXNldHMgaGlzdG9yeSBzdGFjaywgYnV0IGtlZXBzIGN1cnJlbnQgZWRpdG9yJ3MgY29udGVudC5cbiAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY29tbWl0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNvbW1pdCgpIHtcbiAgICAgIC8vIENsZWFyIHRoZSBzdGFjay5cbiAgICAgIHRoaXMuc3RhY2sgPSBbXTsgLy8gUmVzdG9yZSBzdGFja09mZnNldCB0byBpdHMgb3JpZ2luYWwgdmFsdWUuXG5cbiAgICAgIHRoaXMuc3RhY2tPZmZzZXQgPSAtMTsgLy8gUmVjb3JkIG91ciBmaXJzdCBzbmFwc2hvdCAob2Ygbm90aGluZykuXG5cbiAgICAgIHRoaXMucmVjb3JkVW5kbygpO1xuICAgIH1cbiAgICAvKipcbiAgICAqIEBtZXRob2QgcmVzZXRcbiAgICAqIFJlc2V0cyB0aGUgaGlzdG9yeSBzdGFjayBjb21wbGV0ZWx5OyByZXZlcnRpbmcgdG8gYW4gZW1wdHkgZWRpdG9yLlxuICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZXNldFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgIC8vIENsZWFyIHRoZSBzdGFjay5cbiAgICAgIHRoaXMuc3RhY2sgPSBbXTsgLy8gUmVzdG9yZSBzdGFja09mZnNldCB0byBpdHMgb3JpZ2luYWwgdmFsdWUuXG5cbiAgICAgIHRoaXMuc3RhY2tPZmZzZXQgPSAtMTsgLy8gQ2xlYXIgdGhlIGVkaXRhYmxlIGFyZWEuXG5cbiAgICAgIHRoaXMuJGVkaXRhYmxlLmh0bWwoJycpOyAvLyBSZWNvcmQgb3VyIGZpcnN0IHNuYXBzaG90IChvZiBub3RoaW5nKS5cblxuICAgICAgdGhpcy5yZWNvcmRVbmRvKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHVuZG9cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInVuZG9cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdW5kbygpIHtcbiAgICAgIC8vIENyZWF0ZSBzbmFwIHNob3QgaWYgbm90IHlldCByZWNvcmRlZFxuICAgICAgaWYgKHRoaXMuJGVkaXRhYmxlLmh0bWwoKSAhPT0gdGhpcy5zdGFja1t0aGlzLnN0YWNrT2Zmc2V0XS5jb250ZW50cykge1xuICAgICAgICB0aGlzLnJlY29yZFVuZG8oKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuc3RhY2tPZmZzZXQgPiAwKSB7XG4gICAgICAgIHRoaXMuc3RhY2tPZmZzZXQtLTtcbiAgICAgICAgdGhpcy5hcHBseVNuYXBzaG90KHRoaXMuc3RhY2tbdGhpcy5zdGFja09mZnNldF0pO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiByZWRvXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZWRvXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlZG8oKSB7XG4gICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggLSAxID4gdGhpcy5zdGFja09mZnNldCkge1xuICAgICAgICB0aGlzLnN0YWNrT2Zmc2V0Kys7XG4gICAgICAgIHRoaXMuYXBwbHlTbmFwc2hvdCh0aGlzLnN0YWNrW3RoaXMuc3RhY2tPZmZzZXRdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogcmVjb3JkZWQgdW5kb1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicmVjb3JkVW5kb1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZWNvcmRVbmRvKCkge1xuICAgICAgdGhpcy5zdGFja09mZnNldCsrOyAvLyBXYXNoIG91dCBzdGFjayBhZnRlciBzdGFja09mZnNldFxuXG4gICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPiB0aGlzLnN0YWNrT2Zmc2V0KSB7XG4gICAgICAgIHRoaXMuc3RhY2sgPSB0aGlzLnN0YWNrLnNsaWNlKDAsIHRoaXMuc3RhY2tPZmZzZXQpO1xuICAgICAgfSAvLyBDcmVhdGUgbmV3IHNuYXBzaG90IGFuZCBwdXNoIGl0IHRvIHRoZSBlbmRcblxuXG4gICAgICB0aGlzLnN0YWNrLnB1c2godGhpcy5tYWtlU25hcHNob3QoKSk7IC8vIElmIHRoZSBzdGFjayBzaXplIHJlYWNocyB0byB0aGUgbGltaXQsIHRoZW4gc2xpY2UgaXRcblxuICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID4gdGhpcy5jb250ZXh0Lm9wdGlvbnMuaGlzdG9yeUxpbWl0KSB7XG4gICAgICAgIHRoaXMuc3RhY2suc2hpZnQoKTtcbiAgICAgICAgdGhpcy5zdGFja09mZnNldCAtPSAxO1xuICAgICAgfVxuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBIaXN0b3J5O1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvZWRpdGluZy9TdHlsZS5qc1xuZnVuY3Rpb24gU3R5bGVfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBTdHlsZV9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gU3R5bGVfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBTdHlsZV9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgU3R5bGVfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxuXG5cblxudmFyIFN0eWxlX1N0eWxlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3R5bGUoKSB7XG4gICAgU3R5bGVfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3R5bGUpO1xuICB9XG5cbiAgU3R5bGVfY3JlYXRlQ2xhc3MoU3R5bGUsIFt7XG4gICAga2V5OiBcImpRdWVyeUNTU1wiLFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBqUXVlcnlDU1NcbiAgICAgKlxuICAgICAqIFt3b3JrYXJvdW5kXSBmb3Igb2xkIGpRdWVyeVxuICAgICAqIHBhc3NpbmcgYW4gYXJyYXkgb2Ygc3R5bGUgcHJvcGVydGllcyB0byAuY3NzKClcbiAgICAgKiB3aWxsIHJlc3VsdCBpbiBhbiBvYmplY3Qgb2YgcHJvcGVydHktdmFsdWUgcGFpcnMuXG4gICAgICogKGNvbXBhYmlsaXR5IHdpdGggdmVyc2lvbiA8IDEuOSlcbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtICB7alF1ZXJ5fSAkb2JqXG4gICAgICogQHBhcmFtICB7QXJyYXl9IHByb3BlcnR5TmFtZXMgLSBBbiBhcnJheSBvZiBvbmUgb3IgbW9yZSBDU1MgcHJvcGVydGllcy5cbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICovXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGpRdWVyeUNTUygkb2JqLCBwcm9wZXJ0eU5hbWVzKSB7XG4gICAgICBpZiAoZW52LmpxdWVyeVZlcnNpb24gPCAxLjkpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKHByb3BlcnR5TmFtZXMsIGZ1bmN0aW9uIChpZHgsIHByb3BlcnR5TmFtZSkge1xuICAgICAgICAgIHJlc3VsdFtwcm9wZXJ0eU5hbWVdID0gJG9iai5jc3MocHJvcGVydHlOYW1lKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAkb2JqLmNzcyhwcm9wZXJ0eU5hbWVzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogcmV0dXJucyBzdHlsZSBvYmplY3QgZnJvbSBub2RlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJG5vZGVcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmcm9tTm9kZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmcm9tTm9kZSgkbm9kZSkge1xuICAgICAgdmFyIHByb3BlcnRpZXMgPSBbJ2ZvbnQtZmFtaWx5JywgJ2ZvbnQtc2l6ZScsICd0ZXh0LWFsaWduJywgJ2xpc3Qtc3R5bGUtdHlwZScsICdsaW5lLWhlaWdodCddO1xuICAgICAgdmFyIHN0eWxlSW5mbyA9IHRoaXMualF1ZXJ5Q1NTKCRub2RlLCBwcm9wZXJ0aWVzKSB8fCB7fTtcbiAgICAgIHZhciBmb250U2l6ZSA9ICRub2RlWzBdLnN0eWxlLmZvbnRTaXplIHx8IHN0eWxlSW5mb1snZm9udC1zaXplJ107XG4gICAgICBzdHlsZUluZm9bJ2ZvbnQtc2l6ZSddID0gcGFyc2VJbnQoZm9udFNpemUsIDEwKTtcbiAgICAgIHN0eWxlSW5mb1snZm9udC1zaXplLXVuaXQnXSA9IGZvbnRTaXplLm1hdGNoKC9bYS16JV0rJC8pO1xuICAgICAgcmV0dXJuIHN0eWxlSW5mbztcbiAgICB9XG4gICAgLyoqXG4gICAgICogcGFyYWdyYXBoIGxldmVsIHN0eWxlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dyYXBwZWRSYW5nZX0gcm5nXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHN0eWxlSW5mb1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwic3R5bGVQYXJhXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHN0eWxlUGFyYShybmcsIHN0eWxlSW5mbykge1xuICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChybmcubm9kZXMoZG9tLmlzUGFyYSwge1xuICAgICAgICBpbmNsdWRlQW5jZXN0b3I6IHRydWVcbiAgICAgIH0pLCBmdW5jdGlvbiAoaWR4LCBwYXJhKSB7XG4gICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHBhcmEpLmNzcyhzdHlsZUluZm8pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGluc2VydCBhbmQgcmV0dXJucyBzdHlsZU5vZGVzIG9uIHJhbmdlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtXcmFwcGVkUmFuZ2V9IHJuZ1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBvcHRpb25zIGZvciBzdHlsZU5vZGVzXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLm5vZGVOYW1lXSAtIGRlZmF1bHQ6IGBTUEFOYFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZXhwYW5kQ2xvc2VzdFNpYmxpbmddIC0gZGVmYXVsdDogYGZhbHNlYFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMub25seVBhcnRpYWxDb250YWluc10gLSBkZWZhdWx0OiBgZmFsc2VgXG4gICAgICogQHJldHVybiB7Tm9kZVtdfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwic3R5bGVOb2Rlc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzdHlsZU5vZGVzKHJuZywgb3B0aW9ucykge1xuICAgICAgcm5nID0gcm5nLnNwbGl0VGV4dCgpO1xuICAgICAgdmFyIG5vZGVOYW1lID0gb3B0aW9ucyAmJiBvcHRpb25zLm5vZGVOYW1lIHx8ICdTUEFOJztcbiAgICAgIHZhciBleHBhbmRDbG9zZXN0U2libGluZyA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5leHBhbmRDbG9zZXN0U2libGluZyk7XG4gICAgICB2YXIgb25seVBhcnRpYWxDb250YWlucyA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5vbmx5UGFydGlhbENvbnRhaW5zKTtcblxuICAgICAgaWYgKHJuZy5pc0NvbGxhcHNlZCgpKSB7XG4gICAgICAgIHJldHVybiBbcm5nLmluc2VydE5vZGUoZG9tLmNyZWF0ZShub2RlTmFtZSkpXTtcbiAgICAgIH1cblxuICAgICAgdmFyIHByZWQgPSBkb20ubWFrZVByZWRCeU5vZGVOYW1lKG5vZGVOYW1lKTtcbiAgICAgIHZhciBub2RlcyA9IHJuZy5ub2Rlcyhkb20uaXNUZXh0LCB7XG4gICAgICAgIGZ1bGx5Q29udGFpbnM6IHRydWVcbiAgICAgIH0pLm1hcChmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICByZXR1cm4gZG9tLnNpbmdsZUNoaWxkQW5jZXN0b3IodGV4dCwgcHJlZCkgfHwgZG9tLndyYXAodGV4dCwgbm9kZU5hbWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChleHBhbmRDbG9zZXN0U2libGluZykge1xuICAgICAgICBpZiAob25seVBhcnRpYWxDb250YWlucykge1xuICAgICAgICAgIHZhciBub2Rlc0luUmFuZ2UgPSBybmcubm9kZXMoKTsgLy8gY29tcG9zZSB3aXRoIHBhcnRpYWwgY29udGFpbnMgcHJlZGljYXRpb25cblxuICAgICAgICAgIHByZWQgPSBmdW5jLmFuZChwcmVkLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIGxpc3RzLmNvbnRhaW5zKG5vZGVzSW5SYW5nZSwgbm9kZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbm9kZXMubWFwKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgdmFyIHNpYmxpbmdzID0gZG9tLndpdGhDbG9zZXN0U2libGluZ3Mobm9kZSwgcHJlZCk7XG4gICAgICAgICAgdmFyIGhlYWQgPSBsaXN0cy5oZWFkKHNpYmxpbmdzKTtcbiAgICAgICAgICB2YXIgdGFpbHMgPSBsaXN0cy50YWlsKHNpYmxpbmdzKTtcbiAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKHRhaWxzLCBmdW5jdGlvbiAoaWR4LCBlbGVtKSB7XG4gICAgICAgICAgICBkb20uYXBwZW5kQ2hpbGROb2RlcyhoZWFkLCBlbGVtLmNoaWxkTm9kZXMpO1xuICAgICAgICAgICAgZG9tLnJlbW92ZShlbGVtKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gbGlzdHMuaGVhZChzaWJsaW5ncyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5vZGVzO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBnZXQgY3VycmVudCBzdHlsZSBvbiBjdXJzb3JcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IC0gb2JqZWN0IGNvbnRhaW5zIHN0eWxlIHByb3BlcnRpZXMuXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJjdXJyZW50XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGN1cnJlbnQocm5nKSB7XG4gICAgICB2YXIgJGNvbnQgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSghZG9tLmlzRWxlbWVudChybmcuc2MpID8gcm5nLnNjLnBhcmVudE5vZGUgOiBybmcuc2MpO1xuICAgICAgdmFyIHN0eWxlSW5mbyA9IHRoaXMuZnJvbU5vZGUoJGNvbnQpOyAvLyBkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZSBmb3IgdG9nZ2xlIHN0YXRlXG4gICAgICAvLyBbd29ya2Fyb3VuZF0gcHJldmVudCBGaXJlZm94IG5zcmVzdWx0OiBcIjB4ODAwMDQwMDUgKE5TX0VSUk9SX0ZBSUxVUkUpXCJcblxuICAgICAgdHJ5IHtcbiAgICAgICAgc3R5bGVJbmZvID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZXh0ZW5kKHN0eWxlSW5mbywge1xuICAgICAgICAgICdmb250LWJvbGQnOiBkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZSgnYm9sZCcpID8gJ2JvbGQnIDogJ25vcm1hbCcsXG4gICAgICAgICAgJ2ZvbnQtaXRhbGljJzogZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoJ2l0YWxpYycpID8gJ2l0YWxpYycgOiAnbm9ybWFsJyxcbiAgICAgICAgICAnZm9udC11bmRlcmxpbmUnOiBkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZSgndW5kZXJsaW5lJykgPyAndW5kZXJsaW5lJyA6ICdub3JtYWwnLFxuICAgICAgICAgICdmb250LXN1YnNjcmlwdCc6IGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKCdzdWJzY3JpcHQnKSA/ICdzdWJzY3JpcHQnIDogJ25vcm1hbCcsXG4gICAgICAgICAgJ2ZvbnQtc3VwZXJzY3JpcHQnOiBkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZSgnc3VwZXJzY3JpcHQnKSA/ICdzdXBlcnNjcmlwdCcgOiAnbm9ybWFsJyxcbiAgICAgICAgICAnZm9udC1zdHJpa2V0aHJvdWdoJzogZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoJ3N0cmlrZXRocm91Z2gnKSA/ICdzdHJpa2V0aHJvdWdoJyA6ICdub3JtYWwnLFxuICAgICAgICAgICdmb250LWZhbWlseSc6IGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFZhbHVlKCdmb250bmFtZScpIHx8IHN0eWxlSW5mb1snZm9udC1mYW1pbHknXVxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHt9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgLy8gbGlzdC1zdHlsZS10eXBlIHRvIGxpc3Qtc3R5bGUodW5vcmRlcmVkLCBvcmRlcmVkKVxuXG5cbiAgICAgIGlmICghcm5nLmlzT25MaXN0KCkpIHtcbiAgICAgICAgc3R5bGVJbmZvWydsaXN0LXN0eWxlJ10gPSAnbm9uZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgb3JkZXJlZFR5cGVzID0gWydjaXJjbGUnLCAnZGlzYycsICdkaXNjLWxlYWRpbmctemVybycsICdzcXVhcmUnXTtcbiAgICAgICAgdmFyIGlzVW5vcmRlcmVkID0gb3JkZXJlZFR5cGVzLmluZGV4T2Yoc3R5bGVJbmZvWydsaXN0LXN0eWxlLXR5cGUnXSkgPiAtMTtcbiAgICAgICAgc3R5bGVJbmZvWydsaXN0LXN0eWxlJ10gPSBpc1Vub3JkZXJlZCA/ICd1bm9yZGVyZWQnIDogJ29yZGVyZWQnO1xuICAgICAgfVxuXG4gICAgICB2YXIgcGFyYSA9IGRvbS5hbmNlc3Rvcihybmcuc2MsIGRvbS5pc1BhcmEpO1xuXG4gICAgICBpZiAocGFyYSAmJiBwYXJhLnN0eWxlWydsaW5lLWhlaWdodCddKSB7XG4gICAgICAgIHN0eWxlSW5mb1snbGluZS1oZWlnaHQnXSA9IHBhcmEuc3R5bGUubGluZUhlaWdodDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBsaW5lSGVpZ2h0ID0gcGFyc2VJbnQoc3R5bGVJbmZvWydsaW5lLWhlaWdodCddLCAxMCkgLyBwYXJzZUludChzdHlsZUluZm9bJ2ZvbnQtc2l6ZSddLCAxMCk7XG4gICAgICAgIHN0eWxlSW5mb1snbGluZS1oZWlnaHQnXSA9IGxpbmVIZWlnaHQudG9GaXhlZCgxKTtcbiAgICAgIH1cblxuICAgICAgc3R5bGVJbmZvLmFuY2hvciA9IHJuZy5pc09uQW5jaG9yKCkgJiYgZG9tLmFuY2VzdG9yKHJuZy5zYywgZG9tLmlzQW5jaG9yKTtcbiAgICAgIHN0eWxlSW5mby5hbmNlc3RvcnMgPSBkb20ubGlzdEFuY2VzdG9yKHJuZy5zYywgZG9tLmlzRWRpdGFibGUpO1xuICAgICAgc3R5bGVJbmZvLnJhbmdlID0gcm5nO1xuICAgICAgcmV0dXJuIHN0eWxlSW5mbztcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gU3R5bGU7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9lZGl0aW5nL0J1bGxldC5qc1xuZnVuY3Rpb24gQnVsbGV0X2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gQnVsbGV0X2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBCdWxsZXRfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBCdWxsZXRfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIEJ1bGxldF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cblxuXG5cblxuXG52YXIgQnVsbGV0X0J1bGxldCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJ1bGxldCgpIHtcbiAgICBCdWxsZXRfY2xhc3NDYWxsQ2hlY2sodGhpcywgQnVsbGV0KTtcbiAgfVxuXG4gIEJ1bGxldF9jcmVhdGVDbGFzcyhCdWxsZXQsIFt7XG4gICAga2V5OiBcImluc2VydE9yZGVyZWRMaXN0XCIsXG5cbiAgICAvKipcbiAgICAgKiB0b2dnbGUgb3JkZXJlZCBsaXN0XG4gICAgICovXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluc2VydE9yZGVyZWRMaXN0KGVkaXRhYmxlKSB7XG4gICAgICB0aGlzLnRvZ2dsZUxpc3QoJ09MJywgZWRpdGFibGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0b2dnbGUgdW5vcmRlcmVkIGxpc3RcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImluc2VydFVub3JkZXJlZExpc3RcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zZXJ0VW5vcmRlcmVkTGlzdChlZGl0YWJsZSkge1xuICAgICAgdGhpcy50b2dnbGVMaXN0KCdVTCcsIGVkaXRhYmxlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaW5kZW50XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJpbmRlbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5kZW50KGVkaXRhYmxlKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB2YXIgcm5nID0gcmFuZ2UuY3JlYXRlKGVkaXRhYmxlKS53cmFwQm9keUlubGluZVdpdGhQYXJhKCk7XG4gICAgICB2YXIgcGFyYXMgPSBybmcubm9kZXMoZG9tLmlzUGFyYSwge1xuICAgICAgICBpbmNsdWRlQW5jZXN0b3I6IHRydWVcbiAgICAgIH0pO1xuICAgICAgdmFyIGNsdXN0ZXJlZHMgPSBsaXN0cy5jbHVzdGVyQnkocGFyYXMsIGZ1bmMucGVxMigncGFyZW50Tm9kZScpKTtcbiAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmVhY2goY2x1c3RlcmVkcywgZnVuY3Rpb24gKGlkeCwgcGFyYXMpIHtcbiAgICAgICAgdmFyIGhlYWQgPSBsaXN0cy5oZWFkKHBhcmFzKTtcblxuICAgICAgICBpZiAoZG9tLmlzTGkoaGVhZCkpIHtcbiAgICAgICAgICB2YXIgcHJldmlvdXNMaXN0ID0gX3RoaXMuZmluZExpc3QoaGVhZC5wcmV2aW91c1NpYmxpbmcpO1xuXG4gICAgICAgICAgaWYgKHByZXZpb3VzTGlzdCkge1xuICAgICAgICAgICAgcGFyYXMubWFwKGZ1bmN0aW9uIChwYXJhKSB7XG4gICAgICAgICAgICAgIHJldHVybiBwcmV2aW91c0xpc3QuYXBwZW5kQ2hpbGQocGFyYSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMud3JhcExpc3QocGFyYXMsIGhlYWQucGFyZW50Tm9kZS5ub2RlTmFtZSk7XG5cbiAgICAgICAgICAgIHBhcmFzLm1hcChmdW5jdGlvbiAocGFyYSkge1xuICAgICAgICAgICAgICByZXR1cm4gcGFyYS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChwYXJhKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5hcHBlbmRUb1ByZXZpb3VzKHBhcmEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmVhY2gocGFyYXMsIGZ1bmN0aW9uIChpZHgsIHBhcmEpIHtcbiAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHBhcmEpLmNzcygnbWFyZ2luTGVmdCcsIGZ1bmN0aW9uIChpZHgsIHZhbCkge1xuICAgICAgICAgICAgICByZXR1cm4gKHBhcnNlSW50KHZhbCwgMTApIHx8IDApICsgMjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBybmcuc2VsZWN0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIG91dGRlbnRcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIm91dGRlbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gb3V0ZGVudChlZGl0YWJsZSkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHZhciBybmcgPSByYW5nZS5jcmVhdGUoZWRpdGFibGUpLndyYXBCb2R5SW5saW5lV2l0aFBhcmEoKTtcbiAgICAgIHZhciBwYXJhcyA9IHJuZy5ub2Rlcyhkb20uaXNQYXJhLCB7XG4gICAgICAgIGluY2x1ZGVBbmNlc3RvcjogdHJ1ZVxuICAgICAgfSk7XG4gICAgICB2YXIgY2x1c3RlcmVkcyA9IGxpc3RzLmNsdXN0ZXJCeShwYXJhcywgZnVuYy5wZXEyKCdwYXJlbnROb2RlJykpO1xuICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChjbHVzdGVyZWRzLCBmdW5jdGlvbiAoaWR4LCBwYXJhcykge1xuICAgICAgICB2YXIgaGVhZCA9IGxpc3RzLmhlYWQocGFyYXMpO1xuXG4gICAgICAgIGlmIChkb20uaXNMaShoZWFkKSkge1xuICAgICAgICAgIF90aGlzMi5yZWxlYXNlTGlzdChbcGFyYXNdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKHBhcmFzLCBmdW5jdGlvbiAoaWR4LCBwYXJhKSB7XG4gICAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShwYXJhKS5jc3MoJ21hcmdpbkxlZnQnLCBmdW5jdGlvbiAoaWR4LCB2YWwpIHtcbiAgICAgICAgICAgICAgdmFsID0gcGFyc2VJbnQodmFsLCAxMCkgfHwgMDtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbCA+IDI1ID8gdmFsIC0gMjUgOiAnJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJuZy5zZWxlY3QoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogdG9nZ2xlIGxpc3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsaXN0TmFtZSAtIE9MIG9yIFVMXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJ0b2dnbGVMaXN0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRvZ2dsZUxpc3QobGlzdE5hbWUsIGVkaXRhYmxlKSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgdmFyIHJuZyA9IHJhbmdlLmNyZWF0ZShlZGl0YWJsZSkud3JhcEJvZHlJbmxpbmVXaXRoUGFyYSgpO1xuICAgICAgdmFyIHBhcmFzID0gcm5nLm5vZGVzKGRvbS5pc1BhcmEsIHtcbiAgICAgICAgaW5jbHVkZUFuY2VzdG9yOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHZhciBib29rbWFyayA9IHJuZy5wYXJhQm9va21hcmsocGFyYXMpO1xuICAgICAgdmFyIGNsdXN0ZXJlZHMgPSBsaXN0cy5jbHVzdGVyQnkocGFyYXMsIGZ1bmMucGVxMigncGFyZW50Tm9kZScpKTsgLy8gcGFyYWdyYXBoIHRvIGxpc3RcblxuICAgICAgaWYgKGxpc3RzLmZpbmQocGFyYXMsIGRvbS5pc1B1cmVQYXJhKSkge1xuICAgICAgICB2YXIgd3JhcHBlZFBhcmFzID0gW107XG4gICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmVhY2goY2x1c3RlcmVkcywgZnVuY3Rpb24gKGlkeCwgcGFyYXMpIHtcbiAgICAgICAgICB3cmFwcGVkUGFyYXMgPSB3cmFwcGVkUGFyYXMuY29uY2F0KF90aGlzMy53cmFwTGlzdChwYXJhcywgbGlzdE5hbWUpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcmFzID0gd3JhcHBlZFBhcmFzOyAvLyBsaXN0IHRvIHBhcmFncmFwaCBvciBjaGFuZ2UgbGlzdCBzdHlsZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGRpZmZMaXN0cyA9IHJuZy5ub2Rlcyhkb20uaXNMaXN0LCB7XG4gICAgICAgICAgaW5jbHVkZUFuY2VzdG9yOiB0cnVlXG4gICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobGlzdE5vZGUpIHtcbiAgICAgICAgICByZXR1cm4gIWV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLm5vZGVOYW1lKGxpc3ROb2RlLCBsaXN0TmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChkaWZmTGlzdHMubGVuZ3RoKSB7XG4gICAgICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChkaWZmTGlzdHMsIGZ1bmN0aW9uIChpZHgsIGxpc3ROb2RlKSB7XG4gICAgICAgICAgICBkb20ucmVwbGFjZShsaXN0Tm9kZSwgbGlzdE5hbWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhcmFzID0gdGhpcy5yZWxlYXNlTGlzdChjbHVzdGVyZWRzLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByYW5nZS5jcmVhdGVGcm9tUGFyYUJvb2ttYXJrKGJvb2ttYXJrLCBwYXJhcykuc2VsZWN0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Tm9kZVtdfSBwYXJhc1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsaXN0TmFtZVxuICAgICAqIEByZXR1cm4ge05vZGVbXX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIndyYXBMaXN0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHdyYXBMaXN0KHBhcmFzLCBsaXN0TmFtZSkge1xuICAgICAgdmFyIGhlYWQgPSBsaXN0cy5oZWFkKHBhcmFzKTtcbiAgICAgIHZhciBsYXN0ID0gbGlzdHMubGFzdChwYXJhcyk7XG4gICAgICB2YXIgcHJldkxpc3QgPSBkb20uaXNMaXN0KGhlYWQucHJldmlvdXNTaWJsaW5nKSAmJiBoZWFkLnByZXZpb3VzU2libGluZztcbiAgICAgIHZhciBuZXh0TGlzdCA9IGRvbS5pc0xpc3QobGFzdC5uZXh0U2libGluZykgJiYgbGFzdC5uZXh0U2libGluZztcbiAgICAgIHZhciBsaXN0Tm9kZSA9IHByZXZMaXN0IHx8IGRvbS5pbnNlcnRBZnRlcihkb20uY3JlYXRlKGxpc3ROYW1lIHx8ICdVTCcpLCBsYXN0KTsgLy8gUCB0byBMSVxuXG4gICAgICBwYXJhcyA9IHBhcmFzLm1hcChmdW5jdGlvbiAocGFyYSkge1xuICAgICAgICByZXR1cm4gZG9tLmlzUHVyZVBhcmEocGFyYSkgPyBkb20ucmVwbGFjZShwYXJhLCAnTEknKSA6IHBhcmE7XG4gICAgICB9KTsgLy8gYXBwZW5kIHRvIGxpc3QoPHVsPiwgPG9sPilcblxuICAgICAgZG9tLmFwcGVuZENoaWxkTm9kZXMobGlzdE5vZGUsIHBhcmFzKTtcblxuICAgICAgaWYgKG5leHRMaXN0KSB7XG4gICAgICAgIGRvbS5hcHBlbmRDaGlsZE5vZGVzKGxpc3ROb2RlLCBsaXN0cy5mcm9tKG5leHRMaXN0LmNoaWxkTm9kZXMpKTtcbiAgICAgICAgZG9tLnJlbW92ZShuZXh0TGlzdCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwYXJhcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZWxlYXNlTGlzdFxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcnJheVtdfSBjbHVzdGVyZWRzXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc0VzY2Fwc2VUb0JvZHlcbiAgICAgKiBAcmV0dXJuIHtOb2RlW119XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZWxlYXNlTGlzdFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZWxlYXNlTGlzdChjbHVzdGVyZWRzLCBpc0VzY2Fwc2VUb0JvZHkpIHtcbiAgICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgICB2YXIgcmVsZWFzZWRQYXJhcyA9IFtdO1xuICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChjbHVzdGVyZWRzLCBmdW5jdGlvbiAoaWR4LCBwYXJhcykge1xuICAgICAgICB2YXIgaGVhZCA9IGxpc3RzLmhlYWQocGFyYXMpO1xuICAgICAgICB2YXIgbGFzdCA9IGxpc3RzLmxhc3QocGFyYXMpO1xuICAgICAgICB2YXIgaGVhZExpc3QgPSBpc0VzY2Fwc2VUb0JvZHkgPyBkb20ubGFzdEFuY2VzdG9yKGhlYWQsIGRvbS5pc0xpc3QpIDogaGVhZC5wYXJlbnROb2RlO1xuICAgICAgICB2YXIgcGFyZW50SXRlbSA9IGhlYWRMaXN0LnBhcmVudE5vZGU7XG5cbiAgICAgICAgaWYgKGhlYWRMaXN0LnBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdMSScpIHtcbiAgICAgICAgICBwYXJhcy5tYXAoZnVuY3Rpb24gKHBhcmEpIHtcbiAgICAgICAgICAgIHZhciBuZXdMaXN0ID0gX3RoaXM0LmZpbmROZXh0U2libGluZ3MocGFyYSk7XG5cbiAgICAgICAgICAgIGlmIChwYXJlbnRJdGVtLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgICAgIHBhcmVudEl0ZW0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocGFyYSwgcGFyZW50SXRlbS5uZXh0U2libGluZyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwYXJlbnRJdGVtLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQocGFyYSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICBfdGhpczQud3JhcExpc3QobmV3TGlzdCwgaGVhZExpc3Qubm9kZU5hbWUpO1xuXG4gICAgICAgICAgICAgIHBhcmEuYXBwZW5kQ2hpbGQobmV3TGlzdFswXS5wYXJlbnROb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChoZWFkTGlzdC5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHBhcmVudEl0ZW0ucmVtb3ZlQ2hpbGQoaGVhZExpc3QpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChwYXJlbnRJdGVtLmNoaWxkTm9kZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBwYXJlbnRJdGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocGFyZW50SXRlbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBsYXN0TGlzdCA9IGhlYWRMaXN0LmNoaWxkTm9kZXMubGVuZ3RoID4gMSA/IGRvbS5zcGxpdFRyZWUoaGVhZExpc3QsIHtcbiAgICAgICAgICAgIG5vZGU6IGxhc3QucGFyZW50Tm9kZSxcbiAgICAgICAgICAgIG9mZnNldDogZG9tLnBvc2l0aW9uKGxhc3QpICsgMVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGlzU2tpcFBhZGRpbmdCbGFua0hUTUw6IHRydWVcbiAgICAgICAgICB9KSA6IG51bGw7XG4gICAgICAgICAgdmFyIG1pZGRsZUxpc3QgPSBkb20uc3BsaXRUcmVlKGhlYWRMaXN0LCB7XG4gICAgICAgICAgICBub2RlOiBoZWFkLnBhcmVudE5vZGUsXG4gICAgICAgICAgICBvZmZzZXQ6IGRvbS5wb3NpdGlvbihoZWFkKVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGlzU2tpcFBhZGRpbmdCbGFua0hUTUw6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBwYXJhcyA9IGlzRXNjYXBzZVRvQm9keSA/IGRvbS5saXN0RGVzY2VuZGFudChtaWRkbGVMaXN0LCBkb20uaXNMaSkgOiBsaXN0cy5mcm9tKG1pZGRsZUxpc3QuY2hpbGROb2RlcykuZmlsdGVyKGRvbS5pc0xpKTsgLy8gTEkgdG8gUFxuXG4gICAgICAgICAgaWYgKGlzRXNjYXBzZVRvQm9keSB8fCAhZG9tLmlzTGlzdChoZWFkTGlzdC5wYXJlbnROb2RlKSkge1xuICAgICAgICAgICAgcGFyYXMgPSBwYXJhcy5tYXAoZnVuY3Rpb24gKHBhcmEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGRvbS5yZXBsYWNlKHBhcmEsICdQJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKGxpc3RzLmZyb20ocGFyYXMpLnJldmVyc2UoKSwgZnVuY3Rpb24gKGlkeCwgcGFyYSkge1xuICAgICAgICAgICAgZG9tLmluc2VydEFmdGVyKHBhcmEsIGhlYWRMaXN0KTtcbiAgICAgICAgICB9KTsgLy8gcmVtb3ZlIGVtcHR5IGxpc3RzXG5cbiAgICAgICAgICB2YXIgcm9vdExpc3RzID0gbGlzdHMuY29tcGFjdChbaGVhZExpc3QsIG1pZGRsZUxpc3QsIGxhc3RMaXN0XSk7XG4gICAgICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChyb290TGlzdHMsIGZ1bmN0aW9uIChpZHgsIHJvb3RMaXN0KSB7XG4gICAgICAgICAgICB2YXIgbGlzdE5vZGVzID0gW3Jvb3RMaXN0XS5jb25jYXQoZG9tLmxpc3REZXNjZW5kYW50KHJvb3RMaXN0LCBkb20uaXNMaXN0KSk7XG4gICAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKGxpc3ROb2Rlcy5yZXZlcnNlKCksIGZ1bmN0aW9uIChpZHgsIGxpc3ROb2RlKSB7XG4gICAgICAgICAgICAgIGlmICghZG9tLm5vZGVMZW5ndGgobGlzdE5vZGUpKSB7XG4gICAgICAgICAgICAgICAgZG9tLnJlbW92ZShsaXN0Tm9kZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVsZWFzZWRQYXJhcyA9IHJlbGVhc2VkUGFyYXMuY29uY2F0KHBhcmFzKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlbGVhc2VkUGFyYXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgYXBwZW5kVG9QcmV2aW91c1xuICAgICAqXG4gICAgICogQXBwZW5kcyBsaXN0IHRvIHByZXZpb3VzIGxpc3QgaXRlbSwgaWZcbiAgICAgKiBub25lIGV4aXN0IGl0IHdyYXBzIHRoZSBsaXN0IGluIGEgbmV3IGxpc3QgaXRlbS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7SFRNTE5vZGV9IExpc3RJdGVtXG4gICAgICogQHJldHVybiB7SFRNTE5vZGV9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJhcHBlbmRUb1ByZXZpb3VzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZFRvUHJldmlvdXMobm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUucHJldmlvdXNTaWJsaW5nID8gZG9tLmFwcGVuZENoaWxkTm9kZXMobm9kZS5wcmV2aW91c1NpYmxpbmcsIFtub2RlXSkgOiB0aGlzLndyYXBMaXN0KFtub2RlXSwgJ0xJJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZmluZExpc3RcbiAgICAgKlxuICAgICAqIEZpbmRzIGFuIGV4aXN0aW5nIGxpc3QgaW4gbGlzdCBpdGVtXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0hUTUxOb2RlfSBMaXN0SXRlbVxuICAgICAqIEByZXR1cm4ge0FycmF5W119XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmaW5kTGlzdFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kTGlzdChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZSA/IGxpc3RzLmZpbmQobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgIHJldHVybiBbJ09MJywgJ1VMJ10uaW5kZXhPZihjaGlsZC5ub2RlTmFtZSkgPiAtMTtcbiAgICAgIH0pIDogbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmaW5kTmV4dFNpYmxpbmdzXG4gICAgICpcbiAgICAgKiBGaW5kcyBhbGwgbGlzdCBpdGVtIHNpYmxpbmdzIHRoYXQgZm9sbG93IGl0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0hUTUxOb2RlfSBMaXN0SXRlbVxuICAgICAqIEByZXR1cm4ge0hUTUxOb2RlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmluZE5leHRTaWJsaW5nc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kTmV4dFNpYmxpbmdzKG5vZGUpIHtcbiAgICAgIHZhciBzaWJsaW5ncyA9IFtdO1xuXG4gICAgICB3aGlsZSAobm9kZS5uZXh0U2libGluZykge1xuICAgICAgICBzaWJsaW5ncy5wdXNoKG5vZGUubmV4dFNpYmxpbmcpO1xuICAgICAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNpYmxpbmdzO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBCdWxsZXQ7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9lZGl0aW5nL1R5cGluZy5qc1xuZnVuY3Rpb24gVHlwaW5nX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gVHlwaW5nX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBUeXBpbmdfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBUeXBpbmdfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIFR5cGluZ19kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cblxuXG5cbi8qKlxuICogQGNsYXNzIGVkaXRpbmcuVHlwaW5nXG4gKlxuICogVHlwaW5nXG4gKlxuICovXG5cbnZhciBUeXBpbmdfVHlwaW5nID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVHlwaW5nKGNvbnRleHQpIHtcbiAgICBUeXBpbmdfY2xhc3NDYWxsQ2hlY2sodGhpcywgVHlwaW5nKTtcblxuICAgIC8vIGEgQnVsbGV0IGluc3RhbmNlIHRvIHRvZ2dsZSBsaXN0cyBvZmZcbiAgICB0aGlzLmJ1bGxldCA9IG5ldyBCdWxsZXRfQnVsbGV0KCk7XG4gICAgdGhpcy5vcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuICB9XG4gIC8qKlxuICAgKiBpbnNlcnQgdGFiXG4gICAqXG4gICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHRhYnNpemVcbiAgICovXG5cblxuICBUeXBpbmdfY3JlYXRlQ2xhc3MoVHlwaW5nLCBbe1xuICAgIGtleTogXCJpbnNlcnRUYWJcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zZXJ0VGFiKHJuZywgdGFic2l6ZSkge1xuICAgICAgdmFyIHRhYiA9IGRvbS5jcmVhdGVUZXh0KG5ldyBBcnJheSh0YWJzaXplICsgMSkuam9pbihkb20uTkJTUF9DSEFSKSk7XG4gICAgICBybmcgPSBybmcuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgIHJuZy5pbnNlcnROb2RlKHRhYiwgdHJ1ZSk7XG4gICAgICBybmcgPSByYW5nZS5jcmVhdGUodGFiLCB0YWJzaXplKTtcbiAgICAgIHJuZy5zZWxlY3QoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaW5zZXJ0IHBhcmFncmFwaFxuICAgICAqXG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRlZGl0YWJsZVxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmcgQ2FuIGJlIHVzZWQgaW4gdW5pdCB0ZXN0cyB0byBcIm1vY2tcIiB0aGUgcmFuZ2VcbiAgICAgKlxuICAgICAqIGJsb2NrcXVvdGVCcmVha2luZ0xldmVsXG4gICAgICogICAwIC0gTm8gYnJlYWssIHRoZSBuZXcgcGFyYWdyYXBoIHJlbWFpbnMgaW5zaWRlIHRoZSBxdW90ZVxuICAgICAqICAgMSAtIEJyZWFrIHRoZSBmaXJzdCBibG9ja3F1b3RlIGluIHRoZSBhbmNlc3RvcnMgbGlzdFxuICAgICAqICAgMiAtIEJyZWFrIGFsbCBibG9ja3F1b3Rlcywgc28gdGhhdCB0aGUgbmV3IHBhcmFncmFwaCBpcyBub3QgcXVvdGVkICh0aGlzIGlzIHRoZSBkZWZhdWx0KVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiaW5zZXJ0UGFyYWdyYXBoXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluc2VydFBhcmFncmFwaChlZGl0YWJsZSwgcm5nKSB7XG4gICAgICBybmcgPSBybmcgfHwgcmFuZ2UuY3JlYXRlKGVkaXRhYmxlKTsgLy8gZGVsZXRlQ29udGVudHMgb24gcmFuZ2UuXG5cbiAgICAgIHJuZyA9IHJuZy5kZWxldGVDb250ZW50cygpOyAvLyBXcmFwIHJhbmdlIGlmIGl0IG5lZWRzIHRvIGJlIHdyYXBwZWQgYnkgcGFyYWdyYXBoXG5cbiAgICAgIHJuZyA9IHJuZy53cmFwQm9keUlubGluZVdpdGhQYXJhKCk7IC8vIGZpbmRpbmcgcGFyYWdyYXBoXG5cbiAgICAgIHZhciBzcGxpdFJvb3QgPSBkb20uYW5jZXN0b3Iocm5nLnNjLCBkb20uaXNQYXJhKTtcbiAgICAgIHZhciBuZXh0UGFyYTsgLy8gb24gcGFyYWdyYXBoOiBzcGxpdCBwYXJhZ3JhcGhcblxuICAgICAgaWYgKHNwbGl0Um9vdCkge1xuICAgICAgICAvLyBpZiBpdCBpcyBhbiBlbXB0eSBsaW5lIHdpdGggbGlcbiAgICAgICAgaWYgKGRvbS5pc0xpKHNwbGl0Um9vdCkgJiYgKGRvbS5pc0VtcHR5KHNwbGl0Um9vdCkgfHwgZG9tLmRlZXBlc3RDaGlsZElzRW1wdHkoc3BsaXRSb290KSkpIHtcbiAgICAgICAgICAvLyB0b2dnbGUgVUwvT0wgYW5kIGVzY2FwZVxuICAgICAgICAgIHRoaXMuYnVsbGV0LnRvZ2dsZUxpc3Qoc3BsaXRSb290LnBhcmVudE5vZGUubm9kZU5hbWUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgYmxvY2txdW90ZSA9IG51bGw7XG5cbiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmJsb2NrcXVvdGVCcmVha2luZ0xldmVsID09PSAxKSB7XG4gICAgICAgICAgICBibG9ja3F1b3RlID0gZG9tLmFuY2VzdG9yKHNwbGl0Um9vdCwgZG9tLmlzQmxvY2txdW90ZSk7XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuYmxvY2txdW90ZUJyZWFraW5nTGV2ZWwgPT09IDIpIHtcbiAgICAgICAgICAgIGJsb2NrcXVvdGUgPSBkb20ubGFzdEFuY2VzdG9yKHNwbGl0Um9vdCwgZG9tLmlzQmxvY2txdW90ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGJsb2NrcXVvdGUpIHtcbiAgICAgICAgICAgIC8vIFdlJ3JlIGluc2lkZSBhIGJsb2NrcXVvdGUgYW5kIG9wdGlvbnMgYXNrIHVzIHRvIGJyZWFrIGl0XG4gICAgICAgICAgICBuZXh0UGFyYSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGRvbS5lbXB0eVBhcmEpWzBdOyAvLyBJZiB0aGUgc3BsaXQgaXMgcmlnaHQgYmVmb3JlIGEgPGJyPiwgcmVtb3ZlIGl0IHNvIHRoYXQgdGhlcmUncyBubyBcImVtcHR5IGxpbmVcIlxuICAgICAgICAgICAgLy8gYWZ0ZXIgdGhlIHNwbGl0IGluIHRoZSBuZXcgYmxvY2txdW90ZSBjcmVhdGVkXG5cbiAgICAgICAgICAgIGlmIChkb20uaXNSaWdodEVkZ2VQb2ludChybmcuZ2V0U3RhcnRQb2ludCgpKSAmJiBkb20uaXNCUihybmcuc2MubmV4dFNpYmxpbmcpKSB7XG4gICAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHJuZy5zYy5uZXh0U2libGluZykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzcGxpdCA9IGRvbS5zcGxpdFRyZWUoYmxvY2txdW90ZSwgcm5nLmdldFN0YXJ0UG9pbnQoKSwge1xuICAgICAgICAgICAgICBpc0Rpc2NhcmRFbXB0eVNwbGl0czogdHJ1ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChzcGxpdCkge1xuICAgICAgICAgICAgICBzcGxpdC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXh0UGFyYSwgc3BsaXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZG9tLmluc2VydEFmdGVyKG5leHRQYXJhLCBibG9ja3F1b3RlKTsgLy8gVGhlcmUncyBubyBzcGxpdCBpZiB3ZSB3ZXJlIGF0IHRoZSBlbmQgb2YgdGhlIGJsb2NrcXVvdGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV4dFBhcmEgPSBkb20uc3BsaXRUcmVlKHNwbGl0Um9vdCwgcm5nLmdldFN0YXJ0UG9pbnQoKSk7IC8vIG5vdCBhIGJsb2NrcXVvdGUsIGp1c3QgaW5zZXJ0IHRoZSBwYXJhZ3JhcGhcblxuICAgICAgICAgICAgdmFyIGVtcHR5QW5jaG9ycyA9IGRvbS5saXN0RGVzY2VuZGFudChzcGxpdFJvb3QsIGRvbS5pc0VtcHR5QW5jaG9yKTtcbiAgICAgICAgICAgIGVtcHR5QW5jaG9ycyA9IGVtcHR5QW5jaG9ycy5jb25jYXQoZG9tLmxpc3REZXNjZW5kYW50KG5leHRQYXJhLCBkb20uaXNFbXB0eUFuY2hvcikpO1xuICAgICAgICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChlbXB0eUFuY2hvcnMsIGZ1bmN0aW9uIChpZHgsIGFuY2hvcikge1xuICAgICAgICAgICAgICBkb20ucmVtb3ZlKGFuY2hvcik7XG4gICAgICAgICAgICB9KTsgLy8gcmVwbGFjZSBlbXB0eSBoZWFkaW5nLCBwcmUgb3IgY3VzdG9tLW1hZGUgc3R5bGVUYWcgd2l0aCBQIHRhZ1xuXG4gICAgICAgICAgICBpZiAoKGRvbS5pc0hlYWRpbmcobmV4dFBhcmEpIHx8IGRvbS5pc1ByZShuZXh0UGFyYSkgfHwgZG9tLmlzQ3VzdG9tU3R5bGVUYWcobmV4dFBhcmEpKSAmJiBkb20uaXNFbXB0eShuZXh0UGFyYSkpIHtcbiAgICAgICAgICAgICAgbmV4dFBhcmEgPSBkb20ucmVwbGFjZShuZXh0UGFyYSwgJ3AnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8gbm8gcGFyYWdyYXBoOiBpbnNlcnQgZW1wdHkgcGFyYWdyYXBoXG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBuZXh0ID0gcm5nLnNjLmNoaWxkTm9kZXNbcm5nLnNvXTtcbiAgICAgICAgbmV4dFBhcmEgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShkb20uZW1wdHlQYXJhKVswXTtcblxuICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgIHJuZy5zYy5pbnNlcnRCZWZvcmUobmV4dFBhcmEsIG5leHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJuZy5zYy5hcHBlbmRDaGlsZChuZXh0UGFyYSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmFuZ2UuY3JlYXRlKG5leHRQYXJhLCAwKS5ub3JtYWxpemUoKS5zZWxlY3QoKS5zY3JvbGxJbnRvVmlldyhlZGl0YWJsZSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFR5cGluZztcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL2VkaXRpbmcvVGFibGUuanNcbmZ1bmN0aW9uIFRhYmxlX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gVGFibGVfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIFRhYmxlX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgVGFibGVfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIFRhYmxlX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cblxuLyoqXG4gKiBAY2xhc3MgQ3JlYXRlIGEgdmlydHVhbCB0YWJsZSB0byBjcmVhdGUgd2hhdCBhY3Rpb25zIHRvIGRvIGluIGNoYW5nZS5cbiAqIEBwYXJhbSB7b2JqZWN0fSBzdGFydFBvaW50IENlbGwgc2VsZWN0ZWQgdG8gYXBwbHkgY2hhbmdlLlxuICogQHBhcmFtIHtlbnVtfSB3aGVyZSAgV2hlcmUgY2hhbmdlIHdpbGwgYmUgYXBwbGllZCBSb3cgb3IgQ29sLiBVc2UgZW51bTogVGFibGVSZXN1bHRBY3Rpb24ud2hlcmVcbiAqIEBwYXJhbSB7ZW51bX0gYWN0aW9uIEFjdGlvbiB0byBiZSBhcHBsaWVkLiBVc2UgZW51bTogVGFibGVSZXN1bHRBY3Rpb24ucmVxdWVzdEFjdGlvblxuICogQHBhcmFtIHtvYmplY3R9IGRvbVRhYmxlIERvbSBlbGVtZW50IG9mIHRhYmxlIHRvIG1ha2UgY2hhbmdlcy5cbiAqL1xuXG52YXIgVGFibGVSZXN1bHRBY3Rpb24gPSBmdW5jdGlvbiBUYWJsZVJlc3VsdEFjdGlvbihzdGFydFBvaW50LCB3aGVyZSwgYWN0aW9uLCBkb21UYWJsZSkge1xuICB2YXIgX3N0YXJ0UG9pbnQgPSB7XG4gICAgJ2NvbFBvcyc6IDAsXG4gICAgJ3Jvd1Bvcyc6IDBcbiAgfTtcbiAgdmFyIF92aXJ0dWFsVGFibGUgPSBbXTtcbiAgdmFyIF9hY3Rpb25DZWxsTGlzdCA9IFtdOyAvLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAvLyBQcml2YXRlIGZ1bmN0aW9uc1xuICAvLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHN0YXJ0UG9pbnQgb2YgYWN0aW9uLlxuICAgKi9cblxuICBmdW5jdGlvbiBzZXRTdGFydFBvaW50KCkge1xuICAgIGlmICghc3RhcnRQb2ludCB8fCAhc3RhcnRQb2ludC50YWdOYW1lIHx8IHN0YXJ0UG9pbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAndGQnICYmIHN0YXJ0UG9pbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAndGgnKSB7XG4gICAgICAvLyBJbXBvc3NpYmxlIHRvIGlkZW50aWZ5IHN0YXJ0IENlbGwgcG9pbnRcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBfc3RhcnRQb2ludC5jb2xQb3MgPSBzdGFydFBvaW50LmNlbGxJbmRleDtcblxuICAgIGlmICghc3RhcnRQb2ludC5wYXJlbnRFbGVtZW50IHx8ICFzdGFydFBvaW50LnBhcmVudEVsZW1lbnQudGFnTmFtZSB8fCBzdGFydFBvaW50LnBhcmVudEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAndHInKSB7XG4gICAgICAvLyBJbXBvc3NpYmxlIHRvIGlkZW50aWZ5IHN0YXJ0IFJvdyBwb2ludFxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIF9zdGFydFBvaW50LnJvd1BvcyA9IHN0YXJ0UG9pbnQucGFyZW50RWxlbWVudC5yb3dJbmRleDtcbiAgfVxuICAvKipcbiAgICogRGVmaW5lIHZpcnR1YWwgdGFibGUgcG9zaXRpb24gaW5mbyBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSB7aW50fSByb3dJbmRleCBJbmRleCBwb3NpdGlvbiBpbiBsaW5lIG9mIHZpcnR1YWwgdGFibGUuXG4gICAqIEBwYXJhbSB7aW50fSBjZWxsSW5kZXggSW5kZXggcG9zaXRpb24gaW4gY29sdW1uIG9mIHZpcnR1YWwgdGFibGUuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBiYXNlUm93IFJvdyBhZmZlY3RlZCBieSB0aGlzIHBvc2l0aW9uLlxuICAgKiBAcGFyYW0ge29iamVjdH0gYmFzZUNlbGwgQ2VsbCBhZmZlY3RlZCBieSB0aGlzIHBvc2l0aW9uLlxuICAgKiBAcGFyYW0ge2Jvb2x9IGlzU3BhbiBJbmZvcm0gaWYgaXQgaXMgYW4gc3BhbiBjZWxsL3Jvdy5cbiAgICovXG5cblxuICBmdW5jdGlvbiBzZXRWaXJ0dWFsVGFibGVQb3NpdGlvbihyb3dJbmRleCwgY2VsbEluZGV4LCBiYXNlUm93LCBiYXNlQ2VsbCwgaXNSb3dTcGFuLCBpc0NvbFNwYW4sIGlzVmlydHVhbENlbGwpIHtcbiAgICB2YXIgb2JqUG9zaXRpb24gPSB7XG4gICAgICAnYmFzZVJvdyc6IGJhc2VSb3csXG4gICAgICAnYmFzZUNlbGwnOiBiYXNlQ2VsbCxcbiAgICAgICdpc1Jvd1NwYW4nOiBpc1Jvd1NwYW4sXG4gICAgICAnaXNDb2xTcGFuJzogaXNDb2xTcGFuLFxuICAgICAgJ2lzVmlydHVhbCc6IGlzVmlydHVhbENlbGxcbiAgICB9O1xuXG4gICAgaWYgKCFfdmlydHVhbFRhYmxlW3Jvd0luZGV4XSkge1xuICAgICAgX3ZpcnR1YWxUYWJsZVtyb3dJbmRleF0gPSBbXTtcbiAgICB9XG5cbiAgICBfdmlydHVhbFRhYmxlW3Jvd0luZGV4XVtjZWxsSW5kZXhdID0gb2JqUG9zaXRpb247XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZSBhY3Rpb24gY2VsbCBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB2aXJ0dWFsVGFibGVDZWxsT2JqIE9iamVjdCBvZiBzcGVjaWZpYyBwb3NpdGlvbiBvbiB2aXJ0dWFsIHRhYmxlLlxuICAgKiBAcGFyYW0ge2VudW19IHJlc3VsdEFjdGlvbiBBY3Rpb24gdG8gYmUgYXBwbGllZCBpbiB0aGF0IGl0ZW0uXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gZ2V0QWN0aW9uQ2VsbCh2aXJ0dWFsVGFibGVDZWxsT2JqLCByZXN1bHRBY3Rpb24sIHZpcnR1YWxSb3dQb3NpdGlvbiwgdmlydHVhbENvbFBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdiYXNlQ2VsbCc6IHZpcnR1YWxUYWJsZUNlbGxPYmouYmFzZUNlbGwsXG4gICAgICAnYWN0aW9uJzogcmVzdWx0QWN0aW9uLFxuICAgICAgJ3ZpcnR1YWxUYWJsZSc6IHtcbiAgICAgICAgJ3Jvd0luZGV4JzogdmlydHVhbFJvd1Bvc2l0aW9uLFxuICAgICAgICAnY2VsbEluZGV4JzogdmlydHVhbENvbFBvc2l0aW9uXG4gICAgICB9XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogUmVjb3ZlciBmcmVlIGluZGV4IG9mIHJvdyB0byBhcHBlbmQgQ2VsbC5cbiAgICpcbiAgICogQHBhcmFtIHtpbnR9IHJvd0luZGV4IEluZGV4IG9mIHJvdyB0byBmaW5kIGZyZWUgc3BhY2UuXG4gICAqIEBwYXJhbSB7aW50fSBjZWxsSW5kZXggSW5kZXggb2YgY2VsbCB0byBmaW5kIGZyZWUgc3BhY2UgaW4gdGFibGUuXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gcmVjb3ZlckNlbGxJbmRleChyb3dJbmRleCwgY2VsbEluZGV4KSB7XG4gICAgaWYgKCFfdmlydHVhbFRhYmxlW3Jvd0luZGV4XSkge1xuICAgICAgcmV0dXJuIGNlbGxJbmRleDtcbiAgICB9XG5cbiAgICBpZiAoIV92aXJ0dWFsVGFibGVbcm93SW5kZXhdW2NlbGxJbmRleF0pIHtcbiAgICAgIHJldHVybiBjZWxsSW5kZXg7XG4gICAgfVxuXG4gICAgdmFyIG5ld0NlbGxJbmRleCA9IGNlbGxJbmRleDtcblxuICAgIHdoaWxlIChfdmlydHVhbFRhYmxlW3Jvd0luZGV4XVtuZXdDZWxsSW5kZXhdKSB7XG4gICAgICBuZXdDZWxsSW5kZXgrKztcblxuICAgICAgaWYgKCFfdmlydHVhbFRhYmxlW3Jvd0luZGV4XVtuZXdDZWxsSW5kZXhdKSB7XG4gICAgICAgIHJldHVybiBuZXdDZWxsSW5kZXg7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZWNvdmVyIGluZm8gYWJvdXQgcm93IGFuZCBjZWxsIGFuZCBhZGQgaW5mb3JtYXRpb24gdG8gdmlydHVhbCB0YWJsZS5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IHJvdyBSb3cgdG8gcmVjb3ZlciBpbmZvcm1hdGlvbi5cbiAgICogQHBhcmFtIHtvYmplY3R9IGNlbGwgQ2VsbCB0byByZWNvdmVyIGluZm9ybWF0aW9uLlxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGFkZENlbGxJbmZvVG9WaXJ0dWFsKHJvdywgY2VsbCkge1xuICAgIHZhciBjZWxsSW5kZXggPSByZWNvdmVyQ2VsbEluZGV4KHJvdy5yb3dJbmRleCwgY2VsbC5jZWxsSW5kZXgpO1xuICAgIHZhciBjZWxsSGFzQ29sc3BhbiA9IGNlbGwuY29sU3BhbiA+IDE7XG4gICAgdmFyIGNlbGxIYXNSb3dzcGFuID0gY2VsbC5yb3dTcGFuID4gMTtcbiAgICB2YXIgaXNUaGlzU2VsZWN0ZWRDZWxsID0gcm93LnJvd0luZGV4ID09PSBfc3RhcnRQb2ludC5yb3dQb3MgJiYgY2VsbC5jZWxsSW5kZXggPT09IF9zdGFydFBvaW50LmNvbFBvcztcbiAgICBzZXRWaXJ0dWFsVGFibGVQb3NpdGlvbihyb3cucm93SW5kZXgsIGNlbGxJbmRleCwgcm93LCBjZWxsLCBjZWxsSGFzUm93c3BhbiwgY2VsbEhhc0NvbHNwYW4sIGZhbHNlKTsgLy8gQWRkIHNwYW4gcm93cyB0byB2aXJ0dWFsIFRhYmxlLlxuXG4gICAgdmFyIHJvd3NwYW5OdW1iZXIgPSBjZWxsLmF0dHJpYnV0ZXMucm93U3BhbiA/IHBhcnNlSW50KGNlbGwuYXR0cmlidXRlcy5yb3dTcGFuLnZhbHVlLCAxMCkgOiAwO1xuXG4gICAgaWYgKHJvd3NwYW5OdW1iZXIgPiAxKSB7XG4gICAgICBmb3IgKHZhciBycCA9IDE7IHJwIDwgcm93c3Bhbk51bWJlcjsgcnArKykge1xuICAgICAgICB2YXIgcm93c3BhbkluZGV4ID0gcm93LnJvd0luZGV4ICsgcnA7XG4gICAgICAgIGFkanVzdFN0YXJ0UG9pbnQocm93c3BhbkluZGV4LCBjZWxsSW5kZXgsIGNlbGwsIGlzVGhpc1NlbGVjdGVkQ2VsbCk7XG4gICAgICAgIHNldFZpcnR1YWxUYWJsZVBvc2l0aW9uKHJvd3NwYW5JbmRleCwgY2VsbEluZGV4LCByb3csIGNlbGwsIHRydWUsIGNlbGxIYXNDb2xzcGFuLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9IC8vIEFkZCBzcGFuIGNvbHMgdG8gdmlydHVhbCB0YWJsZS5cblxuXG4gICAgdmFyIGNvbHNwYW5OdW1iZXIgPSBjZWxsLmF0dHJpYnV0ZXMuY29sU3BhbiA/IHBhcnNlSW50KGNlbGwuYXR0cmlidXRlcy5jb2xTcGFuLnZhbHVlLCAxMCkgOiAwO1xuXG4gICAgaWYgKGNvbHNwYW5OdW1iZXIgPiAxKSB7XG4gICAgICBmb3IgKHZhciBjcCA9IDE7IGNwIDwgY29sc3Bhbk51bWJlcjsgY3ArKykge1xuICAgICAgICB2YXIgY2VsbHNwYW5JbmRleCA9IHJlY292ZXJDZWxsSW5kZXgocm93LnJvd0luZGV4LCBjZWxsSW5kZXggKyBjcCk7XG4gICAgICAgIGFkanVzdFN0YXJ0UG9pbnQocm93LnJvd0luZGV4LCBjZWxsc3BhbkluZGV4LCBjZWxsLCBpc1RoaXNTZWxlY3RlZENlbGwpO1xuICAgICAgICBzZXRWaXJ0dWFsVGFibGVQb3NpdGlvbihyb3cucm93SW5kZXgsIGNlbGxzcGFuSW5kZXgsIHJvdywgY2VsbCwgY2VsbEhhc1Jvd3NwYW4sIHRydWUsIHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogUHJvY2VzcyB2YWxpZGF0aW9uIGFuZCBhZGp1c3Qgb2Ygc3RhcnQgcG9pbnQgaWYgbmVlZGVkXG4gICAqXG4gICAqIEBwYXJhbSB7aW50fSByb3dJbmRleFxuICAgKiBAcGFyYW0ge2ludH0gY2VsbEluZGV4XG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjZWxsXG4gICAqIEBwYXJhbSB7Ym9vbH0gaXNTZWxlY3RlZENlbGxcbiAgICovXG5cblxuICBmdW5jdGlvbiBhZGp1c3RTdGFydFBvaW50KHJvd0luZGV4LCBjZWxsSW5kZXgsIGNlbGwsIGlzU2VsZWN0ZWRDZWxsKSB7XG4gICAgaWYgKHJvd0luZGV4ID09PSBfc3RhcnRQb2ludC5yb3dQb3MgJiYgX3N0YXJ0UG9pbnQuY29sUG9zID49IGNlbGwuY2VsbEluZGV4ICYmIGNlbGwuY2VsbEluZGV4IDw9IGNlbGxJbmRleCAmJiAhaXNTZWxlY3RlZENlbGwpIHtcbiAgICAgIF9zdGFydFBvaW50LmNvbFBvcysrO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQ3JlYXRlIHZpcnR1YWwgdGFibGUgb2YgY2VsbHMgd2l0aCBhbGwgY2VsbHMsIGluY2x1ZGluZyBzcGFuIGNlbGxzLlxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGNyZWF0ZVZpcnR1YWxUYWJsZSgpIHtcbiAgICB2YXIgcm93cyA9IGRvbVRhYmxlLnJvd3M7XG5cbiAgICBmb3IgKHZhciByb3dJbmRleCA9IDA7IHJvd0luZGV4IDwgcm93cy5sZW5ndGg7IHJvd0luZGV4KyspIHtcbiAgICAgIHZhciBjZWxscyA9IHJvd3Nbcm93SW5kZXhdLmNlbGxzO1xuXG4gICAgICBmb3IgKHZhciBjZWxsSW5kZXggPSAwOyBjZWxsSW5kZXggPCBjZWxscy5sZW5ndGg7IGNlbGxJbmRleCsrKSB7XG4gICAgICAgIGFkZENlbGxJbmZvVG9WaXJ0dWFsKHJvd3Nbcm93SW5kZXhdLCBjZWxsc1tjZWxsSW5kZXhdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEdldCBhY3Rpb24gdG8gYmUgYXBwbGllZCBvbiB0aGUgY2VsbC5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGNlbGwgdmlydHVhbCB0YWJsZSBjZWxsIHRvIGFwcGx5IGFjdGlvblxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGdldERlbGV0ZVJlc3VsdEFjdGlvblRvQ2VsbChjZWxsKSB7XG4gICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgY2FzZSBUYWJsZVJlc3VsdEFjdGlvbi53aGVyZS5Db2x1bW46XG4gICAgICAgIGlmIChjZWxsLmlzQ29sU3Bhbikge1xuICAgICAgICAgIHJldHVybiBUYWJsZVJlc3VsdEFjdGlvbi5yZXN1bHRBY3Rpb24uU3VidHJhY3RTcGFuQ291bnQ7XG4gICAgICAgIH1cblxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBUYWJsZVJlc3VsdEFjdGlvbi53aGVyZS5Sb3c6XG4gICAgICAgIGlmICghY2VsbC5pc1ZpcnR1YWwgJiYgY2VsbC5pc1Jvd1NwYW4pIHtcbiAgICAgICAgICByZXR1cm4gVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLkFkZENlbGw7XG4gICAgICAgIH0gZWxzZSBpZiAoY2VsbC5pc1Jvd1NwYW4pIHtcbiAgICAgICAgICByZXR1cm4gVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLlN1YnRyYWN0U3BhbkNvdW50O1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5SZW1vdmVDZWxsO1xuICB9XG4gIC8qKlxuICAgKiBHZXQgYWN0aW9uIHRvIGJlIGFwcGxpZWQgb24gdGhlIGNlbGwuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjZWxsIHZpcnR1YWwgdGFibGUgY2VsbCB0byBhcHBseSBhY3Rpb25cbiAgICovXG5cblxuICBmdW5jdGlvbiBnZXRBZGRSZXN1bHRBY3Rpb25Ub0NlbGwoY2VsbCkge1xuICAgIHN3aXRjaCAod2hlcmUpIHtcbiAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ud2hlcmUuQ29sdW1uOlxuICAgICAgICBpZiAoY2VsbC5pc0NvbFNwYW4pIHtcbiAgICAgICAgICByZXR1cm4gVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLlN1bVNwYW5Db3VudDtcbiAgICAgICAgfSBlbHNlIGlmIChjZWxsLmlzUm93U3BhbiAmJiBjZWxsLmlzVmlydHVhbCkge1xuICAgICAgICAgIHJldHVybiBUYWJsZVJlc3VsdEFjdGlvbi5yZXN1bHRBY3Rpb24uSWdub3JlO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ud2hlcmUuUm93OlxuICAgICAgICBpZiAoY2VsbC5pc1Jvd1NwYW4pIHtcbiAgICAgICAgICByZXR1cm4gVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLlN1bVNwYW5Db3VudDtcbiAgICAgICAgfSBlbHNlIGlmIChjZWxsLmlzQ29sU3BhbiAmJiBjZWxsLmlzVmlydHVhbCkge1xuICAgICAgICAgIHJldHVybiBUYWJsZVJlc3VsdEFjdGlvbi5yZXN1bHRBY3Rpb24uSWdub3JlO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5BZGRDZWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBzZXRTdGFydFBvaW50KCk7XG4gICAgY3JlYXRlVmlydHVhbFRhYmxlKCk7XG4gIH0gLy8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gUHVibGljIGZ1bmN0aW9uc1xuICAvLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIC8qKlxuICAgKiBSZWNvdmVyIGFycmF5IG9zIHdoYXQgdG8gZG8gaW4gdGFibGUuXG4gICAqL1xuXG5cbiAgdGhpcy5nZXRBY3Rpb25MaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBmaXhlZFJvdyA9IHdoZXJlID09PSBUYWJsZVJlc3VsdEFjdGlvbi53aGVyZS5Sb3cgPyBfc3RhcnRQb2ludC5yb3dQb3MgOiAtMTtcbiAgICB2YXIgZml4ZWRDb2wgPSB3aGVyZSA9PT0gVGFibGVSZXN1bHRBY3Rpb24ud2hlcmUuQ29sdW1uID8gX3N0YXJ0UG9pbnQuY29sUG9zIDogLTE7XG4gICAgdmFyIGFjdHVhbFBvc2l0aW9uID0gMDtcbiAgICB2YXIgY2FuQ29udGludWUgPSB0cnVlO1xuXG4gICAgd2hpbGUgKGNhbkNvbnRpbnVlKSB7XG4gICAgICB2YXIgcm93UG9zaXRpb24gPSBmaXhlZFJvdyA+PSAwID8gZml4ZWRSb3cgOiBhY3R1YWxQb3NpdGlvbjtcbiAgICAgIHZhciBjb2xQb3NpdGlvbiA9IGZpeGVkQ29sID49IDAgPyBmaXhlZENvbCA6IGFjdHVhbFBvc2l0aW9uO1xuICAgICAgdmFyIHJvdyA9IF92aXJ0dWFsVGFibGVbcm93UG9zaXRpb25dO1xuXG4gICAgICBpZiAoIXJvdykge1xuICAgICAgICBjYW5Db250aW51ZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gX2FjdGlvbkNlbGxMaXN0O1xuICAgICAgfVxuXG4gICAgICB2YXIgY2VsbCA9IHJvd1tjb2xQb3NpdGlvbl07XG5cbiAgICAgIGlmICghY2VsbCkge1xuICAgICAgICBjYW5Db250aW51ZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gX2FjdGlvbkNlbGxMaXN0O1xuICAgICAgfSAvLyBEZWZpbmUgYWN0aW9uIHRvIGJlIGFwcGxpZWQgaW4gdGhpcyBjZWxsXG5cblxuICAgICAgdmFyIHJlc3VsdEFjdGlvbiA9IFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5JZ25vcmU7XG5cbiAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ucmVxdWVzdEFjdGlvbi5BZGQ6XG4gICAgICAgICAgcmVzdWx0QWN0aW9uID0gZ2V0QWRkUmVzdWx0QWN0aW9uVG9DZWxsKGNlbGwpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ucmVxdWVzdEFjdGlvbi5EZWxldGU6XG4gICAgICAgICAgcmVzdWx0QWN0aW9uID0gZ2V0RGVsZXRlUmVzdWx0QWN0aW9uVG9DZWxsKGNlbGwpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBfYWN0aW9uQ2VsbExpc3QucHVzaChnZXRBY3Rpb25DZWxsKGNlbGwsIHJlc3VsdEFjdGlvbiwgcm93UG9zaXRpb24sIGNvbFBvc2l0aW9uKSk7XG5cbiAgICAgIGFjdHVhbFBvc2l0aW9uKys7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9hY3Rpb25DZWxsTGlzdDtcbiAgfTtcblxuICBpbml0KCk7XG59O1xuLyoqXG4qXG4qIFdoZXJlIGFjdGlvbiBvY2NvdXJzIGVudW0uXG4qL1xuXG5cblRhYmxlUmVzdWx0QWN0aW9uLndoZXJlID0ge1xuICAnUm93JzogMCxcbiAgJ0NvbHVtbic6IDFcbn07XG4vKipcbipcbiogUmVxdWVzdGVkIGFjdGlvbiB0byBhcHBseSBlbnVtLlxuKi9cblxuVGFibGVSZXN1bHRBY3Rpb24ucmVxdWVzdEFjdGlvbiA9IHtcbiAgJ0FkZCc6IDAsXG4gICdEZWxldGUnOiAxXG59O1xuLyoqXG4qXG4qIFJlc3VsdCBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQgZW51bS5cbiovXG5cblRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbiA9IHtcbiAgJ0lnbm9yZSc6IDAsXG4gICdTdWJ0cmFjdFNwYW5Db3VudCc6IDEsXG4gICdSZW1vdmVDZWxsJzogMixcbiAgJ0FkZENlbGwnOiAzLFxuICAnU3VtU3BhbkNvdW50JzogNFxufTtcbi8qKlxuICpcbiAqIEBjbGFzcyBlZGl0aW5nLlRhYmxlXG4gKlxuICogVGFibGVcbiAqXG4gKi9cblxudmFyIFRhYmxlX1RhYmxlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGFibGUoKSB7XG4gICAgVGFibGVfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGFibGUpO1xuICB9XG5cbiAgVGFibGVfY3JlYXRlQ2xhc3MoVGFibGUsIFt7XG4gICAga2V5OiBcInRhYlwiLFxuXG4gICAgLyoqXG4gICAgICogaGFuZGxlIHRhYiBrZXlcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzU2hpZnRcbiAgICAgKi9cbiAgICB2YWx1ZTogZnVuY3Rpb24gdGFiKHJuZywgaXNTaGlmdCkge1xuICAgICAgdmFyIGNlbGwgPSBkb20uYW5jZXN0b3Iocm5nLmNvbW1vbkFuY2VzdG9yKCksIGRvbS5pc0NlbGwpO1xuICAgICAgdmFyIHRhYmxlID0gZG9tLmFuY2VzdG9yKGNlbGwsIGRvbS5pc1RhYmxlKTtcbiAgICAgIHZhciBjZWxscyA9IGRvbS5saXN0RGVzY2VuZGFudCh0YWJsZSwgZG9tLmlzQ2VsbCk7XG4gICAgICB2YXIgbmV4dENlbGwgPSBsaXN0c1tpc1NoaWZ0ID8gJ3ByZXYnIDogJ25leHQnXShjZWxscywgY2VsbCk7XG5cbiAgICAgIGlmIChuZXh0Q2VsbCkge1xuICAgICAgICByYW5nZS5jcmVhdGUobmV4dENlbGwsIDApLnNlbGVjdCgpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYSBuZXcgcm93XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dyYXBwZWRSYW5nZX0gcm5nXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBvc2l0aW9uICh0b3AvYm90dG9tKVxuICAgICAqIEByZXR1cm4ge05vZGV9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJhZGRSb3dcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUm93KHJuZywgcG9zaXRpb24pIHtcbiAgICAgIHZhciBjZWxsID0gZG9tLmFuY2VzdG9yKHJuZy5jb21tb25BbmNlc3RvcigpLCBkb20uaXNDZWxsKTtcbiAgICAgIHZhciBjdXJyZW50VHIgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShjZWxsKS5jbG9zZXN0KCd0cicpO1xuICAgICAgdmFyIHRyQXR0cmlidXRlcyA9IHRoaXMucmVjb3ZlckF0dHJpYnV0ZXMoY3VycmVudFRyKTtcbiAgICAgIHZhciBodG1sID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzx0cicgKyB0ckF0dHJpYnV0ZXMgKyAnPjwvdHI+Jyk7XG4gICAgICB2YXIgdlRhYmxlID0gbmV3IFRhYmxlUmVzdWx0QWN0aW9uKGNlbGwsIFRhYmxlUmVzdWx0QWN0aW9uLndoZXJlLlJvdywgVGFibGVSZXN1bHRBY3Rpb24ucmVxdWVzdEFjdGlvbi5BZGQsIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGN1cnJlbnRUcikuY2xvc2VzdCgndGFibGUnKVswXSk7XG4gICAgICB2YXIgYWN0aW9ucyA9IHZUYWJsZS5nZXRBY3Rpb25MaXN0KCk7XG5cbiAgICAgIGZvciAodmFyIGlkQ2VsbCA9IDA7IGlkQ2VsbCA8IGFjdGlvbnMubGVuZ3RoOyBpZENlbGwrKykge1xuICAgICAgICB2YXIgY3VycmVudENlbGwgPSBhY3Rpb25zW2lkQ2VsbF07XG4gICAgICAgIHZhciB0ZEF0dHJpYnV0ZXMgPSB0aGlzLnJlY292ZXJBdHRyaWJ1dGVzKGN1cnJlbnRDZWxsLmJhc2VDZWxsKTtcblxuICAgICAgICBzd2l0Y2ggKGN1cnJlbnRDZWxsLmFjdGlvbikge1xuICAgICAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLkFkZENlbGw6XG4gICAgICAgICAgICBodG1sLmFwcGVuZCgnPHRkJyArIHRkQXR0cmlidXRlcyArICc+JyArIGRvbS5ibGFuayArICc8L3RkPicpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5TdW1TcGFuQ291bnQ6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmFzZUNlbGxUciA9IGN1cnJlbnRDZWxsLmJhc2VDZWxsLnBhcmVudDtcbiAgICAgICAgICAgICAgICB2YXIgaXNUb3BGcm9tUm93U3BhbiA9ICghYmFzZUNlbGxUciA/IDAgOiBjdXJyZW50Q2VsbC5iYXNlQ2VsbC5jbG9zZXN0KCd0cicpLnJvd0luZGV4KSA8PSBjdXJyZW50VHJbMF0ucm93SW5kZXg7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNUb3BGcm9tUm93U3Bhbikge1xuICAgICAgICAgICAgICAgICAgdmFyIG5ld1RkID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzxkaXY+PC9kaXY+JykuYXBwZW5kKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8dGQnICsgdGRBdHRyaWJ1dGVzICsgJz4nICsgZG9tLmJsYW5rICsgJzwvdGQ+JykucmVtb3ZlQXR0cigncm93c3BhbicpKS5odG1sKCk7XG4gICAgICAgICAgICAgICAgICBodG1sLmFwcGVuZChuZXdUZCk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB2YXIgcm93c3Bhbk51bWJlciA9IHBhcnNlSW50KGN1cnJlbnRDZWxsLmJhc2VDZWxsLnJvd1NwYW4sIDEwKTtcbiAgICAgICAgICAgICAgcm93c3Bhbk51bWJlcisrO1xuICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5iYXNlQ2VsbC5zZXRBdHRyaWJ1dGUoJ3Jvd1NwYW4nLCByb3dzcGFuTnVtYmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgY3VycmVudFRyLmJlZm9yZShodG1sKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBjZWxsSGFzUm93c3BhbiA9IGNlbGwucm93U3BhbiA+IDE7XG5cbiAgICAgICAgaWYgKGNlbGxIYXNSb3dzcGFuKSB7XG4gICAgICAgICAgdmFyIGxhc3RUckluZGV4ID0gY3VycmVudFRyWzBdLnJvd0luZGV4ICsgKGNlbGwucm93U3BhbiAtIDIpO1xuICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGN1cnJlbnRUcikucGFyZW50KCkuZmluZCgndHInKVtsYXN0VHJJbmRleF0pLmFmdGVyKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGh0bWwpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50VHIuYWZ0ZXIoaHRtbCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhIG5ldyBjb2xcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcG9zaXRpb24gKGxlZnQvcmlnaHQpXG4gICAgICogQHJldHVybiB7Tm9kZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImFkZENvbFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRDb2wocm5nLCBwb3NpdGlvbikge1xuICAgICAgdmFyIGNlbGwgPSBkb20uYW5jZXN0b3Iocm5nLmNvbW1vbkFuY2VzdG9yKCksIGRvbS5pc0NlbGwpO1xuICAgICAgdmFyIHJvdyA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGNlbGwpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgICB2YXIgcm93c0dyb3VwID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkocm93KS5zaWJsaW5ncygpO1xuICAgICAgcm93c0dyb3VwLnB1c2gocm93KTtcbiAgICAgIHZhciB2VGFibGUgPSBuZXcgVGFibGVSZXN1bHRBY3Rpb24oY2VsbCwgVGFibGVSZXN1bHRBY3Rpb24ud2hlcmUuQ29sdW1uLCBUYWJsZVJlc3VsdEFjdGlvbi5yZXF1ZXN0QWN0aW9uLkFkZCwgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkocm93KS5jbG9zZXN0KCd0YWJsZScpWzBdKTtcbiAgICAgIHZhciBhY3Rpb25zID0gdlRhYmxlLmdldEFjdGlvbkxpc3QoKTtcblxuICAgICAgZm9yICh2YXIgYWN0aW9uSW5kZXggPSAwOyBhY3Rpb25JbmRleCA8IGFjdGlvbnMubGVuZ3RoOyBhY3Rpb25JbmRleCsrKSB7XG4gICAgICAgIHZhciBjdXJyZW50Q2VsbCA9IGFjdGlvbnNbYWN0aW9uSW5kZXhdO1xuICAgICAgICB2YXIgdGRBdHRyaWJ1dGVzID0gdGhpcy5yZWNvdmVyQXR0cmlidXRlcyhjdXJyZW50Q2VsbC5iYXNlQ2VsbCk7XG5cbiAgICAgICAgc3dpdGNoIChjdXJyZW50Q2VsbC5hY3Rpb24pIHtcbiAgICAgICAgICBjYXNlIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5BZGRDZWxsOlxuICAgICAgICAgICAgaWYgKHBvc2l0aW9uID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGN1cnJlbnRDZWxsLmJhc2VDZWxsKS5hZnRlcignPHRkJyArIHRkQXR0cmlidXRlcyArICc+JyArIGRvbS5ibGFuayArICc8L3RkPicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoY3VycmVudENlbGwuYmFzZUNlbGwpLmJlZm9yZSgnPHRkJyArIHRkQXR0cmlidXRlcyArICc+JyArIGRvbS5ibGFuayArICc8L3RkPicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLlN1bVNwYW5Db3VudDpcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgICB2YXIgY29sc3Bhbk51bWJlciA9IHBhcnNlSW50KGN1cnJlbnRDZWxsLmJhc2VDZWxsLmNvbFNwYW4sIDEwKTtcbiAgICAgICAgICAgICAgY29sc3Bhbk51bWJlcisrO1xuICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5iYXNlQ2VsbC5zZXRBdHRyaWJ1dGUoJ2NvbFNwYW4nLCBjb2xzcGFuTnVtYmVyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGN1cnJlbnRDZWxsLmJhc2VDZWxsKS5iZWZvcmUoJzx0ZCcgKyB0ZEF0dHJpYnV0ZXMgKyAnPicgKyBkb20uYmxhbmsgKyAnPC90ZD4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgLypcbiAgICAqIENvcHkgYXR0cmlidXRlcyBmcm9tIGVsZW1lbnQuXG4gICAgKlxuICAgICogQHBhcmFtIHtvYmplY3R9IEVsZW1lbnQgdG8gcmVjb3ZlciBhdHRyaWJ1dGVzLlxuICAgICogQHJldHVybiB7c3RyaW5nfSBDb3BpZWQgc3RyaW5nIGVsZW1lbnRzLlxuICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZWNvdmVyQXR0cmlidXRlc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZWNvdmVyQXR0cmlidXRlcyhlbCkge1xuICAgICAgdmFyIHJlc3VsdFN0ciA9ICcnO1xuXG4gICAgICBpZiAoIWVsKSB7XG4gICAgICAgIHJldHVybiByZXN1bHRTdHI7XG4gICAgICB9XG5cbiAgICAgIHZhciBhdHRyTGlzdCA9IGVsLmF0dHJpYnV0ZXMgfHwgW107XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0ckxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGF0dHJMaXN0W2ldLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lkJykge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGF0dHJMaXN0W2ldLnNwZWNpZmllZCkge1xuICAgICAgICAgIHJlc3VsdFN0ciArPSAnICcgKyBhdHRyTGlzdFtpXS5uYW1lICsgJz1cXCcnICsgYXR0ckxpc3RbaV0udmFsdWUgKyAnXFwnJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0U3RyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGUgY3VycmVudCByb3dcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcmV0dXJuIHtOb2RlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZGVsZXRlUm93XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlbGV0ZVJvdyhybmcpIHtcbiAgICAgIHZhciBjZWxsID0gZG9tLmFuY2VzdG9yKHJuZy5jb21tb25BbmNlc3RvcigpLCBkb20uaXNDZWxsKTtcbiAgICAgIHZhciByb3cgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShjZWxsKS5jbG9zZXN0KCd0cicpO1xuICAgICAgdmFyIGNlbGxQb3MgPSByb3cuY2hpbGRyZW4oJ3RkLCB0aCcpLmluZGV4KGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGNlbGwpKTtcbiAgICAgIHZhciByb3dQb3MgPSByb3dbMF0ucm93SW5kZXg7XG4gICAgICB2YXIgdlRhYmxlID0gbmV3IFRhYmxlUmVzdWx0QWN0aW9uKGNlbGwsIFRhYmxlUmVzdWx0QWN0aW9uLndoZXJlLlJvdywgVGFibGVSZXN1bHRBY3Rpb24ucmVxdWVzdEFjdGlvbi5EZWxldGUsIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHJvdykuY2xvc2VzdCgndGFibGUnKVswXSk7XG4gICAgICB2YXIgYWN0aW9ucyA9IHZUYWJsZS5nZXRBY3Rpb25MaXN0KCk7XG5cbiAgICAgIGZvciAodmFyIGFjdGlvbkluZGV4ID0gMDsgYWN0aW9uSW5kZXggPCBhY3Rpb25zLmxlbmd0aDsgYWN0aW9uSW5kZXgrKykge1xuICAgICAgICBpZiAoIWFjdGlvbnNbYWN0aW9uSW5kZXhdKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYmFzZUNlbGwgPSBhY3Rpb25zW2FjdGlvbkluZGV4XS5iYXNlQ2VsbDtcbiAgICAgICAgdmFyIHZpcnR1YWxQb3NpdGlvbiA9IGFjdGlvbnNbYWN0aW9uSW5kZXhdLnZpcnR1YWxUYWJsZTtcbiAgICAgICAgdmFyIGhhc1Jvd3NwYW4gPSBiYXNlQ2VsbC5yb3dTcGFuICYmIGJhc2VDZWxsLnJvd1NwYW4gPiAxO1xuICAgICAgICB2YXIgcm93c3Bhbk51bWJlciA9IGhhc1Jvd3NwYW4gPyBwYXJzZUludChiYXNlQ2VsbC5yb3dTcGFuLCAxMCkgOiAwO1xuXG4gICAgICAgIHN3aXRjaCAoYWN0aW9uc1thY3Rpb25JbmRleF0uYWN0aW9uKSB7XG4gICAgICAgICAgY2FzZSBUYWJsZVJlc3VsdEFjdGlvbi5yZXN1bHRBY3Rpb24uSWdub3JlOlxuICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICBjYXNlIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5BZGRDZWxsOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2YXIgbmV4dFJvdyA9IHJvdy5uZXh0KCd0cicpWzBdO1xuXG4gICAgICAgICAgICAgIGlmICghbmV4dFJvdykge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdmFyIGNsb25lUm93ID0gcm93WzBdLmNlbGxzW2NlbGxQb3NdO1xuXG4gICAgICAgICAgICAgIGlmIChoYXNSb3dzcGFuKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJvd3NwYW5OdW1iZXIgPiAyKSB7XG4gICAgICAgICAgICAgICAgICByb3dzcGFuTnVtYmVyLS07XG4gICAgICAgICAgICAgICAgICBuZXh0Um93Lmluc2VydEJlZm9yZShjbG9uZVJvdywgbmV4dFJvdy5jZWxsc1tjZWxsUG9zXSk7XG4gICAgICAgICAgICAgICAgICBuZXh0Um93LmNlbGxzW2NlbGxQb3NdLnNldEF0dHJpYnV0ZSgncm93U3BhbicsIHJvd3NwYW5OdW1iZXIpO1xuICAgICAgICAgICAgICAgICAgbmV4dFJvdy5jZWxsc1tjZWxsUG9zXS5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJvd3NwYW5OdW1iZXIgPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgIG5leHRSb3cuaW5zZXJ0QmVmb3JlKGNsb25lUm93LCBuZXh0Um93LmNlbGxzW2NlbGxQb3NdKTtcbiAgICAgICAgICAgICAgICAgIG5leHRSb3cuY2VsbHNbY2VsbFBvc10ucmVtb3ZlQXR0cmlidXRlKCdyb3dTcGFuJyk7XG4gICAgICAgICAgICAgICAgICBuZXh0Um93LmNlbGxzW2NlbGxQb3NdLmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICBjYXNlIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5TdWJ0cmFjdFNwYW5Db3VudDpcbiAgICAgICAgICAgIGlmIChoYXNSb3dzcGFuKSB7XG4gICAgICAgICAgICAgIGlmIChyb3dzcGFuTnVtYmVyID4gMikge1xuICAgICAgICAgICAgICAgIHJvd3NwYW5OdW1iZXItLTtcbiAgICAgICAgICAgICAgICBiYXNlQ2VsbC5zZXRBdHRyaWJ1dGUoJ3Jvd1NwYW4nLCByb3dzcGFuTnVtYmVyKTtcblxuICAgICAgICAgICAgICAgIGlmICh2aXJ0dWFsUG9zaXRpb24ucm93SW5kZXggIT09IHJvd1BvcyAmJiBiYXNlQ2VsbC5jZWxsSW5kZXggPT09IGNlbGxQb3MpIHtcbiAgICAgICAgICAgICAgICAgIGJhc2VDZWxsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb3dzcGFuTnVtYmVyID09PSAyKSB7XG4gICAgICAgICAgICAgICAgYmFzZUNlbGwucmVtb3ZlQXR0cmlidXRlKCdyb3dTcGFuJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAodmlydHVhbFBvc2l0aW9uLnJvd0luZGV4ICE9PSByb3dQb3MgJiYgYmFzZUNlbGwuY2VsbEluZGV4ID09PSBjZWxsUG9zKSB7XG4gICAgICAgICAgICAgICAgICBiYXNlQ2VsbC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICBjYXNlIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5SZW1vdmVDZWxsOlxuICAgICAgICAgICAgLy8gRG8gbm90IG5lZWQgcmVtb3ZlIGNlbGwgYmVjYXVzZSByb3cgd2lsbCBiZSBkZWxldGVkLlxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcm93LnJlbW92ZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGUgY3VycmVudCBjb2xcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcmV0dXJuIHtOb2RlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZGVsZXRlQ29sXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlbGV0ZUNvbChybmcpIHtcbiAgICAgIHZhciBjZWxsID0gZG9tLmFuY2VzdG9yKHJuZy5jb21tb25BbmNlc3RvcigpLCBkb20uaXNDZWxsKTtcbiAgICAgIHZhciByb3cgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShjZWxsKS5jbG9zZXN0KCd0cicpO1xuICAgICAgdmFyIGNlbGxQb3MgPSByb3cuY2hpbGRyZW4oJ3RkLCB0aCcpLmluZGV4KGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGNlbGwpKTtcbiAgICAgIHZhciB2VGFibGUgPSBuZXcgVGFibGVSZXN1bHRBY3Rpb24oY2VsbCwgVGFibGVSZXN1bHRBY3Rpb24ud2hlcmUuQ29sdW1uLCBUYWJsZVJlc3VsdEFjdGlvbi5yZXF1ZXN0QWN0aW9uLkRlbGV0ZSwgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkocm93KS5jbG9zZXN0KCd0YWJsZScpWzBdKTtcbiAgICAgIHZhciBhY3Rpb25zID0gdlRhYmxlLmdldEFjdGlvbkxpc3QoKTtcblxuICAgICAgZm9yICh2YXIgYWN0aW9uSW5kZXggPSAwOyBhY3Rpb25JbmRleCA8IGFjdGlvbnMubGVuZ3RoOyBhY3Rpb25JbmRleCsrKSB7XG4gICAgICAgIGlmICghYWN0aW9uc1thY3Rpb25JbmRleF0pIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAoYWN0aW9uc1thY3Rpb25JbmRleF0uYWN0aW9uKSB7XG4gICAgICAgICAgY2FzZSBUYWJsZVJlc3VsdEFjdGlvbi5yZXN1bHRBY3Rpb24uSWdub3JlOlxuICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICBjYXNlIFRhYmxlUmVzdWx0QWN0aW9uLnJlc3VsdEFjdGlvbi5TdWJ0cmFjdFNwYW5Db3VudDpcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdmFyIGJhc2VDZWxsID0gYWN0aW9uc1thY3Rpb25JbmRleF0uYmFzZUNlbGw7XG4gICAgICAgICAgICAgIHZhciBoYXNDb2xzcGFuID0gYmFzZUNlbGwuY29sU3BhbiAmJiBiYXNlQ2VsbC5jb2xTcGFuID4gMTtcblxuICAgICAgICAgICAgICBpZiAoaGFzQ29sc3Bhbikge1xuICAgICAgICAgICAgICAgIHZhciBjb2xzcGFuTnVtYmVyID0gYmFzZUNlbGwuY29sU3BhbiA/IHBhcnNlSW50KGJhc2VDZWxsLmNvbFNwYW4sIDEwKSA6IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29sc3Bhbk51bWJlciA+IDIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbHNwYW5OdW1iZXItLTtcbiAgICAgICAgICAgICAgICAgIGJhc2VDZWxsLnNldEF0dHJpYnV0ZSgnY29sU3BhbicsIGNvbHNwYW5OdW1iZXIpO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoYmFzZUNlbGwuY2VsbEluZGV4ID09PSBjZWxsUG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VDZWxsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29sc3Bhbk51bWJlciA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgYmFzZUNlbGwucmVtb3ZlQXR0cmlidXRlKCdjb2xTcGFuJyk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChiYXNlQ2VsbC5jZWxsSW5kZXggPT09IGNlbGxQb3MpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZUNlbGwuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAgIGNhc2UgVGFibGVSZXN1bHRBY3Rpb24ucmVzdWx0QWN0aW9uLlJlbW92ZUNlbGw6XG4gICAgICAgICAgICBkb20ucmVtb3ZlKGFjdGlvbnNbYWN0aW9uSW5kZXhdLmJhc2VDZWxsLCB0cnVlKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGNyZWF0ZSBlbXB0eSB0YWJsZSBlbGVtZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcm93Q291bnRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gY29sQ291bnRcbiAgICAgKiBAcmV0dXJuIHtOb2RlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY3JlYXRlVGFibGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlVGFibGUoY29sQ291bnQsIHJvd0NvdW50LCBvcHRpb25zKSB7XG4gICAgICB2YXIgdGRzID0gW107XG4gICAgICB2YXIgdGRIVE1MO1xuXG4gICAgICBmb3IgKHZhciBpZHhDb2wgPSAwOyBpZHhDb2wgPCBjb2xDb3VudDsgaWR4Q29sKyspIHtcbiAgICAgICAgdGRzLnB1c2goJzx0ZD4nICsgZG9tLmJsYW5rICsgJzwvdGQ+Jyk7XG4gICAgICB9XG5cbiAgICAgIHRkSFRNTCA9IHRkcy5qb2luKCcnKTtcbiAgICAgIHZhciB0cnMgPSBbXTtcbiAgICAgIHZhciB0ckhUTUw7XG5cbiAgICAgIGZvciAodmFyIGlkeFJvdyA9IDA7IGlkeFJvdyA8IHJvd0NvdW50OyBpZHhSb3crKykge1xuICAgICAgICB0cnMucHVzaCgnPHRyPicgKyB0ZEhUTUwgKyAnPC90cj4nKTtcbiAgICAgIH1cblxuICAgICAgdHJIVE1MID0gdHJzLmpvaW4oJycpO1xuICAgICAgdmFyICR0YWJsZSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8dGFibGU+JyArIHRySFRNTCArICc8L3RhYmxlPicpO1xuXG4gICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnRhYmxlQ2xhc3NOYW1lKSB7XG4gICAgICAgICR0YWJsZS5hZGRDbGFzcyhvcHRpb25zLnRhYmxlQ2xhc3NOYW1lKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICR0YWJsZVswXTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIGN1cnJlbnQgdGFibGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcmV0dXJuIHtOb2RlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZGVsZXRlVGFibGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVsZXRlVGFibGUocm5nKSB7XG4gICAgICB2YXIgY2VsbCA9IGRvbS5hbmNlc3RvcihybmcuY29tbW9uQW5jZXN0b3IoKSwgZG9tLmlzQ2VsbCk7XG4gICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShjZWxsKS5jbG9zZXN0KCd0YWJsZScpLnJlbW92ZSgpO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBUYWJsZTtcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9FZGl0b3IuanNcbmZ1bmN0aW9uIEVkaXRvcl9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEVkaXRvcl9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gRWRpdG9yX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgRWRpdG9yX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBFZGl0b3JfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG52YXIgS0VZX0JPR1VTID0gJ2JvZ3VzJztcbi8qKlxuICogQGNsYXNzIEVkaXRvclxuICovXG5cbnZhciBFZGl0b3JfRWRpdG9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRWRpdG9yKGNvbnRleHQpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgRWRpdG9yX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEVkaXRvcik7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMuJG5vdGUgPSBjb250ZXh0LmxheW91dEluZm8ubm90ZTtcbiAgICB0aGlzLiRlZGl0b3IgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdG9yO1xuICAgIHRoaXMuJGVkaXRhYmxlID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRhYmxlO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmxhbmcgPSB0aGlzLm9wdGlvbnMubGFuZ0luZm87XG4gICAgdGhpcy5lZGl0YWJsZSA9IHRoaXMuJGVkaXRhYmxlWzBdO1xuICAgIHRoaXMubGFzdFJhbmdlID0gbnVsbDtcbiAgICB0aGlzLnNuYXBzaG90ID0gbnVsbDtcbiAgICB0aGlzLnN0eWxlID0gbmV3IFN0eWxlX1N0eWxlKCk7XG4gICAgdGhpcy50YWJsZSA9IG5ldyBUYWJsZV9UYWJsZSgpO1xuICAgIHRoaXMudHlwaW5nID0gbmV3IFR5cGluZ19UeXBpbmcoY29udGV4dCk7XG4gICAgdGhpcy5idWxsZXQgPSBuZXcgQnVsbGV0X0J1bGxldCgpO1xuICAgIHRoaXMuaGlzdG9yeSA9IG5ldyBIaXN0b3J5X0hpc3RvcnkoY29udGV4dCk7XG4gICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAuZXNjYXBlJywgdGhpcy5sYW5nLmhlbHAuZXNjYXBlKTtcbiAgICB0aGlzLmNvbnRleHQubWVtbygnaGVscC51bmRvJywgdGhpcy5sYW5nLmhlbHAudW5kbyk7XG4gICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAucmVkbycsIHRoaXMubGFuZy5oZWxwLnJlZG8pO1xuICAgIHRoaXMuY29udGV4dC5tZW1vKCdoZWxwLnRhYicsIHRoaXMubGFuZy5oZWxwLnRhYik7XG4gICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAudW50YWInLCB0aGlzLmxhbmcuaGVscC51bnRhYik7XG4gICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAuaW5zZXJ0UGFyYWdyYXBoJywgdGhpcy5sYW5nLmhlbHAuaW5zZXJ0UGFyYWdyYXBoKTtcbiAgICB0aGlzLmNvbnRleHQubWVtbygnaGVscC5pbnNlcnRPcmRlcmVkTGlzdCcsIHRoaXMubGFuZy5oZWxwLmluc2VydE9yZGVyZWRMaXN0KTtcbiAgICB0aGlzLmNvbnRleHQubWVtbygnaGVscC5pbnNlcnRVbm9yZGVyZWRMaXN0JywgdGhpcy5sYW5nLmhlbHAuaW5zZXJ0VW5vcmRlcmVkTGlzdCk7XG4gICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAuaW5kZW50JywgdGhpcy5sYW5nLmhlbHAuaW5kZW50KTtcbiAgICB0aGlzLmNvbnRleHQubWVtbygnaGVscC5vdXRkZW50JywgdGhpcy5sYW5nLmhlbHAub3V0ZGVudCk7XG4gICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAuZm9ybWF0UGFyYScsIHRoaXMubGFuZy5oZWxwLmZvcm1hdFBhcmEpO1xuICAgIHRoaXMuY29udGV4dC5tZW1vKCdoZWxwLmluc2VydEhvcml6b250YWxSdWxlJywgdGhpcy5sYW5nLmhlbHAuaW5zZXJ0SG9yaXpvbnRhbFJ1bGUpO1xuICAgIHRoaXMuY29udGV4dC5tZW1vKCdoZWxwLmZvbnROYW1lJywgdGhpcy5sYW5nLmhlbHAuZm9udE5hbWUpOyAvLyBuYXRpdmUgY29tbWFuZHMod2l0aCBleGVjQ29tbWFuZCksIGdlbmVyYXRlIGZ1bmN0aW9uIGZvciBleGVjQ29tbWFuZFxuXG4gICAgdmFyIGNvbW1hbmRzID0gWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnLCAnc3RyaWtldGhyb3VnaCcsICdzdXBlcnNjcmlwdCcsICdzdWJzY3JpcHQnLCAnanVzdGlmeUxlZnQnLCAnanVzdGlmeUNlbnRlcicsICdqdXN0aWZ5UmlnaHQnLCAnanVzdGlmeUZ1bGwnLCAnZm9ybWF0QmxvY2snLCAncmVtb3ZlRm9ybWF0JywgJ2JhY2tDb2xvciddO1xuXG4gICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gY29tbWFuZHMubGVuZ3RoOyBpZHggPCBsZW47IGlkeCsrKSB7XG4gICAgICB0aGlzW2NvbW1hbmRzW2lkeF1dID0gZnVuY3Rpb24gKHNDbWQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIF90aGlzLmJlZm9yZUNvbW1hbmQoKTtcblxuICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKHNDbWQsIGZhbHNlLCB2YWx1ZSk7XG5cbiAgICAgICAgICBfdGhpcy5hZnRlckNvbW1hbmQodHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICB9KGNvbW1hbmRzW2lkeF0pO1xuXG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnaGVscC4nICsgY29tbWFuZHNbaWR4XSwgdGhpcy5sYW5nLmhlbHBbY29tbWFuZHNbaWR4XV0pO1xuICAgIH1cblxuICAgIHRoaXMuZm9udE5hbWUgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIF90aGlzLmZvbnRTdHlsaW5nKCdmb250LWZhbWlseScsIGVudi52YWxpZEZvbnROYW1lKHZhbHVlKSk7XG4gICAgfSk7XG4gICAgdGhpcy5mb250U2l6ZSA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB2YXIgdW5pdCA9IF90aGlzLmN1cnJlbnRTdHlsZSgpWydmb250LXNpemUtdW5pdCddO1xuXG4gICAgICByZXR1cm4gX3RoaXMuZm9udFN0eWxpbmcoJ2ZvbnQtc2l6ZScsIHZhbHVlICsgdW5pdCk7XG4gICAgfSk7XG4gICAgdGhpcy5mb250U2l6ZVVuaXQgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdmFyIHNpemUgPSBfdGhpcy5jdXJyZW50U3R5bGUoKVsnZm9udC1zaXplJ107XG5cbiAgICAgIHJldHVybiBfdGhpcy5mb250U3R5bGluZygnZm9udC1zaXplJywgc2l6ZSArIHZhbHVlKTtcbiAgICB9KTtcblxuICAgIGZvciAodmFyIF9pZHggPSAxOyBfaWR4IDw9IDY7IF9pZHgrKykge1xuICAgICAgdGhpc1snZm9ybWF0SCcgKyBfaWR4XSA9IGZ1bmN0aW9uIChpZHgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpcy5mb3JtYXRCbG9jaygnSCcgKyBpZHgpO1xuICAgICAgICB9O1xuICAgICAgfShfaWR4KTtcblxuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2hlbHAuZm9ybWF0SCcgKyBfaWR4LCB0aGlzLmxhbmcuaGVscFsnZm9ybWF0SCcgKyBfaWR4XSk7XG4gICAgfVxuXG4gICAgdGhpcy5pbnNlcnRQYXJhZ3JhcGggPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIF90aGlzLnR5cGluZy5pbnNlcnRQYXJhZ3JhcGgoX3RoaXMuZWRpdGFibGUpO1xuICAgIH0pO1xuICAgIHRoaXMuaW5zZXJ0T3JkZXJlZExpc3QgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIF90aGlzLmJ1bGxldC5pbnNlcnRPcmRlcmVkTGlzdChfdGhpcy5lZGl0YWJsZSk7XG4gICAgfSk7XG4gICAgdGhpcy5pbnNlcnRVbm9yZGVyZWRMaXN0ID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoKSB7XG4gICAgICBfdGhpcy5idWxsZXQuaW5zZXJ0VW5vcmRlcmVkTGlzdChfdGhpcy5lZGl0YWJsZSk7XG4gICAgfSk7XG4gICAgdGhpcy5pbmRlbnQgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIF90aGlzLmJ1bGxldC5pbmRlbnQoX3RoaXMuZWRpdGFibGUpO1xuICAgIH0pO1xuICAgIHRoaXMub3V0ZGVudCA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKCkge1xuICAgICAgX3RoaXMuYnVsbGV0Lm91dGRlbnQoX3RoaXMuZWRpdGFibGUpO1xuICAgIH0pO1xuICAgIC8qKlxuICAgICAqIGluc2VydE5vZGVcbiAgICAgKiBpbnNlcnQgbm9kZVxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqL1xuXG4gICAgdGhpcy5pbnNlcnROb2RlID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgaWYgKF90aGlzLmlzTGltaXRlZChleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShub2RlKS50ZXh0KCkubGVuZ3RoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBybmcgPSBfdGhpcy5nZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgcm5nLmluc2VydE5vZGUobm9kZSk7XG5cbiAgICAgIF90aGlzLnNldExhc3RSYW5nZShyYW5nZS5jcmVhdGVGcm9tTm9kZUFmdGVyKG5vZGUpLnNlbGVjdCgpKTtcbiAgICB9KTtcbiAgICAvKipcbiAgICAgKiBpbnNlcnQgdGV4dFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0XG4gICAgICovXG5cbiAgICB0aGlzLmluc2VydFRleHQgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICBpZiAoX3RoaXMuaXNMaW1pdGVkKHRleHQubGVuZ3RoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBybmcgPSBfdGhpcy5nZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgdmFyIHRleHROb2RlID0gcm5nLmluc2VydE5vZGUoZG9tLmNyZWF0ZVRleHQodGV4dCkpO1xuXG4gICAgICBfdGhpcy5zZXRMYXN0UmFuZ2UocmFuZ2UuY3JlYXRlKHRleHROb2RlLCBkb20ubm9kZUxlbmd0aCh0ZXh0Tm9kZSkpLnNlbGVjdCgpKTtcbiAgICB9KTtcbiAgICAvKipcbiAgICAgKiBwYXN0ZSBIVE1MXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1hcmt1cFxuICAgICAqL1xuXG4gICAgdGhpcy5wYXN0ZUhUTUwgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uIChtYXJrdXApIHtcbiAgICAgIGlmIChfdGhpcy5pc0xpbWl0ZWQobWFya3VwLmxlbmd0aCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXJrdXAgPSBfdGhpcy5jb250ZXh0Lmludm9rZSgnY29kZXZpZXcucHVyaWZ5JywgbWFya3VwKTtcblxuICAgICAgdmFyIGNvbnRlbnRzID0gX3RoaXMuZ2V0TGFzdFJhbmdlKCkucGFzdGVIVE1MKG1hcmt1cCk7XG5cbiAgICAgIF90aGlzLnNldExhc3RSYW5nZShyYW5nZS5jcmVhdGVGcm9tTm9kZUFmdGVyKGxpc3RzLmxhc3QoY29udGVudHMpKS5zZWxlY3QoKSk7XG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogZm9ybWF0QmxvY2tcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YWdOYW1lXG4gICAgICovXG5cbiAgICB0aGlzLmZvcm1hdEJsb2NrID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAodGFnTmFtZSwgJHRhcmdldCkge1xuICAgICAgdmFyIG9uQXBwbHlDdXN0b21TdHlsZSA9IF90aGlzLm9wdGlvbnMuY2FsbGJhY2tzLm9uQXBwbHlDdXN0b21TdHlsZTtcblxuICAgICAgaWYgKG9uQXBwbHlDdXN0b21TdHlsZSkge1xuICAgICAgICBvbkFwcGx5Q3VzdG9tU3R5bGUuY2FsbChfdGhpcywgJHRhcmdldCwgX3RoaXMuY29udGV4dCwgX3RoaXMub25Gb3JtYXRCbG9jayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfdGhpcy5vbkZvcm1hdEJsb2NrKHRhZ05hbWUsICR0YXJnZXQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8qKlxuICAgICAqIGluc2VydCBob3Jpem9udGFsIHJ1bGVcbiAgICAgKi9cblxuICAgIHRoaXMuaW5zZXJ0SG9yaXpvbnRhbFJ1bGUgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBock5vZGUgPSBfdGhpcy5nZXRMYXN0UmFuZ2UoKS5pbnNlcnROb2RlKGRvbS5jcmVhdGUoJ0hSJykpO1xuXG4gICAgICBpZiAoaHJOb2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgIF90aGlzLnNldExhc3RSYW5nZShyYW5nZS5jcmVhdGUoaHJOb2RlLm5leHRTaWJsaW5nLCAwKS5ub3JtYWxpemUoKS5zZWxlY3QoKSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogbGluZUhlaWdodFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqL1xuXG4gICAgdGhpcy5saW5lSGVpZ2h0ID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIF90aGlzLnN0eWxlLnN0eWxlUGFyYShfdGhpcy5nZXRMYXN0UmFuZ2UoKSwge1xuICAgICAgICBsaW5lSGVpZ2h0OiB2YWx1ZVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogY3JlYXRlIGxpbmsgKGNvbW1hbmQpXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGlua0luZm9cbiAgICAgKi9cblxuICAgIHRoaXMuY3JlYXRlTGluayA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKGxpbmtJbmZvKSB7XG4gICAgICB2YXIgbGlua1VybCA9IGxpbmtJbmZvLnVybDtcbiAgICAgIHZhciBsaW5rVGV4dCA9IGxpbmtJbmZvLnRleHQ7XG4gICAgICB2YXIgaXNOZXdXaW5kb3cgPSBsaW5rSW5mby5pc05ld1dpbmRvdztcbiAgICAgIHZhciBjaGVja1Byb3RvY29sID0gbGlua0luZm8uY2hlY2tQcm90b2NvbDtcblxuICAgICAgdmFyIHJuZyA9IGxpbmtJbmZvLnJhbmdlIHx8IF90aGlzLmdldExhc3RSYW5nZSgpO1xuXG4gICAgICB2YXIgYWRkaXRpb25hbFRleHRMZW5ndGggPSBsaW5rVGV4dC5sZW5ndGggLSBybmcudG9TdHJpbmcoKS5sZW5ndGg7XG5cbiAgICAgIGlmIChhZGRpdGlvbmFsVGV4dExlbmd0aCA+IDAgJiYgX3RoaXMuaXNMaW1pdGVkKGFkZGl0aW9uYWxUZXh0TGVuZ3RoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBpc1RleHRDaGFuZ2VkID0gcm5nLnRvU3RyaW5nKCkgIT09IGxpbmtUZXh0OyAvLyBoYW5kbGUgc3BhY2VkIHVybHMgZnJvbSBpbnB1dFxuXG4gICAgICBpZiAodHlwZW9mIGxpbmtVcmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGxpbmtVcmwgPSBsaW5rVXJsLnRyaW0oKTtcbiAgICAgIH1cblxuICAgICAgaWYgKF90aGlzLm9wdGlvbnMub25DcmVhdGVMaW5rKSB7XG4gICAgICAgIGxpbmtVcmwgPSBfdGhpcy5vcHRpb25zLm9uQ3JlYXRlTGluayhsaW5rVXJsKTtcbiAgICAgIH0gZWxzZSBpZiAoY2hlY2tQcm90b2NvbCkge1xuICAgICAgICAvLyBpZiB1cmwgZG9lc24ndCBoYXZlIGFueSBwcm90b2NvbCBhbmQgbm90IGV2ZW4gYSByZWxhdGl2ZSBvciBhIGxhYmVsLCB1c2UgaHR0cDovLyBhcyBkZWZhdWx0XG4gICAgICAgIGxpbmtVcmwgPSAvXihbQS1aYS16XVtBLVphLXowLTkrLS5dKlxcOnwjfFxcLykvLnRlc3QobGlua1VybCkgPyBsaW5rVXJsIDogX3RoaXMub3B0aW9ucy5kZWZhdWx0UHJvdG9jb2wgKyBsaW5rVXJsO1xuICAgICAgfVxuXG4gICAgICB2YXIgYW5jaG9ycyA9IFtdO1xuXG4gICAgICBpZiAoaXNUZXh0Q2hhbmdlZCkge1xuICAgICAgICBybmcgPSBybmcuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgdmFyIGFuY2hvciA9IHJuZy5pbnNlcnROb2RlKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8QT4nICsgbGlua1RleHQgKyAnPC9BPicpWzBdKTtcbiAgICAgICAgYW5jaG9ycy5wdXNoKGFuY2hvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhbmNob3JzID0gX3RoaXMuc3R5bGUuc3R5bGVOb2RlcyhybmcsIHtcbiAgICAgICAgICBub2RlTmFtZTogJ0EnLFxuICAgICAgICAgIGV4cGFuZENsb3Nlc3RTaWJsaW5nOiB0cnVlLFxuICAgICAgICAgIG9ubHlQYXJ0aWFsQ29udGFpbnM6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmVhY2goYW5jaG9ycywgZnVuY3Rpb24gKGlkeCwgYW5jaG9yKSB7XG4gICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGFuY2hvcikuYXR0cignaHJlZicsIGxpbmtVcmwpO1xuXG4gICAgICAgIGlmIChpc05ld1dpbmRvdykge1xuICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGFuY2hvcikuYXR0cigndGFyZ2V0JywgJ19ibGFuaycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGFuY2hvcikucmVtb3ZlQXR0cigndGFyZ2V0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfdGhpcy5zZXRMYXN0UmFuZ2UoX3RoaXMuY3JlYXRlUmFuZ2VGcm9tTGlzdChhbmNob3JzKS5zZWxlY3QoKSk7XG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogc2V0dGluZyBjb2xvclxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNPYmpDb2xvciAgY29sb3IgY29kZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzT2JqQ29sb3IuZm9yZUNvbG9yIGZvcmVncm91bmQgY29sb3JcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc09iakNvbG9yLmJhY2tDb2xvciBiYWNrZ3JvdW5kIGNvbG9yXG4gICAgICovXG5cbiAgICB0aGlzLmNvbG9yID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoY29sb3JJbmZvKSB7XG4gICAgICB2YXIgZm9yZUNvbG9yID0gY29sb3JJbmZvLmZvcmVDb2xvcjtcbiAgICAgIHZhciBiYWNrQ29sb3IgPSBjb2xvckluZm8uYmFja0NvbG9yO1xuXG4gICAgICBpZiAoZm9yZUNvbG9yKSB7XG4gICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdmb3JlQ29sb3InLCBmYWxzZSwgZm9yZUNvbG9yKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGJhY2tDb2xvcikge1xuICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnYmFja0NvbG9yJywgZmFsc2UsIGJhY2tDb2xvcik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogU2V0IGZvcmVncm91bmQgY29sb3JcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb2xvckNvZGUgZm9yZWdyb3VuZCBjb2xvciBjb2RlXG4gICAgICovXG5cbiAgICB0aGlzLmZvcmVDb2xvciA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKGNvbG9ySW5mbykge1xuICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2ZvcmVDb2xvcicsIGZhbHNlLCBjb2xvckluZm8pO1xuICAgIH0pO1xuICAgIC8qKlxuICAgICAqIGluc2VydCBUYWJsZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRpbWVuc2lvbiBvZiB0YWJsZSAoZXggOiBcIjV4NVwiKVxuICAgICAqL1xuXG4gICAgdGhpcy5pbnNlcnRUYWJsZSA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKGRpbSkge1xuICAgICAgdmFyIGRpbWVuc2lvbiA9IGRpbS5zcGxpdCgneCcpO1xuXG4gICAgICB2YXIgcm5nID0gX3RoaXMuZ2V0TGFzdFJhbmdlKCkuZGVsZXRlQ29udGVudHMoKTtcblxuICAgICAgcm5nLmluc2VydE5vZGUoX3RoaXMudGFibGUuY3JlYXRlVGFibGUoZGltZW5zaW9uWzBdLCBkaW1lbnNpb25bMV0sIF90aGlzLm9wdGlvbnMpKTtcbiAgICB9KTtcbiAgICAvKipcbiAgICAgKiByZW1vdmUgbWVkaWEgb2JqZWN0IGFuZCBGaWd1cmUgRWxlbWVudHMgaWYgbWVkaWEgb2JqZWN0IGlzIGltZyB3aXRoIEZpZ3VyZS5cbiAgICAgKi9cblxuICAgIHRoaXMucmVtb3ZlTWVkaWEgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkdGFyZ2V0ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoX3RoaXMucmVzdG9yZVRhcmdldCgpKS5wYXJlbnQoKTtcblxuICAgICAgaWYgKCR0YXJnZXQuY2xvc2VzdCgnZmlndXJlJykubGVuZ3RoKSB7XG4gICAgICAgICR0YXJnZXQuY2xvc2VzdCgnZmlndXJlJykucmVtb3ZlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkdGFyZ2V0ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoX3RoaXMucmVzdG9yZVRhcmdldCgpKS5kZXRhY2goKTtcbiAgICAgIH1cblxuICAgICAgX3RoaXMuY29udGV4dC50cmlnZ2VyRXZlbnQoJ21lZGlhLmRlbGV0ZScsICR0YXJnZXQsIF90aGlzLiRlZGl0YWJsZSk7XG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogZmxvYXQgbWVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqL1xuXG4gICAgdGhpcy5mbG9hdE1lID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhciAkdGFyZ2V0ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoX3RoaXMucmVzdG9yZVRhcmdldCgpKTtcbiAgICAgICR0YXJnZXQudG9nZ2xlQ2xhc3MoJ25vdGUtZmxvYXQtbGVmdCcsIHZhbHVlID09PSAnbGVmdCcpO1xuICAgICAgJHRhcmdldC50b2dnbGVDbGFzcygnbm90ZS1mbG9hdC1yaWdodCcsIHZhbHVlID09PSAncmlnaHQnKTtcbiAgICAgICR0YXJnZXQuY3NzKCdmbG9hdCcsIHZhbHVlID09PSAnbm9uZScgPyAnJyA6IHZhbHVlKTtcbiAgICB9KTtcbiAgICAvKipcbiAgICAgKiByZXNpemUgb3ZlcmxheSBlbGVtZW50XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICovXG5cbiAgICB0aGlzLnJlc2l6ZSA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB2YXIgJHRhcmdldCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKF90aGlzLnJlc3RvcmVUYXJnZXQoKSk7XG4gICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuXG4gICAgICBpZiAodmFsdWUgPT09IDApIHtcbiAgICAgICAgJHRhcmdldC5jc3MoJ3dpZHRoJywgJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHRhcmdldC5jc3Moe1xuICAgICAgICAgIHdpZHRoOiB2YWx1ZSAqIDEwMCArICclJyxcbiAgICAgICAgICBoZWlnaHQ6ICcnXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgRWRpdG9yX2NyZWF0ZUNsYXNzKEVkaXRvciwgW3tcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIC8vIGJpbmQgY3VzdG9tIGV2ZW50c1xuICAgICAgdGhpcy4kZWRpdGFibGUub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGNvcmVfa2V5LmNvZGUuRU5URVIpIHtcbiAgICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2VudGVyJywgZXZlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdrZXlkb3duJywgZXZlbnQpOyAvLyBrZWVwIGEgc25hcHNob3QgdG8gbGltaXQgdGV4dCBvbiBpbnB1dCBldmVudFxuXG5cbiAgICAgICAgX3RoaXMyLnNuYXBzaG90ID0gX3RoaXMyLmhpc3RvcnkubWFrZVNuYXBzaG90KCk7XG4gICAgICAgIF90aGlzMi5oYXNLZXlTaG9ydEN1dCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICBpZiAoX3RoaXMyLm9wdGlvbnMuc2hvcnRjdXRzKSB7XG4gICAgICAgICAgICBfdGhpczIuaGFzS2V5U2hvcnRDdXQgPSBfdGhpczIuaGFuZGxlS2V5TWFwKGV2ZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMyLnByZXZlbnREZWZhdWx0RWRpdGFibGVTaG9ydEN1dHMoZXZlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfdGhpczIuaXNMaW1pdGVkKDEsIGV2ZW50KSkge1xuICAgICAgICAgIHZhciBsYXN0UmFuZ2UgPSBfdGhpczIuZ2V0TGFzdFJhbmdlKCk7XG5cbiAgICAgICAgICBpZiAobGFzdFJhbmdlLmVvIC0gbGFzdFJhbmdlLnNvID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXMyLnNldExhc3RSYW5nZSgpOyAvLyByZWNvcmQgdW5kbyBpbiB0aGUga2V5IGV2ZW50IGV4Y2VwdCBrZXlNYXAuXG5cblxuICAgICAgICBpZiAoX3RoaXMyLm9wdGlvbnMucmVjb3JkRXZlcnlLZXlzdHJva2UpIHtcbiAgICAgICAgICBpZiAoX3RoaXMyLmhhc0tleVNob3J0Q3V0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgX3RoaXMyLmhpc3RvcnkucmVjb3JkVW5kbygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSkub24oJ2tleXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIF90aGlzMi5zZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2tleXVwJywgZXZlbnQpO1xuICAgICAgfSkub24oJ2ZvY3VzJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIF90aGlzMi5zZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2ZvY3VzJywgZXZlbnQpO1xuICAgICAgfSkub24oJ2JsdXInLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdibHVyJywgZXZlbnQpO1xuICAgICAgfSkub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ21vdXNlZG93bicsIGV2ZW50KTtcbiAgICAgIH0pLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIF90aGlzMi5zZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgICBfdGhpczIuaGlzdG9yeS5yZWNvcmRVbmRvKCk7XG5cbiAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdtb3VzZXVwJywgZXZlbnQpO1xuICAgICAgfSkub24oJ3Njcm9sbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ3Njcm9sbCcsIGV2ZW50KTtcbiAgICAgIH0pLm9uKCdwYXN0ZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBfdGhpczIuc2V0TGFzdFJhbmdlKCk7XG5cbiAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdwYXN0ZScsIGV2ZW50KTtcbiAgICAgIH0pLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVG8gbGltaXQgY29tcG9zaXRpb24gY2hhcmFjdGVycyAoZS5nLiBLb3JlYW4pXG4gICAgICAgIGlmIChfdGhpczIuaXNMaW1pdGVkKDApICYmIF90aGlzMi5zbmFwc2hvdCkge1xuICAgICAgICAgIF90aGlzMi5oaXN0b3J5LmFwcGx5U25hcHNob3QoX3RoaXMyLnNuYXBzaG90KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLiRlZGl0YWJsZS5hdHRyKCdzcGVsbGNoZWNrJywgdGhpcy5vcHRpb25zLnNwZWxsQ2hlY2spO1xuICAgICAgdGhpcy4kZWRpdGFibGUuYXR0cignYXV0b2NvcnJlY3QnLCB0aGlzLm9wdGlvbnMuc3BlbGxDaGVjayk7XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZUdyYW1tYXIpIHtcbiAgICAgICAgdGhpcy4kZWRpdGFibGUuYXR0cignZGF0YS1ncmFtbScsIGZhbHNlKTtcbiAgICAgIH0gLy8gaW5pdCBjb250ZW50IGJlZm9yZSBzZXQgZXZlbnRcblxuXG4gICAgICB0aGlzLiRlZGl0YWJsZS5odG1sKGRvbS5odG1sKHRoaXMuJG5vdGUpIHx8IGRvbS5lbXB0eVBhcmEpO1xuICAgICAgdGhpcy4kZWRpdGFibGUub24oZW52LmlucHV0RXZlbnROYW1lLCBmdW5jLmRlYm91bmNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdjaGFuZ2UnLCBfdGhpczIuJGVkaXRhYmxlLmh0bWwoKSwgX3RoaXMyLiRlZGl0YWJsZSk7XG4gICAgICB9LCAxMCkpO1xuICAgICAgdGhpcy4kZWRpdGFibGUub24oJ2ZvY3VzaW4nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdmb2N1c2luJywgZXZlbnQpO1xuICAgICAgfSkub24oJ2ZvY3Vzb3V0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIF90aGlzMi5jb250ZXh0LnRyaWdnZXJFdmVudCgnZm9jdXNvdXQnLCBldmVudCk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5haXJNb2RlKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMub3ZlcnJpZGVDb250ZXh0TWVudSkge1xuICAgICAgICAgIHRoaXMuJGVkaXRvci5vbignY29udGV4dG1lbnUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIF90aGlzMi5jb250ZXh0LnRyaWdnZXJFdmVudCgnY29udGV4dG1lbnUnLCBldmVudCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy53aWR0aCkge1xuICAgICAgICAgIHRoaXMuJGVkaXRvci5vdXRlcldpZHRoKHRoaXMub3B0aW9ucy53aWR0aCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhlaWdodCkge1xuICAgICAgICAgIHRoaXMuJGVkaXRhYmxlLm91dGVySGVpZ2h0KHRoaXMub3B0aW9ucy5oZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tYXhIZWlnaHQpIHtcbiAgICAgICAgICB0aGlzLiRlZGl0YWJsZS5jc3MoJ21heC1oZWlnaHQnLCB0aGlzLm9wdGlvbnMubWF4SGVpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgdGhpcy4kZWRpdGFibGUuY3NzKCdtaW4taGVpZ2h0JywgdGhpcy5vcHRpb25zLm1pbkhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5oaXN0b3J5LnJlY29yZFVuZG8oKTtcbiAgICAgIHRoaXMuc2V0TGFzdFJhbmdlKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImRlc3Ryb3lcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHRoaXMuJGVkaXRhYmxlLm9mZigpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJoYW5kbGVLZXlNYXBcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlS2V5TWFwKGV2ZW50KSB7XG4gICAgICB2YXIga2V5TWFwID0gdGhpcy5vcHRpb25zLmtleU1hcFtlbnYuaXNNYWMgPyAnbWFjJyA6ICdwYyddO1xuICAgICAgdmFyIGtleXMgPSBbXTtcblxuICAgICAgaWYgKGV2ZW50Lm1ldGFLZXkpIHtcbiAgICAgICAga2V5cy5wdXNoKCdDTUQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50LmN0cmxLZXkgJiYgIWV2ZW50LmFsdEtleSkge1xuICAgICAgICBrZXlzLnB1c2goJ0NUUkwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgIGtleXMucHVzaCgnU0hJRlQnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGtleU5hbWUgPSBjb3JlX2tleS5uYW1lRnJvbUNvZGVbZXZlbnQua2V5Q29kZV07XG5cbiAgICAgIGlmIChrZXlOYW1lKSB7XG4gICAgICAgIGtleXMucHVzaChrZXlOYW1lKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGV2ZW50TmFtZSA9IGtleU1hcFtrZXlzLmpvaW4oJysnKV07XG5cbiAgICAgIGlmIChrZXlOYW1lID09PSAnVEFCJyAmJiAhdGhpcy5vcHRpb25zLnRhYkRpc2FibGUpIHtcbiAgICAgICAgdGhpcy5hZnRlckNvbW1hbmQoKTtcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnROYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRleHQuaW52b2tlKGV2ZW50TmFtZSkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gaWYga2V5TWFwIGFjdGlvbiB3YXMgaW52b2tlZFxuXG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoY29yZV9rZXkuaXNFZGl0KGV2ZW50LmtleUNvZGUpKSB7XG4gICAgICAgIHRoaXMuYWZ0ZXJDb21tYW5kKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwicHJldmVudERlZmF1bHRFZGl0YWJsZVNob3J0Q3V0c1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdEVkaXRhYmxlU2hvcnRDdXRzKGV2ZW50KSB7XG4gICAgICAvLyBCKEJvbGQsIDY2KSAvIEkoSXRhbGljLCA3MykgLyBVKFVuZGVybGluZSwgODUpXG4gICAgICBpZiAoKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgJiYgbGlzdHMuY29udGFpbnMoWzY2LCA3MywgODVdLCBldmVudC5rZXlDb2RlKSkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpc0xpbWl0ZWRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNMaW1pdGVkKHBhZCwgZXZlbnQpIHtcbiAgICAgIHBhZCA9IHBhZCB8fCAwO1xuXG4gICAgICBpZiAodHlwZW9mIGV2ZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpZiAoY29yZV9rZXkuaXNNb3ZlKGV2ZW50LmtleUNvZGUpIHx8IGNvcmVfa2V5LmlzTmF2aWdhdGlvbihldmVudC5rZXlDb2RlKSB8fCBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgbGlzdHMuY29udGFpbnMoW2NvcmVfa2V5LmNvZGUuQkFDS1NQQUNFLCBjb3JlX2tleS5jb2RlLkRFTEVURV0sIGV2ZW50LmtleUNvZGUpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMubWF4VGV4dExlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKHRoaXMuJGVkaXRhYmxlLnRleHQoKS5sZW5ndGggKyBwYWQgPiB0aGlzLm9wdGlvbnMubWF4VGV4dExlbmd0aCkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogY3JlYXRlIHJhbmdlXG4gICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY3JlYXRlUmFuZ2VcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlUmFuZ2UoKSB7XG4gICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICB0aGlzLnNldExhc3RSYW5nZSgpO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TGFzdFJhbmdlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGNyZWF0ZSBhIG5ldyByYW5nZSBmcm9tIHRoZSBsaXN0IG9mIGVsZW1lbnRzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2xpc3R9IGRvbSBlbGVtZW50IGxpc3RcbiAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJjcmVhdGVSYW5nZUZyb21MaXN0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVJhbmdlRnJvbUxpc3QobHN0KSB7XG4gICAgICB2YXIgc3RhcnRSYW5nZSA9IHJhbmdlLmNyZWF0ZUZyb21Ob2RlQmVmb3JlKGxpc3RzLmhlYWQobHN0KSk7XG4gICAgICB2YXIgc3RhcnRQb2ludCA9IHN0YXJ0UmFuZ2UuZ2V0U3RhcnRQb2ludCgpO1xuICAgICAgdmFyIGVuZFJhbmdlID0gcmFuZ2UuY3JlYXRlRnJvbU5vZGVBZnRlcihsaXN0cy5sYXN0KGxzdCkpO1xuICAgICAgdmFyIGVuZFBvaW50ID0gZW5kUmFuZ2UuZ2V0RW5kUG9pbnQoKTtcbiAgICAgIHJldHVybiByYW5nZS5jcmVhdGUoc3RhcnRQb2ludC5ub2RlLCBzdGFydFBvaW50Lm9mZnNldCwgZW5kUG9pbnQubm9kZSwgZW5kUG9pbnQub2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2V0IHRoZSBsYXN0IHJhbmdlXG4gICAgICpcbiAgICAgKiBpZiBnaXZlbiBybmcgaXMgZXhpc3QsIHNldCBybmcgYXMgdGhlIGxhc3QgcmFuZ2VcbiAgICAgKiBvciBjcmVhdGUgYSBuZXcgcmFuZ2UgYXQgdGhlIGVuZCBvZiB0aGUgZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInNldExhc3RSYW5nZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMYXN0UmFuZ2Uocm5nKSB7XG4gICAgICBpZiAocm5nKSB7XG4gICAgICAgIHRoaXMubGFzdFJhbmdlID0gcm5nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYXN0UmFuZ2UgPSByYW5nZS5jcmVhdGUodGhpcy5lZGl0YWJsZSk7XG5cbiAgICAgICAgaWYgKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHRoaXMubGFzdFJhbmdlLnNjKS5jbG9zZXN0KCcubm90ZS1lZGl0YWJsZScpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMubGFzdFJhbmdlID0gcmFuZ2UuY3JlYXRlRnJvbUJvZHlFbGVtZW50KHRoaXMuZWRpdGFibGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGdldCB0aGUgbGFzdCByYW5nZVxuICAgICAqXG4gICAgICogaWYgdGhlcmUgaXMgYSBzYXZlZCBsYXN0IHJhbmdlLCByZXR1cm4gaXRcbiAgICAgKiBvciBjcmVhdGUgYSBuZXcgcmFuZ2UgYW5kIHJldHVybiBpdFxuICAgICAqXG4gICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0TGFzdFJhbmdlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldExhc3RSYW5nZSgpIHtcbiAgICAgIGlmICghdGhpcy5sYXN0UmFuZ2UpIHtcbiAgICAgICAgdGhpcy5zZXRMYXN0UmFuZ2UoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMubGFzdFJhbmdlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBzYXZlUmFuZ2VcbiAgICAgKlxuICAgICAqIHNhdmUgY3VycmVudCByYW5nZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbdGhlbkNvbGxhcHNlPWZhbHNlXVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwic2F2ZVJhbmdlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVSYW5nZSh0aGVuQ29sbGFwc2UpIHtcbiAgICAgIGlmICh0aGVuQ29sbGFwc2UpIHtcbiAgICAgICAgdGhpcy5nZXRMYXN0UmFuZ2UoKS5jb2xsYXBzZSgpLnNlbGVjdCgpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiByZXN0b3JlUmFuZ2VcbiAgICAgKlxuICAgICAqIHJlc3RvcmUgbGF0ZWx5IHJhbmdlXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZXN0b3JlUmFuZ2VcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzdG9yZVJhbmdlKCkge1xuICAgICAgaWYgKHRoaXMubGFzdFJhbmdlKSB7XG4gICAgICAgIHRoaXMubGFzdFJhbmdlLnNlbGVjdCgpO1xuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInNhdmVUYXJnZXRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZVRhcmdldChub2RlKSB7XG4gICAgICB0aGlzLiRlZGl0YWJsZS5kYXRhKCd0YXJnZXQnLCBub2RlKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiY2xlYXJUYXJnZXRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJUYXJnZXQoKSB7XG4gICAgICB0aGlzLiRlZGl0YWJsZS5yZW1vdmVEYXRhKCd0YXJnZXQnKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwicmVzdG9yZVRhcmdldFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZXN0b3JlVGFyZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVkaXRhYmxlLmRhdGEoJ3RhcmdldCcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBjdXJyZW50U3R5bGVcbiAgICAgKlxuICAgICAqIGN1cnJlbnQgc3R5bGVcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R8Qm9vbGVhbn0gdW5mb2N1c1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY3VycmVudFN0eWxlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGN1cnJlbnRTdHlsZSgpIHtcbiAgICAgIHZhciBybmcgPSByYW5nZS5jcmVhdGUoKTtcblxuICAgICAgaWYgKHJuZykge1xuICAgICAgICBybmcgPSBybmcubm9ybWFsaXplKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBybmcgPyB0aGlzLnN0eWxlLmN1cnJlbnQocm5nKSA6IHRoaXMuc3R5bGUuZnJvbU5vZGUodGhpcy4kZWRpdGFibGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBzdHlsZSBmcm9tIG5vZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkbm9kZVxuICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInN0eWxlRnJvbU5vZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc3R5bGVGcm9tTm9kZSgkbm9kZSkge1xuICAgICAgcmV0dXJuIHRoaXMuc3R5bGUuZnJvbU5vZGUoJG5vZGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB1bmRvXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJ1bmRvXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVuZG8oKSB7XG4gICAgICB0aGlzLmNvbnRleHQudHJpZ2dlckV2ZW50KCdiZWZvcmUuY29tbWFuZCcsIHRoaXMuJGVkaXRhYmxlLmh0bWwoKSk7XG4gICAgICB0aGlzLmhpc3RvcnkudW5kbygpO1xuICAgICAgdGhpcy5jb250ZXh0LnRyaWdnZXJFdmVudCgnY2hhbmdlJywgdGhpcy4kZWRpdGFibGUuaHRtbCgpLCB0aGlzLiRlZGl0YWJsZSk7XG4gICAgfVxuICAgIC8qXG4gICAgKiBjb21taXRcbiAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiY29tbWl0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNvbW1pdCgpIHtcbiAgICAgIHRoaXMuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2JlZm9yZS5jb21tYW5kJywgdGhpcy4kZWRpdGFibGUuaHRtbCgpKTtcbiAgICAgIHRoaXMuaGlzdG9yeS5jb21taXQoKTtcbiAgICAgIHRoaXMuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2NoYW5nZScsIHRoaXMuJGVkaXRhYmxlLmh0bWwoKSwgdGhpcy4kZWRpdGFibGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiByZWRvXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZWRvXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlZG8oKSB7XG4gICAgICB0aGlzLmNvbnRleHQudHJpZ2dlckV2ZW50KCdiZWZvcmUuY29tbWFuZCcsIHRoaXMuJGVkaXRhYmxlLmh0bWwoKSk7XG4gICAgICB0aGlzLmhpc3RvcnkucmVkbygpO1xuICAgICAgdGhpcy5jb250ZXh0LnRyaWdnZXJFdmVudCgnY2hhbmdlJywgdGhpcy4kZWRpdGFibGUuaHRtbCgpLCB0aGlzLiRlZGl0YWJsZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGJlZm9yZSBjb21tYW5kXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJiZWZvcmVDb21tYW5kXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGJlZm9yZUNvbW1hbmQoKSB7XG4gICAgICB0aGlzLmNvbnRleHQudHJpZ2dlckV2ZW50KCdiZWZvcmUuY29tbWFuZCcsIHRoaXMuJGVkaXRhYmxlLmh0bWwoKSk7IC8vIFNldCBzdHlsZVdpdGhDU1MgYmVmb3JlIHJ1biBhIGNvbW1hbmRcblxuICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3N0eWxlV2l0aENTUycsIGZhbHNlLCB0aGlzLm9wdGlvbnMuc3R5bGVXaXRoQ1NTKTsgLy8ga2VlcCBmb2N1cyBvbiBlZGl0YWJsZSBiZWZvcmUgY29tbWFuZCBleGVjdXRpb25cblxuICAgICAgdGhpcy5mb2N1cygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBhZnRlciBjb21tYW5kXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc1ByZXZlbnRUcmlnZ2VyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJhZnRlckNvbW1hbmRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWZ0ZXJDb21tYW5kKGlzUHJldmVudFRyaWdnZXIpIHtcbiAgICAgIHRoaXMubm9ybWFsaXplQ29udGVudCgpO1xuICAgICAgdGhpcy5oaXN0b3J5LnJlY29yZFVuZG8oKTtcblxuICAgICAgaWYgKCFpc1ByZXZlbnRUcmlnZ2VyKSB7XG4gICAgICAgIHRoaXMuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2NoYW5nZScsIHRoaXMuJGVkaXRhYmxlLmh0bWwoKSwgdGhpcy4kZWRpdGFibGUpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBoYW5kbGUgdGFiIGtleVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwidGFiXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRhYigpIHtcbiAgICAgIHZhciBybmcgPSB0aGlzLmdldExhc3RSYW5nZSgpO1xuXG4gICAgICBpZiAocm5nLmlzQ29sbGFwc2VkKCkgJiYgcm5nLmlzT25DZWxsKCkpIHtcbiAgICAgICAgdGhpcy50YWJsZS50YWIocm5nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudGFiU2l6ZSA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5pc0xpbWl0ZWQodGhpcy5vcHRpb25zLnRhYlNpemUpKSB7XG4gICAgICAgICAgdGhpcy5iZWZvcmVDb21tYW5kKCk7XG4gICAgICAgICAgdGhpcy50eXBpbmcuaW5zZXJ0VGFiKHJuZywgdGhpcy5vcHRpb25zLnRhYlNpemUpO1xuICAgICAgICAgIHRoaXMuYWZ0ZXJDb21tYW5kKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogaGFuZGxlIHNoaWZ0K3RhYiBrZXlcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInVudGFiXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVudGFiKCkge1xuICAgICAgdmFyIHJuZyA9IHRoaXMuZ2V0TGFzdFJhbmdlKCk7XG5cbiAgICAgIGlmIChybmcuaXNDb2xsYXBzZWQoKSAmJiBybmcuaXNPbkNlbGwoKSkge1xuICAgICAgICB0aGlzLnRhYmxlLnRhYihybmcsIHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50YWJTaXplID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJ1biBnaXZlbiBmdW5jdGlvbiBiZXR3ZWVuIGJlZm9yZUNvbW1hbmQgYW5kIGFmdGVyQ29tbWFuZFxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwid3JhcENvbW1hbmRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gd3JhcENvbW1hbmQoZm4pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYmVmb3JlQ29tbWFuZCgpO1xuICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmFmdGVyQ29tbWFuZCgpO1xuICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaW5zZXJ0IGltYWdlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3JjXG4gICAgICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IHBhcmFtXG4gICAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImluc2VydEltYWdlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluc2VydEltYWdlKHNyYywgcGFyYW0pIHtcbiAgICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgICByZXR1cm4gY3JlYXRlSW1hZ2Uoc3JjLCBwYXJhbSkudGhlbihmdW5jdGlvbiAoJGltYWdlKSB7XG4gICAgICAgIF90aGlzMy5iZWZvcmVDb21tYW5kKCk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHBhcmFtKCRpbWFnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICRpbWFnZS5hdHRyKCdkYXRhLWZpbGVuYW1lJywgcGFyYW0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICRpbWFnZS5jc3MoJ3dpZHRoJywgTWF0aC5taW4oX3RoaXMzLiRlZGl0YWJsZS53aWR0aCgpLCAkaW1hZ2Uud2lkdGgoKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgJGltYWdlLnNob3coKTtcblxuICAgICAgICBfdGhpczMuZ2V0TGFzdFJhbmdlKCkuaW5zZXJ0Tm9kZSgkaW1hZ2VbMF0pO1xuXG4gICAgICAgIF90aGlzMy5zZXRMYXN0UmFuZ2UocmFuZ2UuY3JlYXRlRnJvbU5vZGVBZnRlcigkaW1hZ2VbMF0pLnNlbGVjdCgpKTtcblxuICAgICAgICBfdGhpczMuYWZ0ZXJDb21tYW5kKCk7XG4gICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIF90aGlzMy5jb250ZXh0LnRyaWdnZXJFdmVudCgnaW1hZ2UudXBsb2FkLmVycm9yJywgZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaW5zZXJ0SW1hZ2VzXG4gICAgICogQHBhcmFtIHtGaWxlW119IGZpbGVzXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJpbnNlcnRJbWFnZXNBc0RhdGFVUkxcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zZXJ0SW1hZ2VzQXNEYXRhVVJMKGZpbGVzKSB7XG4gICAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChmaWxlcywgZnVuY3Rpb24gKGlkeCwgZmlsZSkge1xuICAgICAgICB2YXIgZmlsZW5hbWUgPSBmaWxlLm5hbWU7XG5cbiAgICAgICAgaWYgKF90aGlzNC5vcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplICYmIF90aGlzNC5vcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplIDwgZmlsZS5zaXplKSB7XG4gICAgICAgICAgX3RoaXM0LmNvbnRleHQudHJpZ2dlckV2ZW50KCdpbWFnZS51cGxvYWQuZXJyb3InLCBfdGhpczQubGFuZy5pbWFnZS5tYXhpbXVtRmlsZVNpemVFcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVhZEZpbGVBc0RhdGFVUkwoZmlsZSkudGhlbihmdW5jdGlvbiAoZGF0YVVSTCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5pbnNlcnRJbWFnZShkYXRhVVJMLCBmaWxlbmFtZSk7XG4gICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpczQuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2ltYWdlLnVwbG9hZC5lcnJvcicpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaW5zZXJ0SW1hZ2VzT3JDYWxsYmFja1xuICAgICAqIEBwYXJhbSB7RmlsZVtdfSBmaWxlc1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiaW5zZXJ0SW1hZ2VzT3JDYWxsYmFja1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbnNlcnRJbWFnZXNPckNhbGxiYWNrKGZpbGVzKSB7XG4gICAgICB2YXIgY2FsbGJhY2tzID0gdGhpcy5vcHRpb25zLmNhbGxiYWNrczsgLy8gSWYgb25JbWFnZVVwbG9hZCBzZXQsXG5cbiAgICAgIGlmIChjYWxsYmFja3Mub25JbWFnZVVwbG9hZCkge1xuICAgICAgICB0aGlzLmNvbnRleHQudHJpZ2dlckV2ZW50KCdpbWFnZS51cGxvYWQnLCBmaWxlcyk7IC8vIGVsc2UgaW5zZXJ0IEltYWdlIGFzIGRhdGFVUkxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaW5zZXJ0SW1hZ2VzQXNEYXRhVVJMKGZpbGVzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogcmV0dXJuIHNlbGVjdGVkIHBsYWluIHRleHRcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRleHRcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImdldFNlbGVjdGVkVGV4dFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3RlZFRleHQoKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5nZXRMYXN0UmFuZ2UoKTsgLy8gaWYgcmFuZ2Ugb24gYW5jaG9yLCBleHBhbmQgcmFuZ2Ugd2l0aCBhbmNob3JcblxuICAgICAgaWYgKHJuZy5pc09uQW5jaG9yKCkpIHtcbiAgICAgICAgcm5nID0gcmFuZ2UuY3JlYXRlRnJvbU5vZGUoZG9tLmFuY2VzdG9yKHJuZy5zYywgZG9tLmlzQW5jaG9yKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBybmcudG9TdHJpbmcoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwib25Gb3JtYXRCbG9ja1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBvbkZvcm1hdEJsb2NrKHRhZ05hbWUsICR0YXJnZXQpIHtcbiAgICAgIC8vIFt3b3JrYXJvdW5kXSBmb3IgTVNJRSwgSUUgbmVlZCBgPGBcbiAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdGb3JtYXRCbG9jaycsIGZhbHNlLCBlbnYuaXNNU0lFID8gJzwnICsgdGFnTmFtZSArICc+JyA6IHRhZ05hbWUpOyAvLyBzdXBwb3J0IGN1c3RvbSBjbGFzc1xuXG4gICAgICBpZiAoJHRhcmdldCAmJiAkdGFyZ2V0Lmxlbmd0aCkge1xuICAgICAgICAvLyBmaW5kIHRoZSBleGFjdCBlbGVtZW50IGhhcyBnaXZlbiB0YWdOYW1lXG4gICAgICAgIGlmICgkdGFyZ2V0WzBdLnRhZ05hbWUudG9VcHBlckNhc2UoKSAhPT0gdGFnTmFtZS50b1VwcGVyQ2FzZSgpKSB7XG4gICAgICAgICAgJHRhcmdldCA9ICR0YXJnZXQuZmluZCh0YWdOYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkdGFyZ2V0ICYmICR0YXJnZXQubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIGNsYXNzTmFtZSA9ICR0YXJnZXRbMF0uY2xhc3NOYW1lIHx8ICcnO1xuXG4gICAgICAgICAgaWYgKGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSYW5nZSA9IHRoaXMuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgICAgIHZhciAkcGFyZW50ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoW2N1cnJlbnRSYW5nZS5zYywgY3VycmVudFJhbmdlLmVjXSkuY2xvc2VzdCh0YWdOYW1lKTtcbiAgICAgICAgICAgICRwYXJlbnQuYWRkQ2xhc3MoY2xhc3NOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZm9ybWF0UGFyYVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmb3JtYXRQYXJhKCkge1xuICAgICAgdGhpcy5mb3JtYXRCbG9jaygnUCcpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJmb250U3R5bGluZ1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmb250U3R5bGluZyh0YXJnZXQsIHZhbHVlKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5nZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgaWYgKHJuZyAhPT0gJycpIHtcbiAgICAgICAgdmFyIHNwYW5zID0gdGhpcy5zdHlsZS5zdHlsZU5vZGVzKHJuZyk7XG4gICAgICAgIHRoaXMuJGVkaXRvci5maW5kKCcubm90ZS1zdGF0dXMtb3V0cHV0JykuaHRtbCgnJyk7XG4gICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHNwYW5zKS5jc3ModGFyZ2V0LCB2YWx1ZSk7IC8vIFt3b3JrYXJvdW5kXSBhZGRlZCBzdHlsZWQgYm9ndXMgc3BhbiBmb3Igc3R5bGVcbiAgICAgICAgLy8gIC0gYWxzbyBib2d1cyBjaGFyYWN0ZXIgbmVlZGVkIGZvciBjdXJzb3IgcG9zaXRpb25cblxuICAgICAgICBpZiAocm5nLmlzQ29sbGFwc2VkKCkpIHtcbiAgICAgICAgICB2YXIgZmlyc3RTcGFuID0gbGlzdHMuaGVhZChzcGFucyk7XG5cbiAgICAgICAgICBpZiAoZmlyc3RTcGFuICYmICFkb20ubm9kZUxlbmd0aChmaXJzdFNwYW4pKSB7XG4gICAgICAgICAgICBmaXJzdFNwYW4uaW5uZXJIVE1MID0gZG9tLlpFUk9fV0lEVEhfTkJTUF9DSEFSO1xuICAgICAgICAgICAgcmFuZ2UuY3JlYXRlRnJvbU5vZGUoZmlyc3RTcGFuLmZpcnN0Q2hpbGQpLnNlbGVjdCgpO1xuICAgICAgICAgICAgdGhpcy5zZXRMYXN0UmFuZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuJGVkaXRhYmxlLmRhdGEoS0VZX0JPR1VTLCBmaXJzdFNwYW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNldExhc3RSYW5nZSh0aGlzLmNyZWF0ZVJhbmdlRnJvbUxpc3Qoc3BhbnMpLnNlbGVjdCgpKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG5vdGVTdGF0dXNPdXRwdXQgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5ub3coKTtcbiAgICAgICAgdGhpcy4kZWRpdG9yLmZpbmQoJy5ub3RlLXN0YXR1cy1vdXRwdXQnKS5odG1sKCc8ZGl2IGlkPVwibm90ZS1zdGF0dXMtb3V0cHV0LScgKyBub3RlU3RhdHVzT3V0cHV0ICsgJ1wiIGNsYXNzPVwiYWxlcnQgYWxlcnQtaW5mb1wiPicgKyB0aGlzLmxhbmcub3V0cHV0Lm5vU2VsZWN0aW9uICsgJzwvZGl2PicpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnI25vdGUtc3RhdHVzLW91dHB1dC0nICsgbm90ZVN0YXR1c091dHB1dCkucmVtb3ZlKCk7XG4gICAgICAgIH0sIDUwMDApO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiB1bmxpbmtcbiAgICAgKlxuICAgICAqIEB0eXBlIGNvbW1hbmRcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInVubGlua1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1bmxpbmsoKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5nZXRMYXN0UmFuZ2UoKTtcblxuICAgICAgaWYgKHJuZy5pc09uQW5jaG9yKCkpIHtcbiAgICAgICAgdmFyIGFuY2hvciA9IGRvbS5hbmNlc3Rvcihybmcuc2MsIGRvbS5pc0FuY2hvcik7XG4gICAgICAgIHJuZyA9IHJhbmdlLmNyZWF0ZUZyb21Ob2RlKGFuY2hvcik7XG4gICAgICAgIHJuZy5zZWxlY3QoKTtcbiAgICAgICAgdGhpcy5zZXRMYXN0UmFuZ2UoKTtcbiAgICAgICAgdGhpcy5iZWZvcmVDb21tYW5kKCk7XG4gICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmxpbmsnKTtcbiAgICAgICAgdGhpcy5hZnRlckNvbW1hbmQoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogcmV0dXJucyBsaW5rIGluZm9cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9IHJldHVybi5yYW5nZVxuICAgICAqIEByZXR1cm4ge1N0cmluZ30gcmV0dXJuLnRleHRcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSBbcmV0dXJuLmlzTmV3V2luZG93PXRydWVdXG4gICAgICogQHJldHVybiB7U3RyaW5nfSBbcmV0dXJuLnVybD1cIlwiXVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0TGlua0luZm9cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGlua0luZm8oKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5nZXRMYXN0UmFuZ2UoKS5leHBhbmQoZG9tLmlzQW5jaG9yKTsgLy8gR2V0IHRoZSBmaXJzdCBhbmNob3Igb24gcmFuZ2UoZm9yIGVkaXQpLlxuXG4gICAgICB2YXIgJGFuY2hvciA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGxpc3RzLmhlYWQocm5nLm5vZGVzKGRvbS5pc0FuY2hvcikpKTtcbiAgICAgIHZhciBsaW5rSW5mbyA9IHtcbiAgICAgICAgcmFuZ2U6IHJuZyxcbiAgICAgICAgdGV4dDogcm5nLnRvU3RyaW5nKCksXG4gICAgICAgIHVybDogJGFuY2hvci5sZW5ndGggPyAkYW5jaG9yLmF0dHIoJ2hyZWYnKSA6ICcnXG4gICAgICB9OyAvLyBXaGVuIGFuY2hvciBleGlzdHMsXG5cbiAgICAgIGlmICgkYW5jaG9yLmxlbmd0aCkge1xuICAgICAgICAvLyBTZXQgaXNOZXdXaW5kb3cgYnkgY2hlY2tpbmcgaXRzIHRhcmdldC5cbiAgICAgICAgbGlua0luZm8uaXNOZXdXaW5kb3cgPSAkYW5jaG9yLmF0dHIoJ3RhcmdldCcpID09PSAnX2JsYW5rJztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxpbmtJbmZvO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJhZGRSb3dcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUm93KHBvc2l0aW9uKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5nZXRMYXN0UmFuZ2UodGhpcy4kZWRpdGFibGUpO1xuXG4gICAgICBpZiAocm5nLmlzQ29sbGFwc2VkKCkgJiYgcm5nLmlzT25DZWxsKCkpIHtcbiAgICAgICAgdGhpcy5iZWZvcmVDb21tYW5kKCk7XG4gICAgICAgIHRoaXMudGFibGUuYWRkUm93KHJuZywgcG9zaXRpb24pO1xuICAgICAgICB0aGlzLmFmdGVyQ29tbWFuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJhZGRDb2xcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkQ29sKHBvc2l0aW9uKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5nZXRMYXN0UmFuZ2UodGhpcy4kZWRpdGFibGUpO1xuXG4gICAgICBpZiAocm5nLmlzQ29sbGFwc2VkKCkgJiYgcm5nLmlzT25DZWxsKCkpIHtcbiAgICAgICAgdGhpcy5iZWZvcmVDb21tYW5kKCk7XG4gICAgICAgIHRoaXMudGFibGUuYWRkQ29sKHJuZywgcG9zaXRpb24pO1xuICAgICAgICB0aGlzLmFmdGVyQ29tbWFuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZWxldGVSb3dcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVsZXRlUm93KCkge1xuICAgICAgdmFyIHJuZyA9IHRoaXMuZ2V0TGFzdFJhbmdlKHRoaXMuJGVkaXRhYmxlKTtcblxuICAgICAgaWYgKHJuZy5pc0NvbGxhcHNlZCgpICYmIHJuZy5pc09uQ2VsbCgpKSB7XG4gICAgICAgIHRoaXMuYmVmb3JlQ29tbWFuZCgpO1xuICAgICAgICB0aGlzLnRhYmxlLmRlbGV0ZVJvdyhybmcpO1xuICAgICAgICB0aGlzLmFmdGVyQ29tbWFuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZWxldGVDb2xcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVsZXRlQ29sKCkge1xuICAgICAgdmFyIHJuZyA9IHRoaXMuZ2V0TGFzdFJhbmdlKHRoaXMuJGVkaXRhYmxlKTtcblxuICAgICAgaWYgKHJuZy5pc0NvbGxhcHNlZCgpICYmIHJuZy5pc09uQ2VsbCgpKSB7XG4gICAgICAgIHRoaXMuYmVmb3JlQ29tbWFuZCgpO1xuICAgICAgICB0aGlzLnRhYmxlLmRlbGV0ZUNvbChybmcpO1xuICAgICAgICB0aGlzLmFmdGVyQ29tbWFuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZWxldGVUYWJsZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZWxldGVUYWJsZSgpIHtcbiAgICAgIHZhciBybmcgPSB0aGlzLmdldExhc3RSYW5nZSh0aGlzLiRlZGl0YWJsZSk7XG5cbiAgICAgIGlmIChybmcuaXNDb2xsYXBzZWQoKSAmJiBybmcuaXNPbkNlbGwoKSkge1xuICAgICAgICB0aGlzLmJlZm9yZUNvbW1hbmQoKTtcbiAgICAgICAgdGhpcy50YWJsZS5kZWxldGVUYWJsZShybmcpO1xuICAgICAgICB0aGlzLmFmdGVyQ29tbWFuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1Bvc2l0aW9ufSBwb3NcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJHRhcmdldCAtIHRhcmdldCBlbGVtZW50XG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYktlZXBSYXRpb10gLSBrZWVwIHJhdGlvXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJyZXNpemVUb1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemVUbyhwb3MsICR0YXJnZXQsIGJLZWVwUmF0aW8pIHtcbiAgICAgIHZhciBpbWFnZVNpemU7XG5cbiAgICAgIGlmIChiS2VlcFJhdGlvKSB7XG4gICAgICAgIHZhciBuZXdSYXRpbyA9IHBvcy55IC8gcG9zLng7XG4gICAgICAgIHZhciByYXRpbyA9ICR0YXJnZXQuZGF0YSgncmF0aW8nKTtcbiAgICAgICAgaW1hZ2VTaXplID0ge1xuICAgICAgICAgIHdpZHRoOiByYXRpbyA+IG5ld1JhdGlvID8gcG9zLnggOiBwb3MueSAvIHJhdGlvLFxuICAgICAgICAgIGhlaWdodDogcmF0aW8gPiBuZXdSYXRpbyA/IHBvcy54ICogcmF0aW8gOiBwb3MueVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW1hZ2VTaXplID0ge1xuICAgICAgICAgIHdpZHRoOiBwb3MueCxcbiAgICAgICAgICBoZWlnaHQ6IHBvcy55XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgICR0YXJnZXQuY3NzKGltYWdlU2l6ZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciBlZGl0YWJsZSBhcmVhIGhhcyBmb2N1cyBvciBub3QuXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJoYXNGb2N1c1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNGb2N1cygpIHtcbiAgICAgIHJldHVybiB0aGlzLiRlZGl0YWJsZS5pcygnOmZvY3VzJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHNldCBmb2N1c1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZm9jdXNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXMoKSB7XG4gICAgICAvLyBbd29ya2Fyb3VuZF0gU2NyZWVuIHdpbGwgbW92ZSB3aGVuIHBhZ2UgaXMgc2NvbGxlZCBpbiBJRS5cbiAgICAgIC8vICAtIGRvIGZvY3VzIHdoZW4gbm90IGZvY3VzZWRcbiAgICAgIGlmICghdGhpcy5oYXNGb2N1cygpKSB7XG4gICAgICAgIHRoaXMuJGVkaXRhYmxlLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciBjb250ZW50cyBpcyBlbXB0eSBvciBub3QuXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImlzRW1wdHlcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNFbXB0eSgpIHtcbiAgICAgIHJldHVybiBkb20uaXNFbXB0eSh0aGlzLiRlZGl0YWJsZVswXSkgfHwgZG9tLmVtcHR5UGFyYSA9PT0gdGhpcy4kZWRpdGFibGUuaHRtbCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFsbCBjb250ZW50cyBhbmQgcmVzdG9yZXMgdGhlIGVkaXRhYmxlIGluc3RhbmNlIHRvIGFuIF9lbXB0eVBhcmFfLlxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZW1wdHlcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZW1wdHkoKSB7XG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdjb2RlJywgZG9tLmVtcHR5UGFyYSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIG5vcm1hbGl6ZSBjb250ZW50XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJub3JtYWxpemVDb250ZW50XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG5vcm1hbGl6ZUNvbnRlbnQoKSB7XG4gICAgICB0aGlzLiRlZGl0YWJsZVswXS5ub3JtYWxpemUoKTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gRWRpdG9yO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvbW9kdWxlL0NsaXBib2FyZC5qc1xuZnVuY3Rpb24gQ2xpcGJvYXJkX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gQ2xpcGJvYXJkX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBDbGlwYm9hcmRfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBDbGlwYm9hcmRfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIENsaXBib2FyZF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cblxudmFyIENsaXBib2FyZF9DbGlwYm9hcmQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDbGlwYm9hcmQoY29udGV4dCkge1xuICAgIENsaXBib2FyZF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDbGlwYm9hcmQpO1xuXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLiRlZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZTtcbiAgfVxuXG4gIENsaXBib2FyZF9jcmVhdGVDbGFzcyhDbGlwYm9hcmQsIFt7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHRoaXMuJGVkaXRhYmxlLm9uKCdwYXN0ZScsIHRoaXMucGFzdGVCeUV2ZW50LmJpbmQodGhpcykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBwYXN0ZSBieSBjbGlwYm9hcmQgZXZlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJwYXN0ZUJ5RXZlbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcGFzdGVCeUV2ZW50KGV2ZW50KSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB2YXIgY2xpcGJvYXJkRGF0YSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YTtcblxuICAgICAgaWYgKGNsaXBib2FyZERhdGEgJiYgY2xpcGJvYXJkRGF0YS5pdGVtcyAmJiBjbGlwYm9hcmREYXRhLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICB2YXIgaXRlbSA9IGNsaXBib2FyZERhdGEuaXRlbXMubGVuZ3RoID4gMSA/IGNsaXBib2FyZERhdGEuaXRlbXNbMV0gOiBsaXN0cy5oZWFkKGNsaXBib2FyZERhdGEuaXRlbXMpO1xuXG4gICAgICAgIGlmIChpdGVtLmtpbmQgPT09ICdmaWxlJyAmJiBpdGVtLnR5cGUuaW5kZXhPZignaW1hZ2UvJykgIT09IC0xKSB7XG4gICAgICAgICAgLy8gcGFzdGUgaW1nIGZpbGVcbiAgICAgICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0SW1hZ2VzT3JDYWxsYmFjaycsIFtpdGVtLmdldEFzRmlsZSgpXSk7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLmtpbmQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgLy8gcGFzdGUgdGV4dCB3aXRoIG1heFRleHRMZW5ndGggY2hlY2tcbiAgICAgICAgICBpZiAodGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmlzTGltaXRlZCcsIGNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHdpbmRvdy5jbGlwYm9hcmREYXRhKSB7XG4gICAgICAgIC8vIGZvciBJRVxuICAgICAgICB2YXIgdGV4dCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKTtcblxuICAgICAgICBpZiAodGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmlzTGltaXRlZCcsIHRleHQubGVuZ3RoKSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gLy8gQ2FsbCBlZGl0b3IuYWZ0ZXJDb21tYW5kIGFmdGVyIHByb2NlZWRpbmcgZGVmYXVsdCBldmVudCBoYW5kbGVyXG5cblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuYWZ0ZXJDb21tYW5kJyk7XG4gICAgICB9LCAxMCk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIENsaXBib2FyZDtcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9Ecm9wem9uZS5qc1xuZnVuY3Rpb24gRHJvcHpvbmVfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBEcm9wem9uZV9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gRHJvcHpvbmVfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBEcm9wem9uZV9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgRHJvcHpvbmVfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cbnZhciBEcm9wem9uZV9Ecm9wem9uZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERyb3B6b25lKGNvbnRleHQpIHtcbiAgICBEcm9wem9uZV9jbGFzc0NhbGxDaGVjayh0aGlzLCBEcm9wem9uZSk7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMuJGV2ZW50TGlzdGVuZXIgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShkb2N1bWVudCk7XG4gICAgdGhpcy4kZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB0aGlzLiRlZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZTtcbiAgICB0aGlzLm9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdGhpcy5sYW5nID0gdGhpcy5vcHRpb25zLmxhbmdJbmZvO1xuICAgIHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzID0ge307XG4gICAgdGhpcy4kZHJvcHpvbmUgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShbJzxkaXYgY2xhc3M9XCJub3RlLWRyb3B6b25lXCI+JywgJzxkaXYgY2xhc3M9XCJub3RlLWRyb3B6b25lLW1lc3NhZ2VcIj48L2Rpdj4nLCAnPC9kaXY+J10uam9pbignJykpLnByZXBlbmRUbyh0aGlzLiRlZGl0b3IpO1xuICB9XG4gIC8qKlxuICAgKiBhdHRhY2ggRHJhZyBhbmQgRHJvcCBFdmVudHNcbiAgICovXG5cblxuICBEcm9wem9uZV9jcmVhdGVDbGFzcyhEcm9wem9uZSwgW3tcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlRHJhZ0FuZERyb3ApIHtcbiAgICAgICAgLy8gcHJldmVudCBkZWZhdWx0IGRyb3AgZXZlbnRcbiAgICAgICAgdGhpcy5kb2N1bWVudEV2ZW50SGFuZGxlcnMub25Ecm9wID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH07IC8vIGRvIG5vdCBjb25zaWRlciBvdXRzaWRlIG9mIGRyb3B6b25lXG5cblxuICAgICAgICB0aGlzLiRldmVudExpc3RlbmVyID0gdGhpcy4kZHJvcHpvbmU7XG4gICAgICAgIHRoaXMuJGV2ZW50TGlzdGVuZXIub24oJ2Ryb3AnLCB0aGlzLmRvY3VtZW50RXZlbnRIYW5kbGVycy5vbkRyb3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hdHRhY2hEcmFnQW5kRHJvcEV2ZW50KCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGF0dGFjaCBEcmFnIGFuZCBEcm9wIEV2ZW50c1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiYXR0YWNoRHJhZ0FuZERyb3BFdmVudFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBhdHRhY2hEcmFnQW5kRHJvcEV2ZW50KCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgdmFyIGNvbGxlY3Rpb24gPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgpO1xuICAgICAgdmFyICRkcm9wem9uZU1lc3NhZ2UgPSB0aGlzLiRkcm9wem9uZS5maW5kKCcubm90ZS1kcm9wem9uZS1tZXNzYWdlJyk7XG5cbiAgICAgIHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJhZ2VudGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGlzQ29kZXZpZXcgPSBfdGhpcy5jb250ZXh0Lmludm9rZSgnY29kZXZpZXcuaXNBY3RpdmF0ZWQnKTtcblxuICAgICAgICB2YXIgaGFzRWRpdG9yU2l6ZSA9IF90aGlzLiRlZGl0b3Iud2lkdGgoKSA+IDAgJiYgX3RoaXMuJGVkaXRvci5oZWlnaHQoKSA+IDA7XG5cbiAgICAgICAgaWYgKCFpc0NvZGV2aWV3ICYmICFjb2xsZWN0aW9uLmxlbmd0aCAmJiBoYXNFZGl0b3JTaXplKSB7XG4gICAgICAgICAgX3RoaXMuJGVkaXRvci5hZGRDbGFzcygnZHJhZ292ZXInKTtcblxuICAgICAgICAgIF90aGlzLiRkcm9wem9uZS53aWR0aChfdGhpcy4kZWRpdG9yLndpZHRoKCkpO1xuXG4gICAgICAgICAgX3RoaXMuJGRyb3B6b25lLmhlaWdodChfdGhpcy4kZWRpdG9yLmhlaWdodCgpKTtcblxuICAgICAgICAgICRkcm9wem9uZU1lc3NhZ2UudGV4dChfdGhpcy5sYW5nLmltYWdlLmRyYWdJbWFnZUhlcmUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb24uYWRkKGUudGFyZ2V0KTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJhZ2xlYXZlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb24ubm90KGUudGFyZ2V0KTsgLy8gSWYgbm9kZU5hbWUgaXMgQk9EWSwgdGhlbiBqdXN0IG1ha2UgaXQgb3ZlciAoZml4IGZvciBJRSlcblxuICAgICAgICBpZiAoIWNvbGxlY3Rpb24ubGVuZ3RoIHx8IGUudGFyZ2V0Lm5vZGVOYW1lID09PSAnQk9EWScpIHtcbiAgICAgICAgICBjb2xsZWN0aW9uID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoKTtcblxuICAgICAgICAgIF90aGlzLiRlZGl0b3IucmVtb3ZlQ2xhc3MoJ2RyYWdvdmVyJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29sbGVjdGlvbiA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCk7XG5cbiAgICAgICAgX3RoaXMuJGVkaXRvci5yZW1vdmVDbGFzcygnZHJhZ292ZXInKTtcbiAgICAgIH07IC8vIHNob3cgZHJvcHpvbmUgb24gZHJhZ2VudGVyIHdoZW4gZHJhZ2dpbmcgYSBvYmplY3QgdG8gZG9jdW1lbnRcbiAgICAgIC8vIC1idXQgb25seSBpZiB0aGUgZWRpdG9yIGlzIHZpc2libGUsIGkuZS4gaGFzIGEgcG9zaXRpdmUgd2lkdGggYW5kIGhlaWdodFxuXG5cbiAgICAgIHRoaXMuJGV2ZW50TGlzdGVuZXIub24oJ2RyYWdlbnRlcicsIHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJhZ2VudGVyKS5vbignZHJhZ2xlYXZlJywgdGhpcy5kb2N1bWVudEV2ZW50SGFuZGxlcnMub25EcmFnbGVhdmUpLm9uKCdkcm9wJywgdGhpcy5kb2N1bWVudEV2ZW50SGFuZGxlcnMub25Ecm9wKTsgLy8gY2hhbmdlIGRyb3B6b25lJ3MgbWVzc2FnZSBvbiBob3Zlci5cblxuICAgICAgdGhpcy4kZHJvcHpvbmUub24oJ2RyYWdlbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMuJGRyb3B6b25lLmFkZENsYXNzKCdob3ZlcicpO1xuXG4gICAgICAgICRkcm9wem9uZU1lc3NhZ2UudGV4dChfdGhpcy5sYW5nLmltYWdlLmRyb3BJbWFnZSk7XG4gICAgICB9KS5vbignZHJhZ2xlYXZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy4kZHJvcHpvbmUucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG5cbiAgICAgICAgJGRyb3B6b25lTWVzc2FnZS50ZXh0KF90aGlzLmxhbmcuaW1hZ2UuZHJhZ0ltYWdlSGVyZSk7XG4gICAgICB9KTsgLy8gYXR0YWNoIGRyb3BJbWFnZVxuXG4gICAgICB0aGlzLiRkcm9wem9uZS5vbignZHJvcCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgZGF0YVRyYW5zZmVyID0gZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXI7IC8vIHN0b3AgdGhlIGJyb3dzZXIgZnJvbSBvcGVuaW5nIHRoZSBkcm9wcGVkIGNvbnRlbnRcblxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmIChkYXRhVHJhbnNmZXIgJiYgZGF0YVRyYW5zZmVyLmZpbGVzICYmIGRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICBfdGhpcy4kZWRpdGFibGUuZm9jdXMoKTtcblxuICAgICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0SW1hZ2VzT3JDYWxsYmFjaycsIGRhdGFUcmFuc2Zlci5maWxlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChkYXRhVHJhbnNmZXIudHlwZXMsIGZ1bmN0aW9uIChpZHgsIHR5cGUpIHtcbiAgICAgICAgICAgIC8vIHNraXAgbW96LXNwZWNpZmljIHR5cGVzXG4gICAgICAgICAgICBpZiAodHlwZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ19tb3pfJykgPiAtMSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZGF0YVRyYW5zZmVyLmdldERhdGEodHlwZSk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigndGV4dCcpID4gLTEpIHtcbiAgICAgICAgICAgICAgX3RoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5wYXN0ZUhUTUwnLCBjb250ZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGNvbnRlbnQpLmVhY2goZnVuY3Rpb24gKGlkeCwgaXRlbSkge1xuICAgICAgICAgICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0Tm9kZScsIGl0ZW0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSkub24oJ2RyYWdvdmVyJywgZmFsc2UpOyAvLyBwcmV2ZW50IGRlZmF1bHQgZHJhZ292ZXIgZXZlbnRcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgX3RoaXMyLiRldmVudExpc3RlbmVyLm9mZihrZXkuc3Vic3RyKDIpLnRvTG93ZXJDYXNlKCksIF90aGlzMi5kb2N1bWVudEV2ZW50SGFuZGxlcnNba2V5XSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZG9jdW1lbnRFdmVudEhhbmRsZXJzID0ge307XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIERyb3B6b25lO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvbW9kdWxlL0NvZGV2aWV3LmpzXG5mdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSBcInVuZGVmaW5lZFwiIHx8IG9bU3ltYm9sLml0ZXJhdG9yXSA9PSBudWxsKSB7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChvID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSkgeyB2YXIgaSA9IDA7IHZhciBGID0gZnVuY3Rpb24gRigpIHt9OyByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgeyBpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OyByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9OyB9LCBlOiBmdW5jdGlvbiBlKF9lKSB7IHRocm93IF9lOyB9LCBmOiBGIH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpOyB9IHZhciBpdCwgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsIGRpZEVyciA9IGZhbHNlLCBlcnI7IHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7IGl0ID0gb1tTeW1ib2wuaXRlcmF0b3JdKCk7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciBzdGVwID0gaXQubmV4dCgpOyBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOyByZXR1cm4gc3RlcDsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgZGlkRXJyID0gdHJ1ZTsgZXJyID0gX2UyOyB9LCBmOiBmdW5jdGlvbiBmKCkgeyB0cnkgeyBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbXCJyZXR1cm5cIl0gIT0gbnVsbCkgaXRbXCJyZXR1cm5cIl0oKTsgfSBmaW5hbGx5IHsgaWYgKGRpZEVycikgdGhyb3cgZXJyOyB9IH0gfTsgfVxuXG5mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09IFwic3RyaW5nXCIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSBcIk9iamVjdFwiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSBcIk1hcFwiIHx8IG4gPT09IFwiU2V0XCIpIHJldHVybiBBcnJheS5mcm9tKG4pOyBpZiAobiA9PT0gXCJBcmd1bWVudHNcIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH1cblxuZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9XG5cbmZ1bmN0aW9uIENvZGV2aWV3X2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gQ29kZXZpZXdfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIENvZGV2aWV3X2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgQ29kZXZpZXdfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIENvZGV2aWV3X2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG4vKipcbiAqIEBjbGFzcyBDb2Rldmlld1xuICovXG5cbnZhciBDb2Rldmlld19Db2RlVmlldyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvZGVWaWV3KGNvbnRleHQpIHtcbiAgICBDb2Rldmlld19jbGFzc0NhbGxDaGVjayh0aGlzLCBDb2RlVmlldyk7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMuJGVkaXRvciA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0b3I7XG4gICAgdGhpcy4kZWRpdGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGFibGU7XG4gICAgdGhpcy4kY29kYWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5jb2RhYmxlO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLkNvZGVNaXJyb3JDb25zdHJ1Y3RvciA9IHdpbmRvdy5Db2RlTWlycm9yO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5jb2RlbWlycm9yLkNvZGVNaXJyb3JDb25zdHJ1Y3Rvcikge1xuICAgICAgdGhpcy5Db2RlTWlycm9yQ29uc3RydWN0b3IgPSB0aGlzLm9wdGlvbnMuY29kZW1pcnJvci5Db2RlTWlycm9yQ29uc3RydWN0b3I7XG4gICAgfVxuICB9XG5cbiAgQ29kZXZpZXdfY3JlYXRlQ2xhc3MoQ29kZVZpZXcsIFt7XG4gICAga2V5OiBcInN5bmNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc3luYyhodG1sKSB7XG4gICAgICB2YXIgaXNDb2RldmlldyA9IHRoaXMuaXNBY3RpdmF0ZWQoKTtcbiAgICAgIHZhciBDb2RlTWlycm9yID0gdGhpcy5Db2RlTWlycm9yQ29uc3RydWN0b3I7XG5cbiAgICAgIGlmIChpc0NvZGV2aWV3KSB7XG4gICAgICAgIGlmIChodG1sKSB7XG4gICAgICAgICAgaWYgKENvZGVNaXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuJGNvZGFibGUuZGF0YSgnY21FZGl0b3InKS5nZXREb2MoKS5zZXRWYWx1ZShodG1sKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kY29kYWJsZS52YWwoaHRtbCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChDb2RlTWlycm9yKSB7XG4gICAgICAgICAgICB0aGlzLiRjb2RhYmxlLmRhdGEoJ2NtRWRpdG9yJykuc2F2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB0aGlzLiRjb2RhYmxlLm9uKCdrZXl1cCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gY29yZV9rZXkuY29kZS5FU0NBUEUpIHtcbiAgICAgICAgICBfdGhpcy5kZWFjdGl2YXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiaXNBY3RpdmF0ZWRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNBY3RpdmF0ZWQoKSB7XG4gICAgICByZXR1cm4gdGhpcy4kZWRpdG9yLmhhc0NsYXNzKCdjb2RldmlldycpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0b2dnbGUgY29kZXZpZXdcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInRvZ2dsZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB0b2dnbGUoKSB7XG4gICAgICBpZiAodGhpcy5pc0FjdGl2YXRlZCgpKSB7XG4gICAgICAgIHRoaXMuZGVhY3RpdmF0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZSgpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNvbnRleHQudHJpZ2dlckV2ZW50KCdjb2Rldmlldy50b2dnbGVkJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHB1cmlmeSBpbnB1dCB2YWx1ZVxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicHVyaWZ5XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHB1cmlmeSh2YWx1ZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb2Rldmlld0ZpbHRlcikge1xuICAgICAgICAvLyBmaWx0ZXIgY29kZSB2aWV3IHJlZ2V4XG4gICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSh0aGlzLm9wdGlvbnMuY29kZXZpZXdGaWx0ZXJSZWdleCwgJycpOyAvLyBhbGxvdyBzcGVjaWZpYyBpZnJhbWUgdGFnXG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb2Rldmlld0lmcmFtZUZpbHRlcikge1xuICAgICAgICAgIHZhciB3aGl0ZWxpc3QgPSB0aGlzLm9wdGlvbnMuY29kZXZpZXdJZnJhbWVXaGl0ZWxpc3RTcmMuY29uY2F0KHRoaXMub3B0aW9ucy5jb2Rldmlld0lmcmFtZVdoaXRlbGlzdFNyY0Jhc2UpO1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvKDxpZnJhbWUuKj8+Lio/KD86PFxcL2lmcmFtZT4pPykvZ2ksIGZ1bmN0aW9uICh0YWcpIHtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBpZiBzcmMgYXR0cmlidXRlIGlzIGR1cGxpY2F0ZWRcbiAgICAgICAgICAgIGlmICgvPC4rc3JjKD89PT8oJ3xcInxcXHMpPylbXFxzXFxTXStzcmMoPz0oJ3xcInxcXHMpPylbXj5dKj8+L2kudGVzdCh0YWcpKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHdoaXRlbGlzdCksXG4gICAgICAgICAgICAgICAgX3N0ZXA7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNyYyA9IF9zdGVwLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgLy8gcGFzcyBpZiBzcmMgaXMgdHJ1c3RlZFxuICAgICAgICAgICAgICAgIGlmIChuZXcgUmVnRXhwKCdzcmM9XCIoaHR0cHM/Oik/XFwvXFwvJyArIHNyYy5yZXBsYWNlKC9bLVxcL1xcXFxeJCorPy4oKXxbXFxde31dL2csICdcXFxcJCYnKSArICdcXC8oLispXCInKS50ZXN0KHRhZykpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0YWc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTtcbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgIF9pdGVyYXRvci5mKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGFjdGl2YXRlIGNvZGUgdmlld1xuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiYWN0aXZhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgdmFyIENvZGVNaXJyb3IgPSB0aGlzLkNvZGVNaXJyb3JDb25zdHJ1Y3RvcjtcbiAgICAgIHRoaXMuJGNvZGFibGUudmFsKGRvbS5odG1sKHRoaXMuJGVkaXRhYmxlLCB0aGlzLm9wdGlvbnMucHJldHRpZnlIdG1sKSk7XG4gICAgICB0aGlzLiRjb2RhYmxlLmhlaWdodCh0aGlzLiRlZGl0YWJsZS5oZWlnaHQoKSk7XG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCd0b29sYmFyLnVwZGF0ZUNvZGV2aWV3JywgdHJ1ZSk7XG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdhaXJQb3BvdmVyLnVwZGF0ZUNvZGV2aWV3JywgdHJ1ZSk7XG4gICAgICB0aGlzLiRlZGl0b3IuYWRkQ2xhc3MoJ2NvZGV2aWV3Jyk7XG4gICAgICB0aGlzLiRjb2RhYmxlLmZvY3VzKCk7IC8vIGFjdGl2YXRlIENvZGVNaXJyb3IgYXMgY29kYWJsZVxuXG4gICAgICBpZiAoQ29kZU1pcnJvcikge1xuICAgICAgICB2YXIgY21FZGl0b3IgPSBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSh0aGlzLiRjb2RhYmxlWzBdLCB0aGlzLm9wdGlvbnMuY29kZW1pcnJvcik7IC8vIENvZGVNaXJyb3IgVGVyblNlcnZlclxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY29kZW1pcnJvci50ZXJuKSB7XG4gICAgICAgICAgdmFyIHNlcnZlciA9IG5ldyBDb2RlTWlycm9yLlRlcm5TZXJ2ZXIodGhpcy5vcHRpb25zLmNvZGVtaXJyb3IudGVybik7XG4gICAgICAgICAgY21FZGl0b3IudGVyblNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgICBjbUVkaXRvci5vbignY3Vyc29yQWN0aXZpdHknLCBmdW5jdGlvbiAoY20pIHtcbiAgICAgICAgICAgIHNlcnZlci51cGRhdGVBcmdIaW50cyhjbSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjbUVkaXRvci5vbignYmx1cicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIF90aGlzMi5jb250ZXh0LnRyaWdnZXJFdmVudCgnYmx1ci5jb2RldmlldycsIGNtRWRpdG9yLmdldFZhbHVlKCksIGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNtRWRpdG9yLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdjaGFuZ2UuY29kZXZpZXcnLCBjbUVkaXRvci5nZXRWYWx1ZSgpLCBjbUVkaXRvcik7XG4gICAgICAgIH0pOyAvLyBDb2RlTWlycm9yIGhhc24ndCBQYWRkaW5nLlxuXG4gICAgICAgIGNtRWRpdG9yLnNldFNpemUobnVsbCwgdGhpcy4kZWRpdGFibGUub3V0ZXJIZWlnaHQoKSk7XG4gICAgICAgIHRoaXMuJGNvZGFibGUuZGF0YSgnY21FZGl0b3InLCBjbUVkaXRvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiRjb2RhYmxlLm9uKCdibHVyJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdibHVyLmNvZGV2aWV3JywgX3RoaXMyLiRjb2RhYmxlLnZhbCgpLCBldmVudCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiRjb2RhYmxlLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2NoYW5nZS5jb2RldmlldycsIF90aGlzMi4kY29kYWJsZS52YWwoKSwgX3RoaXMyLiRjb2RhYmxlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGRlYWN0aXZhdGUgY29kZSB2aWV3XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJkZWFjdGl2YXRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7XG4gICAgICB2YXIgQ29kZU1pcnJvciA9IHRoaXMuQ29kZU1pcnJvckNvbnN0cnVjdG9yOyAvLyBkZWFjdGl2YXRlIENvZGVNaXJyb3IgYXMgY29kYWJsZVxuXG4gICAgICBpZiAoQ29kZU1pcnJvcikge1xuICAgICAgICB2YXIgY21FZGl0b3IgPSB0aGlzLiRjb2RhYmxlLmRhdGEoJ2NtRWRpdG9yJyk7XG4gICAgICAgIHRoaXMuJGNvZGFibGUudmFsKGNtRWRpdG9yLmdldFZhbHVlKCkpO1xuICAgICAgICBjbUVkaXRvci50b1RleHRBcmVhKCk7XG4gICAgICB9XG5cbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMucHVyaWZ5KGRvbS52YWx1ZSh0aGlzLiRjb2RhYmxlLCB0aGlzLm9wdGlvbnMucHJldHRpZnlIdG1sKSB8fCBkb20uZW1wdHlQYXJhKTtcbiAgICAgIHZhciBpc0NoYW5nZSA9IHRoaXMuJGVkaXRhYmxlLmh0bWwoKSAhPT0gdmFsdWU7XG4gICAgICB0aGlzLiRlZGl0YWJsZS5odG1sKHZhbHVlKTtcbiAgICAgIHRoaXMuJGVkaXRhYmxlLmhlaWdodCh0aGlzLm9wdGlvbnMuaGVpZ2h0ID8gdGhpcy4kY29kYWJsZS5oZWlnaHQoKSA6ICdhdXRvJyk7XG4gICAgICB0aGlzLiRlZGl0b3IucmVtb3ZlQ2xhc3MoJ2NvZGV2aWV3Jyk7XG5cbiAgICAgIGlmIChpc0NoYW5nZSkge1xuICAgICAgICB0aGlzLmNvbnRleHQudHJpZ2dlckV2ZW50KCdjaGFuZ2UnLCB0aGlzLiRlZGl0YWJsZS5odG1sKCksIHRoaXMuJGVkaXRhYmxlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy4kZWRpdGFibGUuZm9jdXMoKTtcbiAgICAgIHRoaXMuY29udGV4dC5pbnZva2UoJ3Rvb2xiYXIudXBkYXRlQ29kZXZpZXcnLCBmYWxzZSk7XG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdhaXJQb3BvdmVyLnVwZGF0ZUNvZGV2aWV3JywgZmFsc2UpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICBpZiAodGhpcy5pc0FjdGl2YXRlZCgpKSB7XG4gICAgICAgIHRoaXMuZGVhY3RpdmF0ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBDb2RlVmlldztcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9TdGF0dXNiYXIuanNcbmZ1bmN0aW9uIFN0YXR1c2Jhcl9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIFN0YXR1c2Jhcl9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gU3RhdHVzYmFyX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgU3RhdHVzYmFyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBTdGF0dXNiYXJfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG52YXIgRURJVEFCTEVfUEFERElORyA9IDI0O1xuXG52YXIgU3RhdHVzYmFyX1N0YXR1c2JhciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN0YXR1c2Jhcihjb250ZXh0KSB7XG4gICAgU3RhdHVzYmFyX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0YXR1c2Jhcik7XG5cbiAgICB0aGlzLiRkb2N1bWVudCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGRvY3VtZW50KTtcbiAgICB0aGlzLiRzdGF0dXNiYXIgPSBjb250ZXh0LmxheW91dEluZm8uc3RhdHVzYmFyO1xuICAgIHRoaXMuJGVkaXRhYmxlID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRhYmxlO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgfVxuXG4gIFN0YXR1c2Jhcl9jcmVhdGVDbGFzcyhTdGF0dXNiYXIsIFt7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWlyTW9kZSB8fCB0aGlzLm9wdGlvbnMuZGlzYWJsZVJlc2l6ZUVkaXRvcikge1xuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLiRzdGF0dXNiYXIub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICB2YXIgZWRpdGFibGVUb3AgPSBfdGhpcy4kZWRpdGFibGUub2Zmc2V0KCkudG9wIC0gX3RoaXMuJGRvY3VtZW50LnNjcm9sbFRvcCgpO1xuXG4gICAgICAgIHZhciBvbk1vdXNlTW92ZSA9IGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGV2ZW50KSB7XG4gICAgICAgICAgdmFyIGhlaWdodCA9IGV2ZW50LmNsaWVudFkgLSAoZWRpdGFibGVUb3AgKyBFRElUQUJMRV9QQURESU5HKTtcbiAgICAgICAgICBoZWlnaHQgPSBfdGhpcy5vcHRpb25zLm1pbmhlaWdodCA+IDAgPyBNYXRoLm1heChoZWlnaHQsIF90aGlzLm9wdGlvbnMubWluaGVpZ2h0KSA6IGhlaWdodDtcbiAgICAgICAgICBoZWlnaHQgPSBfdGhpcy5vcHRpb25zLm1heEhlaWdodCA+IDAgPyBNYXRoLm1pbihoZWlnaHQsIF90aGlzLm9wdGlvbnMubWF4SGVpZ2h0KSA6IGhlaWdodDtcblxuICAgICAgICAgIF90aGlzLiRlZGl0YWJsZS5oZWlnaHQoaGVpZ2h0KTtcbiAgICAgICAgfTtcblxuICAgICAgICBfdGhpcy4kZG9jdW1lbnQub24oJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKS5vbmUoJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMuJGRvY3VtZW50Lm9mZignbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLiRzdGF0dXNiYXIub2ZmKCk7XG4gICAgICB0aGlzLiRzdGF0dXNiYXIuYWRkQ2xhc3MoJ2xvY2tlZCcpO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBTdGF0dXNiYXI7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvRnVsbHNjcmVlbi5qc1xuZnVuY3Rpb24gRnVsbHNjcmVlbl9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEZ1bGxzY3JlZW5fZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIEZ1bGxzY3JlZW5fY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBGdWxsc2NyZWVuX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBGdWxsc2NyZWVuX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG52YXIgRnVsbHNjcmVlbl9GdWxsc2NyZWVuID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRnVsbHNjcmVlbihjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIEZ1bGxzY3JlZW5fY2xhc3NDYWxsQ2hlY2sodGhpcywgRnVsbHNjcmVlbik7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMuJGVkaXRvciA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0b3I7XG4gICAgdGhpcy4kdG9vbGJhciA9IGNvbnRleHQubGF5b3V0SW5mby50b29sYmFyO1xuICAgIHRoaXMuJGVkaXRhYmxlID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRhYmxlO1xuICAgIHRoaXMuJGNvZGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uY29kYWJsZTtcbiAgICB0aGlzLiR3aW5kb3cgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSh3aW5kb3cpO1xuICAgIHRoaXMuJHNjcm9sbGJhciA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCdodG1sLCBib2R5Jyk7XG5cbiAgICB0aGlzLm9uUmVzaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgX3RoaXMucmVzaXplVG8oe1xuICAgICAgICBoOiBfdGhpcy4kd2luZG93LmhlaWdodCgpIC0gX3RoaXMuJHRvb2xiYXIub3V0ZXJIZWlnaHQoKVxuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuXG4gIEZ1bGxzY3JlZW5fY3JlYXRlQ2xhc3MoRnVsbHNjcmVlbiwgW3tcbiAgICBrZXk6IFwicmVzaXplVG9cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplVG8oc2l6ZSkge1xuICAgICAgdGhpcy4kZWRpdGFibGUuY3NzKCdoZWlnaHQnLCBzaXplLmgpO1xuICAgICAgdGhpcy4kY29kYWJsZS5jc3MoJ2hlaWdodCcsIHNpemUuaCk7XG5cbiAgICAgIGlmICh0aGlzLiRjb2RhYmxlLmRhdGEoJ2NtZWRpdG9yJykpIHtcbiAgICAgICAgdGhpcy4kY29kYWJsZS5kYXRhKCdjbWVkaXRvcicpLnNldHNpemUobnVsbCwgc2l6ZS5oKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogdG9nZ2xlIGZ1bGxzY3JlZW5cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInRvZ2dsZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB0b2dnbGUoKSB7XG4gICAgICB0aGlzLiRlZGl0b3IudG9nZ2xlQ2xhc3MoJ2Z1bGxzY3JlZW4nKTtcblxuICAgICAgaWYgKHRoaXMuaXNGdWxsc2NyZWVuKCkpIHtcbiAgICAgICAgdGhpcy4kZWRpdGFibGUuZGF0YSgnb3JnSGVpZ2h0JywgdGhpcy4kZWRpdGFibGUuY3NzKCdoZWlnaHQnKSk7XG4gICAgICAgIHRoaXMuJGVkaXRhYmxlLmRhdGEoJ29yZ01heEhlaWdodCcsIHRoaXMuJGVkaXRhYmxlLmNzcygnbWF4SGVpZ2h0JykpO1xuICAgICAgICB0aGlzLiRlZGl0YWJsZS5jc3MoJ21heEhlaWdodCcsICcnKTtcbiAgICAgICAgdGhpcy4kd2luZG93Lm9uKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplKS50cmlnZ2VyKCdyZXNpemUnKTtcbiAgICAgICAgdGhpcy4kc2Nyb2xsYmFyLmNzcygnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiR3aW5kb3cub2ZmKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplKTtcbiAgICAgICAgdGhpcy5yZXNpemVUbyh7XG4gICAgICAgICAgaDogdGhpcy4kZWRpdGFibGUuZGF0YSgnb3JnSGVpZ2h0JylcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJGVkaXRhYmxlLmNzcygnbWF4SGVpZ2h0JywgdGhpcy4kZWRpdGFibGUuY3NzKCdvcmdNYXhIZWlnaHQnKSk7XG4gICAgICAgIHRoaXMuJHNjcm9sbGJhci5jc3MoJ292ZXJmbG93JywgJ3Zpc2libGUnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgndG9vbGJhci51cGRhdGVGdWxsc2NyZWVuJywgdGhpcy5pc0Z1bGxzY3JlZW4oKSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImlzRnVsbHNjcmVlblwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpc0Z1bGxzY3JlZW4oKSB7XG4gICAgICByZXR1cm4gdGhpcy4kZWRpdG9yLmhhc0NsYXNzKCdmdWxsc2NyZWVuJyk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEZ1bGxzY3JlZW47XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvSGFuZGxlLmpzXG5mdW5jdGlvbiBIYW5kbGVfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBIYW5kbGVfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIEhhbmRsZV9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIEhhbmRsZV9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgSGFuZGxlX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cbnZhciBIYW5kbGVfSGFuZGxlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSGFuZGxlKGNvbnRleHQpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgSGFuZGxlX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhhbmRsZSk7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMuJGRvY3VtZW50ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoZG9jdW1lbnQpO1xuICAgIHRoaXMuJGVkaXRpbmdBcmVhID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRpbmdBcmVhO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmxhbmcgPSB0aGlzLm9wdGlvbnMubGFuZ0luZm87XG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICAnc3VtbWVybm90ZS5tb3VzZWRvd24nOiBmdW5jdGlvbiBzdW1tZXJub3RlTW91c2Vkb3duKHdlLCBlKSB7XG4gICAgICAgIGlmIChfdGhpcy51cGRhdGUoZS50YXJnZXQsIGUpKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUua2V5dXAgc3VtbWVybm90ZS5zY3JvbGwgc3VtbWVybm90ZS5jaGFuZ2Ugc3VtbWVybm90ZS5kaWFsb2cuc2hvd24nOiBmdW5jdGlvbiBzdW1tZXJub3RlS2V5dXBTdW1tZXJub3RlU2Nyb2xsU3VtbWVybm90ZUNoYW5nZVN1bW1lcm5vdGVEaWFsb2dTaG93bigpIHtcbiAgICAgICAgX3RoaXMudXBkYXRlKCk7XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUuZGlzYWJsZSBzdW1tZXJub3RlLmJsdXInOiBmdW5jdGlvbiBzdW1tZXJub3RlRGlzYWJsZVN1bW1lcm5vdGVCbHVyKCkge1xuICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUuY29kZXZpZXcudG9nZ2xlZCc6IGZ1bmN0aW9uIHN1bW1lcm5vdGVDb2Rldmlld1RvZ2dsZWQoKSB7XG4gICAgICAgIF90aGlzLnVwZGF0ZSgpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBIYW5kbGVfY3JlYXRlQ2xhc3MoSGFuZGxlLCBbe1xuICAgIGtleTogXCJpbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgdGhpcy4kaGFuZGxlID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoWyc8ZGl2IGNsYXNzPVwibm90ZS1oYW5kbGVcIj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtY29udHJvbC1zZWxlY3Rpb25cIj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtY29udHJvbC1zZWxlY3Rpb24tYmdcIj48L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtY29udHJvbC1ob2xkZXIgbm90ZS1jb250cm9sLW53XCI+PC9kaXY+JywgJzxkaXYgY2xhc3M9XCJub3RlLWNvbnRyb2wtaG9sZGVyIG5vdGUtY29udHJvbC1uZVwiPjwvZGl2PicsICc8ZGl2IGNsYXNzPVwibm90ZS1jb250cm9sLWhvbGRlciBub3RlLWNvbnRyb2wtc3dcIj48L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIicsIHRoaXMub3B0aW9ucy5kaXNhYmxlUmVzaXplSW1hZ2UgPyAnbm90ZS1jb250cm9sLWhvbGRlcicgOiAnbm90ZS1jb250cm9sLXNpemluZycsICcgbm90ZS1jb250cm9sLXNlXCI+PC9kaXY+JywgdGhpcy5vcHRpb25zLmRpc2FibGVSZXNpemVJbWFnZSA/ICcnIDogJzxkaXYgY2xhc3M9XCJub3RlLWNvbnRyb2wtc2VsZWN0aW9uLWluZm9cIj48L2Rpdj4nLCAnPC9kaXY+JywgJzwvZGl2PiddLmpvaW4oJycpKS5wcmVwZW5kVG8odGhpcy4kZWRpdGluZ0FyZWEpO1xuICAgICAgdGhpcy4kaGFuZGxlLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGRvbS5pc0NvbnRyb2xTaXppbmcoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICB2YXIgJHRhcmdldCA9IF90aGlzMi4kaGFuZGxlLmZpbmQoJy5ub3RlLWNvbnRyb2wtc2VsZWN0aW9uJykuZGF0YSgndGFyZ2V0Jyk7XG5cbiAgICAgICAgICB2YXIgcG9zU3RhcnQgPSAkdGFyZ2V0Lm9mZnNldCgpO1xuXG4gICAgICAgICAgdmFyIHNjcm9sbFRvcCA9IF90aGlzMi4kZG9jdW1lbnQuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgICB2YXIgb25Nb3VzZU1vdmUgPSBmdW5jdGlvbiBvbk1vdXNlTW92ZShldmVudCkge1xuICAgICAgICAgICAgX3RoaXMyLmNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzaXplVG8nLCB7XG4gICAgICAgICAgICAgIHg6IGV2ZW50LmNsaWVudFggLSBwb3NTdGFydC5sZWZ0LFxuICAgICAgICAgICAgICB5OiBldmVudC5jbGllbnRZIC0gKHBvc1N0YXJ0LnRvcCAtIHNjcm9sbFRvcClcbiAgICAgICAgICAgIH0sICR0YXJnZXQsICFldmVudC5zaGlmdEtleSk7XG5cbiAgICAgICAgICAgIF90aGlzMi51cGRhdGUoJHRhcmdldFswXSwgZXZlbnQpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBfdGhpczIuJGRvY3VtZW50Lm9uKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkub25lKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgX3RoaXMyLiRkb2N1bWVudC5vZmYoJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTtcblxuICAgICAgICAgICAgX3RoaXMyLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuYWZ0ZXJDb21tYW5kJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoISR0YXJnZXQuZGF0YSgncmF0aW8nKSkge1xuICAgICAgICAgICAgLy8gb3JpZ2luYWwgcmF0aW8uXG4gICAgICAgICAgICAkdGFyZ2V0LmRhdGEoJ3JhdGlvJywgJHRhcmdldC5oZWlnaHQoKSAvICR0YXJnZXQud2lkdGgoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTsgLy8gTGlzdGVuIGZvciBzY3JvbGxpbmcgb24gdGhlIGhhbmRsZSBvdmVybGF5LlxuXG4gICAgICB0aGlzLiRoYW5kbGUub24oJ3doZWVsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIF90aGlzMi51cGRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLiRoYW5kbGUucmVtb3ZlKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInVwZGF0ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUodGFyZ2V0LCBldmVudCkge1xuICAgICAgaWYgKHRoaXMuY29udGV4dC5pc0Rpc2FibGVkKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB2YXIgaXNJbWFnZSA9IGRvbS5pc0ltZyh0YXJnZXQpO1xuICAgICAgdmFyICRzZWxlY3Rpb24gPSB0aGlzLiRoYW5kbGUuZmluZCgnLm5vdGUtY29udHJvbC1zZWxlY3Rpb24nKTtcbiAgICAgIHRoaXMuY29udGV4dC5pbnZva2UoJ2ltYWdlUG9wb3Zlci51cGRhdGUnLCB0YXJnZXQsIGV2ZW50KTtcblxuICAgICAgaWYgKGlzSW1hZ2UpIHtcbiAgICAgICAgdmFyICRpbWFnZSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHRhcmdldCk7XG4gICAgICAgIHZhciBwb3NpdGlvbiA9ICRpbWFnZS5wb3NpdGlvbigpO1xuICAgICAgICB2YXIgcG9zID0ge1xuICAgICAgICAgIGxlZnQ6IHBvc2l0aW9uLmxlZnQgKyBwYXJzZUludCgkaW1hZ2UuY3NzKCdtYXJnaW5MZWZ0JyksIDEwKSxcbiAgICAgICAgICB0b3A6IHBvc2l0aW9uLnRvcCArIHBhcnNlSW50KCRpbWFnZS5jc3MoJ21hcmdpblRvcCcpLCAxMClcbiAgICAgICAgfTsgLy8gZXhjbHVkZSBtYXJnaW5cblxuICAgICAgICB2YXIgaW1hZ2VTaXplID0ge1xuICAgICAgICAgIHc6ICRpbWFnZS5vdXRlcldpZHRoKGZhbHNlKSxcbiAgICAgICAgICBoOiAkaW1hZ2Uub3V0ZXJIZWlnaHQoZmFsc2UpXG4gICAgICAgIH07XG4gICAgICAgICRzZWxlY3Rpb24uY3NzKHtcbiAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICAgIHRvcDogcG9zLnRvcCxcbiAgICAgICAgICB3aWR0aDogaW1hZ2VTaXplLncsXG4gICAgICAgICAgaGVpZ2h0OiBpbWFnZVNpemUuaFxuICAgICAgICB9KS5kYXRhKCd0YXJnZXQnLCAkaW1hZ2UpOyAvLyBzYXZlIGN1cnJlbnQgaW1hZ2UgZWxlbWVudC5cblxuICAgICAgICB2YXIgb3JpZ0ltYWdlT2JqID0gbmV3IEltYWdlKCk7XG4gICAgICAgIG9yaWdJbWFnZU9iai5zcmMgPSAkaW1hZ2UuYXR0cignc3JjJyk7XG4gICAgICAgIHZhciBzaXppbmdUZXh0ID0gaW1hZ2VTaXplLncgKyAneCcgKyBpbWFnZVNpemUuaCArICcgKCcgKyB0aGlzLmxhbmcuaW1hZ2Uub3JpZ2luYWwgKyAnOiAnICsgb3JpZ0ltYWdlT2JqLndpZHRoICsgJ3gnICsgb3JpZ0ltYWdlT2JqLmhlaWdodCArICcpJztcbiAgICAgICAgJHNlbGVjdGlvbi5maW5kKCcubm90ZS1jb250cm9sLXNlbGVjdGlvbi1pbmZvJykudGV4dChzaXppbmdUZXh0KTtcbiAgICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLnNhdmVUYXJnZXQnLCB0YXJnZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpc0ltYWdlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBoaWRlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJGhhbmRsZVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiaGlkZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmNsZWFyVGFyZ2V0Jyk7XG4gICAgICB0aGlzLiRoYW5kbGUuY2hpbGRyZW4oKS5oaWRlKCk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEhhbmRsZTtcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9BdXRvTGluay5qc1xuZnVuY3Rpb24gQXV0b0xpbmtfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBBdXRvTGlua19kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gQXV0b0xpbmtfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBBdXRvTGlua19kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgQXV0b0xpbmtfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxudmFyIGRlZmF1bHRTY2hlbWUgPSAnaHR0cDovLyc7XG52YXIgbGlua1BhdHRlcm4gPSAvXihbQS1aYS16XVtBLVphLXowLTkrLS5dKlxcOltcXC9dezJ9fHRlbDp8bWFpbHRvOltBLVowLTkuXyUrLV0rQCk/KHd3d1xcLik/KC4rKSQvaTtcblxudmFyIEF1dG9MaW5rX0F1dG9MaW5rID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQXV0b0xpbmsoY29udGV4dCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBBdXRvTGlua19jbGFzc0NhbGxDaGVjayh0aGlzLCBBdXRvTGluayk7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLmtleXVwJzogZnVuY3Rpb24gc3VtbWVybm90ZUtleXVwKHdlLCBlKSB7XG4gICAgICAgIGlmICghZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgIF90aGlzLmhhbmRsZUtleXVwKGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUua2V5ZG93bic6IGZ1bmN0aW9uIHN1bW1lcm5vdGVLZXlkb3duKHdlLCBlKSB7XG4gICAgICAgIF90aGlzLmhhbmRsZUtleWRvd24oZSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIEF1dG9MaW5rX2NyZWF0ZUNsYXNzKEF1dG9MaW5rLCBbe1xuICAgIGtleTogXCJpbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJyZXBsYWNlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGxhY2UoKSB7XG4gICAgICBpZiAoIXRoaXMubGFzdFdvcmRSYW5nZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBrZXl3b3JkID0gdGhpcy5sYXN0V29yZFJhbmdlLnRvU3RyaW5nKCk7XG4gICAgICB2YXIgbWF0Y2ggPSBrZXl3b3JkLm1hdGNoKGxpbmtQYXR0ZXJuKTtcblxuICAgICAgaWYgKG1hdGNoICYmIChtYXRjaFsxXSB8fCBtYXRjaFsyXSkpIHtcbiAgICAgICAgdmFyIGxpbmsgPSBtYXRjaFsxXSA/IGtleXdvcmQgOiBkZWZhdWx0U2NoZW1lICsga2V5d29yZDtcbiAgICAgICAgdmFyIHVybFRleHQgPSB0aGlzLm9wdGlvbnMuc2hvd0RvbWFpbk9ubHlGb3JBdXRvbGluayA/IGtleXdvcmQucmVwbGFjZSgvXig/Omh0dHBzPzpcXC9cXC8pPyg/OnRlbD86Pyk/KD86bWFpbHRvPzo/KT8oPzp3d3dcXC4pPy9pLCAnJykuc3BsaXQoJy8nKVswXSA6IGtleXdvcmQ7XG4gICAgICAgIHZhciBub2RlID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzxhIC8+JykuaHRtbCh1cmxUZXh0KS5hdHRyKCdocmVmJywgbGluaylbMF07XG5cbiAgICAgICAgaWYgKHRoaXMuY29udGV4dC5vcHRpb25zLmxpbmtUYXJnZXRCbGFuaykge1xuICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKG5vZGUpLmF0dHIoJ3RhcmdldCcsICdfYmxhbmsnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubGFzdFdvcmRSYW5nZS5pbnNlcnROb2RlKG5vZGUpO1xuICAgICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuZm9jdXMnKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGFuZGxlS2V5ZG93blwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVLZXlkb3duKGUpIHtcbiAgICAgIGlmIChsaXN0cy5jb250YWlucyhbY29yZV9rZXkuY29kZS5FTlRFUiwgY29yZV9rZXkuY29kZS5TUEFDRV0sIGUua2V5Q29kZSkpIHtcbiAgICAgICAgdmFyIHdvcmRSYW5nZSA9IHRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5jcmVhdGVSYW5nZScpLmdldFdvcmRSYW5nZSgpO1xuICAgICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSB3b3JkUmFuZ2U7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImhhbmRsZUtleXVwXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUtleXVwKGUpIHtcbiAgICAgIGlmIChsaXN0cy5jb250YWlucyhbY29yZV9rZXkuY29kZS5FTlRFUiwgY29yZV9rZXkuY29kZS5TUEFDRV0sIGUua2V5Q29kZSkpIHtcbiAgICAgICAgdGhpcy5yZXBsYWNlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEF1dG9MaW5rO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvbW9kdWxlL0F1dG9TeW5jLmpzXG5mdW5jdGlvbiBBdXRvU3luY19jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEF1dG9TeW5jX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBBdXRvU3luY19jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIEF1dG9TeW5jX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBBdXRvU3luY19kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cbi8qKlxuICogdGV4dGFyZWEgYXV0byBzeW5jLlxuICovXG5cbnZhciBBdXRvU3luY19BdXRvU3luYyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dG9TeW5jKGNvbnRleHQpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgQXV0b1N5bmNfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXV0b1N5bmMpO1xuXG4gICAgdGhpcy4kbm90ZSA9IGNvbnRleHQubGF5b3V0SW5mby5ub3RlO1xuICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgJ3N1bW1lcm5vdGUuY2hhbmdlJzogZnVuY3Rpb24gc3VtbWVybm90ZUNoYW5nZSgpIHtcbiAgICAgICAgX3RoaXMuJG5vdGUudmFsKGNvbnRleHQuaW52b2tlKCdjb2RlJykpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBBdXRvU3luY19jcmVhdGVDbGFzcyhBdXRvU3luYywgW3tcbiAgICBrZXk6IFwic2hvdWxkSW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRJbml0aWFsaXplKCkge1xuICAgICAgcmV0dXJuIGRvbS5pc1RleHRhcmVhKHRoaXMuJG5vdGVbMF0pO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBBdXRvU3luYztcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9BdXRvUmVwbGFjZS5qc1xuZnVuY3Rpb24gQXV0b1JlcGxhY2VfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBBdXRvUmVwbGFjZV9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gQXV0b1JlcGxhY2VfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBBdXRvUmVwbGFjZV9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgQXV0b1JlcGxhY2VfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxuXG52YXIgQXV0b1JlcGxhY2VfQXV0b1JlcGxhY2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBdXRvUmVwbGFjZShjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIEF1dG9SZXBsYWNlX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEF1dG9SZXBsYWNlKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5vcHRpb25zID0gY29udGV4dC5vcHRpb25zLnJlcGxhY2UgfHwge307XG4gICAgdGhpcy5rZXlzID0gW2NvcmVfa2V5LmNvZGUuRU5URVIsIGNvcmVfa2V5LmNvZGUuU1BBQ0UsIGNvcmVfa2V5LmNvZGUuUEVSSU9ELCBjb3JlX2tleS5jb2RlLkNPTU1BLCBjb3JlX2tleS5jb2RlLlNFTUlDT0xPTiwgY29yZV9rZXkuY29kZS5TTEFTSF07XG4gICAgdGhpcy5wcmV2aW91c0tleWRvd25Db2RlID0gbnVsbDtcbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLmtleXVwJzogZnVuY3Rpb24gc3VtbWVybm90ZUtleXVwKHdlLCBlKSB7XG4gICAgICAgIGlmICghZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgIF90aGlzLmhhbmRsZUtleXVwKGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUua2V5ZG93bic6IGZ1bmN0aW9uIHN1bW1lcm5vdGVLZXlkb3duKHdlLCBlKSB7XG4gICAgICAgIF90aGlzLmhhbmRsZUtleWRvd24oZSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIEF1dG9SZXBsYWNlX2NyZWF0ZUNsYXNzKEF1dG9SZXBsYWNlLCBbe1xuICAgIGtleTogXCJzaG91bGRJbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZEluaXRpYWxpemUoKSB7XG4gICAgICByZXR1cm4gISF0aGlzLm9wdGlvbnMubWF0Y2g7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHRoaXMubGFzdFdvcmQgPSBudWxsO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLmxhc3RXb3JkID0gbnVsbDtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwicmVwbGFjZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZXBsYWNlKCkge1xuICAgICAgaWYgKCF0aGlzLmxhc3RXb3JkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIGtleXdvcmQgPSB0aGlzLmxhc3RXb3JkLnRvU3RyaW5nKCk7XG4gICAgICB0aGlzLm9wdGlvbnMubWF0Y2goa2V5d29yZCwgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgIHZhciBub2RlID0gJyc7XG5cbiAgICAgICAgICBpZiAodHlwZW9mIG1hdGNoID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbm9kZSA9IGRvbS5jcmVhdGVUZXh0KG1hdGNoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoIGluc3RhbmNlb2YgalF1ZXJ5KSB7XG4gICAgICAgICAgICBub2RlID0gbWF0Y2hbMF07XG4gICAgICAgICAgfSBlbHNlIGlmIChtYXRjaCBpbnN0YW5jZW9mIE5vZGUpIHtcbiAgICAgICAgICAgIG5vZGUgPSBtYXRjaDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIW5vZGUpIHJldHVybjtcbiAgICAgICAgICBzZWxmLmxhc3RXb3JkLmluc2VydE5vZGUobm9kZSk7XG4gICAgICAgICAgc2VsZi5sYXN0V29yZCA9IG51bGw7XG4gICAgICAgICAgc2VsZi5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmZvY3VzJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJoYW5kbGVLZXlkb3duXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUtleWRvd24oZSkge1xuICAgICAgLy8gdGhpcyBmb3JjZXMgaXQgdG8gcmVtZW1iZXIgdGhlIGxhc3Qgd2hvbGUgd29yZCwgZXZlbiBpZiBtdWx0aXBsZSB0ZXJtaW5hdGlvbiBrZXlzIGFyZSBwcmVzc2VkXG4gICAgICAvLyBiZWZvcmUgdGhlIHByZXZpb3VzIGtleSBpcyBsZXQgZ28uXG4gICAgICBpZiAodGhpcy5wcmV2aW91c0tleWRvd25Db2RlICYmIGxpc3RzLmNvbnRhaW5zKHRoaXMua2V5cywgdGhpcy5wcmV2aW91c0tleWRvd25Db2RlKSkge1xuICAgICAgICB0aGlzLnByZXZpb3VzS2V5ZG93bkNvZGUgPSBlLmtleUNvZGU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGxpc3RzLmNvbnRhaW5zKHRoaXMua2V5cywgZS5rZXlDb2RlKSkge1xuICAgICAgICB2YXIgd29yZFJhbmdlID0gdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmNyZWF0ZVJhbmdlJykuZ2V0V29yZFJhbmdlKCk7XG4gICAgICAgIHRoaXMubGFzdFdvcmQgPSB3b3JkUmFuZ2U7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucHJldmlvdXNLZXlkb3duQ29kZSA9IGUua2V5Q29kZTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGFuZGxlS2V5dXBcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlS2V5dXAoZSkge1xuICAgICAgaWYgKGxpc3RzLmNvbnRhaW5zKHRoaXMua2V5cywgZS5rZXlDb2RlKSkge1xuICAgICAgICB0aGlzLnJlcGxhY2UoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQXV0b1JlcGxhY2U7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvUGxhY2Vob2xkZXIuanNcbmZ1bmN0aW9uIFBsYWNlaG9sZGVyX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gUGxhY2Vob2xkZXJfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIFBsYWNlaG9sZGVyX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgUGxhY2Vob2xkZXJfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIFBsYWNlaG9sZGVyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG52YXIgUGxhY2Vob2xkZXJfUGxhY2Vob2xkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQbGFjZWhvbGRlcihjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIFBsYWNlaG9sZGVyX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBsYWNlaG9sZGVyKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy4kZWRpdGluZ0FyZWEgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGluZ0FyZWE7XG4gICAgdGhpcy5vcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5pbmhlcml0UGxhY2Vob2xkZXIgPT09IHRydWUpIHtcbiAgICAgIC8vIGdldCBwbGFjZWhvbGRlciB2YWx1ZSBmcm9tIHRoZSBvcmlnaW5hbCBlbGVtZW50XG4gICAgICB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIgPSB0aGlzLmNvbnRleHQuJG5vdGUuYXR0cigncGxhY2Vob2xkZXInKSB8fCB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXI7XG4gICAgfVxuXG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICAnc3VtbWVybm90ZS5pbml0IHN1bW1lcm5vdGUuY2hhbmdlJzogZnVuY3Rpb24gc3VtbWVybm90ZUluaXRTdW1tZXJub3RlQ2hhbmdlKCkge1xuICAgICAgICBfdGhpcy51cGRhdGUoKTtcbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5jb2Rldmlldy50b2dnbGVkJzogZnVuY3Rpb24gc3VtbWVybm90ZUNvZGV2aWV3VG9nZ2xlZCgpIHtcbiAgICAgICAgX3RoaXMudXBkYXRlKCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIFBsYWNlaG9sZGVyX2NyZWF0ZUNsYXNzKFBsYWNlaG9sZGVyLCBbe1xuICAgIGtleTogXCJzaG91bGRJbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZEluaXRpYWxpemUoKSB7XG4gICAgICByZXR1cm4gISF0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXI7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB0aGlzLiRwbGFjZWhvbGRlciA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8ZGl2IGNsYXNzPVwibm90ZS1wbGFjZWhvbGRlclwiPicpO1xuICAgICAgdGhpcy4kcGxhY2Vob2xkZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpczIuY29udGV4dC5pbnZva2UoJ2ZvY3VzJyk7XG4gICAgICB9KS5odG1sKHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlcikucHJlcGVuZFRvKHRoaXMuJGVkaXRpbmdBcmVhKTtcbiAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImRlc3Ryb3lcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHRoaXMuJHBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJ1cGRhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgdmFyIGlzU2hvdyA9ICF0aGlzLmNvbnRleHQuaW52b2tlKCdjb2Rldmlldy5pc0FjdGl2YXRlZCcpICYmIHRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5pc0VtcHR5Jyk7XG4gICAgICB0aGlzLiRwbGFjZWhvbGRlci50b2dnbGUoaXNTaG93KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gUGxhY2Vob2xkZXI7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvQnV0dG9ucy5qc1xuZnVuY3Rpb24gQnV0dG9uc19jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEJ1dHRvbnNfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIEJ1dHRvbnNfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBCdXR0b25zX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBCdXR0b25zX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cblxuXG52YXIgQnV0dG9uc19CdXR0b25zID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQnV0dG9ucyhjb250ZXh0KSB7XG4gICAgQnV0dG9uc19jbGFzc0NhbGxDaGVjayh0aGlzLCBCdXR0b25zKTtcblxuICAgIHRoaXMudWkgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLnVpO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy4kdG9vbGJhciA9IGNvbnRleHQubGF5b3V0SW5mby50b29sYmFyO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmxhbmcgPSB0aGlzLm9wdGlvbnMubGFuZ0luZm87XG4gICAgdGhpcy5pbnZlcnRlZEtleU1hcCA9IGZ1bmMuaW52ZXJ0T2JqZWN0KHRoaXMub3B0aW9ucy5rZXlNYXBbZW52LmlzTWFjID8gJ21hYycgOiAncGMnXSk7XG4gIH1cblxuICBCdXR0b25zX2NyZWF0ZUNsYXNzKEJ1dHRvbnMsIFt7XG4gICAga2V5OiBcInJlcHJlc2VudFNob3J0Y3V0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlcHJlc2VudFNob3J0Y3V0KGVkaXRvck1ldGhvZCkge1xuICAgICAgdmFyIHNob3J0Y3V0ID0gdGhpcy5pbnZlcnRlZEtleU1hcFtlZGl0b3JNZXRob2RdO1xuXG4gICAgICBpZiAoIXRoaXMub3B0aW9ucy5zaG9ydGN1dHMgfHwgIXNob3J0Y3V0KSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGVudi5pc01hYykge1xuICAgICAgICBzaG9ydGN1dCA9IHNob3J0Y3V0LnJlcGxhY2UoJ0NNRCcsICfijJgnKS5yZXBsYWNlKCdTSElGVCcsICfih6cnKTtcbiAgICAgIH1cblxuICAgICAgc2hvcnRjdXQgPSBzaG9ydGN1dC5yZXBsYWNlKCdCQUNLU0xBU0gnLCAnXFxcXCcpLnJlcGxhY2UoJ1NMQVNIJywgJy8nKS5yZXBsYWNlKCdMRUZUQlJBQ0tFVCcsICdbJykucmVwbGFjZSgnUklHSFRCUkFDS0VUJywgJ10nKTtcbiAgICAgIHJldHVybiAnICgnICsgc2hvcnRjdXQgKyAnKSc7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImJ1dHRvblwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBidXR0b24obykge1xuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudG9vbHRpcCAmJiBvLnRvb2x0aXApIHtcbiAgICAgICAgZGVsZXRlIG8udG9vbHRpcDtcbiAgICAgIH1cblxuICAgICAgby5jb250YWluZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyO1xuICAgICAgcmV0dXJuIHRoaXMudWkuYnV0dG9uKG8pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLmFkZFRvb2xiYXJCdXR0b25zKCk7XG4gICAgICB0aGlzLmFkZEltYWdlUG9wb3ZlckJ1dHRvbnMoKTtcbiAgICAgIHRoaXMuYWRkTGlua1BvcG92ZXJCdXR0b25zKCk7XG4gICAgICB0aGlzLmFkZFRhYmxlUG9wb3ZlckJ1dHRvbnMoKTtcbiAgICAgIHRoaXMuZm9udEluc3RhbGxlZE1hcCA9IHt9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICBkZWxldGUgdGhpcy5mb250SW5zdGFsbGVkTWFwO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpc0ZvbnRJbnN0YWxsZWRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNGb250SW5zdGFsbGVkKG5hbWUpIHtcbiAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuZm9udEluc3RhbGxlZE1hcCwgbmFtZSkpIHtcbiAgICAgICAgdGhpcy5mb250SW5zdGFsbGVkTWFwW25hbWVdID0gZW52LmlzRm9udEluc3RhbGxlZChuYW1lKSB8fCBsaXN0cy5jb250YWlucyh0aGlzLm9wdGlvbnMuZm9udE5hbWVzSWdub3JlQ2hlY2ssIG5hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5mb250SW5zdGFsbGVkTWFwW25hbWVdO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpc0ZvbnREZXNlcnZlZFRvQWRkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGlzRm9udERlc2VydmVkVG9BZGQobmFtZSkge1xuICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiBuYW1lICE9PSAnJyAmJiB0aGlzLmlzRm9udEluc3RhbGxlZChuYW1lKSAmJiBlbnYuZ2VuZXJpY0ZvbnRGYW1pbGllcy5pbmRleE9mKG5hbWUpID09PSAtMTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiY29sb3JQYWxldHRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNvbG9yUGFsZXR0ZShjbGFzc05hbWUsIHRvb2x0aXAsIGJhY2tDb2xvciwgZm9yZUNvbG9yKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICByZXR1cm4gdGhpcy51aS5idXR0b25Hcm91cCh7XG4gICAgICAgIGNsYXNzTmFtZTogJ25vdGUtY29sb3IgJyArIGNsYXNzTmFtZSxcbiAgICAgICAgY2hpbGRyZW46IFt0aGlzLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1jdXJyZW50LWNvbG9yLWJ1dHRvbicsXG4gICAgICAgICAgY29udGVudHM6IHRoaXMudWkuaWNvbih0aGlzLm9wdGlvbnMuaWNvbnMuZm9udCArICcgbm90ZS1yZWNlbnQtY29sb3InKSxcbiAgICAgICAgICB0b29sdGlwOiB0b29sdGlwLFxuICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljayhlKSB7XG4gICAgICAgICAgICB2YXIgJGJ1dHRvbiA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGUuY3VycmVudFRhcmdldCk7XG5cbiAgICAgICAgICAgIGlmIChiYWNrQ29sb3IgJiYgZm9yZUNvbG9yKSB7XG4gICAgICAgICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuY29sb3InLCB7XG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAkYnV0dG9uLmF0dHIoJ2RhdGEtYmFja0NvbG9yJyksXG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAkYnV0dG9uLmF0dHIoJ2RhdGEtZm9yZUNvbG9yJylcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGJhY2tDb2xvcikge1xuICAgICAgICAgICAgICBfdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmNvbG9yJywge1xuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJGJ1dHRvbi5hdHRyKCdkYXRhLWJhY2tDb2xvcicpXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JlQ29sb3IpIHtcbiAgICAgICAgICAgICAgX3RoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5jb2xvcicsIHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICRidXR0b24uYXR0cignZGF0YS1mb3JlQ29sb3InKVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiBjYWxsYmFjaygkYnV0dG9uKSB7XG4gICAgICAgICAgICB2YXIgJHJlY2VudENvbG9yID0gJGJ1dHRvbi5maW5kKCcubm90ZS1yZWNlbnQtY29sb3InKTtcblxuICAgICAgICAgICAgaWYgKGJhY2tDb2xvcikge1xuICAgICAgICAgICAgICAkcmVjZW50Q29sb3IuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgX3RoaXMub3B0aW9ucy5jb2xvckJ1dHRvbi5iYWNrQ29sb3IpO1xuICAgICAgICAgICAgICAkYnV0dG9uLmF0dHIoJ2RhdGEtYmFja0NvbG9yJywgX3RoaXMub3B0aW9ucy5jb2xvckJ1dHRvbi5iYWNrQ29sb3IpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZm9yZUNvbG9yKSB7XG4gICAgICAgICAgICAgICRyZWNlbnRDb2xvci5jc3MoJ2NvbG9yJywgX3RoaXMub3B0aW9ucy5jb2xvckJ1dHRvbi5mb3JlQ29sb3IpO1xuICAgICAgICAgICAgICAkYnV0dG9uLmF0dHIoJ2RhdGEtZm9yZUNvbG9yJywgX3RoaXMub3B0aW9ucy5jb2xvckJ1dHRvbi5mb3JlQ29sb3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJHJlY2VudENvbG9yLmNzcygnY29sb3InLCAndHJhbnNwYXJlbnQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pLCB0aGlzLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tdG9nZ2xlJyxcbiAgICAgICAgICBjb250ZW50czogdGhpcy51aS5kcm9wZG93bkJ1dHRvbkNvbnRlbnRzKCcnLCB0aGlzLm9wdGlvbnMpLFxuICAgICAgICAgIHRvb2x0aXA6IHRoaXMubGFuZy5jb2xvci5tb3JlLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSksIHRoaXMudWkuZHJvcGRvd24oe1xuICAgICAgICAgIGl0ZW1zOiAoYmFja0NvbG9yID8gWyc8ZGl2IGNsYXNzPVwibm90ZS1wYWxldHRlXCI+JywgJzxkaXYgY2xhc3M9XCJub3RlLXBhbGV0dGUtdGl0bGVcIj4nICsgdGhpcy5sYW5nLmNvbG9yLmJhY2tncm91bmQgKyAnPC9kaXY+JywgJzxkaXY+JywgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwibm90ZS1jb2xvci1yZXNldCBidG4gYnRuLWxpZ2h0IGJ0bi1kZWZhdWx0XCIgZGF0YS1ldmVudD1cImJhY2tDb2xvclwiIGRhdGEtdmFsdWU9XCJ0cmFuc3BhcmVudFwiPicsIHRoaXMubGFuZy5jb2xvci50cmFuc3BhcmVudCwgJzwvYnV0dG9uPicsICc8L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtaG9sZGVyXCIgZGF0YS1ldmVudD1cImJhY2tDb2xvclwiPjwhLS0gYmFjayBjb2xvcnMgLS0+PC9kaXY+JywgJzxkaXY+JywgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwibm90ZS1jb2xvci1zZWxlY3QgYnRuIGJ0bi1saWdodCBidG4tZGVmYXVsdFwiIGRhdGEtZXZlbnQ9XCJvcGVuUGFsZXR0ZVwiIGRhdGEtdmFsdWU9XCJiYWNrQ29sb3JQaWNrZXJcIj4nLCB0aGlzLmxhbmcuY29sb3IuY3BTZWxlY3QsICc8L2J1dHRvbj4nLCAnPGlucHV0IHR5cGU9XCJjb2xvclwiIGlkPVwiYmFja0NvbG9yUGlja2VyXCIgY2xhc3M9XCJub3RlLWJ0biBub3RlLWNvbG9yLXNlbGVjdC1idG5cIiB2YWx1ZT1cIicgKyB0aGlzLm9wdGlvbnMuY29sb3JCdXR0b24uYmFja0NvbG9yICsgJ1wiIGRhdGEtZXZlbnQ9XCJiYWNrQ29sb3JQYWxldHRlXCI+JywgJzwvZGl2PicsICc8ZGl2IGNsYXNzPVwibm90ZS1ob2xkZXItY3VzdG9tXCIgaWQ9XCJiYWNrQ29sb3JQYWxldHRlXCIgZGF0YS1ldmVudD1cImJhY2tDb2xvclwiPjwvZGl2PicsICc8L2Rpdj4nXS5qb2luKCcnKSA6ICcnKSArIChmb3JlQ29sb3IgPyBbJzxkaXYgY2xhc3M9XCJub3RlLXBhbGV0dGVcIj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtcGFsZXR0ZS10aXRsZVwiPicgKyB0aGlzLmxhbmcuY29sb3IuZm9yZWdyb3VuZCArICc8L2Rpdj4nLCAnPGRpdj4nLCAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJub3RlLWNvbG9yLXJlc2V0IGJ0biBidG4tbGlnaHQgYnRuLWRlZmF1bHRcIiBkYXRhLWV2ZW50PVwicmVtb3ZlRm9ybWF0XCIgZGF0YS12YWx1ZT1cImZvcmVDb2xvclwiPicsIHRoaXMubGFuZy5jb2xvci5yZXNldFRvRGVmYXVsdCwgJzwvYnV0dG9uPicsICc8L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtaG9sZGVyXCIgZGF0YS1ldmVudD1cImZvcmVDb2xvclwiPjwhLS0gZm9yZSBjb2xvcnMgLS0+PC9kaXY+JywgJzxkaXY+JywgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwibm90ZS1jb2xvci1zZWxlY3QgYnRuIGJ0bi1saWdodCBidG4tZGVmYXVsdFwiIGRhdGEtZXZlbnQ9XCJvcGVuUGFsZXR0ZVwiIGRhdGEtdmFsdWU9XCJmb3JlQ29sb3JQaWNrZXJcIj4nLCB0aGlzLmxhbmcuY29sb3IuY3BTZWxlY3QsICc8L2J1dHRvbj4nLCAnPGlucHV0IHR5cGU9XCJjb2xvclwiIGlkPVwiZm9yZUNvbG9yUGlja2VyXCIgY2xhc3M9XCJub3RlLWJ0biBub3RlLWNvbG9yLXNlbGVjdC1idG5cIiB2YWx1ZT1cIicgKyB0aGlzLm9wdGlvbnMuY29sb3JCdXR0b24uZm9yZUNvbG9yICsgJ1wiIGRhdGEtZXZlbnQ9XCJmb3JlQ29sb3JQYWxldHRlXCI+JywgJzwvZGl2PicsIC8vIEZpeCBtaXNzaW5nIERpdiwgQ29tbWVudGVkIHRvIGZpbmQgZWFzaWx5IGlmIGl0J3Mgd3JvbmdcbiAgICAgICAgICAnPGRpdiBjbGFzcz1cIm5vdGUtaG9sZGVyLWN1c3RvbVwiIGlkPVwiZm9yZUNvbG9yUGFsZXR0ZVwiIGRhdGEtZXZlbnQ9XCJmb3JlQ29sb3JcIj48L2Rpdj4nLCAnPC9kaXY+J10uam9pbignJykgOiAnJyksXG4gICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIGNhbGxiYWNrKCRkcm9wZG93bikge1xuICAgICAgICAgICAgJGRyb3Bkb3duLmZpbmQoJy5ub3RlLWhvbGRlcicpLmVhY2goZnVuY3Rpb24gKGlkeCwgaXRlbSkge1xuICAgICAgICAgICAgICB2YXIgJGhvbGRlciA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGl0ZW0pO1xuICAgICAgICAgICAgICAkaG9sZGVyLmFwcGVuZChfdGhpcy51aS5wYWxldHRlKHtcbiAgICAgICAgICAgICAgICBjb2xvcnM6IF90aGlzLm9wdGlvbnMuY29sb3JzLFxuICAgICAgICAgICAgICAgIGNvbG9yc05hbWU6IF90aGlzLm9wdGlvbnMuY29sb3JzTmFtZSxcbiAgICAgICAgICAgICAgICBldmVudE5hbWU6ICRob2xkZXIuZGF0YSgnZXZlbnQnKSxcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IF90aGlzLm9wdGlvbnMuY29udGFpbmVyLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6IF90aGlzLm9wdGlvbnMudG9vbHRpcFxuICAgICAgICAgICAgICB9KS5yZW5kZXIoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8qIFRPRE86IGRvIHdlIGhhdmUgdG8gcmVjb3JkIHJlY2VudCBjdXN0b20gY29sb3JzIHdpdGhpbiBjb29raWVzPyAqL1xuXG4gICAgICAgICAgICB2YXIgY3VzdG9tQ29sb3JzID0gW1snI0ZGRkZGRicsICcjRkZGRkZGJywgJyNGRkZGRkYnLCAnI0ZGRkZGRicsICcjRkZGRkZGJywgJyNGRkZGRkYnLCAnI0ZGRkZGRicsICcjRkZGRkZGJ11dO1xuICAgICAgICAgICAgJGRyb3Bkb3duLmZpbmQoJy5ub3RlLWhvbGRlci1jdXN0b20nKS5lYWNoKGZ1bmN0aW9uIChpZHgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgdmFyICRob2xkZXIgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShpdGVtKTtcbiAgICAgICAgICAgICAgJGhvbGRlci5hcHBlbmQoX3RoaXMudWkucGFsZXR0ZSh7XG4gICAgICAgICAgICAgICAgY29sb3JzOiBjdXN0b21Db2xvcnMsXG4gICAgICAgICAgICAgICAgY29sb3JzTmFtZTogY3VzdG9tQ29sb3JzLFxuICAgICAgICAgICAgICAgIGV2ZW50TmFtZTogJGhvbGRlci5kYXRhKCdldmVudCcpLFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogX3RoaXMub3B0aW9ucy5jb250YWluZXIsXG4gICAgICAgICAgICAgICAgdG9vbHRpcDogX3RoaXMub3B0aW9ucy50b29sdGlwXG4gICAgICAgICAgICAgIH0pLnJlbmRlcigpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGRyb3Bkb3duLmZpbmQoJ2lucHV0W3R5cGU9Y29sb3JdJykuZWFjaChmdW5jdGlvbiAoaWR4LCBpdGVtKSB7XG4gICAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGl0ZW0pLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyICRjaGlwID0gJGRyb3Bkb3duLmZpbmQoJyMnICsgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkodGhpcykuZGF0YSgnZXZlbnQnKSkuZmluZCgnLm5vdGUtY29sb3ItYnRuJykuZmlyc3QoKTtcbiAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSB0aGlzLnZhbHVlLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgJGNoaXAuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgY29sb3IpLmF0dHIoJ2FyaWEtbGFiZWwnLCBjb2xvcikuYXR0cignZGF0YS12YWx1ZScsIGNvbG9yKS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJywgY29sb3IpO1xuICAgICAgICAgICAgICAgICRjaGlwLmNsaWNrKCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbGljazogZnVuY3Rpb24gY2xpY2soZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdmFyICRwYXJlbnQgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnLicgKyBjbGFzc05hbWUpLmZpbmQoJy5ub3RlLWRyb3Bkb3duLW1lbnUnKTtcbiAgICAgICAgICAgIHZhciAkYnV0dG9uID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgICAgIHZhciBldmVudE5hbWUgPSAkYnV0dG9uLmRhdGEoJ2V2ZW50Jyk7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAkYnV0dG9uLmF0dHIoJ2RhdGEtdmFsdWUnKTtcblxuICAgICAgICAgICAgaWYgKGV2ZW50TmFtZSA9PT0gJ29wZW5QYWxldHRlJykge1xuICAgICAgICAgICAgICB2YXIgJHBpY2tlciA9ICRwYXJlbnQuZmluZCgnIycgKyB2YWx1ZSk7XG4gICAgICAgICAgICAgIHZhciAkcGFsZXR0ZSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCRwYXJlbnQuZmluZCgnIycgKyAkcGlja2VyLmRhdGEoJ2V2ZW50JykpLmZpbmQoJy5ub3RlLWNvbG9yLXJvdycpWzBdKTsgLy8gU2hpZnQgcGFsZXR0ZSBjaGlwc1xuXG4gICAgICAgICAgICAgIHZhciAkY2hpcCA9ICRwYWxldHRlLmZpbmQoJy5ub3RlLWNvbG9yLWJ0bicpLmxhc3QoKS5kZXRhY2goKTsgLy8gU2V0IGNoaXAgYXR0cmlidXRlc1xuXG4gICAgICAgICAgICAgIHZhciBjb2xvciA9ICRwaWNrZXIudmFsKCk7XG4gICAgICAgICAgICAgICRjaGlwLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIGNvbG9yKS5hdHRyKCdhcmlhLWxhYmVsJywgY29sb3IpLmF0dHIoJ2RhdGEtdmFsdWUnLCBjb2xvcikuYXR0cignZGF0YS1vcmlnaW5hbC10aXRsZScsIGNvbG9yKTtcbiAgICAgICAgICAgICAgJHBhbGV0dGUucHJlcGVuZCgkY2hpcCk7XG4gICAgICAgICAgICAgICRwaWNrZXIuY2xpY2soKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmIChsaXN0cy5jb250YWlucyhbJ2JhY2tDb2xvcicsICdmb3JlQ29sb3InXSwgZXZlbnROYW1lKSkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldmVudE5hbWUgPT09ICdiYWNrQ29sb3InID8gJ2JhY2tncm91bmQtY29sb3InIDogJ2NvbG9yJztcbiAgICAgICAgICAgICAgICB2YXIgJGNvbG9yID0gJGJ1dHRvbi5jbG9zZXN0KCcubm90ZS1jb2xvcicpLmZpbmQoJy5ub3RlLXJlY2VudC1jb2xvcicpO1xuICAgICAgICAgICAgICAgIHZhciAkY3VycmVudEJ1dHRvbiA9ICRidXR0b24uY2xvc2VzdCgnLm5vdGUtY29sb3InKS5maW5kKCcubm90ZS1jdXJyZW50LWNvbG9yLWJ1dHRvbicpO1xuICAgICAgICAgICAgICAgICRjb2xvci5jc3Moa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnRCdXR0b24uYXR0cignZGF0YS0nICsgZXZlbnROYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBfdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLicgKyBldmVudE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pXVxuICAgICAgfSkucmVuZGVyKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImFkZFRvb2xiYXJCdXR0b25zXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFRvb2xiYXJCdXR0b25zKCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uc3R5bGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIudWkuYnV0dG9uR3JvdXAoW190aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5kcm9wZG93bkJ1dHRvbkNvbnRlbnRzKF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLm1hZ2ljKSwgX3RoaXMyLm9wdGlvbnMpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLnN0eWxlLnN0eWxlLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSksIF90aGlzMi51aS5kcm9wZG93bih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tc3R5bGUnLFxuICAgICAgICAgIGl0ZW1zOiBfdGhpczIub3B0aW9ucy5zdHlsZVRhZ3MsXG4gICAgICAgICAgdGl0bGU6IF90aGlzMi5sYW5nLnN0eWxlLnN0eWxlLFxuICAgICAgICAgIHRlbXBsYXRlOiBmdW5jdGlvbiB0ZW1wbGF0ZShpdGVtKSB7XG4gICAgICAgICAgICAvLyBUQkQ6IG5lZWQgdG8gYmUgc2ltcGxpZmllZFxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBpdGVtID0ge1xuICAgICAgICAgICAgICAgIHRhZzogaXRlbSxcbiAgICAgICAgICAgICAgICB0aXRsZTogT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKF90aGlzMi5sYW5nLnN0eWxlLCBpdGVtKSA/IF90aGlzMi5sYW5nLnN0eWxlW2l0ZW1dIDogaXRlbVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGFnID0gaXRlbS50YWc7XG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBpdGVtLnRpdGxlO1xuICAgICAgICAgICAgdmFyIHN0eWxlID0gaXRlbS5zdHlsZSA/ICcgc3R5bGU9XCInICsgaXRlbS5zdHlsZSArICdcIiAnIDogJyc7XG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gaXRlbS5jbGFzc05hbWUgPyAnIGNsYXNzPVwiJyArIGl0ZW0uY2xhc3NOYW1lICsgJ1wiJyA6ICcnO1xuICAgICAgICAgICAgcmV0dXJuICc8JyArIHRhZyArIHN0eWxlICsgY2xhc3NOYW1lICsgJz4nICsgdGl0bGUgKyAnPC8nICsgdGFnICsgJz4nO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xpY2s6IF90aGlzMi5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5mb3JtYXRCbG9jaycpXG4gICAgICAgIH0pXSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3Aoc3R5bGVJZHgsIHN0eWxlTGVuKSB7XG4gICAgICAgIHZhciBpdGVtID0gX3RoaXMyLm9wdGlvbnMuc3R5bGVUYWdzW3N0eWxlSWR4XTtcblxuICAgICAgICBfdGhpczIuY29udGV4dC5tZW1vKCdidXR0b24uc3R5bGUuJyArIGl0ZW0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWJ0bi1zdHlsZS0nICsgaXRlbSxcbiAgICAgICAgICAgIGNvbnRlbnRzOiAnPGRpdiBkYXRhLXZhbHVlPVwiJyArIGl0ZW0gKyAnXCI+JyArIGl0ZW0udG9VcHBlckNhc2UoKSArICc8L2Rpdj4nLFxuICAgICAgICAgICAgdG9vbHRpcDogX3RoaXMyLmxhbmcuc3R5bGVbaXRlbV0sXG4gICAgICAgICAgICBjbGljazogX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmZvcm1hdEJsb2NrJylcbiAgICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBmb3IgKHZhciBzdHlsZUlkeCA9IDAsIHN0eWxlTGVuID0gdGhpcy5vcHRpb25zLnN0eWxlVGFncy5sZW5ndGg7IHN0eWxlSWR4IDwgc3R5bGVMZW47IHN0eWxlSWR4KyspIHtcbiAgICAgICAgX2xvb3Aoc3R5bGVJZHgsIHN0eWxlTGVuKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5ib2xkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1idG4tYm9sZCcsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLmJvbGQpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmZvbnQuYm9sZCArIF90aGlzMi5yZXByZXNlbnRTaG9ydGN1dCgnYm9sZCcpLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyQW5kVXBkYXRlU3RhdGUoJ2VkaXRvci5ib2xkJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uaXRhbGljJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1idG4taXRhbGljJyxcbiAgICAgICAgICBjb250ZW50czogX3RoaXMyLnVpLmljb24oX3RoaXMyLm9wdGlvbnMuaWNvbnMuaXRhbGljKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5mb250Lml0YWxpYyArIF90aGlzMi5yZXByZXNlbnRTaG9ydGN1dCgnaXRhbGljJyksXG4gICAgICAgICAgY2xpY2s6IF90aGlzMi5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXJBbmRVcGRhdGVTdGF0ZSgnZWRpdG9yLml0YWxpYycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnVuZGVybGluZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ25vdGUtYnRuLXVuZGVybGluZScsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLnVuZGVybGluZSksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXMyLmxhbmcuZm9udC51bmRlcmxpbmUgKyBfdGhpczIucmVwcmVzZW50U2hvcnRjdXQoJ3VuZGVybGluZScpLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyQW5kVXBkYXRlU3RhdGUoJ2VkaXRvci51bmRlcmxpbmUnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5jbGVhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy5lcmFzZXIpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmZvbnQuY2xlYXIgKyBfdGhpczIucmVwcmVzZW50U2hvcnRjdXQoJ3JlbW92ZUZvcm1hdCcpLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVtb3ZlRm9ybWF0JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uc3RyaWtldGhyb3VnaCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ25vdGUtYnRuLXN0cmlrZXRocm91Z2gnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy5zdHJpa2V0aHJvdWdoKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5mb250LnN0cmlrZXRocm91Z2ggKyBfdGhpczIucmVwcmVzZW50U2hvcnRjdXQoJ3N0cmlrZXRocm91Z2gnKSxcbiAgICAgICAgICBjbGljazogX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlckFuZFVwZGF0ZVN0YXRlKCdlZGl0b3Iuc3RyaWtldGhyb3VnaCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnN1cGVyc2NyaXB0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1idG4tc3VwZXJzY3JpcHQnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy5zdXBlcnNjcmlwdCksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXMyLmxhbmcuZm9udC5zdXBlcnNjcmlwdCxcbiAgICAgICAgICBjbGljazogX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlckFuZFVwZGF0ZVN0YXRlKCdlZGl0b3Iuc3VwZXJzY3JpcHQnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5zdWJzY3JpcHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWJ0bi1zdWJzY3JpcHQnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy5zdWJzY3JpcHQpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmZvbnQuc3Vic2NyaXB0LFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyQW5kVXBkYXRlU3RhdGUoJ2VkaXRvci5zdWJzY3JpcHQnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5mb250bmFtZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHN0eWxlSW5mbyA9IF90aGlzMi5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmN1cnJlbnRTdHlsZScpO1xuXG4gICAgICAgIGlmIChfdGhpczIub3B0aW9ucy5hZGREZWZhdWx0Rm9udHMpIHtcbiAgICAgICAgICAvLyBBZGQgJ2RlZmF1bHQnIGZvbnRzIGludG8gdGhlIGZvbnRuYW1lcyBhcnJheSBpZiBub3QgZXhpc3RcbiAgICAgICAgICBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5lYWNoKHN0eWxlSW5mb1snZm9udC1mYW1pbHknXS5zcGxpdCgnLCcpLCBmdW5jdGlvbiAoaWR4LCBmb250bmFtZSkge1xuICAgICAgICAgICAgZm9udG5hbWUgPSBmb250bmFtZS50cmltKCkucmVwbGFjZSgvWydcIl0rL2csICcnKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzMi5pc0ZvbnREZXNlcnZlZFRvQWRkKGZvbnRuYW1lKSkge1xuICAgICAgICAgICAgICBpZiAoX3RoaXMyLm9wdGlvbnMuZm9udE5hbWVzLmluZGV4T2YoZm9udG5hbWUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIF90aGlzMi5vcHRpb25zLmZvbnROYW1lcy5wdXNoKGZvbnRuYW1lKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF90aGlzMi51aS5idXR0b25Hcm91cChbX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tdG9nZ2xlJyxcbiAgICAgICAgICBjb250ZW50czogX3RoaXMyLnVpLmRyb3Bkb3duQnV0dG9uQ29udGVudHMoJzxzcGFuIGNsYXNzPVwibm90ZS1jdXJyZW50LWZvbnRuYW1lXCI+PC9zcGFuPicsIF90aGlzMi5vcHRpb25zKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5mb250Lm5hbWUsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdG9nZ2xlOiAnZHJvcGRvd24nXG4gICAgICAgICAgfVxuICAgICAgICB9KSwgX3RoaXMyLnVpLmRyb3Bkb3duQ2hlY2soe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLWZvbnRuYW1lJyxcbiAgICAgICAgICBjaGVja0NsYXNzTmFtZTogX3RoaXMyLm9wdGlvbnMuaWNvbnMubWVudUNoZWNrLFxuICAgICAgICAgIGl0ZW1zOiBfdGhpczIub3B0aW9ucy5mb250TmFtZXMuZmlsdGVyKF90aGlzMi5pc0ZvbnRJbnN0YWxsZWQuYmluZChfdGhpczIpKSxcbiAgICAgICAgICB0aXRsZTogX3RoaXMyLmxhbmcuZm9udC5uYW1lLFxuICAgICAgICAgIHRlbXBsYXRlOiBmdW5jdGlvbiB0ZW1wbGF0ZShpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPVwiZm9udC1mYW1pbHk6ICcgKyBlbnYudmFsaWRGb250TmFtZShpdGVtKSArICdcIj4nICsgaXRlbSArICc8L3NwYW4+JztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyQW5kVXBkYXRlU3RhdGUoJ2VkaXRvci5mb250TmFtZScpXG4gICAgICAgIH0pXSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uZm9udHNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIudWkuYnV0dG9uR3JvdXAoW190aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5kcm9wZG93bkJ1dHRvbkNvbnRlbnRzKCc8c3BhbiBjbGFzcz1cIm5vdGUtY3VycmVudC1mb250c2l6ZVwiPjwvc3Bhbj4nLCBfdGhpczIub3B0aW9ucyksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXMyLmxhbmcuZm9udC5zaXplLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSksIF90aGlzMi51aS5kcm9wZG93bkNoZWNrKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdkcm9wZG93bi1mb250c2l6ZScsXG4gICAgICAgICAgY2hlY2tDbGFzc05hbWU6IF90aGlzMi5vcHRpb25zLmljb25zLm1lbnVDaGVjayxcbiAgICAgICAgICBpdGVtczogX3RoaXMyLm9wdGlvbnMuZm9udFNpemVzLFxuICAgICAgICAgIHRpdGxlOiBfdGhpczIubGFuZy5mb250LnNpemUsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMi5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXJBbmRVcGRhdGVTdGF0ZSgnZWRpdG9yLmZvbnRTaXplJylcbiAgICAgICAgfSldKS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5mb250c2l6ZXVuaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIudWkuYnV0dG9uR3JvdXAoW190aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5kcm9wZG93bkJ1dHRvbkNvbnRlbnRzKCc8c3BhbiBjbGFzcz1cIm5vdGUtY3VycmVudC1mb250c2l6ZXVuaXRcIj48L3NwYW4+JywgX3RoaXMyLm9wdGlvbnMpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmZvbnQuc2l6ZXVuaXQsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdG9nZ2xlOiAnZHJvcGRvd24nXG4gICAgICAgICAgfVxuICAgICAgICB9KSwgX3RoaXMyLnVpLmRyb3Bkb3duQ2hlY2soe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLWZvbnRzaXpldW5pdCcsXG4gICAgICAgICAgY2hlY2tDbGFzc05hbWU6IF90aGlzMi5vcHRpb25zLmljb25zLm1lbnVDaGVjayxcbiAgICAgICAgICBpdGVtczogX3RoaXMyLm9wdGlvbnMuZm9udFNpemVVbml0cyxcbiAgICAgICAgICB0aXRsZTogX3RoaXMyLmxhbmcuZm9udC5zaXpldW5pdCxcbiAgICAgICAgICBjbGljazogX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlckFuZFVwZGF0ZVN0YXRlKCdlZGl0b3IuZm9udFNpemVVbml0JylcbiAgICAgICAgfSldKS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5jb2xvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5jb2xvclBhbGV0dGUoJ25vdGUtY29sb3ItYWxsJywgX3RoaXMyLmxhbmcuY29sb3IucmVjZW50LCB0cnVlLCB0cnVlKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5mb3JlY29sb3InLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIuY29sb3JQYWxldHRlKCdub3RlLWNvbG9yLWZvcmUnLCBfdGhpczIubGFuZy5jb2xvci5mb3JlZ3JvdW5kLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uYmFja2NvbG9yJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmNvbG9yUGFsZXR0ZSgnbm90ZS1jb2xvci1iYWNrJywgX3RoaXMyLmxhbmcuY29sb3IuYmFja2dyb3VuZCwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnVsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLnVub3JkZXJlZGxpc3QpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmxpc3RzLnVub3JkZXJlZCArIF90aGlzMi5yZXByZXNlbnRTaG9ydGN1dCgnaW5zZXJ0VW5vcmRlcmVkTGlzdCcpLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuaW5zZXJ0VW5vcmRlcmVkTGlzdCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLm9sJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLm9yZGVyZWRsaXN0KSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5saXN0cy5vcmRlcmVkICsgX3RoaXMyLnJlcHJlc2VudFNob3J0Y3V0KCdpbnNlcnRPcmRlcmVkTGlzdCcpLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuaW5zZXJ0T3JkZXJlZExpc3QnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGp1c3RpZnlMZWZ0ID0gdGhpcy5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdGhpcy51aS5pY29uKHRoaXMub3B0aW9ucy5pY29ucy5hbGlnbkxlZnQpLFxuICAgICAgICB0b29sdGlwOiB0aGlzLmxhbmcucGFyYWdyYXBoLmxlZnQgKyB0aGlzLnJlcHJlc2VudFNob3J0Y3V0KCdqdXN0aWZ5TGVmdCcpLFxuICAgICAgICBjbGljazogdGhpcy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5qdXN0aWZ5TGVmdCcpXG4gICAgICB9KTtcbiAgICAgIHZhciBqdXN0aWZ5Q2VudGVyID0gdGhpcy5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdGhpcy51aS5pY29uKHRoaXMub3B0aW9ucy5pY29ucy5hbGlnbkNlbnRlciksXG4gICAgICAgIHRvb2x0aXA6IHRoaXMubGFuZy5wYXJhZ3JhcGguY2VudGVyICsgdGhpcy5yZXByZXNlbnRTaG9ydGN1dCgnanVzdGlmeUNlbnRlcicpLFxuICAgICAgICBjbGljazogdGhpcy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5qdXN0aWZ5Q2VudGVyJylcbiAgICAgIH0pO1xuICAgICAgdmFyIGp1c3RpZnlSaWdodCA9IHRoaXMuYnV0dG9uKHtcbiAgICAgICAgY29udGVudHM6IHRoaXMudWkuaWNvbih0aGlzLm9wdGlvbnMuaWNvbnMuYWxpZ25SaWdodCksXG4gICAgICAgIHRvb2x0aXA6IHRoaXMubGFuZy5wYXJhZ3JhcGgucmlnaHQgKyB0aGlzLnJlcHJlc2VudFNob3J0Y3V0KCdqdXN0aWZ5UmlnaHQnKSxcbiAgICAgICAgY2xpY2s6IHRoaXMuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuanVzdGlmeVJpZ2h0JylcbiAgICAgIH0pO1xuICAgICAgdmFyIGp1c3RpZnlGdWxsID0gdGhpcy5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdGhpcy51aS5pY29uKHRoaXMub3B0aW9ucy5pY29ucy5hbGlnbkp1c3RpZnkpLFxuICAgICAgICB0b29sdGlwOiB0aGlzLmxhbmcucGFyYWdyYXBoLmp1c3RpZnkgKyB0aGlzLnJlcHJlc2VudFNob3J0Y3V0KCdqdXN0aWZ5RnVsbCcpLFxuICAgICAgICBjbGljazogdGhpcy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5qdXN0aWZ5RnVsbCcpXG4gICAgICB9KTtcbiAgICAgIHZhciBvdXRkZW50ID0gdGhpcy5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdGhpcy51aS5pY29uKHRoaXMub3B0aW9ucy5pY29ucy5vdXRkZW50KSxcbiAgICAgICAgdG9vbHRpcDogdGhpcy5sYW5nLnBhcmFncmFwaC5vdXRkZW50ICsgdGhpcy5yZXByZXNlbnRTaG9ydGN1dCgnb3V0ZGVudCcpLFxuICAgICAgICBjbGljazogdGhpcy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5vdXRkZW50JylcbiAgICAgIH0pO1xuICAgICAgdmFyIGluZGVudCA9IHRoaXMuYnV0dG9uKHtcbiAgICAgICAgY29udGVudHM6IHRoaXMudWkuaWNvbih0aGlzLm9wdGlvbnMuaWNvbnMuaW5kZW50KSxcbiAgICAgICAgdG9vbHRpcDogdGhpcy5sYW5nLnBhcmFncmFwaC5pbmRlbnQgKyB0aGlzLnJlcHJlc2VudFNob3J0Y3V0KCdpbmRlbnQnKSxcbiAgICAgICAgY2xpY2s6IHRoaXMuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuaW5kZW50JylcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5qdXN0aWZ5TGVmdCcsIGZ1bmMuaW52b2tlKGp1c3RpZnlMZWZ0LCAncmVuZGVyJykpO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5qdXN0aWZ5Q2VudGVyJywgZnVuYy5pbnZva2UoanVzdGlmeUNlbnRlciwgJ3JlbmRlcicpKTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uanVzdGlmeVJpZ2h0JywgZnVuYy5pbnZva2UoanVzdGlmeVJpZ2h0LCAncmVuZGVyJykpO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5qdXN0aWZ5RnVsbCcsIGZ1bmMuaW52b2tlKGp1c3RpZnlGdWxsLCAncmVuZGVyJykpO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5vdXRkZW50JywgZnVuYy5pbnZva2Uob3V0ZGVudCwgJ3JlbmRlcicpKTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uaW5kZW50JywgZnVuYy5pbnZva2UoaW5kZW50LCAncmVuZGVyJykpO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5wYXJhZ3JhcGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIudWkuYnV0dG9uR3JvdXAoW190aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5kcm9wZG93bkJ1dHRvbkNvbnRlbnRzKF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLmFsaWduTGVmdCksIF90aGlzMi5vcHRpb25zKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5wYXJhZ3JhcGgucGFyYWdyYXBoLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSksIF90aGlzMi51aS5kcm9wZG93bihbX3RoaXMyLnVpLmJ1dHRvbkdyb3VwKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWFsaWduJyxcbiAgICAgICAgICBjaGlsZHJlbjogW2p1c3RpZnlMZWZ0LCBqdXN0aWZ5Q2VudGVyLCBqdXN0aWZ5UmlnaHQsIGp1c3RpZnlGdWxsXVxuICAgICAgICB9KSwgX3RoaXMyLnVpLmJ1dHRvbkdyb3VwKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWxpc3QnLFxuICAgICAgICAgIGNoaWxkcmVuOiBbb3V0ZGVudCwgaW5kZW50XVxuICAgICAgICB9KV0pXSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uaGVpZ2h0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLnVpLmJ1dHRvbkdyb3VwKFtfdGhpczIuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdkcm9wZG93bi10b2dnbGUnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuZHJvcGRvd25CdXR0b25Db250ZW50cyhfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy50ZXh0SGVpZ2h0KSwgX3RoaXMyLm9wdGlvbnMpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmZvbnQuaGVpZ2h0LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSksIF90aGlzMi51aS5kcm9wZG93bkNoZWNrKHtcbiAgICAgICAgICBpdGVtczogX3RoaXMyLm9wdGlvbnMubGluZUhlaWdodHMsXG4gICAgICAgICAgY2hlY2tDbGFzc05hbWU6IF90aGlzMi5vcHRpb25zLmljb25zLm1lbnVDaGVjayxcbiAgICAgICAgICBjbGFzc05hbWU6ICdkcm9wZG93bi1saW5lLWhlaWdodCcsXG4gICAgICAgICAgdGl0bGU6IF90aGlzMi5sYW5nLmZvbnQuaGVpZ2h0LFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IubGluZUhlaWdodCcpXG4gICAgICAgIH0pXSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24udGFibGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIudWkuYnV0dG9uR3JvdXAoW190aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5kcm9wZG93bkJ1dHRvbkNvbnRlbnRzKF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLnRhYmxlKSwgX3RoaXMyLm9wdGlvbnMpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLnRhYmxlLnRhYmxlLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSksIF90aGlzMi51aS5kcm9wZG93bih7XG4gICAgICAgICAgdGl0bGU6IF90aGlzMi5sYW5nLnRhYmxlLnRhYmxlLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ25vdGUtdGFibGUnLFxuICAgICAgICAgIGl0ZW1zOiBbJzxkaXYgY2xhc3M9XCJub3RlLWRpbWVuc2lvbi1waWNrZXJcIj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtZGltZW5zaW9uLXBpY2tlci1tb3VzZWNhdGNoZXJcIiBkYXRhLWV2ZW50PVwiaW5zZXJ0VGFibGVcIiBkYXRhLXZhbHVlPVwiMXgxXCI+PC9kaXY+JywgJzxkaXYgY2xhc3M9XCJub3RlLWRpbWVuc2lvbi1waWNrZXItaGlnaGxpZ2h0ZWRcIj48L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtZGltZW5zaW9uLXBpY2tlci11bmhpZ2hsaWdodGVkXCI+PC9kaXY+JywgJzwvZGl2PicsICc8ZGl2IGNsYXNzPVwibm90ZS1kaW1lbnNpb24tZGlzcGxheVwiPjEgeCAxPC9kaXY+J10uam9pbignJylcbiAgICAgICAgfSldLCB7XG4gICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIGNhbGxiYWNrKCRub2RlKSB7XG4gICAgICAgICAgICB2YXIgJGNhdGNoZXIgPSAkbm9kZS5maW5kKCcubm90ZS1kaW1lbnNpb24tcGlja2VyLW1vdXNlY2F0Y2hlcicpO1xuICAgICAgICAgICAgJGNhdGNoZXIuY3NzKHtcbiAgICAgICAgICAgICAgd2lkdGg6IF90aGlzMi5vcHRpb25zLmluc2VydFRhYmxlTWF4U2l6ZS5jb2wgKyAnZW0nLFxuICAgICAgICAgICAgICBoZWlnaHQ6IF90aGlzMi5vcHRpb25zLmluc2VydFRhYmxlTWF4U2l6ZS5yb3cgKyAnZW0nXG4gICAgICAgICAgICB9KS5tb3VzZWRvd24oX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmluc2VydFRhYmxlJykpLm9uKCdtb3VzZW1vdmUnLCBfdGhpczIudGFibGVNb3ZlSGFuZGxlci5iaW5kKF90aGlzMikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24ubGluaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy5saW5rKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5saW5rLmxpbmsgKyBfdGhpczIucmVwcmVzZW50U2hvcnRjdXQoJ2xpbmtEaWFsb2cuc2hvdycpLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdsaW5rRGlhbG9nLnNob3cnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5waWN0dXJlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLnBpY3R1cmUpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmltYWdlLmltYWdlLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdpbWFnZURpYWxvZy5zaG93JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24udmlkZW8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogX3RoaXMyLnVpLmljb24oX3RoaXMyLm9wdGlvbnMuaWNvbnMudmlkZW8pLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLnZpZGVvLnZpZGVvLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCd2aWRlb0RpYWxvZy5zaG93JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uaHInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogX3RoaXMyLnVpLmljb24oX3RoaXMyLm9wdGlvbnMuaWNvbnMubWludXMpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLmhyLmluc2VydCArIF90aGlzMi5yZXByZXNlbnRTaG9ydGN1dCgnaW5zZXJ0SG9yaXpvbnRhbFJ1bGUnKSxcbiAgICAgICAgICBjbGljazogX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmluc2VydEhvcml6b250YWxSdWxlJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uZnVsbHNjcmVlbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1mdWxsc2NyZWVuIG5vdGUtY29kZXZpZXcta2VlcCcsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLmFycm93c0FsdCksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXMyLmxhbmcub3B0aW9ucy5mdWxsc2NyZWVuLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczIuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdmdWxsc2NyZWVuLnRvZ2dsZScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLmNvZGV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnYnRuLWNvZGV2aWV3IG5vdGUtY29kZXZpZXcta2VlcCcsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLmNvZGUpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMi5sYW5nLm9wdGlvbnMuY29kZXZpZXcsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMi5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2NvZGV2aWV3LnRvZ2dsZScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnJlZG8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczIuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogX3RoaXMyLnVpLmljb24oX3RoaXMyLm9wdGlvbnMuaWNvbnMucmVkbyksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXMyLmxhbmcuaGlzdG9yeS5yZWRvICsgX3RoaXMyLnJlcHJlc2VudFNob3J0Y3V0KCdyZWRvJyksXG4gICAgICAgICAgY2xpY2s6IF90aGlzMi5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5yZWRvJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24udW5kbycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzMi5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczIudWkuaWNvbihfdGhpczIub3B0aW9ucy5pY29ucy51bmRvKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5oaXN0b3J5LnVuZG8gKyBfdGhpczIucmVwcmVzZW50U2hvcnRjdXQoJ3VuZG8nKSxcbiAgICAgICAgICBjbGljazogX3RoaXMyLmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLnVuZG8nKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5oZWxwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMyLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMi51aS5pY29uKF90aGlzMi5vcHRpb25zLmljb25zLnF1ZXN0aW9uKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczIubGFuZy5vcHRpb25zLmhlbHAsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMi5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2hlbHBEaWFsb2cuc2hvdycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGltYWdlOiBbXG4gICAgICogICBbJ2ltYWdlUmVzaXplJywgWydyZXNpemVGdWxsJywgJ3Jlc2l6ZUhhbGYnLCAncmVzaXplUXVhcnRlcicsICdyZXNpemVOb25lJ11dLFxuICAgICAqICAgWydmbG9hdCcsIFsnZmxvYXRMZWZ0JywgJ2Zsb2F0UmlnaHQnLCAnZmxvYXROb25lJ11dLFxuICAgICAqICAgWydyZW1vdmUnLCBbJ3JlbW92ZU1lZGlhJ11dLFxuICAgICAqIF0sXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJhZGRJbWFnZVBvcG92ZXJCdXR0b25zXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEltYWdlUG9wb3ZlckJ1dHRvbnMoKSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgLy8gSW1hZ2UgU2l6ZSBCdXR0b25zXG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnJlc2l6ZUZ1bGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczMuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogJzxzcGFuIGNsYXNzPVwibm90ZS1mb250c2l6ZS0xMFwiPjEwMCU8L3NwYW4+JyxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczMubGFuZy5pbWFnZS5yZXNpemVGdWxsLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczMuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVzaXplJywgJzEnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5yZXNpemVIYWxmJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMzLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6ICc8c3BhbiBjbGFzcz1cIm5vdGUtZm9udHNpemUtMTBcIj41MCU8L3NwYW4+JyxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczMubGFuZy5pbWFnZS5yZXNpemVIYWxmLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczMuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVzaXplJywgJzAuNScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnJlc2l6ZVF1YXJ0ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczMuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogJzxzcGFuIGNsYXNzPVwibm90ZS1mb250c2l6ZS0xMFwiPjI1JTwvc3Bhbj4nLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMy5sYW5nLmltYWdlLnJlc2l6ZVF1YXJ0ZXIsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5yZXNpemUnLCAnMC4yNScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnJlc2l6ZU5vbmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczMuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogX3RoaXMzLnVpLmljb24oX3RoaXMzLm9wdGlvbnMuaWNvbnMucm9sbGJhY2spLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMy5sYW5nLmltYWdlLnJlc2l6ZU5vbmUsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5yZXNpemUnLCAnMCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7IC8vIEZsb2F0IEJ1dHRvbnNcblxuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5mbG9hdExlZnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczMuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogX3RoaXMzLnVpLmljb24oX3RoaXMzLm9wdGlvbnMuaWNvbnMuZmxvYXRMZWZ0KSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczMubGFuZy5pbWFnZS5mbG9hdExlZnQsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5mbG9hdE1lJywgJ2xlZnQnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5mbG9hdFJpZ2h0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMzLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMy51aS5pY29uKF90aGlzMy5vcHRpb25zLmljb25zLmZsb2F0UmlnaHQpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzMy5sYW5nLmltYWdlLmZsb2F0UmlnaHQsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5mbG9hdE1lJywgJ3JpZ2h0JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uZmxvYXROb25lJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMzLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMy51aS5pY29uKF90aGlzMy5vcHRpb25zLmljb25zLnJvbGxiYWNrKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczMubGFuZy5pbWFnZS5mbG9hdE5vbmUsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5mbG9hdE1lJywgJ25vbmUnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pOyAvLyBSZW1vdmUgQnV0dG9uc1xuXG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnJlbW92ZU1lZGlhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMzLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IF90aGlzMy51aS5pY29uKF90aGlzMy5vcHRpb25zLmljb25zLnRyYXNoKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczMubGFuZy5pbWFnZS5yZW1vdmUsXG4gICAgICAgICAgY2xpY2s6IF90aGlzMy5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5yZW1vdmVNZWRpYScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImFkZExpbmtQb3BvdmVyQnV0dG9uc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMaW5rUG9wb3ZlckJ1dHRvbnMoKSB7XG4gICAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5saW5rRGlhbG9nU2hvdycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzNC5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczQudWkuaWNvbihfdGhpczQub3B0aW9ucy5pY29ucy5saW5rKSxcbiAgICAgICAgICB0b29sdGlwOiBfdGhpczQubGFuZy5saW5rLmVkaXQsXG4gICAgICAgICAgY2xpY2s6IF90aGlzNC5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2xpbmtEaWFsb2cuc2hvdycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLnVubGluaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzNC5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczQudWkuaWNvbihfdGhpczQub3B0aW9ucy5pY29ucy51bmxpbmspLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzNC5sYW5nLmxpbmsudW5saW5rLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczQuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IudW5saW5rJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogdGFibGUgOiBbXG4gICAgICogIFsnYWRkJywgWydhZGRSb3dEb3duJywgJ2FkZFJvd1VwJywgJ2FkZENvbExlZnQnLCAnYWRkQ29sUmlnaHQnXV0sXG4gICAgICogIFsnZGVsZXRlJywgWydkZWxldGVSb3cnLCAnZGVsZXRlQ29sJywgJ2RlbGV0ZVRhYmxlJ11dXG4gICAgICogXSxcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImFkZFRhYmxlUG9wb3ZlckJ1dHRvbnNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkVGFibGVQb3BvdmVyQnV0dG9ucygpIHtcbiAgICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLmFkZFJvd1VwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXM1LmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnYnRuLW1kJyxcbiAgICAgICAgICBjb250ZW50czogX3RoaXM1LnVpLmljb24oX3RoaXM1Lm9wdGlvbnMuaWNvbnMucm93QWJvdmUpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzNS5sYW5nLnRhYmxlLmFkZFJvd0Fib3ZlLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczUuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuYWRkUm93JywgJ3RvcCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLmFkZFJvd0Rvd24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczUuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdidG4tbWQnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczUudWkuaWNvbihfdGhpczUub3B0aW9ucy5pY29ucy5yb3dCZWxvdyksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXM1LmxhbmcudGFibGUuYWRkUm93QmVsb3csXG4gICAgICAgICAgY2xpY2s6IF90aGlzNS5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5hZGRSb3cnLCAnYm90dG9tJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uYWRkQ29sTGVmdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzNS5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1tZCcsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzNS51aS5pY29uKF90aGlzNS5vcHRpb25zLmljb25zLmNvbEJlZm9yZSksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXM1LmxhbmcudGFibGUuYWRkQ29sTGVmdCxcbiAgICAgICAgICBjbGljazogX3RoaXM1LmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmFkZENvbCcsICdsZWZ0JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uYWRkQ29sUmlnaHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczUuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdidG4tbWQnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczUudWkuaWNvbihfdGhpczUub3B0aW9ucy5pY29ucy5jb2xBZnRlciksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXM1LmxhbmcudGFibGUuYWRkQ29sUmlnaHQsXG4gICAgICAgICAgY2xpY2s6IF90aGlzNS5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5hZGRDb2wnLCAncmlnaHQnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi5kZWxldGVSb3cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczUuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdidG4tbWQnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczUudWkuaWNvbihfdGhpczUub3B0aW9ucy5pY29ucy5yb3dSZW1vdmUpLFxuICAgICAgICAgIHRvb2x0aXA6IF90aGlzNS5sYW5nLnRhYmxlLmRlbFJvdyxcbiAgICAgICAgICBjbGljazogX3RoaXM1LmNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmRlbGV0ZVJvdycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRleHQubWVtbygnYnV0dG9uLmRlbGV0ZUNvbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzNS5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1tZCcsXG4gICAgICAgICAgY29udGVudHM6IF90aGlzNS51aS5pY29uKF90aGlzNS5vcHRpb25zLmljb25zLmNvbFJlbW92ZSksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXM1LmxhbmcudGFibGUuZGVsQ29sLFxuICAgICAgICAgIGNsaWNrOiBfdGhpczUuY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuZGVsZXRlQ29sJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGV4dC5tZW1vKCdidXR0b24uZGVsZXRlVGFibGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpczUuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdidG4tbWQnLFxuICAgICAgICAgIGNvbnRlbnRzOiBfdGhpczUudWkuaWNvbihfdGhpczUub3B0aW9ucy5pY29ucy50cmFzaCksXG4gICAgICAgICAgdG9vbHRpcDogX3RoaXM1LmxhbmcudGFibGUuZGVsVGFibGUsXG4gICAgICAgICAgY2xpY2s6IF90aGlzNS5jb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5kZWxldGVUYWJsZScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImJ1aWxkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGJ1aWxkKCRjb250YWluZXIsIGdyb3Vwcykge1xuICAgICAgZm9yICh2YXIgZ3JvdXBJZHggPSAwLCBncm91cExlbiA9IGdyb3Vwcy5sZW5ndGg7IGdyb3VwSWR4IDwgZ3JvdXBMZW47IGdyb3VwSWR4KyspIHtcbiAgICAgICAgdmFyIGdyb3VwID0gZ3JvdXBzW2dyb3VwSWR4XTtcbiAgICAgICAgdmFyIGdyb3VwTmFtZSA9IEFycmF5LmlzQXJyYXkoZ3JvdXApID8gZ3JvdXBbMF0gOiBncm91cDtcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSBBcnJheS5pc0FycmF5KGdyb3VwKSA/IGdyb3VwLmxlbmd0aCA9PT0gMSA/IFtncm91cFswXV0gOiBncm91cFsxXSA6IFtncm91cF07XG4gICAgICAgIHZhciAkZ3JvdXAgPSB0aGlzLnVpLmJ1dHRvbkdyb3VwKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLScgKyBncm91cE5hbWVcbiAgICAgICAgfSkucmVuZGVyKCk7XG5cbiAgICAgICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gYnV0dG9ucy5sZW5ndGg7IGlkeCA8IGxlbjsgaWR4KyspIHtcbiAgICAgICAgICB2YXIgYnRuID0gdGhpcy5jb250ZXh0Lm1lbW8oJ2J1dHRvbi4nICsgYnV0dG9uc1tpZHhdKTtcblxuICAgICAgICAgIGlmIChidG4pIHtcbiAgICAgICAgICAgICRncm91cC5hcHBlbmQodHlwZW9mIGJ0biA9PT0gJ2Z1bmN0aW9uJyA/IGJ0bih0aGlzLmNvbnRleHQpIDogYnRuKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkZ3JvdXAuYXBwZW5kVG8oJGNvbnRhaW5lcik7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBbJGNvbnRhaW5lcl1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInVwZGF0ZUN1cnJlbnRTdHlsZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVDdXJyZW50U3R5bGUoJGNvbnRhaW5lcikge1xuICAgICAgdmFyIF90aGlzNiA9IHRoaXM7XG5cbiAgICAgIHZhciAkY29udCA9ICRjb250YWluZXIgfHwgdGhpcy4kdG9vbGJhcjtcbiAgICAgIHZhciBzdHlsZUluZm8gPSB0aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuY3VycmVudFN0eWxlJyk7XG4gICAgICB0aGlzLnVwZGF0ZUJ0blN0YXRlcygkY29udCwge1xuICAgICAgICAnLm5vdGUtYnRuLWJvbGQnOiBmdW5jdGlvbiBub3RlQnRuQm9sZCgpIHtcbiAgICAgICAgICByZXR1cm4gc3R5bGVJbmZvWydmb250LWJvbGQnXSA9PT0gJ2JvbGQnO1xuICAgICAgICB9LFxuICAgICAgICAnLm5vdGUtYnRuLWl0YWxpYyc6IGZ1bmN0aW9uIG5vdGVCdG5JdGFsaWMoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlSW5mb1snZm9udC1pdGFsaWMnXSA9PT0gJ2l0YWxpYyc7XG4gICAgICAgIH0sXG4gICAgICAgICcubm90ZS1idG4tdW5kZXJsaW5lJzogZnVuY3Rpb24gbm90ZUJ0blVuZGVybGluZSgpIHtcbiAgICAgICAgICByZXR1cm4gc3R5bGVJbmZvWydmb250LXVuZGVybGluZSddID09PSAndW5kZXJsaW5lJztcbiAgICAgICAgfSxcbiAgICAgICAgJy5ub3RlLWJ0bi1zdWJzY3JpcHQnOiBmdW5jdGlvbiBub3RlQnRuU3Vic2NyaXB0KCkge1xuICAgICAgICAgIHJldHVybiBzdHlsZUluZm9bJ2ZvbnQtc3Vic2NyaXB0J10gPT09ICdzdWJzY3JpcHQnO1xuICAgICAgICB9LFxuICAgICAgICAnLm5vdGUtYnRuLXN1cGVyc2NyaXB0JzogZnVuY3Rpb24gbm90ZUJ0blN1cGVyc2NyaXB0KCkge1xuICAgICAgICAgIHJldHVybiBzdHlsZUluZm9bJ2ZvbnQtc3VwZXJzY3JpcHQnXSA9PT0gJ3N1cGVyc2NyaXB0JztcbiAgICAgICAgfSxcbiAgICAgICAgJy5ub3RlLWJ0bi1zdHJpa2V0aHJvdWdoJzogZnVuY3Rpb24gbm90ZUJ0blN0cmlrZXRocm91Z2goKSB7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlSW5mb1snZm9udC1zdHJpa2V0aHJvdWdoJ10gPT09ICdzdHJpa2V0aHJvdWdoJztcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChzdHlsZUluZm9bJ2ZvbnQtZmFtaWx5J10pIHtcbiAgICAgICAgdmFyIGZvbnROYW1lcyA9IHN0eWxlSW5mb1snZm9udC1mYW1pbHknXS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoL1tcXCdcXFwiXS9nLCAnJykucmVwbGFjZSgvXFxzKyQvLCAnJykucmVwbGFjZSgvXlxccysvLCAnJyk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgZm9udE5hbWUgPSBsaXN0cy5maW5kKGZvbnROYW1lcywgdGhpcy5pc0ZvbnRJbnN0YWxsZWQuYmluZCh0aGlzKSk7XG4gICAgICAgICRjb250LmZpbmQoJy5kcm9wZG93bi1mb250bmFtZSBhJykuZWFjaChmdW5jdGlvbiAoaWR4LCBpdGVtKSB7XG4gICAgICAgICAgdmFyICRpdGVtID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoaXRlbSk7IC8vIGFsd2F5cyBjb21wYXJlIHN0cmluZyB0byBhdm9pZCBjcmVhdGluZyBhbm90aGVyIGZ1bmMuXG5cbiAgICAgICAgICB2YXIgaXNDaGVja2VkID0gJGl0ZW0uZGF0YSgndmFsdWUnKSArICcnID09PSBmb250TmFtZSArICcnO1xuICAgICAgICAgICRpdGVtLnRvZ2dsZUNsYXNzKCdjaGVja2VkJywgaXNDaGVja2VkKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRjb250LmZpbmQoJy5ub3RlLWN1cnJlbnQtZm9udG5hbWUnKS50ZXh0KGZvbnROYW1lKS5jc3MoJ2ZvbnQtZmFtaWx5JywgZm9udE5hbWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3R5bGVJbmZvWydmb250LXNpemUnXSkge1xuICAgICAgICB2YXIgZm9udFNpemUgPSBzdHlsZUluZm9bJ2ZvbnQtc2l6ZSddO1xuICAgICAgICAkY29udC5maW5kKCcuZHJvcGRvd24tZm9udHNpemUgYScpLmVhY2goZnVuY3Rpb24gKGlkeCwgaXRlbSkge1xuICAgICAgICAgIHZhciAkaXRlbSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGl0ZW0pOyAvLyBhbHdheXMgY29tcGFyZSB3aXRoIHN0cmluZyB0byBhdm9pZCBjcmVhdGluZyBhbm90aGVyIGZ1bmMuXG5cbiAgICAgICAgICB2YXIgaXNDaGVja2VkID0gJGl0ZW0uZGF0YSgndmFsdWUnKSArICcnID09PSBmb250U2l6ZSArICcnO1xuICAgICAgICAgICRpdGVtLnRvZ2dsZUNsYXNzKCdjaGVja2VkJywgaXNDaGVja2VkKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRjb250LmZpbmQoJy5ub3RlLWN1cnJlbnQtZm9udHNpemUnKS50ZXh0KGZvbnRTaXplKTtcbiAgICAgICAgdmFyIGZvbnRTaXplVW5pdCA9IHN0eWxlSW5mb1snZm9udC1zaXplLXVuaXQnXTtcbiAgICAgICAgJGNvbnQuZmluZCgnLmRyb3Bkb3duLWZvbnRzaXpldW5pdCBhJykuZWFjaChmdW5jdGlvbiAoaWR4LCBpdGVtKSB7XG4gICAgICAgICAgdmFyICRpdGVtID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoaXRlbSk7XG4gICAgICAgICAgdmFyIGlzQ2hlY2tlZCA9ICRpdGVtLmRhdGEoJ3ZhbHVlJykgKyAnJyA9PT0gZm9udFNpemVVbml0ICsgJyc7XG4gICAgICAgICAgJGl0ZW0udG9nZ2xlQ2xhc3MoJ2NoZWNrZWQnLCBpc0NoZWNrZWQpO1xuICAgICAgICB9KTtcbiAgICAgICAgJGNvbnQuZmluZCgnLm5vdGUtY3VycmVudC1mb250c2l6ZXVuaXQnKS50ZXh0KGZvbnRTaXplVW5pdCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdHlsZUluZm9bJ2xpbmUtaGVpZ2h0J10pIHtcbiAgICAgICAgdmFyIGxpbmVIZWlnaHQgPSBzdHlsZUluZm9bJ2xpbmUtaGVpZ2h0J107XG4gICAgICAgICRjb250LmZpbmQoJy5kcm9wZG93bi1saW5lLWhlaWdodCBsaSBhJykuZWFjaChmdW5jdGlvbiAoaWR4LCBpdGVtKSB7XG4gICAgICAgICAgLy8gYWx3YXlzIGNvbXBhcmUgd2l0aCBzdHJpbmcgdG8gYXZvaWQgY3JlYXRpbmcgYW5vdGhlciBmdW5jLlxuICAgICAgICAgIHZhciBpc0NoZWNrZWQgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShpdGVtKS5kYXRhKCd2YWx1ZScpICsgJycgPT09IGxpbmVIZWlnaHQgKyAnJztcbiAgICAgICAgICBfdGhpczYuY2xhc3NOYW1lID0gaXNDaGVja2VkID8gJ2NoZWNrZWQnIDogJyc7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJ1cGRhdGVCdG5TdGF0ZXNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQnRuU3RhdGVzKCRjb250YWluZXIsIGluZm9zKSB7XG4gICAgICB2YXIgX3RoaXM3ID0gdGhpcztcblxuICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuZWFjaChpbmZvcywgZnVuY3Rpb24gKHNlbGVjdG9yLCBwcmVkKSB7XG4gICAgICAgIF90aGlzNy51aS50b2dnbGVCdG5BY3RpdmUoJGNvbnRhaW5lci5maW5kKHNlbGVjdG9yKSwgcHJlZCgpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJ0YWJsZU1vdmVIYW5kbGVyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRhYmxlTW92ZUhhbmRsZXIoZXZlbnQpIHtcbiAgICAgIHZhciBQWF9QRVJfRU0gPSAxODtcbiAgICAgIHZhciAkcGlja2VyID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUpOyAvLyB0YXJnZXQgaXMgbW91c2VjYXRjaGVyXG5cbiAgICAgIHZhciAkZGltZW5zaW9uRGlzcGxheSA9ICRwaWNrZXIubmV4dCgpO1xuICAgICAgdmFyICRjYXRjaGVyID0gJHBpY2tlci5maW5kKCcubm90ZS1kaW1lbnNpb24tcGlja2VyLW1vdXNlY2F0Y2hlcicpO1xuICAgICAgdmFyICRoaWdobGlnaHRlZCA9ICRwaWNrZXIuZmluZCgnLm5vdGUtZGltZW5zaW9uLXBpY2tlci1oaWdobGlnaHRlZCcpO1xuICAgICAgdmFyICR1bmhpZ2hsaWdodGVkID0gJHBpY2tlci5maW5kKCcubm90ZS1kaW1lbnNpb24tcGlja2VyLXVuaGlnaGxpZ2h0ZWQnKTtcbiAgICAgIHZhciBwb3NPZmZzZXQ7IC8vIEhUTUw1IHdpdGggalF1ZXJ5IC0gZS5vZmZzZXRYIGlzIHVuZGVmaW5lZCBpbiBGaXJlZm94XG5cbiAgICAgIGlmIChldmVudC5vZmZzZXRYID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIHBvc0NhdGNoZXIgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShldmVudC50YXJnZXQpLm9mZnNldCgpO1xuICAgICAgICBwb3NPZmZzZXQgPSB7XG4gICAgICAgICAgeDogZXZlbnQucGFnZVggLSBwb3NDYXRjaGVyLmxlZnQsXG4gICAgICAgICAgeTogZXZlbnQucGFnZVkgLSBwb3NDYXRjaGVyLnRvcFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcG9zT2Zmc2V0ID0ge1xuICAgICAgICAgIHg6IGV2ZW50Lm9mZnNldFgsXG4gICAgICAgICAgeTogZXZlbnQub2Zmc2V0WVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICB2YXIgZGltID0ge1xuICAgICAgICBjOiBNYXRoLmNlaWwocG9zT2Zmc2V0LnggLyBQWF9QRVJfRU0pIHx8IDEsXG4gICAgICAgIHI6IE1hdGguY2VpbChwb3NPZmZzZXQueSAvIFBYX1BFUl9FTSkgfHwgMVxuICAgICAgfTtcbiAgICAgICRoaWdobGlnaHRlZC5jc3Moe1xuICAgICAgICB3aWR0aDogZGltLmMgKyAnZW0nLFxuICAgICAgICBoZWlnaHQ6IGRpbS5yICsgJ2VtJ1xuICAgICAgfSk7XG4gICAgICAkY2F0Y2hlci5kYXRhKCd2YWx1ZScsIGRpbS5jICsgJ3gnICsgZGltLnIpO1xuXG4gICAgICBpZiAoZGltLmMgPiAzICYmIGRpbS5jIDwgdGhpcy5vcHRpb25zLmluc2VydFRhYmxlTWF4U2l6ZS5jb2wpIHtcbiAgICAgICAgJHVuaGlnaGxpZ2h0ZWQuY3NzKHtcbiAgICAgICAgICB3aWR0aDogZGltLmMgKyAxICsgJ2VtJ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRpbS5yID4gMyAmJiBkaW0uciA8IHRoaXMub3B0aW9ucy5pbnNlcnRUYWJsZU1heFNpemUucm93KSB7XG4gICAgICAgICR1bmhpZ2hsaWdodGVkLmNzcyh7XG4gICAgICAgICAgaGVpZ2h0OiBkaW0uciArIDEgKyAnZW0nXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAkZGltZW5zaW9uRGlzcGxheS5odG1sKGRpbS5jICsgJyB4ICcgKyBkaW0ucik7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEJ1dHRvbnM7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvVG9vbGJhci5qc1xuZnVuY3Rpb24gVG9vbGJhcl9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIFRvb2xiYXJfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIFRvb2xiYXJfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBUb29sYmFyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBUb29sYmFyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG52YXIgVG9vbGJhcl9Ub29sYmFyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVG9vbGJhcihjb250ZXh0KSB7XG4gICAgVG9vbGJhcl9jbGFzc0NhbGxDaGVjayh0aGlzLCBUb29sYmFyKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy4kd2luZG93ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkod2luZG93KTtcbiAgICB0aGlzLiRkb2N1bWVudCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGRvY3VtZW50KTtcbiAgICB0aGlzLnVpID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZS51aTtcbiAgICB0aGlzLiRub3RlID0gY29udGV4dC5sYXlvdXRJbmZvLm5vdGU7XG4gICAgdGhpcy4kZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB0aGlzLiR0b29sYmFyID0gY29udGV4dC5sYXlvdXRJbmZvLnRvb2xiYXI7XG4gICAgdGhpcy4kZWRpdGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGFibGU7XG4gICAgdGhpcy4kc3RhdHVzYmFyID0gY29udGV4dC5sYXlvdXRJbmZvLnN0YXR1c2JhcjtcbiAgICB0aGlzLm9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdGhpcy5pc0ZvbGxvd2luZyA9IGZhbHNlO1xuICAgIHRoaXMuZm9sbG93U2Nyb2xsID0gdGhpcy5mb2xsb3dTY3JvbGwuYmluZCh0aGlzKTtcbiAgfVxuXG4gIFRvb2xiYXJfY3JlYXRlQ2xhc3MoVG9vbGJhciwgW3tcbiAgICBrZXk6IFwic2hvdWxkSW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRJbml0aWFsaXplKCkge1xuICAgICAgcmV0dXJuICF0aGlzLm9wdGlvbnMuYWlyTW9kZTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgdGhpcy5vcHRpb25zLnRvb2xiYXIgPSB0aGlzLm9wdGlvbnMudG9vbGJhciB8fCBbXTtcblxuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudG9vbGJhci5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy4kdG9vbGJhci5oaWRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdidXR0b25zLmJ1aWxkJywgdGhpcy4kdG9vbGJhciwgdGhpcy5vcHRpb25zLnRvb2xiYXIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLnRvb2xiYXJDb250YWluZXIpIHtcbiAgICAgICAgdGhpcy4kdG9vbGJhci5hcHBlbmRUbyh0aGlzLm9wdGlvbnMudG9vbGJhckNvbnRhaW5lcik7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2hhbmdlQ29udGFpbmVyKGZhbHNlKTtcbiAgICAgIHRoaXMuJG5vdGUub24oJ3N1bW1lcm5vdGUua2V5dXAgc3VtbWVybm90ZS5tb3VzZXVwIHN1bW1lcm5vdGUuY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5jb250ZXh0Lmludm9rZSgnYnV0dG9ucy51cGRhdGVDdXJyZW50U3R5bGUnKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgnYnV0dG9ucy51cGRhdGVDdXJyZW50U3R5bGUnKTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5mb2xsb3dpbmdUb29sYmFyKSB7XG4gICAgICAgIHRoaXMuJHdpbmRvdy5vbignc2Nyb2xsIHJlc2l6ZScsIHRoaXMuZm9sbG93U2Nyb2xsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdGhpcy4kdG9vbGJhci5jaGlsZHJlbigpLnJlbW92ZSgpO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmZvbGxvd2luZ1Rvb2xiYXIpIHtcbiAgICAgICAgdGhpcy4kd2luZG93Lm9mZignc2Nyb2xsIHJlc2l6ZScsIHRoaXMuZm9sbG93U2Nyb2xsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZm9sbG93U2Nyb2xsXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZvbGxvd1Njcm9sbCgpIHtcbiAgICAgIGlmICh0aGlzLiRlZGl0b3IuaGFzQ2xhc3MoJ2Z1bGxzY3JlZW4nKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHZhciBlZGl0b3JIZWlnaHQgPSB0aGlzLiRlZGl0b3Iub3V0ZXJIZWlnaHQoKTtcbiAgICAgIHZhciBlZGl0b3JXaWR0aCA9IHRoaXMuJGVkaXRvci53aWR0aCgpO1xuICAgICAgdmFyIHRvb2xiYXJIZWlnaHQgPSB0aGlzLiR0b29sYmFyLmhlaWdodCgpO1xuICAgICAgdmFyIHN0YXR1c2JhckhlaWdodCA9IHRoaXMuJHN0YXR1c2Jhci5oZWlnaHQoKTsgLy8gY2hlY2sgaWYgdGhlIHdlYiBhcHAgaXMgY3VycmVudGx5IHVzaW5nIGFub3RoZXIgc3RhdGljIGJhclxuXG4gICAgICB2YXIgb3RoZXJCYXJIZWlnaHQgPSAwO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLm90aGVyU3RhdGljQmFyKSB7XG4gICAgICAgIG90aGVyQmFySGVpZ2h0ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkodGhpcy5vcHRpb25zLm90aGVyU3RhdGljQmFyKS5vdXRlckhlaWdodCgpO1xuICAgICAgfVxuXG4gICAgICB2YXIgY3VycmVudE9mZnNldCA9IHRoaXMuJGRvY3VtZW50LnNjcm9sbFRvcCgpO1xuICAgICAgdmFyIGVkaXRvck9mZnNldFRvcCA9IHRoaXMuJGVkaXRvci5vZmZzZXQoKS50b3A7XG4gICAgICB2YXIgZWRpdG9yT2Zmc2V0Qm90dG9tID0gZWRpdG9yT2Zmc2V0VG9wICsgZWRpdG9ySGVpZ2h0O1xuICAgICAgdmFyIGFjdGl2YXRlT2Zmc2V0ID0gZWRpdG9yT2Zmc2V0VG9wIC0gb3RoZXJCYXJIZWlnaHQ7XG4gICAgICB2YXIgZGVhY3RpdmF0ZU9mZnNldEJvdHRvbSA9IGVkaXRvck9mZnNldEJvdHRvbSAtIG90aGVyQmFySGVpZ2h0IC0gdG9vbGJhckhlaWdodCAtIHN0YXR1c2JhckhlaWdodDtcblxuICAgICAgaWYgKCF0aGlzLmlzRm9sbG93aW5nICYmIGN1cnJlbnRPZmZzZXQgPiBhY3RpdmF0ZU9mZnNldCAmJiBjdXJyZW50T2Zmc2V0IDwgZGVhY3RpdmF0ZU9mZnNldEJvdHRvbSAtIHRvb2xiYXJIZWlnaHQpIHtcbiAgICAgICAgdGhpcy5pc0ZvbGxvd2luZyA9IHRydWU7XG4gICAgICAgIHRoaXMuJGVkaXRhYmxlLmNzcyh7XG4gICAgICAgICAgbWFyZ2luVG9wOiB0aGlzLiR0b29sYmFyLm91dGVySGVpZ2h0KClcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRvb2xiYXIuY3NzKHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgICAgICB0b3A6IG90aGVyQmFySGVpZ2h0LFxuICAgICAgICAgIHdpZHRoOiBlZGl0b3JXaWR0aCxcbiAgICAgICAgICB6SW5kZXg6IDEwMDBcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNGb2xsb3dpbmcgJiYgKGN1cnJlbnRPZmZzZXQgPCBhY3RpdmF0ZU9mZnNldCB8fCBjdXJyZW50T2Zmc2V0ID4gZGVhY3RpdmF0ZU9mZnNldEJvdHRvbSkpIHtcbiAgICAgICAgdGhpcy5pc0ZvbGxvd2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLiR0b29sYmFyLmNzcyh7XG4gICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgekluZGV4OiAnYXV0bydcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJGVkaXRhYmxlLmNzcyh7XG4gICAgICAgICAgbWFyZ2luVG9wOiAnJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiY2hhbmdlQ29udGFpbmVyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNoYW5nZUNvbnRhaW5lcihpc0Z1bGxzY3JlZW4pIHtcbiAgICAgIGlmIChpc0Z1bGxzY3JlZW4pIHtcbiAgICAgICAgdGhpcy4kdG9vbGJhci5wcmVwZW5kVG8odGhpcy4kZWRpdG9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9vbGJhckNvbnRhaW5lcikge1xuICAgICAgICAgIHRoaXMuJHRvb2xiYXIuYXBwZW5kVG8odGhpcy5vcHRpb25zLnRvb2xiYXJDb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9sbG93aW5nVG9vbGJhcikge1xuICAgICAgICB0aGlzLmZvbGxvd1Njcm9sbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJ1cGRhdGVGdWxsc2NyZWVuXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUZ1bGxzY3JlZW4oaXNGdWxsc2NyZWVuKSB7XG4gICAgICB0aGlzLnVpLnRvZ2dsZUJ0bkFjdGl2ZSh0aGlzLiR0b29sYmFyLmZpbmQoJy5idG4tZnVsbHNjcmVlbicpLCBpc0Z1bGxzY3JlZW4pO1xuICAgICAgdGhpcy5jaGFuZ2VDb250YWluZXIoaXNGdWxsc2NyZWVuKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwidXBkYXRlQ29kZXZpZXdcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQ29kZXZpZXcoaXNDb2Rldmlldykge1xuICAgICAgdGhpcy51aS50b2dnbGVCdG5BY3RpdmUodGhpcy4kdG9vbGJhci5maW5kKCcuYnRuLWNvZGV2aWV3JyksIGlzQ29kZXZpZXcpO1xuXG4gICAgICBpZiAoaXNDb2Rldmlldykge1xuICAgICAgICB0aGlzLmRlYWN0aXZhdGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiYWN0aXZhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWN0aXZhdGUoaXNJbmNsdWRlQ29kZXZpZXcpIHtcbiAgICAgIHZhciAkYnRuID0gdGhpcy4kdG9vbGJhci5maW5kKCdidXR0b24nKTtcblxuICAgICAgaWYgKCFpc0luY2x1ZGVDb2Rldmlldykge1xuICAgICAgICAkYnRuID0gJGJ0bi5ub3QoJy5ub3RlLWNvZGV2aWV3LWtlZXAnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy51aS50b2dnbGVCdG4oJGJ0biwgdHJ1ZSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImRlYWN0aXZhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVhY3RpdmF0ZShpc0luY2x1ZGVDb2Rldmlldykge1xuICAgICAgdmFyICRidG4gPSB0aGlzLiR0b29sYmFyLmZpbmQoJ2J1dHRvbicpO1xuXG4gICAgICBpZiAoIWlzSW5jbHVkZUNvZGV2aWV3KSB7XG4gICAgICAgICRidG4gPSAkYnRuLm5vdCgnLm5vdGUtY29kZXZpZXcta2VlcCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVpLnRvZ2dsZUJ0bigkYnRuLCBmYWxzZSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFRvb2xiYXI7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvTGlua0RpYWxvZy5qc1xuZnVuY3Rpb24gTGlua0RpYWxvZ19jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIExpbmtEaWFsb2dfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIExpbmtEaWFsb2dfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBMaW5rRGlhbG9nX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBMaW5rRGlhbG9nX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cblxuXG52YXIgTGlua0RpYWxvZ19MaW5rRGlhbG9nID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGlua0RpYWxvZyhjb250ZXh0KSB7XG4gICAgTGlua0RpYWxvZ19jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5rRGlhbG9nKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy51aSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUudWk7XG4gICAgdGhpcy4kYm9keSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGRvY3VtZW50LmJvZHkpO1xuICAgIHRoaXMuJGVkaXRvciA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0b3I7XG4gICAgdGhpcy5vcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuICAgIHRoaXMubGFuZyA9IHRoaXMub3B0aW9ucy5sYW5nSW5mbztcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAubGlua0RpYWxvZy5zaG93JywgdGhpcy5vcHRpb25zLmxhbmdJbmZvLmhlbHBbJ2xpbmtEaWFsb2cuc2hvdyddKTtcbiAgfVxuXG4gIExpbmtEaWFsb2dfY3JlYXRlQ2xhc3MoTGlua0RpYWxvZywgW3tcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdmFyICRjb250YWluZXIgPSB0aGlzLm9wdGlvbnMuZGlhbG9nc0luQm9keSA/IHRoaXMuJGJvZHkgOiB0aGlzLm9wdGlvbnMuY29udGFpbmVyO1xuICAgICAgdmFyIGJvZHkgPSBbJzxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwIG5vdGUtZm9ybS1ncm91cFwiPicsIFwiPGxhYmVsIGZvcj1cXFwibm90ZS1kaWFsb2ctbGluay10eHQtXCIuY29uY2F0KHRoaXMub3B0aW9ucy5pZCwgXCJcXFwiIGNsYXNzPVxcXCJub3RlLWZvcm0tbGFiZWxcXFwiPlwiKS5jb25jYXQodGhpcy5sYW5nLmxpbmsudGV4dFRvRGlzcGxheSwgXCI8L2xhYmVsPlwiKSwgXCI8aW5wdXQgaWQ9XFxcIm5vdGUtZGlhbG9nLWxpbmstdHh0LVwiLmNvbmNhdCh0aGlzLm9wdGlvbnMuaWQsIFwiXFxcIiBjbGFzcz1cXFwibm90ZS1saW5rLXRleHQgZm9ybS1jb250cm9sIG5vdGUtZm9ybS1jb250cm9sIG5vdGUtaW5wdXRcXFwiIHR5cGU9XFxcInRleHRcXFwiLz5cIiksICc8L2Rpdj4nLCAnPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXAgbm90ZS1mb3JtLWdyb3VwXCI+JywgXCI8bGFiZWwgZm9yPVxcXCJub3RlLWRpYWxvZy1saW5rLXVybC1cIi5jb25jYXQodGhpcy5vcHRpb25zLmlkLCBcIlxcXCIgY2xhc3M9XFxcIm5vdGUtZm9ybS1sYWJlbFxcXCI+XCIpLmNvbmNhdCh0aGlzLmxhbmcubGluay51cmwsIFwiPC9sYWJlbD5cIiksIFwiPGlucHV0IGlkPVxcXCJub3RlLWRpYWxvZy1saW5rLXVybC1cIi5jb25jYXQodGhpcy5vcHRpb25zLmlkLCBcIlxcXCIgY2xhc3M9XFxcIm5vdGUtbGluay11cmwgZm9ybS1jb250cm9sIG5vdGUtZm9ybS1jb250cm9sIG5vdGUtaW5wdXRcXFwiIHR5cGU9XFxcInRleHRcXFwiIHZhbHVlPVxcXCJodHRwOi8vXFxcIi8+XCIpLCAnPC9kaXY+JywgIXRoaXMub3B0aW9ucy5kaXNhYmxlTGlua1RhcmdldCA/IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8ZGl2Lz4nKS5hcHBlbmQodGhpcy51aS5jaGVja2JveCh7XG4gICAgICAgIGNsYXNzTmFtZTogJ3NuLWNoZWNrYm94LW9wZW4taW4tbmV3LXdpbmRvdycsXG4gICAgICAgIHRleHQ6IHRoaXMubGFuZy5saW5rLm9wZW5Jbk5ld1dpbmRvdyxcbiAgICAgICAgY2hlY2tlZDogdHJ1ZVxuICAgICAgfSkucmVuZGVyKCkpLmh0bWwoKSA6ICcnLCBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnPGRpdi8+JykuYXBwZW5kKHRoaXMudWkuY2hlY2tib3goe1xuICAgICAgICBjbGFzc05hbWU6ICdzbi1jaGVja2JveC11c2UtcHJvdG9jb2wnLFxuICAgICAgICB0ZXh0OiB0aGlzLmxhbmcubGluay51c2VQcm90b2NvbCxcbiAgICAgICAgY2hlY2tlZDogdHJ1ZVxuICAgICAgfSkucmVuZGVyKCkpLmh0bWwoKV0uam9pbignJyk7XG4gICAgICB2YXIgYnV0dG9uQ2xhc3MgPSAnYnRuIGJ0bi1wcmltYXJ5IG5vdGUtYnRuIG5vdGUtYnRuLXByaW1hcnkgbm90ZS1saW5rLWJ0bic7XG4gICAgICB2YXIgZm9vdGVyID0gXCI8aW5wdXQgdHlwZT1cXFwiYnV0dG9uXFxcIiBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwiXCIuY29uY2F0KGJ1dHRvbkNsYXNzLCBcIlxcXCIgdmFsdWU9XFxcIlwiKS5jb25jYXQodGhpcy5sYW5nLmxpbmsuaW5zZXJ0LCBcIlxcXCIgZGlzYWJsZWQ+XCIpO1xuICAgICAgdGhpcy4kZGlhbG9nID0gdGhpcy51aS5kaWFsb2coe1xuICAgICAgICBjbGFzc05hbWU6ICdsaW5rLWRpYWxvZycsXG4gICAgICAgIHRpdGxlOiB0aGlzLmxhbmcubGluay5pbnNlcnQsXG4gICAgICAgIGZhZGU6IHRoaXMub3B0aW9ucy5kaWFsb2dzRmFkZSxcbiAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgZm9vdGVyOiBmb290ZXJcbiAgICAgIH0pLnJlbmRlcigpLmFwcGVuZFRvKCRjb250YWluZXIpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLnVpLmhpZGVEaWFsb2codGhpcy4kZGlhbG9nKTtcbiAgICAgIHRoaXMuJGRpYWxvZy5yZW1vdmUoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiYmluZEVudGVyS2V5XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGJpbmRFbnRlcktleSgkaW5wdXQsICRidG4pIHtcbiAgICAgICRpbnB1dC5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGNvcmVfa2V5LmNvZGUuRU5URVIpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICRidG4udHJpZ2dlcignY2xpY2snKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHRvZ2dsZSB1cGRhdGUgYnV0dG9uXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJ0b2dnbGVMaW5rQnRuXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRvZ2dsZUxpbmtCdG4oJGxpbmtCdG4sICRsaW5rVGV4dCwgJGxpbmtVcmwpIHtcbiAgICAgIHRoaXMudWkudG9nZ2xlQnRuKCRsaW5rQnRuLCAkbGlua1RleHQudmFsKCkgJiYgJGxpbmtVcmwudmFsKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTaG93IGxpbmsgZGlhbG9nIGFuZCBzZXQgZXZlbnQgaGFuZGxlcnMgb24gZGlhbG9nIGNvbnRyb2xzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGxpbmtJbmZvXG4gICAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInNob3dMaW5rRGlhbG9nXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dMaW5rRGlhbG9nKGxpbmtJbmZvKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICByZXR1cm4gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuRGVmZXJyZWQoZnVuY3Rpb24gKGRlZmVycmVkKSB7XG4gICAgICAgIHZhciAkbGlua1RleHQgPSBfdGhpcy4kZGlhbG9nLmZpbmQoJy5ub3RlLWxpbmstdGV4dCcpO1xuXG4gICAgICAgIHZhciAkbGlua1VybCA9IF90aGlzLiRkaWFsb2cuZmluZCgnLm5vdGUtbGluay11cmwnKTtcblxuICAgICAgICB2YXIgJGxpbmtCdG4gPSBfdGhpcy4kZGlhbG9nLmZpbmQoJy5ub3RlLWxpbmstYnRuJyk7XG5cbiAgICAgICAgdmFyICRvcGVuSW5OZXdXaW5kb3cgPSBfdGhpcy4kZGlhbG9nLmZpbmQoJy5zbi1jaGVja2JveC1vcGVuLWluLW5ldy13aW5kb3cgaW5wdXRbdHlwZT1jaGVja2JveF0nKTtcblxuICAgICAgICB2YXIgJHVzZVByb3RvY29sID0gX3RoaXMuJGRpYWxvZy5maW5kKCcuc24tY2hlY2tib3gtdXNlLXByb3RvY29sIGlucHV0W3R5cGU9Y2hlY2tib3hdJyk7XG5cbiAgICAgICAgX3RoaXMudWkub25EaWFsb2dTaG93bihfdGhpcy4kZGlhbG9nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2RpYWxvZy5zaG93bicpOyAvLyBJZiBubyB1cmwgd2FzIGdpdmVuIGFuZCBnaXZlbiB0ZXh0IGlzIHZhbGlkIFVSTCB0aGVuIGNvcHkgdGhhdCBpbnRvIFVSTCBGaWVsZFxuXG5cbiAgICAgICAgICBpZiAoIWxpbmtJbmZvLnVybCAmJiBmdW5jLmlzVmFsaWRVcmwobGlua0luZm8udGV4dCkpIHtcbiAgICAgICAgICAgIGxpbmtJbmZvLnVybCA9IGxpbmtJbmZvLnRleHQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJGxpbmtUZXh0Lm9uKCdpbnB1dCBwYXN0ZSBwcm9wZXJ0eWNoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIElmIGxpbmt0ZXh0IHdhcyBtb2RpZmllZCBieSBpbnB1dCBldmVudHMsXG4gICAgICAgICAgICAvLyBjbG9uaW5nIHRleHQgZnJvbSBsaW5rVXJsIHdpbGwgYmUgc3RvcHBlZC5cbiAgICAgICAgICAgIGxpbmtJbmZvLnRleHQgPSAkbGlua1RleHQudmFsKCk7XG5cbiAgICAgICAgICAgIF90aGlzLnRvZ2dsZUxpbmtCdG4oJGxpbmtCdG4sICRsaW5rVGV4dCwgJGxpbmtVcmwpO1xuICAgICAgICAgIH0pLnZhbChsaW5rSW5mby50ZXh0KTtcbiAgICAgICAgICAkbGlua1VybC5vbignaW5wdXQgcGFzdGUgcHJvcGVydHljaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBEaXNwbGF5IHNhbWUgdGV4dCBvbiBgVGV4dCB0byBkaXNwbGF5YCBhcyBkZWZhdWx0XG4gICAgICAgICAgICAvLyB3aGVuIGxpbmt0ZXh0IGhhcyBubyB0ZXh0XG4gICAgICAgICAgICBpZiAoIWxpbmtJbmZvLnRleHQpIHtcbiAgICAgICAgICAgICAgJGxpbmtUZXh0LnZhbCgkbGlua1VybC52YWwoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF90aGlzLnRvZ2dsZUxpbmtCdG4oJGxpbmtCdG4sICRsaW5rVGV4dCwgJGxpbmtVcmwpO1xuICAgICAgICAgIH0pLnZhbChsaW5rSW5mby51cmwpO1xuXG4gICAgICAgICAgaWYgKCFlbnYuaXNTdXBwb3J0VG91Y2gpIHtcbiAgICAgICAgICAgICRsaW5rVXJsLnRyaWdnZXIoJ2ZvY3VzJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgX3RoaXMudG9nZ2xlTGlua0J0bigkbGlua0J0biwgJGxpbmtUZXh0LCAkbGlua1VybCk7XG5cbiAgICAgICAgICBfdGhpcy5iaW5kRW50ZXJLZXkoJGxpbmtVcmwsICRsaW5rQnRuKTtcblxuICAgICAgICAgIF90aGlzLmJpbmRFbnRlcktleSgkbGlua1RleHQsICRsaW5rQnRuKTtcblxuICAgICAgICAgIHZhciBpc05ld1dpbmRvd0NoZWNrZWQgPSBsaW5rSW5mby5pc05ld1dpbmRvdyAhPT0gdW5kZWZpbmVkID8gbGlua0luZm8uaXNOZXdXaW5kb3cgOiBfdGhpcy5jb250ZXh0Lm9wdGlvbnMubGlua1RhcmdldEJsYW5rO1xuICAgICAgICAgICRvcGVuSW5OZXdXaW5kb3cucHJvcCgnY2hlY2tlZCcsIGlzTmV3V2luZG93Q2hlY2tlZCk7XG4gICAgICAgICAgdmFyIHVzZVByb3RvY29sQ2hlY2tlZCA9IGxpbmtJbmZvLnVybCA/IGZhbHNlIDogX3RoaXMuY29udGV4dC5vcHRpb25zLnVzZVByb3RvY29sO1xuICAgICAgICAgICR1c2VQcm90b2NvbC5wcm9wKCdjaGVja2VkJywgdXNlUHJvdG9jb2xDaGVja2VkKTtcbiAgICAgICAgICAkbGlua0J0bi5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh7XG4gICAgICAgICAgICAgIHJhbmdlOiBsaW5rSW5mby5yYW5nZSxcbiAgICAgICAgICAgICAgdXJsOiAkbGlua1VybC52YWwoKSxcbiAgICAgICAgICAgICAgdGV4dDogJGxpbmtUZXh0LnZhbCgpLFxuICAgICAgICAgICAgICBpc05ld1dpbmRvdzogJG9wZW5Jbk5ld1dpbmRvdy5pcygnOmNoZWNrZWQnKSxcbiAgICAgICAgICAgICAgY2hlY2tQcm90b2NvbDogJHVzZVByb3RvY29sLmlzKCc6Y2hlY2tlZCcpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgX3RoaXMudWkuaGlkZURpYWxvZyhfdGhpcy4kZGlhbG9nKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgX3RoaXMudWkub25EaWFsb2dIaWRkZW4oX3RoaXMuJGRpYWxvZywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vIGRldGFjaCBldmVudHNcbiAgICAgICAgICAkbGlua1RleHQub2ZmKCk7XG4gICAgICAgICAgJGxpbmtVcmwub2ZmKCk7XG4gICAgICAgICAgJGxpbmtCdG4ub2ZmKCk7XG5cbiAgICAgICAgICBpZiAoZGVmZXJyZWQuc3RhdGUoKSA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF90aGlzLnVpLnNob3dEaWFsb2coX3RoaXMuJGRpYWxvZyk7XG4gICAgICB9KS5wcm9taXNlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBsYXlvdXRJbmZvXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJzaG93XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3coKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgdmFyIGxpbmtJbmZvID0gdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmdldExpbmtJbmZvJyk7XG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3Iuc2F2ZVJhbmdlJyk7XG4gICAgICB0aGlzLnNob3dMaW5rRGlhbG9nKGxpbmtJbmZvKS50aGVuKGZ1bmN0aW9uIChsaW5rSW5mbykge1xuICAgICAgICBfdGhpczIuY29udGV4dC5pbnZva2UoJ2VkaXRvci5yZXN0b3JlUmFuZ2UnKTtcblxuICAgICAgICBfdGhpczIuY29udGV4dC5pbnZva2UoJ2VkaXRvci5jcmVhdGVMaW5rJywgbGlua0luZm8pO1xuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzMi5jb250ZXh0Lmludm9rZSgnZWRpdG9yLnJlc3RvcmVSYW5nZScpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIExpbmtEaWFsb2c7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvTGlua1BvcG92ZXIuanNcbmZ1bmN0aW9uIExpbmtQb3BvdmVyX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gTGlua1BvcG92ZXJfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIExpbmtQb3BvdmVyX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgTGlua1BvcG92ZXJfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIExpbmtQb3BvdmVyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cblxudmFyIExpbmtQb3BvdmVyX0xpbmtQb3BvdmVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGlua1BvcG92ZXIoY29udGV4dCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBMaW5rUG9wb3Zlcl9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5rUG9wb3Zlcik7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMudWkgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLnVpO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLmtleXVwIHN1bW1lcm5vdGUubW91c2V1cCBzdW1tZXJub3RlLmNoYW5nZSBzdW1tZXJub3RlLnNjcm9sbCc6IGZ1bmN0aW9uIHN1bW1lcm5vdGVLZXl1cFN1bW1lcm5vdGVNb3VzZXVwU3VtbWVybm90ZUNoYW5nZVN1bW1lcm5vdGVTY3JvbGwoKSB7XG4gICAgICAgIF90aGlzLnVwZGF0ZSgpO1xuICAgICAgfSxcbiAgICAgICdzdW1tZXJub3RlLmRpc2FibGUgc3VtbWVybm90ZS5kaWFsb2cuc2hvd24gc3VtbWVybm90ZS5ibHVyJzogZnVuY3Rpb24gc3VtbWVybm90ZURpc2FibGVTdW1tZXJub3RlRGlhbG9nU2hvd25TdW1tZXJub3RlQmx1cigpIHtcbiAgICAgICAgX3RoaXMuaGlkZSgpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBMaW5rUG9wb3Zlcl9jcmVhdGVDbGFzcyhMaW5rUG9wb3ZlciwgW3tcbiAgICBrZXk6IFwic2hvdWxkSW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRJbml0aWFsaXplKCkge1xuICAgICAgcmV0dXJuICFsaXN0cy5pc0VtcHR5KHRoaXMub3B0aW9ucy5wb3BvdmVyLmxpbmspO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyID0gdGhpcy51aS5wb3BvdmVyKHtcbiAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1saW5rLXBvcG92ZXInLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gY2FsbGJhY2soJG5vZGUpIHtcbiAgICAgICAgICB2YXIgJGNvbnRlbnQgPSAkbm9kZS5maW5kKCcucG9wb3Zlci1jb250ZW50LC5ub3RlLXBvcG92ZXItY29udGVudCcpO1xuICAgICAgICAgICRjb250ZW50LnByZXBlbmQoJzxzcGFuPjxhIHRhcmdldD1cIl9ibGFua1wiPjwvYT4mbmJzcDs8L3NwYW4+Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pLnJlbmRlcigpLmFwcGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpO1xuICAgICAgdmFyICRjb250ZW50ID0gdGhpcy4kcG9wb3Zlci5maW5kKCcucG9wb3Zlci1jb250ZW50LC5ub3RlLXBvcG92ZXItY29udGVudCcpO1xuICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgnYnV0dG9ucy5idWlsZCcsICRjb250ZW50LCB0aGlzLm9wdGlvbnMucG9wb3Zlci5saW5rKTtcbiAgICAgIHRoaXMuJHBvcG92ZXIub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyLnJlbW92ZSgpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJ1cGRhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgLy8gUHJldmVudCBmb2N1c2luZyBvbiBlZGl0YWJsZSB3aGVuIGludm9rZSgnY29kZScpIGlzIGV4ZWN1dGVkXG4gICAgICBpZiAoIXRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5oYXNGb2N1cycpKSB7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBybmcgPSB0aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuZ2V0TGFzdFJhbmdlJyk7XG5cbiAgICAgIGlmIChybmcuaXNDb2xsYXBzZWQoKSAmJiBybmcuaXNPbkFuY2hvcigpKSB7XG4gICAgICAgIHZhciBhbmNob3IgPSBkb20uYW5jZXN0b3Iocm5nLnNjLCBkb20uaXNBbmNob3IpO1xuICAgICAgICB2YXIgaHJlZiA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGFuY2hvcikuYXR0cignaHJlZicpO1xuICAgICAgICB0aGlzLiRwb3BvdmVyLmZpbmQoJ2EnKS5hdHRyKCdocmVmJywgaHJlZikudGV4dChocmVmKTtcbiAgICAgICAgdmFyIHBvcyA9IGRvbS5wb3NGcm9tUGxhY2Vob2xkZXIoYW5jaG9yKTtcbiAgICAgICAgdmFyIGNvbnRhaW5lck9mZnNldCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHRoaXMub3B0aW9ucy5jb250YWluZXIpLm9mZnNldCgpO1xuICAgICAgICBwb3MudG9wIC09IGNvbnRhaW5lck9mZnNldC50b3A7XG4gICAgICAgIHBvcy5sZWZ0IC09IGNvbnRhaW5lck9mZnNldC5sZWZ0O1xuICAgICAgICB0aGlzLiRwb3BvdmVyLmNzcyh7XG4gICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJyxcbiAgICAgICAgICBsZWZ0OiBwb3MubGVmdCxcbiAgICAgICAgICB0b3A6IHBvcy50b3BcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGlkZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5oaWRlKCk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIExpbmtQb3BvdmVyO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvbW9kdWxlL0ltYWdlRGlhbG9nLmpzXG5mdW5jdGlvbiBJbWFnZURpYWxvZ19jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEltYWdlRGlhbG9nX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBJbWFnZURpYWxvZ19jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIEltYWdlRGlhbG9nX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBJbWFnZURpYWxvZ19kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cblxuXG5cbnZhciBJbWFnZURpYWxvZ19JbWFnZURpYWxvZyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEltYWdlRGlhbG9nKGNvbnRleHQpIHtcbiAgICBJbWFnZURpYWxvZ19jbGFzc0NhbGxDaGVjayh0aGlzLCBJbWFnZURpYWxvZyk7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMudWkgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLnVpO1xuICAgIHRoaXMuJGJvZHkgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShkb2N1bWVudC5ib2R5KTtcbiAgICB0aGlzLiRlZGl0b3IgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdG9yO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmxhbmcgPSB0aGlzLm9wdGlvbnMubGFuZ0luZm87XG4gIH1cblxuICBJbWFnZURpYWxvZ19jcmVhdGVDbGFzcyhJbWFnZURpYWxvZywgW3tcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdmFyIGltYWdlTGltaXRhdGlvbiA9ICcnO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplKSB7XG4gICAgICAgIHZhciB1bml0ID0gTWF0aC5mbG9vcihNYXRoLmxvZyh0aGlzLm9wdGlvbnMubWF4aW11bUltYWdlRmlsZVNpemUpIC8gTWF0aC5sb2coMTAyNCkpO1xuICAgICAgICB2YXIgcmVhZGFibGVTaXplID0gKHRoaXMub3B0aW9ucy5tYXhpbXVtSW1hZ2VGaWxlU2l6ZSAvIE1hdGgucG93KDEwMjQsIHVuaXQpKS50b0ZpeGVkKDIpICogMSArICcgJyArICcgS01HVFAnW3VuaXRdICsgJ0InO1xuICAgICAgICBpbWFnZUxpbWl0YXRpb24gPSBcIjxzbWFsbD5cIi5jb25jYXQodGhpcy5sYW5nLmltYWdlLm1heGltdW1GaWxlU2l6ZSArICcgOiAnICsgcmVhZGFibGVTaXplLCBcIjwvc21hbGw+XCIpO1xuICAgICAgfVxuXG4gICAgICB2YXIgJGNvbnRhaW5lciA9IHRoaXMub3B0aW9ucy5kaWFsb2dzSW5Cb2R5ID8gdGhpcy4kYm9keSA6IHRoaXMub3B0aW9ucy5jb250YWluZXI7XG4gICAgICB2YXIgYm9keSA9IFsnPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXAgbm90ZS1mb3JtLWdyb3VwIG5vdGUtZ3JvdXAtc2VsZWN0LWZyb20tZmlsZXNcIj4nLCAnPGxhYmVsIGZvcj1cIm5vdGUtZGlhbG9nLWltYWdlLWZpbGUtJyArIHRoaXMub3B0aW9ucy5pZCArICdcIiBjbGFzcz1cIm5vdGUtZm9ybS1sYWJlbFwiPicgKyB0aGlzLmxhbmcuaW1hZ2Uuc2VsZWN0RnJvbUZpbGVzICsgJzwvbGFiZWw+JywgJzxpbnB1dCBpZD1cIm5vdGUtZGlhbG9nLWltYWdlLWZpbGUtJyArIHRoaXMub3B0aW9ucy5pZCArICdcIiBjbGFzcz1cIm5vdGUtaW1hZ2UtaW5wdXQgZm9ybS1jb250cm9sLWZpbGUgbm90ZS1mb3JtLWNvbnRyb2wgbm90ZS1pbnB1dFwiICcsICcgdHlwZT1cImZpbGVcIiBuYW1lPVwiZmlsZXNcIiBhY2NlcHQ9XCJpbWFnZS8qXCIgbXVsdGlwbGU9XCJtdWx0aXBsZVwiLz4nLCBpbWFnZUxpbWl0YXRpb24sICc8L2Rpdj4nLCAnPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXAgbm90ZS1ncm91cC1pbWFnZS11cmxcIj4nLCAnPGxhYmVsIGZvcj1cIm5vdGUtZGlhbG9nLWltYWdlLXVybC0nICsgdGhpcy5vcHRpb25zLmlkICsgJ1wiIGNsYXNzPVwibm90ZS1mb3JtLWxhYmVsXCI+JyArIHRoaXMubGFuZy5pbWFnZS51cmwgKyAnPC9sYWJlbD4nLCAnPGlucHV0IGlkPVwibm90ZS1kaWFsb2ctaW1hZ2UtdXJsLScgKyB0aGlzLm9wdGlvbnMuaWQgKyAnXCIgY2xhc3M9XCJub3RlLWltYWdlLXVybCBmb3JtLWNvbnRyb2wgbm90ZS1mb3JtLWNvbnRyb2wgbm90ZS1pbnB1dFwiIHR5cGU9XCJ0ZXh0XCIvPicsICc8L2Rpdj4nXS5qb2luKCcnKTtcbiAgICAgIHZhciBidXR0b25DbGFzcyA9ICdidG4gYnRuLXByaW1hcnkgbm90ZS1idG4gbm90ZS1idG4tcHJpbWFyeSBub3RlLWltYWdlLWJ0bic7XG4gICAgICB2YXIgZm9vdGVyID0gXCI8aW5wdXQgdHlwZT1cXFwiYnV0dG9uXFxcIiBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwiXCIuY29uY2F0KGJ1dHRvbkNsYXNzLCBcIlxcXCIgdmFsdWU9XFxcIlwiKS5jb25jYXQodGhpcy5sYW5nLmltYWdlLmluc2VydCwgXCJcXFwiIGRpc2FibGVkPlwiKTtcbiAgICAgIHRoaXMuJGRpYWxvZyA9IHRoaXMudWkuZGlhbG9nKHtcbiAgICAgICAgdGl0bGU6IHRoaXMubGFuZy5pbWFnZS5pbnNlcnQsXG4gICAgICAgIGZhZGU6IHRoaXMub3B0aW9ucy5kaWFsb2dzRmFkZSxcbiAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgZm9vdGVyOiBmb290ZXJcbiAgICAgIH0pLnJlbmRlcigpLmFwcGVuZFRvKCRjb250YWluZXIpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLnVpLmhpZGVEaWFsb2codGhpcy4kZGlhbG9nKTtcbiAgICAgIHRoaXMuJGRpYWxvZy5yZW1vdmUoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiYmluZEVudGVyS2V5XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGJpbmRFbnRlcktleSgkaW5wdXQsICRidG4pIHtcbiAgICAgICRpbnB1dC5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGNvcmVfa2V5LmNvZGUuRU5URVIpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICRidG4udHJpZ2dlcignY2xpY2snKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInNob3dcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdygpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgIHRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5zYXZlUmFuZ2UnKTtcbiAgICAgIHRoaXMuc2hvd0ltYWdlRGlhbG9nKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAvLyBbd29ya2Fyb3VuZF0gaGlkZSBkaWFsb2cgYmVmb3JlIHJlc3RvcmUgcmFuZ2UgZm9yIElFIHJhbmdlIGZvY3VzXG4gICAgICAgIF90aGlzLnVpLmhpZGVEaWFsb2coX3RoaXMuJGRpYWxvZyk7XG5cbiAgICAgICAgX3RoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5yZXN0b3JlUmFuZ2UnKTtcblxuICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgLy8gaW1hZ2UgdXJsXG4gICAgICAgICAgLy8gSWYgb25JbWFnZUxpbmtJbnNlcnQgc2V0LFxuICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmNhbGxiYWNrcy5vbkltYWdlTGlua0luc2VydCkge1xuICAgICAgICAgICAgX3RoaXMuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2ltYWdlLmxpbmsuaW5zZXJ0JywgZGF0YSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0SW1hZ2UnLCBkYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gYXJyYXkgb2YgZmlsZXNcbiAgICAgICAgICBfdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmluc2VydEltYWdlc09yQ2FsbGJhY2snLCBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2hvdyBpbWFnZSBkaWFsb2dcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkZGlhbG9nXG4gICAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInNob3dJbWFnZURpYWxvZ1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93SW1hZ2VEaWFsb2coKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgcmV0dXJuIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLkRlZmVycmVkKGZ1bmN0aW9uIChkZWZlcnJlZCkge1xuICAgICAgICB2YXIgJGltYWdlSW5wdXQgPSBfdGhpczIuJGRpYWxvZy5maW5kKCcubm90ZS1pbWFnZS1pbnB1dCcpO1xuXG4gICAgICAgIHZhciAkaW1hZ2VVcmwgPSBfdGhpczIuJGRpYWxvZy5maW5kKCcubm90ZS1pbWFnZS11cmwnKTtcblxuICAgICAgICB2YXIgJGltYWdlQnRuID0gX3RoaXMyLiRkaWFsb2cuZmluZCgnLm5vdGUtaW1hZ2UtYnRuJyk7XG5cbiAgICAgICAgX3RoaXMyLnVpLm9uRGlhbG9nU2hvd24oX3RoaXMyLiRkaWFsb2csIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2RpYWxvZy5zaG93bicpOyAvLyBDbG9uaW5nIGltYWdlSW5wdXQgdG8gY2xlYXIgZWxlbWVudC5cblxuXG4gICAgICAgICAgJGltYWdlSW5wdXQucmVwbGFjZVdpdGgoJGltYWdlSW5wdXQuY2xvbmUoKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGV2ZW50LnRhcmdldC5maWxlcyB8fCBldmVudC50YXJnZXQudmFsdWUpO1xuICAgICAgICAgIH0pLnZhbCgnJykpO1xuICAgICAgICAgICRpbWFnZVVybC5vbignaW5wdXQgcGFzdGUgcHJvcGVydHljaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpczIudWkudG9nZ2xlQnRuKCRpbWFnZUJ0biwgJGltYWdlVXJsLnZhbCgpKTtcbiAgICAgICAgICB9KS52YWwoJycpO1xuXG4gICAgICAgICAgaWYgKCFlbnYuaXNTdXBwb3J0VG91Y2gpIHtcbiAgICAgICAgICAgICRpbWFnZVVybC50cmlnZ2VyKCdmb2N1cycpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICRpbWFnZUJ0bi5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCRpbWFnZVVybC52YWwoKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBfdGhpczIuYmluZEVudGVyS2V5KCRpbWFnZVVybCwgJGltYWdlQnRuKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgX3RoaXMyLnVpLm9uRGlhbG9nSGlkZGVuKF90aGlzMi4kZGlhbG9nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJGltYWdlSW5wdXQub2ZmKCk7XG4gICAgICAgICAgJGltYWdlVXJsLm9mZigpO1xuICAgICAgICAgICRpbWFnZUJ0bi5vZmYoKTtcblxuICAgICAgICAgIGlmIChkZWZlcnJlZC5zdGF0ZSgpID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgX3RoaXMyLnVpLnNob3dEaWFsb2coX3RoaXMyLiRkaWFsb2cpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEltYWdlRGlhbG9nO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvbW9kdWxlL0ltYWdlUG9wb3Zlci5qc1xuZnVuY3Rpb24gSW1hZ2VQb3BvdmVyX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gSW1hZ2VQb3BvdmVyX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBJbWFnZVBvcG92ZXJfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBJbWFnZVBvcG92ZXJfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIEltYWdlUG9wb3Zlcl9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cblxuXG4vKipcbiAqIEltYWdlIHBvcG92ZXIgbW9kdWxlXG4gKiAgbW91c2UgZXZlbnRzIHRoYXQgc2hvdy9oaWRlIHBvcG92ZXIgd2lsbCBiZSBoYW5kbGVkIGJ5IEhhbmRsZS5qcy5cbiAqICBIYW5kbGUuanMgd2lsbCByZWNlaXZlIHRoZSBldmVudHMgYW5kIGludm9rZSAnaW1hZ2VQb3BvdmVyLnVwZGF0ZScuXG4gKi9cblxudmFyIEltYWdlUG9wb3Zlcl9JbWFnZVBvcG92ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBJbWFnZVBvcG92ZXIoY29udGV4dCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBJbWFnZVBvcG92ZXJfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW1hZ2VQb3BvdmVyKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy51aSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUudWk7XG4gICAgdGhpcy5lZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZVswXTtcbiAgICB0aGlzLm9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICAnc3VtbWVybm90ZS5kaXNhYmxlIHN1bW1lcm5vdGUuYmx1cic6IGZ1bmN0aW9uIHN1bW1lcm5vdGVEaXNhYmxlU3VtbWVybm90ZUJsdXIoKSB7XG4gICAgICAgIF90aGlzLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgSW1hZ2VQb3BvdmVyX2NyZWF0ZUNsYXNzKEltYWdlUG9wb3ZlciwgW3tcbiAgICBrZXk6IFwic2hvdWxkSW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRJbml0aWFsaXplKCkge1xuICAgICAgcmV0dXJuICFsaXN0cy5pc0VtcHR5KHRoaXMub3B0aW9ucy5wb3BvdmVyLmltYWdlKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdGhpcy4kcG9wb3ZlciA9IHRoaXMudWkucG9wb3Zlcih7XG4gICAgICAgIGNsYXNzTmFtZTogJ25vdGUtaW1hZ2UtcG9wb3ZlcidcbiAgICAgIH0pLnJlbmRlcigpLmFwcGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpO1xuICAgICAgdmFyICRjb250ZW50ID0gdGhpcy4kcG9wb3Zlci5maW5kKCcucG9wb3Zlci1jb250ZW50LC5ub3RlLXBvcG92ZXItY29udGVudCcpO1xuICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgnYnV0dG9ucy5idWlsZCcsICRjb250ZW50LCB0aGlzLm9wdGlvbnMucG9wb3Zlci5pbWFnZSk7XG4gICAgICB0aGlzLiRwb3BvdmVyLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5yZW1vdmUoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwidXBkYXRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0YXJnZXQsIGV2ZW50KSB7XG4gICAgICBpZiAoZG9tLmlzSW1nKHRhcmdldCkpIHtcbiAgICAgICAgdmFyIHBvc2l0aW9uID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkodGFyZ2V0KS5vZmZzZXQoKTtcbiAgICAgICAgdmFyIGNvbnRhaW5lck9mZnNldCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHRoaXMub3B0aW9ucy5jb250YWluZXIpLm9mZnNldCgpO1xuICAgICAgICB2YXIgcG9zID0ge307XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wb3BhdG1vdXNlKSB7XG4gICAgICAgICAgcG9zLmxlZnQgPSBldmVudC5wYWdlWCAtIDIwO1xuICAgICAgICAgIHBvcy50b3AgPSBldmVudC5wYWdlWTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHBvcy50b3AgLT0gY29udGFpbmVyT2Zmc2V0LnRvcDtcbiAgICAgICAgcG9zLmxlZnQgLT0gY29udGFpbmVyT2Zmc2V0LmxlZnQ7XG4gICAgICAgIHRoaXMuJHBvcG92ZXIuY3NzKHtcbiAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICAgIHRvcDogcG9zLnRvcFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJoaWRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyLmhpZGUoKTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gSW1hZ2VQb3BvdmVyO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2UvbW9kdWxlL1RhYmxlUG9wb3Zlci5qc1xuZnVuY3Rpb24gVGFibGVQb3BvdmVyX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gVGFibGVQb3BvdmVyX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBUYWJsZVBvcG92ZXJfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBUYWJsZVBvcG92ZXJfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIFRhYmxlUG9wb3Zlcl9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG5cblxuXG5cblxudmFyIFRhYmxlUG9wb3Zlcl9UYWJsZVBvcG92ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBUYWJsZVBvcG92ZXIoY29udGV4dCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBUYWJsZVBvcG92ZXJfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGFibGVQb3BvdmVyKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy51aSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUudWk7XG4gICAgdGhpcy5vcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgJ3N1bW1lcm5vdGUubW91c2Vkb3duJzogZnVuY3Rpb24gc3VtbWVybm90ZU1vdXNlZG93bih3ZSwgZSkge1xuICAgICAgICBfdGhpcy51cGRhdGUoZS50YXJnZXQpO1xuICAgICAgfSxcbiAgICAgICdzdW1tZXJub3RlLmtleXVwIHN1bW1lcm5vdGUuc2Nyb2xsIHN1bW1lcm5vdGUuY2hhbmdlJzogZnVuY3Rpb24gc3VtbWVybm90ZUtleXVwU3VtbWVybm90ZVNjcm9sbFN1bW1lcm5vdGVDaGFuZ2UoKSB7XG4gICAgICAgIF90aGlzLnVwZGF0ZSgpO1xuICAgICAgfSxcbiAgICAgICdzdW1tZXJub3RlLmRpc2FibGUgc3VtbWVybm90ZS5ibHVyJzogZnVuY3Rpb24gc3VtbWVybm90ZURpc2FibGVTdW1tZXJub3RlQmx1cigpIHtcbiAgICAgICAgX3RoaXMuaGlkZSgpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBUYWJsZVBvcG92ZXJfY3JlYXRlQ2xhc3MoVGFibGVQb3BvdmVyLCBbe1xuICAgIGtleTogXCJzaG91bGRJbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZEluaXRpYWxpemUoKSB7XG4gICAgICByZXR1cm4gIWxpc3RzLmlzRW1wdHkodGhpcy5vcHRpb25zLnBvcG92ZXIudGFibGUpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJpbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyID0gdGhpcy51aS5wb3BvdmVyKHtcbiAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS10YWJsZS1wb3BvdmVyJ1xuICAgICAgfSkucmVuZGVyKCkuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcik7XG4gICAgICB2YXIgJGNvbnRlbnQgPSB0aGlzLiRwb3BvdmVyLmZpbmQoJy5wb3BvdmVyLWNvbnRlbnQsLm5vdGUtcG9wb3Zlci1jb250ZW50Jyk7XG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdidXR0b25zLmJ1aWxkJywgJGNvbnRlbnQsIHRoaXMub3B0aW9ucy5wb3BvdmVyLnRhYmxlKTsgLy8gW3dvcmthcm91bmRdIERpc2FibGUgRmlyZWZveCdzIGRlZmF1bHQgdGFibGUgZWRpdG9yXG5cbiAgICAgIGlmIChlbnYuaXNGRikge1xuICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnZW5hYmxlSW5saW5lVGFibGVFZGl0aW5nJywgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy4kcG9wb3Zlci5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImRlc3Ryb3lcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHRoaXMuJHBvcG92ZXIucmVtb3ZlKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInVwZGF0ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUodGFyZ2V0KSB7XG4gICAgICBpZiAodGhpcy5jb250ZXh0LmlzRGlzYWJsZWQoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHZhciBpc0NlbGwgPSBkb20uaXNDZWxsKHRhcmdldCk7XG5cbiAgICAgIGlmIChpc0NlbGwpIHtcbiAgICAgICAgdmFyIHBvcyA9IGRvbS5wb3NGcm9tUGxhY2Vob2xkZXIodGFyZ2V0KTtcbiAgICAgICAgdmFyIGNvbnRhaW5lck9mZnNldCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKHRoaXMub3B0aW9ucy5jb250YWluZXIpLm9mZnNldCgpO1xuICAgICAgICBwb3MudG9wIC09IGNvbnRhaW5lck9mZnNldC50b3A7XG4gICAgICAgIHBvcy5sZWZ0IC09IGNvbnRhaW5lck9mZnNldC5sZWZ0O1xuICAgICAgICB0aGlzLiRwb3BvdmVyLmNzcyh7XG4gICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJyxcbiAgICAgICAgICBsZWZ0OiBwb3MubGVmdCxcbiAgICAgICAgICB0b3A6IHBvcy50b3BcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGlzQ2VsbDtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGlkZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5oaWRlKCk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFRhYmxlUG9wb3Zlcjtcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9WaWRlb0RpYWxvZy5qc1xuZnVuY3Rpb24gVmlkZW9EaWFsb2dfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBWaWRlb0RpYWxvZ19kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gVmlkZW9EaWFsb2dfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBWaWRlb0RpYWxvZ19kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgVmlkZW9EaWFsb2dfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxuXG52YXIgVmlkZW9EaWFsb2dfVmlkZW9EaWFsb2cgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWaWRlb0RpYWxvZyhjb250ZXh0KSB7XG4gICAgVmlkZW9EaWFsb2dfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmlkZW9EaWFsb2cpO1xuXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLnVpID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZS51aTtcbiAgICB0aGlzLiRib2R5ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoZG9jdW1lbnQuYm9keSk7XG4gICAgdGhpcy4kZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB0aGlzLm9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdGhpcy5sYW5nID0gdGhpcy5vcHRpb25zLmxhbmdJbmZvO1xuICB9XG5cbiAgVmlkZW9EaWFsb2dfY3JlYXRlQ2xhc3MoVmlkZW9EaWFsb2csIFt7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHZhciAkY29udGFpbmVyID0gdGhpcy5vcHRpb25zLmRpYWxvZ3NJbkJvZHkgPyB0aGlzLiRib2R5IDogdGhpcy5vcHRpb25zLmNvbnRhaW5lcjtcbiAgICAgIHZhciBib2R5ID0gWyc8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cCBub3RlLWZvcm0tZ3JvdXAgcm93LWZsdWlkXCI+JywgXCI8bGFiZWwgZm9yPVxcXCJub3RlLWRpYWxvZy12aWRlby11cmwtXCIuY29uY2F0KHRoaXMub3B0aW9ucy5pZCwgXCJcXFwiIGNsYXNzPVxcXCJub3RlLWZvcm0tbGFiZWxcXFwiPlwiKS5jb25jYXQodGhpcy5sYW5nLnZpZGVvLnVybCwgXCIgPHNtYWxsIGNsYXNzPVxcXCJ0ZXh0LW11dGVkXFxcIj5cIikuY29uY2F0KHRoaXMubGFuZy52aWRlby5wcm92aWRlcnMsIFwiPC9zbWFsbD48L2xhYmVsPlwiKSwgXCI8aW5wdXQgaWQ9XFxcIm5vdGUtZGlhbG9nLXZpZGVvLXVybC1cIi5jb25jYXQodGhpcy5vcHRpb25zLmlkLCBcIlxcXCIgY2xhc3M9XFxcIm5vdGUtdmlkZW8tdXJsIGZvcm0tY29udHJvbCBub3RlLWZvcm0tY29udHJvbCBub3RlLWlucHV0XFxcIiB0eXBlPVxcXCJ0ZXh0XFxcIi8+XCIpLCAnPC9kaXY+J10uam9pbignJyk7XG4gICAgICB2YXIgYnV0dG9uQ2xhc3MgPSAnYnRuIGJ0bi1wcmltYXJ5IG5vdGUtYnRuIG5vdGUtYnRuLXByaW1hcnkgbm90ZS12aWRlby1idG4nO1xuICAgICAgdmFyIGZvb3RlciA9IFwiPGlucHV0IHR5cGU9XFxcImJ1dHRvblxcXCIgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcIlwiLmNvbmNhdChidXR0b25DbGFzcywgXCJcXFwiIHZhbHVlPVxcXCJcIikuY29uY2F0KHRoaXMubGFuZy52aWRlby5pbnNlcnQsIFwiXFxcIiBkaXNhYmxlZD5cIik7XG4gICAgICB0aGlzLiRkaWFsb2cgPSB0aGlzLnVpLmRpYWxvZyh7XG4gICAgICAgIHRpdGxlOiB0aGlzLmxhbmcudmlkZW8uaW5zZXJ0LFxuICAgICAgICBmYWRlOiB0aGlzLm9wdGlvbnMuZGlhbG9nc0ZhZGUsXG4gICAgICAgIGJvZHk6IGJvZHksXG4gICAgICAgIGZvb3RlcjogZm9vdGVyXG4gICAgICB9KS5yZW5kZXIoKS5hcHBlbmRUbygkY29udGFpbmVyKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdGhpcy51aS5oaWRlRGlhbG9nKHRoaXMuJGRpYWxvZyk7XG4gICAgICB0aGlzLiRkaWFsb2cucmVtb3ZlKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImJpbmRFbnRlcktleVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kRW50ZXJLZXkoJGlucHV0LCAkYnRuKSB7XG4gICAgICAkaW5wdXQub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBjb3JlX2tleS5jb2RlLkVOVEVSKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAkYnRuLnRyaWdnZXIoJ2NsaWNrJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJjcmVhdGVWaWRlb05vZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlVmlkZW9Ob2RlKHVybCkge1xuICAgICAgLy8gdmlkZW8gdXJsIHBhdHRlcm5zKHlvdXR1YmUsIGluc3RhZ3JhbSwgdmltZW8sIGRhaWx5bW90aW9uLCB5b3VrdSwgbXA0LCBvZ2csIHdlYm0pXG4gICAgICB2YXIgeXRSZWdFeHAgPSAvXFwvXFwvKD86KD86d3d3fG0pXFwuKT8oPzp5b3V0dVxcLmJlXFwvfHlvdXR1YmVcXC5jb21cXC8oPzplbWJlZFxcL3x2XFwvfHdhdGNoXFw/dj18d2F0Y2hcXD8uKyZ2PSkpKFtcXHd8LV17MTF9KSg/Oig/OltcXD8mXXQ9KShcXFMrKSk/JC87XG4gICAgICB2YXIgeXRSZWdFeHBGb3JTdGFydCA9IC9eKD86KFxcZCspaCk/KD86KFxcZCspbSk/KD86KFxcZCspcyk/JC87XG4gICAgICB2YXIgeXRNYXRjaCA9IHVybC5tYXRjaCh5dFJlZ0V4cCk7XG4gICAgICB2YXIgaWdSZWdFeHAgPSAvKD86d3d3XFwufFxcL1xcLylpbnN0YWdyYW1cXC5jb21cXC9wXFwvKC5bYS16QS1aMC05Xy1dKikvO1xuICAgICAgdmFyIGlnTWF0Y2ggPSB1cmwubWF0Y2goaWdSZWdFeHApO1xuICAgICAgdmFyIHZSZWdFeHAgPSAvXFwvXFwvdmluZVxcLmNvXFwvdlxcLyhbYS16QS1aMC05XSspLztcbiAgICAgIHZhciB2TWF0Y2ggPSB1cmwubWF0Y2godlJlZ0V4cCk7XG4gICAgICB2YXIgdmltUmVnRXhwID0gL1xcL1xcLyhwbGF5ZXJcXC4pP3ZpbWVvXFwuY29tXFwvKFthLXpdKlxcLykqKFxcZCspWz9dPy4qLztcbiAgICAgIHZhciB2aW1NYXRjaCA9IHVybC5tYXRjaCh2aW1SZWdFeHApO1xuICAgICAgdmFyIGRtUmVnRXhwID0gLy4rZGFpbHltb3Rpb24uY29tXFwvKHZpZGVvfGh1YilcXC8oW15fXSspW14jXSooI3ZpZGVvPShbXl8mXSspKT8vO1xuICAgICAgdmFyIGRtTWF0Y2ggPSB1cmwubWF0Y2goZG1SZWdFeHApO1xuICAgICAgdmFyIHlvdWt1UmVnRXhwID0gL1xcL1xcL3ZcXC55b3VrdVxcLmNvbVxcL3Zfc2hvd1xcL2lkXyhcXHcrKT0qXFwuaHRtbC87XG4gICAgICB2YXIgeW91a3VNYXRjaCA9IHVybC5tYXRjaCh5b3VrdVJlZ0V4cCk7XG4gICAgICB2YXIgcXFSZWdFeHAgPSAvXFwvXFwvdlxcLnFxXFwuY29tLio/dmlkPSguKykvO1xuICAgICAgdmFyIHFxTWF0Y2ggPSB1cmwubWF0Y2gocXFSZWdFeHApO1xuICAgICAgdmFyIHFxUmVnRXhwMiA9IC9cXC9cXC92XFwucXFcXC5jb21cXC94P1xcLz8ocGFnZXxjb3ZlcikuKj9cXC8oW15cXC9dKylcXC5odG1sXFw/Py4qLztcbiAgICAgIHZhciBxcU1hdGNoMiA9IHVybC5tYXRjaChxcVJlZ0V4cDIpO1xuICAgICAgdmFyIG1wNFJlZ0V4cCA9IC9eLisuKG1wNHxtNHYpJC87XG4gICAgICB2YXIgbXA0TWF0Y2ggPSB1cmwubWF0Y2gobXA0UmVnRXhwKTtcbiAgICAgIHZhciBvZ2dSZWdFeHAgPSAvXi4rLihvZ2d8b2d2KSQvO1xuICAgICAgdmFyIG9nZ01hdGNoID0gdXJsLm1hdGNoKG9nZ1JlZ0V4cCk7XG4gICAgICB2YXIgd2VibVJlZ0V4cCA9IC9eLisuKHdlYm0pJC87XG4gICAgICB2YXIgd2VibU1hdGNoID0gdXJsLm1hdGNoKHdlYm1SZWdFeHApO1xuICAgICAgdmFyIGZiUmVnRXhwID0gLyg/Ond3d1xcLnxcXC9cXC8pZmFjZWJvb2tcXC5jb21cXC8oW15cXC9dKylcXC92aWRlb3NcXC8oWzAtOV0rKS87XG4gICAgICB2YXIgZmJNYXRjaCA9IHVybC5tYXRjaChmYlJlZ0V4cCk7XG4gICAgICB2YXIgJHZpZGVvO1xuXG4gICAgICBpZiAoeXRNYXRjaCAmJiB5dE1hdGNoWzFdLmxlbmd0aCA9PT0gMTEpIHtcbiAgICAgICAgdmFyIHlvdXR1YmVJZCA9IHl0TWF0Y2hbMV07XG4gICAgICAgIHZhciBzdGFydCA9IDA7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB5dE1hdGNoWzJdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIHZhciB5dE1hdGNoRm9yU3RhcnQgPSB5dE1hdGNoWzJdLm1hdGNoKHl0UmVnRXhwRm9yU3RhcnQpO1xuXG4gICAgICAgICAgaWYgKHl0TWF0Y2hGb3JTdGFydCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbiA9IFszNjAwLCA2MCwgMV0sIGkgPSAwLCByID0gbi5sZW5ndGg7IGkgPCByOyBpKyspIHtcbiAgICAgICAgICAgICAgc3RhcnQgKz0gdHlwZW9mIHl0TWF0Y2hGb3JTdGFydFtpICsgMV0gIT09ICd1bmRlZmluZWQnID8gbltpXSAqIHBhcnNlSW50KHl0TWF0Y2hGb3JTdGFydFtpICsgMV0sIDEwKSA6IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJHZpZGVvID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzxpZnJhbWU+JykuYXR0cignZnJhbWVib3JkZXInLCAwKS5hdHRyKCdzcmMnLCAnLy93d3cueW91dHViZS5jb20vZW1iZWQvJyArIHlvdXR1YmVJZCArIChzdGFydCA+IDAgPyAnP3N0YXJ0PScgKyBzdGFydCA6ICcnKSkuYXR0cignd2lkdGgnLCAnNjQwJykuYXR0cignaGVpZ2h0JywgJzM2MCcpO1xuICAgICAgfSBlbHNlIGlmIChpZ01hdGNoICYmIGlnTWF0Y2hbMF0ubGVuZ3RoKSB7XG4gICAgICAgICR2aWRlbyA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8aWZyYW1lPicpLmF0dHIoJ2ZyYW1lYm9yZGVyJywgMCkuYXR0cignc3JjJywgJ2h0dHBzOi8vaW5zdGFncmFtLmNvbS9wLycgKyBpZ01hdGNoWzFdICsgJy9lbWJlZC8nKS5hdHRyKCd3aWR0aCcsICc2MTInKS5hdHRyKCdoZWlnaHQnLCAnNzEwJykuYXR0cignc2Nyb2xsaW5nJywgJ25vJykuYXR0cignYWxsb3d0cmFuc3BhcmVuY3knLCAndHJ1ZScpO1xuICAgICAgfSBlbHNlIGlmICh2TWF0Y2ggJiYgdk1hdGNoWzBdLmxlbmd0aCkge1xuICAgICAgICAkdmlkZW8gPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnPGlmcmFtZT4nKS5hdHRyKCdmcmFtZWJvcmRlcicsIDApLmF0dHIoJ3NyYycsIHZNYXRjaFswXSArICcvZW1iZWQvc2ltcGxlJykuYXR0cignd2lkdGgnLCAnNjAwJykuYXR0cignaGVpZ2h0JywgJzYwMCcpLmF0dHIoJ2NsYXNzJywgJ3ZpbmUtZW1iZWQnKTtcbiAgICAgIH0gZWxzZSBpZiAodmltTWF0Y2ggJiYgdmltTWF0Y2hbM10ubGVuZ3RoKSB7XG4gICAgICAgICR2aWRlbyA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8aWZyYW1lIHdlYmtpdGFsbG93ZnVsbHNjcmVlbiBtb3phbGxvd2Z1bGxzY3JlZW4gYWxsb3dmdWxsc2NyZWVuPicpLmF0dHIoJ2ZyYW1lYm9yZGVyJywgMCkuYXR0cignc3JjJywgJy8vcGxheWVyLnZpbWVvLmNvbS92aWRlby8nICsgdmltTWF0Y2hbM10pLmF0dHIoJ3dpZHRoJywgJzY0MCcpLmF0dHIoJ2hlaWdodCcsICczNjAnKTtcbiAgICAgIH0gZWxzZSBpZiAoZG1NYXRjaCAmJiBkbU1hdGNoWzJdLmxlbmd0aCkge1xuICAgICAgICAkdmlkZW8gPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnPGlmcmFtZT4nKS5hdHRyKCdmcmFtZWJvcmRlcicsIDApLmF0dHIoJ3NyYycsICcvL3d3dy5kYWlseW1vdGlvbi5jb20vZW1iZWQvdmlkZW8vJyArIGRtTWF0Y2hbMl0pLmF0dHIoJ3dpZHRoJywgJzY0MCcpLmF0dHIoJ2hlaWdodCcsICczNjAnKTtcbiAgICAgIH0gZWxzZSBpZiAoeW91a3VNYXRjaCAmJiB5b3VrdU1hdGNoWzFdLmxlbmd0aCkge1xuICAgICAgICAkdmlkZW8gPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnPGlmcmFtZSB3ZWJraXRhbGxvd2Z1bGxzY3JlZW4gbW96YWxsb3dmdWxsc2NyZWVuIGFsbG93ZnVsbHNjcmVlbj4nKS5hdHRyKCdmcmFtZWJvcmRlcicsIDApLmF0dHIoJ2hlaWdodCcsICc0OTgnKS5hdHRyKCd3aWR0aCcsICc1MTAnKS5hdHRyKCdzcmMnLCAnLy9wbGF5ZXIueW91a3UuY29tL2VtYmVkLycgKyB5b3VrdU1hdGNoWzFdKTtcbiAgICAgIH0gZWxzZSBpZiAocXFNYXRjaCAmJiBxcU1hdGNoWzFdLmxlbmd0aCB8fCBxcU1hdGNoMiAmJiBxcU1hdGNoMlsyXS5sZW5ndGgpIHtcbiAgICAgICAgdmFyIHZpZCA9IHFxTWF0Y2ggJiYgcXFNYXRjaFsxXS5sZW5ndGggPyBxcU1hdGNoWzFdIDogcXFNYXRjaDJbMl07XG4gICAgICAgICR2aWRlbyA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8aWZyYW1lIHdlYmtpdGFsbG93ZnVsbHNjcmVlbiBtb3phbGxvd2Z1bGxzY3JlZW4gYWxsb3dmdWxsc2NyZWVuPicpLmF0dHIoJ2ZyYW1lYm9yZGVyJywgMCkuYXR0cignaGVpZ2h0JywgJzMxMCcpLmF0dHIoJ3dpZHRoJywgJzUwMCcpLmF0dHIoJ3NyYycsICdodHRwczovL3YucXEuY29tL3R4cC9pZnJhbWUvcGxheWVyLmh0bWw/dmlkPScgKyB2aWQgKyAnJmFtcDthdXRvPTAnKTtcbiAgICAgIH0gZWxzZSBpZiAobXA0TWF0Y2ggfHwgb2dnTWF0Y2ggfHwgd2VibU1hdGNoKSB7XG4gICAgICAgICR2aWRlbyA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8dmlkZW8gY29udHJvbHM+JykuYXR0cignc3JjJywgdXJsKS5hdHRyKCd3aWR0aCcsICc2NDAnKS5hdHRyKCdoZWlnaHQnLCAnMzYwJyk7XG4gICAgICB9IGVsc2UgaWYgKGZiTWF0Y2ggJiYgZmJNYXRjaFswXS5sZW5ndGgpIHtcbiAgICAgICAgJHZpZGVvID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzxpZnJhbWU+JykuYXR0cignZnJhbWVib3JkZXInLCAwKS5hdHRyKCdzcmMnLCAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3BsdWdpbnMvdmlkZW8ucGhwP2hyZWY9JyArIGVuY29kZVVSSUNvbXBvbmVudChmYk1hdGNoWzBdKSArICcmc2hvd190ZXh0PTAmd2lkdGg9NTYwJykuYXR0cignd2lkdGgnLCAnNTYwJykuYXR0cignaGVpZ2h0JywgJzMwMScpLmF0dHIoJ3Njcm9sbGluZycsICdubycpLmF0dHIoJ2FsbG93dHJhbnNwYXJlbmN5JywgJ3RydWUnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHRoaXMgaXMgbm90IGEga25vd24gdmlkZW8gbGluay4gTm93IHdoYXQsIENhdD8gTm93IHdoYXQ/XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgJHZpZGVvLmFkZENsYXNzKCdub3RlLXZpZGVvLWNsaXAnKTtcbiAgICAgIHJldHVybiAkdmlkZW9bMF07XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInNob3dcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdygpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgIHZhciB0ZXh0ID0gdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLmdldFNlbGVjdGVkVGV4dCcpO1xuICAgICAgdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLnNhdmVSYW5nZScpO1xuICAgICAgdGhpcy5zaG93VmlkZW9EaWFsb2codGV4dCkudGhlbihmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIC8vIFt3b3JrYXJvdW5kXSBoaWRlIGRpYWxvZyBiZWZvcmUgcmVzdG9yZSByYW5nZSBmb3IgSUUgcmFuZ2UgZm9jdXNcbiAgICAgICAgX3RoaXMudWkuaGlkZURpYWxvZyhfdGhpcy4kZGlhbG9nKTtcblxuICAgICAgICBfdGhpcy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLnJlc3RvcmVSYW5nZScpOyAvLyBidWlsZCBub2RlXG5cblxuICAgICAgICB2YXIgJG5vZGUgPSBfdGhpcy5jcmVhdGVWaWRlb05vZGUodXJsKTtcblxuICAgICAgICBpZiAoJG5vZGUpIHtcbiAgICAgICAgICAvLyBpbnNlcnQgdmlkZW8gbm9kZVxuICAgICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0Tm9kZScsICRub2RlKTtcbiAgICAgICAgfVxuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2hvdyB2aWRlbyBkaWFsb2dcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkZGlhbG9nXG4gICAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInNob3dWaWRlb0RpYWxvZ1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93VmlkZW9EaWFsb2coKVxuICAgIC8qIHRleHQgKi9cbiAgICB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgcmV0dXJuIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLkRlZmVycmVkKGZ1bmN0aW9uIChkZWZlcnJlZCkge1xuICAgICAgICB2YXIgJHZpZGVvVXJsID0gX3RoaXMyLiRkaWFsb2cuZmluZCgnLm5vdGUtdmlkZW8tdXJsJyk7XG5cbiAgICAgICAgdmFyICR2aWRlb0J0biA9IF90aGlzMi4kZGlhbG9nLmZpbmQoJy5ub3RlLXZpZGVvLWJ0bicpO1xuXG4gICAgICAgIF90aGlzMi51aS5vbkRpYWxvZ1Nob3duKF90aGlzMi4kZGlhbG9nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMyLmNvbnRleHQudHJpZ2dlckV2ZW50KCdkaWFsb2cuc2hvd24nKTtcblxuICAgICAgICAgICR2aWRlb1VybC5vbignaW5wdXQgcGFzdGUgcHJvcGVydHljaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpczIudWkudG9nZ2xlQnRuKCR2aWRlb0J0biwgJHZpZGVvVXJsLnZhbCgpKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICghZW52LmlzU3VwcG9ydFRvdWNoKSB7XG4gICAgICAgICAgICAkdmlkZW9VcmwudHJpZ2dlcignZm9jdXMnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAkdmlkZW9CdG4uY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgkdmlkZW9VcmwudmFsKCkpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgX3RoaXMyLmJpbmRFbnRlcktleSgkdmlkZW9VcmwsICR2aWRlb0J0bik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF90aGlzMi51aS5vbkRpYWxvZ0hpZGRlbihfdGhpczIuJGRpYWxvZywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICR2aWRlb1VybC5vZmYoKTtcbiAgICAgICAgICAkdmlkZW9CdG4ub2ZmKCk7XG5cbiAgICAgICAgICBpZiAoZGVmZXJyZWQuc3RhdGUoKSA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF90aGlzMi51aS5zaG93RGlhbG9nKF90aGlzMi4kZGlhbG9nKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBWaWRlb0RpYWxvZztcbn0oKTtcblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL21vZHVsZS9IZWxwRGlhbG9nLmpzXG5mdW5jdGlvbiBIZWxwRGlhbG9nX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gSGVscERpYWxvZ19kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gSGVscERpYWxvZ19jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIEhlbHBEaWFsb2dfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIEhlbHBEaWFsb2dfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuXG5cblxudmFyIEhlbHBEaWFsb2dfSGVscERpYWxvZyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEhlbHBEaWFsb2coY29udGV4dCkge1xuICAgIEhlbHBEaWFsb2dfY2xhc3NDYWxsQ2hlY2sodGhpcywgSGVscERpYWxvZyk7XG5cbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMudWkgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLnVpO1xuICAgIHRoaXMuJGJvZHkgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKShkb2N1bWVudC5ib2R5KTtcbiAgICB0aGlzLiRlZGl0b3IgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdG9yO1xuICAgIHRoaXMub3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB0aGlzLmxhbmcgPSB0aGlzLm9wdGlvbnMubGFuZ0luZm87XG4gIH1cblxuICBIZWxwRGlhbG9nX2NyZWF0ZUNsYXNzKEhlbHBEaWFsb2csIFt7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHZhciAkY29udGFpbmVyID0gdGhpcy5vcHRpb25zLmRpYWxvZ3NJbkJvZHkgPyB0aGlzLiRib2R5IDogdGhpcy5vcHRpb25zLmNvbnRhaW5lcjtcbiAgICAgIHZhciBib2R5ID0gWyc8cCBjbGFzcz1cInRleHQtY2VudGVyXCI+JywgJzxhIGhyZWY9XCJodHRwOi8vc3VtbWVybm90ZS5vcmcvXCIgdGFyZ2V0PVwiX2JsYW5rXCI+U3VtbWVybm90ZSAwLjguMTg8L2E+IMK3ICcsICc8YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL3N1bW1lcm5vdGUvc3VtbWVybm90ZVwiIHRhcmdldD1cIl9ibGFua1wiPlByb2plY3Q8L2E+IMK3ICcsICc8YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL3N1bW1lcm5vdGUvc3VtbWVybm90ZS9pc3N1ZXNcIiB0YXJnZXQ9XCJfYmxhbmtcIj5Jc3N1ZXM8L2E+JywgJzwvcD4nXS5qb2luKCcnKTtcbiAgICAgIHRoaXMuJGRpYWxvZyA9IHRoaXMudWkuZGlhbG9nKHtcbiAgICAgICAgdGl0bGU6IHRoaXMubGFuZy5vcHRpb25zLmhlbHAsXG4gICAgICAgIGZhZGU6IHRoaXMub3B0aW9ucy5kaWFsb2dzRmFkZSxcbiAgICAgICAgYm9keTogdGhpcy5jcmVhdGVTaG9ydGN1dExpc3QoKSxcbiAgICAgICAgZm9vdGVyOiBib2R5LFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gY2FsbGJhY2soJG5vZGUpIHtcbiAgICAgICAgICAkbm9kZS5maW5kKCcubW9kYWwtYm9keSwubm90ZS1tb2RhbC1ib2R5JykuY3NzKHtcbiAgICAgICAgICAgICdtYXgtaGVpZ2h0JzogMzAwLFxuICAgICAgICAgICAgJ292ZXJmbG93JzogJ3Njcm9sbCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSkucmVuZGVyKCkuYXBwZW5kVG8oJGNvbnRhaW5lcik7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImRlc3Ryb3lcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHRoaXMudWkuaGlkZURpYWxvZyh0aGlzLiRkaWFsb2cpO1xuICAgICAgdGhpcy4kZGlhbG9nLnJlbW92ZSgpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJjcmVhdGVTaG9ydGN1dExpc3RcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlU2hvcnRjdXRMaXN0KCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgdmFyIGtleU1hcCA9IHRoaXMub3B0aW9ucy5rZXlNYXBbZW52LmlzTWFjID8gJ21hYycgOiAncGMnXTtcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhrZXlNYXApLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHZhciBjb21tYW5kID0ga2V5TWFwW2tleV07XG4gICAgICAgIHZhciAkcm93ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzxkaXY+PGRpdiBjbGFzcz1cImhlbHAtbGlzdC1pdGVtXCI+PC9kaXY+PC9kaXY+Jyk7XG4gICAgICAgICRyb3cuYXBwZW5kKGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8bGFiZWw+PGtiZD4nICsga2V5ICsgJzwva2RiPjwvbGFiZWw+JykuY3NzKHtcbiAgICAgICAgICAnd2lkdGgnOiAxODAsXG4gICAgICAgICAgJ21hcmdpbi1yaWdodCc6IDEwXG4gICAgICAgIH0pKS5hcHBlbmQoZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkoJzxzcGFuLz4nKS5odG1sKF90aGlzLmNvbnRleHQubWVtbygnaGVscC4nICsgY29tbWFuZCkgfHwgY29tbWFuZCkpO1xuICAgICAgICByZXR1cm4gJHJvdy5odG1sKCk7XG4gICAgICB9KS5qb2luKCcnKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2hvdyBoZWxwIGRpYWxvZ1xuICAgICAqXG4gICAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInNob3dIZWxwRGlhbG9nXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dIZWxwRGlhbG9nKCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHJldHVybiBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5EZWZlcnJlZChmdW5jdGlvbiAoZGVmZXJyZWQpIHtcbiAgICAgICAgX3RoaXMyLnVpLm9uRGlhbG9nU2hvd24oX3RoaXMyLiRkaWFsb2csIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpczIuY29udGV4dC50cmlnZ2VyRXZlbnQoJ2RpYWxvZy5zaG93bicpO1xuXG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBfdGhpczIudWkuc2hvd0RpYWxvZyhfdGhpczIuJGRpYWxvZyk7XG4gICAgICB9KS5wcm9taXNlKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInNob3dcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdygpIHtcbiAgICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdlZGl0b3Iuc2F2ZVJhbmdlJyk7XG4gICAgICB0aGlzLnNob3dIZWxwRGlhbG9nKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzMy5jb250ZXh0Lmludm9rZSgnZWRpdG9yLnJlc3RvcmVSYW5nZScpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEhlbHBEaWFsb2c7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvQWlyUG9wb3Zlci5qc1xuZnVuY3Rpb24gQWlyUG9wb3Zlcl9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIEFpclBvcG92ZXJfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIEFpclBvcG92ZXJfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBBaXJQb3BvdmVyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBBaXJQb3BvdmVyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG52YXIgQUlSTU9ERV9QT1BPVkVSX1hfT0ZGU0VUID0gLTU7XG52YXIgQUlSTU9ERV9QT1BPVkVSX1lfT0ZGU0VUID0gNTtcblxudmFyIEFpclBvcG92ZXJfQWlyUG9wb3ZlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEFpclBvcG92ZXIoY29udGV4dCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBBaXJQb3BvdmVyX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFpclBvcG92ZXIpO1xuXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLnVpID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZS51aTtcbiAgICB0aGlzLm9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdGhpcy5oaWRhYmxlID0gdHJ1ZTtcbiAgICB0aGlzLm9uQ29udGV4dG1lbnUgPSBmYWxzZTtcbiAgICB0aGlzLnBhZ2VYID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VZID0gbnVsbDtcbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLmNvbnRleHRtZW51JzogZnVuY3Rpb24gc3VtbWVybm90ZUNvbnRleHRtZW51KGUpIHtcbiAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuZWRpdGluZykge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIF90aGlzLm9uQ29udGV4dG1lbnUgPSB0cnVlO1xuXG4gICAgICAgICAgX3RoaXMudXBkYXRlKHRydWUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUubW91c2Vkb3duJzogZnVuY3Rpb24gc3VtbWVybm90ZU1vdXNlZG93bih3ZSwgZSkge1xuICAgICAgICBfdGhpcy5wYWdlWCA9IGUucGFnZVg7XG4gICAgICAgIF90aGlzLnBhZ2VZID0gZS5wYWdlWTtcbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5rZXl1cCBzdW1tZXJub3RlLm1vdXNldXAgc3VtbWVybm90ZS5zY3JvbGwnOiBmdW5jdGlvbiBzdW1tZXJub3RlS2V5dXBTdW1tZXJub3RlTW91c2V1cFN1bW1lcm5vdGVTY3JvbGwod2UsIGUpIHtcbiAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuZWRpdGluZyAmJiAhX3RoaXMub25Db250ZXh0bWVudSkge1xuICAgICAgICAgIF90aGlzLnBhZ2VYID0gZS5wYWdlWDtcbiAgICAgICAgICBfdGhpcy5wYWdlWSA9IGUucGFnZVk7XG5cbiAgICAgICAgICBfdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF90aGlzLm9uQ29udGV4dG1lbnUgPSBmYWxzZTtcbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5kaXNhYmxlIHN1bW1lcm5vdGUuY2hhbmdlIHN1bW1lcm5vdGUuZGlhbG9nLnNob3duIHN1bW1lcm5vdGUuYmx1cic6IGZ1bmN0aW9uIHN1bW1lcm5vdGVEaXNhYmxlU3VtbWVybm90ZUNoYW5nZVN1bW1lcm5vdGVEaWFsb2dTaG93blN1bW1lcm5vdGVCbHVyKCkge1xuICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUuZm9jdXNvdXQnOiBmdW5jdGlvbiBzdW1tZXJub3RlRm9jdXNvdXQoKSB7XG4gICAgICAgIGlmICghX3RoaXMuJHBvcG92ZXIuaXMoJzphY3RpdmUsOmZvY3VzJykpIHtcbiAgICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgQWlyUG9wb3Zlcl9jcmVhdGVDbGFzcyhBaXJQb3BvdmVyLCBbe1xuICAgIGtleTogXCJzaG91bGRJbml0aWFsaXplXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZEluaXRpYWxpemUoKSB7XG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFpck1vZGUgJiYgIWxpc3RzLmlzRW1wdHkodGhpcy5vcHRpb25zLnBvcG92ZXIuYWlyKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaW5pdGlhbGl6ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHRoaXMuJHBvcG92ZXIgPSB0aGlzLnVpLnBvcG92ZXIoe1xuICAgICAgICBjbGFzc05hbWU6ICdub3RlLWFpci1wb3BvdmVyJ1xuICAgICAgfSkucmVuZGVyKCkuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcik7XG4gICAgICB2YXIgJGNvbnRlbnQgPSB0aGlzLiRwb3BvdmVyLmZpbmQoJy5wb3BvdmVyLWNvbnRlbnQnKTtcbiAgICAgIHRoaXMuY29udGV4dC5pbnZva2UoJ2J1dHRvbnMuYnVpbGQnLCAkY29udGVudCwgdGhpcy5vcHRpb25zLnBvcG92ZXIuYWlyKTsgLy8gZGlzYWJsZSBoaWRpbmcgdGhpcyBwb3BvdmVyIHByZWVtcHRpdmVseSBieSAnc3VtbWVybm90ZS5ibHVyJyBldmVudC5cblxuICAgICAgdGhpcy4kcG9wb3Zlci5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpczIuaGlkYWJsZSA9IGZhbHNlO1xuICAgICAgfSk7IC8vIChyZS0pZW5hYmxlIGhpZGluZyBhZnRlciAnc3VtbWVybm90ZS5ibHVyJyBoYXMgYmVlbiBoYW5kbGVkIChha2EuIGlnbm9yZWQpLlxuXG4gICAgICB0aGlzLiRwb3BvdmVyLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpczIuaGlkYWJsZSA9IHRydWU7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5yZW1vdmUoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwidXBkYXRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZShmb3JjZWx5T3Blbikge1xuICAgICAgdmFyIHN0eWxlSW5mbyA9IHRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5jdXJyZW50U3R5bGUnKTtcblxuICAgICAgaWYgKHN0eWxlSW5mby5yYW5nZSAmJiAoIXN0eWxlSW5mby5yYW5nZS5pc0NvbGxhcHNlZCgpIHx8IGZvcmNlbHlPcGVuKSkge1xuICAgICAgICB2YXIgcmVjdCA9IHtcbiAgICAgICAgICBsZWZ0OiB0aGlzLnBhZ2VYLFxuICAgICAgICAgIHRvcDogdGhpcy5wYWdlWVxuICAgICAgICB9O1xuICAgICAgICB2YXIgY29udGFpbmVyT2Zmc2V0ID0gZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkodGhpcy5vcHRpb25zLmNvbnRhaW5lcikub2Zmc2V0KCk7XG4gICAgICAgIHJlY3QudG9wIC09IGNvbnRhaW5lck9mZnNldC50b3A7XG4gICAgICAgIHJlY3QubGVmdCAtPSBjb250YWluZXJPZmZzZXQubGVmdDtcbiAgICAgICAgdGhpcy4kcG9wb3Zlci5jc3Moe1xuICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsXG4gICAgICAgICAgbGVmdDogTWF0aC5tYXgocmVjdC5sZWZ0LCAwKSArIEFJUk1PREVfUE9QT1ZFUl9YX09GRlNFVCxcbiAgICAgICAgICB0b3A6IHJlY3QudG9wICsgQUlSTU9ERV9QT1BPVkVSX1lfT0ZGU0VUXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbnRleHQuaW52b2tlKCdidXR0b25zLnVwZGF0ZUN1cnJlbnRTdHlsZScsIHRoaXMuJHBvcG92ZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInVwZGF0ZUNvZGV2aWV3XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUNvZGV2aWV3KGlzQ29kZXZpZXcpIHtcbiAgICAgIHRoaXMudWkudG9nZ2xlQnRuQWN0aXZlKHRoaXMuJHBvcG92ZXIuZmluZCgnLmJ0bi1jb2RldmlldycpLCBpc0NvZGV2aWV3KTtcblxuICAgICAgaWYgKGlzQ29kZXZpZXcpIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImhpZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAgIGlmICh0aGlzLmhpZGFibGUpIHtcbiAgICAgICAgdGhpcy4kcG9wb3Zlci5oaWRlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEFpclBvcG92ZXI7XG59KCk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYmFzZS9tb2R1bGUvSGludFBvcG92ZXIuanNcbmZ1bmN0aW9uIEhpbnRQb3BvdmVyX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gSGludFBvcG92ZXJfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIEhpbnRQb3BvdmVyX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgSGludFBvcG92ZXJfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIEhpbnRQb3BvdmVyX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cblxuXG5cblxuXG5cbnZhciBQT1BPVkVSX0RJU1QgPSA1O1xuXG52YXIgSGludFBvcG92ZXJfSGludFBvcG92ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBIaW50UG9wb3Zlcihjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIEhpbnRQb3BvdmVyX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhpbnRQb3BvdmVyKTtcblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy51aSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUudWk7XG4gICAgdGhpcy4kZWRpdGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGFibGU7XG4gICAgdGhpcy5vcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuICAgIHRoaXMuaGludCA9IHRoaXMub3B0aW9ucy5oaW50IHx8IFtdO1xuICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5vcHRpb25zLmhpbnREaXJlY3Rpb24gfHwgJ2JvdHRvbSc7XG4gICAgdGhpcy5oaW50cyA9IEFycmF5LmlzQXJyYXkodGhpcy5oaW50KSA/IHRoaXMuaGludCA6IFt0aGlzLmhpbnRdO1xuICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgJ3N1bW1lcm5vdGUua2V5dXAnOiBmdW5jdGlvbiBzdW1tZXJub3RlS2V5dXAod2UsIGUpIHtcbiAgICAgICAgaWYgKCFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgX3RoaXMuaGFuZGxlS2V5dXAoZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5rZXlkb3duJzogZnVuY3Rpb24gc3VtbWVybm90ZUtleWRvd24od2UsIGUpIHtcbiAgICAgICAgX3RoaXMuaGFuZGxlS2V5ZG93bihlKTtcbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5kaXNhYmxlIHN1bW1lcm5vdGUuZGlhbG9nLnNob3duIHN1bW1lcm5vdGUuYmx1cic6IGZ1bmN0aW9uIHN1bW1lcm5vdGVEaXNhYmxlU3VtbWVybm90ZURpYWxvZ1Nob3duU3VtbWVybm90ZUJsdXIoKSB7XG4gICAgICAgIF90aGlzLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgSGludFBvcG92ZXJfY3JlYXRlQ2xhc3MoSGludFBvcG92ZXIsIFt7XG4gICAga2V5OiBcInNob3VsZEluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdWxkSW5pdGlhbGl6ZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLmhpbnRzLmxlbmd0aCA+IDA7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgICAgdGhpcy5tYXRjaGluZ1dvcmQgPSBudWxsO1xuICAgICAgdGhpcy4kcG9wb3ZlciA9IHRoaXMudWkucG9wb3Zlcih7XG4gICAgICAgIGNsYXNzTmFtZTogJ25vdGUtaGludC1wb3BvdmVyJyxcbiAgICAgICAgaGlkZUFycm93OiB0cnVlLFxuICAgICAgICBkaXJlY3Rpb246ICcnXG4gICAgICB9KS5yZW5kZXIoKS5hcHBlbmRUbyh0aGlzLm9wdGlvbnMuY29udGFpbmVyKTtcbiAgICAgIHRoaXMuJHBvcG92ZXIuaGlkZSgpO1xuICAgICAgdGhpcy4kY29udGVudCA9IHRoaXMuJHBvcG92ZXIuZmluZCgnLnBvcG92ZXItY29udGVudCwubm90ZS1wb3BvdmVyLWNvbnRlbnQnKTtcbiAgICAgIHRoaXMuJGNvbnRlbnQub24oJ2NsaWNrJywgJy5ub3RlLWhpbnQtaXRlbScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIF90aGlzMi4kY29udGVudC5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGUuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgIF90aGlzMi5yZXBsYWNlKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuJHBvcG92ZXIub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyLnJlbW92ZSgpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJzZWxlY3RJdGVtXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdEl0ZW0oJGl0ZW0pIHtcbiAgICAgIHRoaXMuJGNvbnRlbnQuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICRpdGVtLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgIHRoaXMuJGNvbnRlbnRbMF0uc2Nyb2xsVG9wID0gJGl0ZW1bMF0ub2Zmc2V0VG9wIC0gdGhpcy4kY29udGVudC5pbm5lckhlaWdodCgpIC8gMjtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwibW92ZURvd25cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZURvd24oKSB7XG4gICAgICB2YXIgJGN1cnJlbnQgPSB0aGlzLiRjb250ZW50LmZpbmQoJy5ub3RlLWhpbnQtaXRlbS5hY3RpdmUnKTtcbiAgICAgIHZhciAkbmV4dCA9ICRjdXJyZW50Lm5leHQoKTtcblxuICAgICAgaWYgKCRuZXh0Lmxlbmd0aCkge1xuICAgICAgICB0aGlzLnNlbGVjdEl0ZW0oJG5leHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyICRuZXh0R3JvdXAgPSAkY3VycmVudC5wYXJlbnQoKS5uZXh0KCk7XG5cbiAgICAgICAgaWYgKCEkbmV4dEdyb3VwLmxlbmd0aCkge1xuICAgICAgICAgICRuZXh0R3JvdXAgPSB0aGlzLiRjb250ZW50LmZpbmQoJy5ub3RlLWhpbnQtZ3JvdXAnKS5maXJzdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZWxlY3RJdGVtKCRuZXh0R3JvdXAuZmluZCgnLm5vdGUtaGludC1pdGVtJykuZmlyc3QoKSk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcIm1vdmVVcFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBtb3ZlVXAoKSB7XG4gICAgICB2YXIgJGN1cnJlbnQgPSB0aGlzLiRjb250ZW50LmZpbmQoJy5ub3RlLWhpbnQtaXRlbS5hY3RpdmUnKTtcbiAgICAgIHZhciAkcHJldiA9ICRjdXJyZW50LnByZXYoKTtcblxuICAgICAgaWYgKCRwcmV2Lmxlbmd0aCkge1xuICAgICAgICB0aGlzLnNlbGVjdEl0ZW0oJHByZXYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyICRwcmV2R3JvdXAgPSAkY3VycmVudC5wYXJlbnQoKS5wcmV2KCk7XG5cbiAgICAgICAgaWYgKCEkcHJldkdyb3VwLmxlbmd0aCkge1xuICAgICAgICAgICRwcmV2R3JvdXAgPSB0aGlzLiRjb250ZW50LmZpbmQoJy5ub3RlLWhpbnQtZ3JvdXAnKS5sYXN0KCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNlbGVjdEl0ZW0oJHByZXZHcm91cC5maW5kKCcubm90ZS1oaW50LWl0ZW0nKS5sYXN0KCkpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJyZXBsYWNlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGxhY2UoKSB7XG4gICAgICB2YXIgJGl0ZW0gPSB0aGlzLiRjb250ZW50LmZpbmQoJy5ub3RlLWhpbnQtaXRlbS5hY3RpdmUnKTtcblxuICAgICAgaWYgKCRpdGVtLmxlbmd0aCkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMubm9kZUZyb21JdGVtKCRpdGVtKTsgLy8gSWYgbWF0Y2hpbmdXb3JkIGxlbmd0aCA9IDAgLT4gY2FwdHVyZSBPSyAvIG9wZW4gaGludCAvIGJ1dCBhcyBtZW50aW9uIGNhcHR1cmUgXCJcIiAoXFx3KilcblxuICAgICAgICBpZiAodGhpcy5tYXRjaGluZ1dvcmQgIT09IG51bGwgJiYgdGhpcy5tYXRjaGluZ1dvcmQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5sYXN0V29yZFJhbmdlLnNvID0gdGhpcy5sYXN0V29yZFJhbmdlLmVvOyAvLyBFbHNlIHNpID4gMCBhbmQgbm9ybWFsIGNhc2UgLT4gYWRqdXN0IHJhbmdlIFwiYmVmb3JlXCIgZm9yIGNvcnJlY3QgcG9zaXRpb24gb2YgaW5zZXJ0aW9uXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5tYXRjaGluZ1dvcmQgIT09IG51bGwgJiYgdGhpcy5tYXRjaGluZ1dvcmQubGVuZ3RoID4gMCAmJiAhdGhpcy5sYXN0V29yZFJhbmdlLmlzQ29sbGFwc2VkKCkpIHtcbiAgICAgICAgICB2YXIgcmFuZ2VDb21wdXRlID0gdGhpcy5sYXN0V29yZFJhbmdlLmVvIC0gdGhpcy5sYXN0V29yZFJhbmdlLnNvIC0gdGhpcy5tYXRjaGluZ1dvcmQubGVuZ3RoO1xuXG4gICAgICAgICAgaWYgKHJhbmdlQ29tcHV0ZSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFdvcmRSYW5nZS5zbyArPSByYW5nZUNvbXB1dGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sYXN0V29yZFJhbmdlLmluc2VydE5vZGUobm9kZSk7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaW50U2VsZWN0ID09PSAnbmV4dCcpIHtcbiAgICAgICAgICB2YXIgYmxhbmsgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7XG4gICAgICAgICAgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0KCkobm9kZSkuYWZ0ZXIoYmxhbmspO1xuICAgICAgICAgIHJhbmdlLmNyZWF0ZUZyb21Ob2RlQmVmb3JlKGJsYW5rKS5zZWxlY3QoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByYW5nZS5jcmVhdGVGcm9tTm9kZUFmdGVyKG5vZGUpLnNlbGVjdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sYXN0V29yZFJhbmdlID0gbnVsbDtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIHRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5mb2N1cycpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJub2RlRnJvbUl0ZW1cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gbm9kZUZyb21JdGVtKCRpdGVtKSB7XG4gICAgICB2YXIgaGludCA9IHRoaXMuaGludHNbJGl0ZW0uZGF0YSgnaW5kZXgnKV07XG4gICAgICB2YXIgaXRlbSA9ICRpdGVtLmRhdGEoJ2l0ZW0nKTtcbiAgICAgIHZhciBub2RlID0gaGludC5jb250ZW50ID8gaGludC5jb250ZW50KGl0ZW0pIDogaXRlbTtcblxuICAgICAgaWYgKHR5cGVvZiBub2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICBub2RlID0gZG9tLmNyZWF0ZVRleHQobm9kZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJjcmVhdGVJdGVtVGVtcGxhdGVzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUl0ZW1UZW1wbGF0ZXMoaGludElkeCwgaXRlbXMpIHtcbiAgICAgIHZhciBoaW50ID0gdGhpcy5oaW50c1toaW50SWR4XTtcbiAgICAgIHJldHVybiBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW1cbiAgICAgIC8qLCBpZHggKi9cbiAgICAgICkge1xuICAgICAgICB2YXIgJGl0ZW0gPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSgnPGRpdiBjbGFzcz1cIm5vdGUtaGludC1pdGVtXCIvPicpO1xuICAgICAgICAkaXRlbS5hcHBlbmQoaGludC50ZW1wbGF0ZSA/IGhpbnQudGVtcGxhdGUoaXRlbSkgOiBpdGVtICsgJycpO1xuICAgICAgICAkaXRlbS5kYXRhKHtcbiAgICAgICAgICAnaW5kZXgnOiBoaW50SWR4LFxuICAgICAgICAgICdpdGVtJzogaXRlbVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICRpdGVtO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImhhbmRsZUtleWRvd25cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlS2V5ZG93bihlKSB7XG4gICAgICBpZiAoIXRoaXMuJHBvcG92ZXIuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoZS5rZXlDb2RlID09PSBjb3JlX2tleS5jb2RlLkVOVEVSKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5yZXBsYWNlKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gY29yZV9rZXkuY29kZS5VUCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMubW92ZVVwKCk7XG4gICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gY29yZV9rZXkuY29kZS5ET1dOKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5tb3ZlRG93bigpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJzZWFyY2hLZXl3b3JkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaEtleXdvcmQoaW5kZXgsIGtleXdvcmQsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgaGludCA9IHRoaXMuaGludHNbaW5kZXhdO1xuXG4gICAgICBpZiAoaGludCAmJiBoaW50Lm1hdGNoLnRlc3Qoa2V5d29yZCkgJiYgaGludC5zZWFyY2gpIHtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSBoaW50Lm1hdGNoLmV4ZWMoa2V5d29yZCk7XG4gICAgICAgIHRoaXMubWF0Y2hpbmdXb3JkID0gbWF0Y2hlc1swXTtcbiAgICAgICAgaGludC5zZWFyY2gobWF0Y2hlc1sxXSwgY2FsbGJhY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiY3JlYXRlR3JvdXBcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlR3JvdXAoaWR4LCBrZXl3b3JkKSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgdmFyICRncm91cCA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKCc8ZGl2IGNsYXNzPVwibm90ZS1oaW50LWdyb3VwIG5vdGUtaGludC1ncm91cC0nICsgaWR4ICsgJ1wiPjwvZGl2PicpO1xuICAgICAgdGhpcy5zZWFyY2hLZXl3b3JkKGlkeCwga2V5d29yZCwgZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgIGl0ZW1zID0gaXRlbXMgfHwgW107XG5cbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICRncm91cC5odG1sKF90aGlzMy5jcmVhdGVJdGVtVGVtcGxhdGVzKGlkeCwgaXRlbXMpKTtcblxuICAgICAgICAgIF90aGlzMy5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuICRncm91cDtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGFuZGxlS2V5dXBcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlS2V5dXAoZSkge1xuICAgICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICAgIGlmICghbGlzdHMuY29udGFpbnMoW2NvcmVfa2V5LmNvZGUuRU5URVIsIGNvcmVfa2V5LmNvZGUuVVAsIGNvcmVfa2V5LmNvZGUuRE9XTl0sIGUua2V5Q29kZSkpIHtcbiAgICAgICAgdmFyIF9yYW5nZSA9IHRoaXMuY29udGV4dC5pbnZva2UoJ2VkaXRvci5nZXRMYXN0UmFuZ2UnKTtcblxuICAgICAgICB2YXIgd29yZFJhbmdlLCBrZXl3b3JkO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGludE1vZGUgPT09ICd3b3JkcycpIHtcbiAgICAgICAgICB3b3JkUmFuZ2UgPSBfcmFuZ2UuZ2V0V29yZHNSYW5nZShfcmFuZ2UpO1xuICAgICAgICAgIGtleXdvcmQgPSB3b3JkUmFuZ2UudG9TdHJpbmcoKTtcbiAgICAgICAgICB0aGlzLmhpbnRzLmZvckVhY2goZnVuY3Rpb24gKGhpbnQpIHtcbiAgICAgICAgICAgIGlmIChoaW50Lm1hdGNoLnRlc3Qoa2V5d29yZCkpIHtcbiAgICAgICAgICAgICAgd29yZFJhbmdlID0gX3JhbmdlLmdldFdvcmRzTWF0Y2hSYW5nZShoaW50Lm1hdGNoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKCF3b3JkUmFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGtleXdvcmQgPSB3b3JkUmFuZ2UudG9TdHJpbmcoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3b3JkUmFuZ2UgPSBfcmFuZ2UuZ2V0V29yZFJhbmdlKCk7XG4gICAgICAgICAga2V5d29yZCA9IHdvcmRSYW5nZS50b1N0cmluZygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGludHMubGVuZ3RoICYmIGtleXdvcmQpIHtcbiAgICAgICAgICB0aGlzLiRjb250ZW50LmVtcHR5KCk7XG4gICAgICAgICAgdmFyIGJuZCA9IGZ1bmMucmVjdDJibmQobGlzdHMubGFzdCh3b3JkUmFuZ2UuZ2V0Q2xpZW50UmVjdHMoKSkpO1xuICAgICAgICAgIHZhciBjb250YWluZXJPZmZzZXQgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQoKSh0aGlzLm9wdGlvbnMuY29udGFpbmVyKS5vZmZzZXQoKTtcblxuICAgICAgICAgIGlmIChibmQpIHtcbiAgICAgICAgICAgIGJuZC50b3AgLT0gY29udGFpbmVyT2Zmc2V0LnRvcDtcbiAgICAgICAgICAgIGJuZC5sZWZ0IC09IGNvbnRhaW5lck9mZnNldC5sZWZ0O1xuICAgICAgICAgICAgdGhpcy4kcG9wb3Zlci5oaWRlKCk7XG4gICAgICAgICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSB3b3JkUmFuZ2U7XG4gICAgICAgICAgICB0aGlzLmhpbnRzLmZvckVhY2goZnVuY3Rpb24gKGhpbnQsIGlkeCkge1xuICAgICAgICAgICAgICBpZiAoaGludC5tYXRjaC50ZXN0KGtleXdvcmQpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXM0LmNyZWF0ZUdyb3VwKGlkeCwga2V5d29yZCkuYXBwZW5kVG8oX3RoaXM0LiRjb250ZW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7IC8vIHNlbGVjdCBmaXJzdCAubm90ZS1oaW50LWl0ZW1cblxuICAgICAgICAgICAgdGhpcy4kY29udGVudC5maW5kKCcubm90ZS1oaW50LWl0ZW06Zmlyc3QnKS5hZGRDbGFzcygnYWN0aXZlJyk7IC8vIHNldCBwb3NpdGlvbiBmb3IgcG9wb3ZlciBhZnRlciBncm91cCBpcyBjcmVhdGVkXG5cbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICAgICAgdGhpcy4kcG9wb3Zlci5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQ6IGJuZC5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcDogYm5kLnRvcCAtIHRoaXMuJHBvcG92ZXIub3V0ZXJIZWlnaHQoKSAtIFBPUE9WRVJfRElTVFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuJHBvcG92ZXIuY3NzKHtcbiAgICAgICAgICAgICAgICBsZWZ0OiBibmQubGVmdCxcbiAgICAgICAgICAgICAgICB0b3A6IGJuZC50b3AgKyBibmQuaGVpZ2h0ICsgUE9QT1ZFUl9ESVNUXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJzaG93XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNob3coKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyLnNob3coKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGlkZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5oaWRlKCk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEhpbnRQb3BvdmVyO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL2pzL2Jhc2Uvc2V0dGluZ3MuanNcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZSA9IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLmV4dGVuZChleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5zdW1tZXJub3RlLCB7XG4gIHZlcnNpb246ICcwLjguMTgnLFxuICBwbHVnaW5zOiB7fSxcbiAgZG9tOiBkb20sXG4gIHJhbmdlOiByYW5nZSxcbiAgbGlzdHM6IGxpc3RzLFxuICBvcHRpb25zOiB7XG4gICAgbGFuZ0luZm86IGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUubGFuZ1snZW4tVVMnXSxcbiAgICBlZGl0aW5nOiB0cnVlLFxuICAgIG1vZHVsZXM6IHtcbiAgICAgICdlZGl0b3InOiBFZGl0b3JfRWRpdG9yLFxuICAgICAgJ2NsaXBib2FyZCc6IENsaXBib2FyZF9DbGlwYm9hcmQsXG4gICAgICAnZHJvcHpvbmUnOiBEcm9wem9uZV9Ecm9wem9uZSxcbiAgICAgICdjb2Rldmlldyc6IENvZGV2aWV3X0NvZGVWaWV3LFxuICAgICAgJ3N0YXR1c2Jhcic6IFN0YXR1c2Jhcl9TdGF0dXNiYXIsXG4gICAgICAnZnVsbHNjcmVlbic6IEZ1bGxzY3JlZW5fRnVsbHNjcmVlbixcbiAgICAgICdoYW5kbGUnOiBIYW5kbGVfSGFuZGxlLFxuICAgICAgLy8gRklYTUU6IEhpbnRQb3BvdmVyIG11c3QgYmUgZnJvbnQgb2YgYXV0b2xpbmtcbiAgICAgIC8vICAtIFNjcmlwdCBlcnJvciBhYm91dCByYW5nZSB3aGVuIEVudGVyIGtleSBpcyBwcmVzc2VkIG9uIGhpbnQgcG9wb3ZlclxuICAgICAgJ2hpbnRQb3BvdmVyJzogSGludFBvcG92ZXJfSGludFBvcG92ZXIsXG4gICAgICAnYXV0b0xpbmsnOiBBdXRvTGlua19BdXRvTGluayxcbiAgICAgICdhdXRvU3luYyc6IEF1dG9TeW5jX0F1dG9TeW5jLFxuICAgICAgJ2F1dG9SZXBsYWNlJzogQXV0b1JlcGxhY2VfQXV0b1JlcGxhY2UsXG4gICAgICAncGxhY2Vob2xkZXInOiBQbGFjZWhvbGRlcl9QbGFjZWhvbGRlcixcbiAgICAgICdidXR0b25zJzogQnV0dG9uc19CdXR0b25zLFxuICAgICAgJ3Rvb2xiYXInOiBUb29sYmFyX1Rvb2xiYXIsXG4gICAgICAnbGlua0RpYWxvZyc6IExpbmtEaWFsb2dfTGlua0RpYWxvZyxcbiAgICAgICdsaW5rUG9wb3Zlcic6IExpbmtQb3BvdmVyX0xpbmtQb3BvdmVyLFxuICAgICAgJ2ltYWdlRGlhbG9nJzogSW1hZ2VEaWFsb2dfSW1hZ2VEaWFsb2csXG4gICAgICAnaW1hZ2VQb3BvdmVyJzogSW1hZ2VQb3BvdmVyX0ltYWdlUG9wb3ZlcixcbiAgICAgICd0YWJsZVBvcG92ZXInOiBUYWJsZVBvcG92ZXJfVGFibGVQb3BvdmVyLFxuICAgICAgJ3ZpZGVvRGlhbG9nJzogVmlkZW9EaWFsb2dfVmlkZW9EaWFsb2csXG4gICAgICAnaGVscERpYWxvZyc6IEhlbHBEaWFsb2dfSGVscERpYWxvZyxcbiAgICAgICdhaXJQb3BvdmVyJzogQWlyUG9wb3Zlcl9BaXJQb3BvdmVyXG4gICAgfSxcbiAgICBidXR0b25zOiB7fSxcbiAgICBsYW5nOiAnZW4tVVMnLFxuICAgIGZvbGxvd2luZ1Rvb2xiYXI6IGZhbHNlLFxuICAgIHRvb2xiYXJQb3NpdGlvbjogJ3RvcCcsXG4gICAgb3RoZXJTdGF0aWNCYXI6ICcnLFxuICAgIC8vIHRvb2xiYXJcbiAgICBjb2Rldmlld0tlZXBCdXR0b246IGZhbHNlLFxuICAgIHRvb2xiYXI6IFtbJ3N0eWxlJywgWydzdHlsZSddXSwgWydmb250JywgWydib2xkJywgJ3VuZGVybGluZScsICdjbGVhciddXSwgWydmb250bmFtZScsIFsnZm9udG5hbWUnXV0sIFsnY29sb3InLCBbJ2NvbG9yJ11dLCBbJ3BhcmEnLCBbJ3VsJywgJ29sJywgJ3BhcmFncmFwaCddXSwgWyd0YWJsZScsIFsndGFibGUnXV0sIFsnaW5zZXJ0JywgWydsaW5rJywgJ3BpY3R1cmUnLCAndmlkZW8nXV0sIFsndmlldycsIFsnZnVsbHNjcmVlbicsICdjb2RldmlldycsICdoZWxwJ11dXSxcbiAgICAvLyBwb3BvdmVyXG4gICAgcG9wYXRtb3VzZTogdHJ1ZSxcbiAgICBwb3BvdmVyOiB7XG4gICAgICBpbWFnZTogW1sncmVzaXplJywgWydyZXNpemVGdWxsJywgJ3Jlc2l6ZUhhbGYnLCAncmVzaXplUXVhcnRlcicsICdyZXNpemVOb25lJ11dLCBbJ2Zsb2F0JywgWydmbG9hdExlZnQnLCAnZmxvYXRSaWdodCcsICdmbG9hdE5vbmUnXV0sIFsncmVtb3ZlJywgWydyZW1vdmVNZWRpYSddXV0sXG4gICAgICBsaW5rOiBbWydsaW5rJywgWydsaW5rRGlhbG9nU2hvdycsICd1bmxpbmsnXV1dLFxuICAgICAgdGFibGU6IFtbJ2FkZCcsIFsnYWRkUm93RG93bicsICdhZGRSb3dVcCcsICdhZGRDb2xMZWZ0JywgJ2FkZENvbFJpZ2h0J11dLCBbJ2RlbGV0ZScsIFsnZGVsZXRlUm93JywgJ2RlbGV0ZUNvbCcsICdkZWxldGVUYWJsZSddXV0sXG4gICAgICBhaXI6IFtbJ2NvbG9yJywgWydjb2xvciddXSwgWydmb250JywgWydib2xkJywgJ3VuZGVybGluZScsICdjbGVhciddXSwgWydwYXJhJywgWyd1bCcsICdwYXJhZ3JhcGgnXV0sIFsndGFibGUnLCBbJ3RhYmxlJ11dLCBbJ2luc2VydCcsIFsnbGluaycsICdwaWN0dXJlJ11dLCBbJ3ZpZXcnLCBbJ2Z1bGxzY3JlZW4nLCAnY29kZXZpZXcnXV1dXG4gICAgfSxcbiAgICAvLyBhaXIgbW9kZTogaW5saW5lIGVkaXRvclxuICAgIGFpck1vZGU6IGZhbHNlLFxuICAgIG92ZXJyaWRlQ29udGV4dE1lbnU6IGZhbHNlLFxuICAgIC8vIFRCRFxuICAgIHdpZHRoOiBudWxsLFxuICAgIGhlaWdodDogbnVsbCxcbiAgICBsaW5rVGFyZ2V0Qmxhbms6IHRydWUsXG4gICAgdXNlUHJvdG9jb2w6IHRydWUsXG4gICAgZGVmYXVsdFByb3RvY29sOiAnaHR0cDovLycsXG4gICAgZm9jdXM6IGZhbHNlLFxuICAgIHRhYkRpc2FibGVkOiBmYWxzZSxcbiAgICB0YWJTaXplOiA0LFxuICAgIHN0eWxlV2l0aENTUzogZmFsc2UsXG4gICAgc2hvcnRjdXRzOiB0cnVlLFxuICAgIHRleHRhcmVhQXV0b1N5bmM6IHRydWUsXG4gICAgdG9vbHRpcDogJ2F1dG8nLFxuICAgIGNvbnRhaW5lcjogbnVsbCxcbiAgICBtYXhUZXh0TGVuZ3RoOiAwLFxuICAgIGJsb2NrcXVvdGVCcmVha2luZ0xldmVsOiAyLFxuICAgIHNwZWxsQ2hlY2s6IHRydWUsXG4gICAgZGlzYWJsZUdyYW1tYXI6IGZhbHNlLFxuICAgIHBsYWNlaG9sZGVyOiBudWxsLFxuICAgIGluaGVyaXRQbGFjZWhvbGRlcjogZmFsc2UsXG4gICAgLy8gVE9ETzogbmVlZCB0byBiZSBkb2N1bWVudGVkXG4gICAgcmVjb3JkRXZlcnlLZXlzdHJva2U6IGZhbHNlLFxuICAgIGhpc3RvcnlMaW1pdDogMjAwLFxuICAgIC8vIFRPRE86IG5lZWQgdG8gYmUgZG9jdW1lbnRlZFxuICAgIHNob3dEb21haW5Pbmx5Rm9yQXV0b2xpbms6IGZhbHNlLFxuICAgIC8vIFRPRE86IG5lZWQgdG8gYmUgZG9jdW1lbnRlZFxuICAgIGhpbnRNb2RlOiAnd29yZCcsXG4gICAgaGludFNlbGVjdDogJ2FmdGVyJyxcbiAgICBoaW50RGlyZWN0aW9uOiAnYm90dG9tJyxcbiAgICBzdHlsZVRhZ3M6IFsncCcsICdibG9ja3F1b3RlJywgJ3ByZScsICdoMScsICdoMicsICdoMycsICdoNCcsICdoNScsICdoNiddLFxuICAgIGZvbnROYW1lczogWydBcmlhbCcsICdBcmlhbCBCbGFjaycsICdDb21pYyBTYW5zIE1TJywgJ0NvdXJpZXIgTmV3JywgJ0hlbHZldGljYSBOZXVlJywgJ0hlbHZldGljYScsICdJbXBhY3QnLCAnTHVjaWRhIEdyYW5kZScsICdUYWhvbWEnLCAnVGltZXMgTmV3IFJvbWFuJywgJ1ZlcmRhbmEnXSxcbiAgICBmb250TmFtZXNJZ25vcmVDaGVjazogW10sXG4gICAgYWRkRGVmYXVsdEZvbnRzOiB0cnVlLFxuICAgIGZvbnRTaXplczogWyc4JywgJzknLCAnMTAnLCAnMTEnLCAnMTInLCAnMTQnLCAnMTgnLCAnMjQnLCAnMzYnXSxcbiAgICBmb250U2l6ZVVuaXRzOiBbJ3B4JywgJ3B0J10sXG4gICAgLy8gcGFsbGV0ZSBjb2xvcnMobiB4IG4pXG4gICAgY29sb3JzOiBbWycjMDAwMDAwJywgJyM0MjQyNDInLCAnIzYzNjM2MycsICcjOUM5Qzk0JywgJyNDRUM2Q0UnLCAnI0VGRUZFRicsICcjRjdGN0Y3JywgJyNGRkZGRkYnXSwgWycjRkYwMDAwJywgJyNGRjlDMDAnLCAnI0ZGRkYwMCcsICcjMDBGRjAwJywgJyMwMEZGRkYnLCAnIzAwMDBGRicsICcjOUMwMEZGJywgJyNGRjAwRkYnXSwgWycjRjdDNkNFJywgJyNGRkU3Q0UnLCAnI0ZGRUZDNicsICcjRDZFRkQ2JywgJyNDRURFRTcnLCAnI0NFRTdGNycsICcjRDZENkU3JywgJyNFN0Q2REUnXSwgWycjRTc5QzlDJywgJyNGRkM2OUMnLCAnI0ZGRTc5QycsICcjQjVENkE1JywgJyNBNUM2Q0UnLCAnIzlDQzZFRicsICcjQjVBNUQ2JywgJyNENkE1QkQnXSwgWycjRTc2MzYzJywgJyNGN0FENkInLCAnI0ZGRDY2MycsICcjOTRCRDdCJywgJyM3M0E1QUQnLCAnIzZCQURERScsICcjOEM3QkM2JywgJyNDNjdCQTUnXSwgWycjQ0UwMDAwJywgJyNFNzk0MzknLCAnI0VGQzYzMScsICcjNkJBNTRBJywgJyM0QTdCOEMnLCAnIzM5ODRDNicsICcjNjM0QUE1JywgJyNBNTRBN0InXSwgWycjOUMwMDAwJywgJyNCNTYzMDgnLCAnI0JEOTQwMCcsICcjMzk3QjIxJywgJyMxMDRBNUEnLCAnIzA4NTI5NCcsICcjMzExODczJywgJyM3MzE4NDInXSwgWycjNjMwMDAwJywgJyM3QjM5MDAnLCAnIzg0NjMwMCcsICcjMjk1MjE4JywgJyMwODMxMzknLCAnIzAwMzE2MycsICcjMjExMDRBJywgJyM0QTEwMzEnXV0sXG4gICAgLy8gaHR0cDovL2NoaXIuYWcvcHJvamVjdHMvbmFtZS10aGF0LWNvbG9yL1xuICAgIGNvbG9yc05hbWU6IFtbJ0JsYWNrJywgJ1R1bmRvcmEnLCAnRG92ZSBHcmF5JywgJ1N0YXIgRHVzdCcsICdQYWxlIFNsYXRlJywgJ0dhbGxlcnknLCAnQWxhYmFzdGVyJywgJ1doaXRlJ10sIFsnUmVkJywgJ09yYW5nZSBQZWVsJywgJ1llbGxvdycsICdHcmVlbicsICdDeWFuJywgJ0JsdWUnLCAnRWxlY3RyaWMgVmlvbGV0JywgJ01hZ2VudGEnXSwgWydBemFsZWEnLCAnS2FycnknLCAnRWdnIFdoaXRlJywgJ1phbmFoJywgJ0JvdHRpY2VsbGknLCAnVHJvcGljYWwgQmx1ZScsICdNaXNjaGthJywgJ1R3aWxpZ2h0J10sIFsnVG9ueXMgUGluaycsICdQZWFjaCBPcmFuZ2UnLCAnQ3JlYW0gQnJ1bGVlJywgJ1Nwcm91dCcsICdDYXNwZXInLCAnUGVyYW5vJywgJ0NvbGQgUHVycGxlJywgJ0NhcmV5cyBQaW5rJ10sIFsnTWFuZHknLCAnUmFqYWgnLCAnRGFuZGVsaW9uJywgJ09saXZpbmUnLCAnR3VsZiBTdHJlYW0nLCAnVmlraW5nJywgJ0JsdWUgTWFyZ3Vlcml0ZScsICdQdWNlJ10sIFsnR3VhcmRzbWFuIFJlZCcsICdGaXJlIEJ1c2gnLCAnR29sZGVuIERyZWFtJywgJ0NoZWxzZWEgQ3VjdW1iZXInLCAnU21hbHQgQmx1ZScsICdCb3N0b24gQmx1ZScsICdCdXR0ZXJmbHkgQnVzaCcsICdDYWRpbGxhYyddLCBbJ1NhbmdyaWEnLCAnTWFpIFRhaScsICdCdWRkaGEgR29sZCcsICdGb3Jlc3QgR3JlZW4nLCAnRWRlbicsICdWZW5pY2UgQmx1ZScsICdNZXRlb3JpdGUnLCAnQ2xhcmV0J10sIFsnUm9zZXdvb2QnLCAnQ2lubmFtb24nLCAnT2xpdmUnLCAnUGFyc2xleScsICdUaWJlcicsICdNaWRuaWdodCBCbHVlJywgJ1ZhbGVudGlubycsICdMb3Vsb3UnXV0sXG4gICAgY29sb3JCdXR0b246IHtcbiAgICAgIGZvcmVDb2xvcjogJyMwMDAwMDAnLFxuICAgICAgYmFja0NvbG9yOiAnI0ZGRkYwMCdcbiAgICB9LFxuICAgIGxpbmVIZWlnaHRzOiBbJzEuMCcsICcxLjInLCAnMS40JywgJzEuNScsICcxLjYnLCAnMS44JywgJzIuMCcsICczLjAnXSxcbiAgICB0YWJsZUNsYXNzTmFtZTogJ3RhYmxlIHRhYmxlLWJvcmRlcmVkJyxcbiAgICBpbnNlcnRUYWJsZU1heFNpemU6IHtcbiAgICAgIGNvbDogMTAsXG4gICAgICByb3c6IDEwXG4gICAgfSxcbiAgICAvLyBCeSBkZWZhdWx0LCBkaWFsb2dzIGFyZSBhdHRhY2hlZCBpbiBjb250YWluZXIuXG4gICAgZGlhbG9nc0luQm9keTogZmFsc2UsXG4gICAgZGlhbG9nc0ZhZGU6IGZhbHNlLFxuICAgIG1heGltdW1JbWFnZUZpbGVTaXplOiBudWxsLFxuICAgIGNhbGxiYWNrczoge1xuICAgICAgb25CZWZvcmVDb21tYW5kOiBudWxsLFxuICAgICAgb25CbHVyOiBudWxsLFxuICAgICAgb25CbHVyQ29kZXZpZXc6IG51bGwsXG4gICAgICBvbkNoYW5nZTogbnVsbCxcbiAgICAgIG9uQ2hhbmdlQ29kZXZpZXc6IG51bGwsXG4gICAgICBvbkRpYWxvZ1Nob3duOiBudWxsLFxuICAgICAgb25FbnRlcjogbnVsbCxcbiAgICAgIG9uRm9jdXM6IG51bGwsXG4gICAgICBvbkltYWdlTGlua0luc2VydDogbnVsbCxcbiAgICAgIG9uSW1hZ2VVcGxvYWQ6IG51bGwsXG4gICAgICBvbkltYWdlVXBsb2FkRXJyb3I6IG51bGwsXG4gICAgICBvbkluaXQ6IG51bGwsXG4gICAgICBvbktleWRvd246IG51bGwsXG4gICAgICBvbktleXVwOiBudWxsLFxuICAgICAgb25Nb3VzZWRvd246IG51bGwsXG4gICAgICBvbk1vdXNldXA6IG51bGwsXG4gICAgICBvblBhc3RlOiBudWxsLFxuICAgICAgb25TY3JvbGw6IG51bGxcbiAgICB9LFxuICAgIGNvZGVtaXJyb3I6IHtcbiAgICAgIG1vZGU6ICd0ZXh0L2h0bWwnLFxuICAgICAgaHRtbE1vZGU6IHRydWUsXG4gICAgICBsaW5lTnVtYmVyczogdHJ1ZVxuICAgIH0sXG4gICAgY29kZXZpZXdGaWx0ZXI6IGZhbHNlLFxuICAgIGNvZGV2aWV3RmlsdGVyUmVnZXg6IC88XFwvKig/OmFwcGxldHxiKD86YXNlfGdzb3VuZHxsaW5rKXxlbWJlZHxmcmFtZSg/OnNldCk/fGlsYXllcnxsKD86YXllcnxpbmspfG1ldGF8b2JqZWN0fHMoPzpjcmlwdHx0eWxlKXx0KD86aXRsZXxleHRhcmVhKXx4bWwpW14+XSo/Pi9naSxcbiAgICBjb2Rldmlld0lmcmFtZUZpbHRlcjogdHJ1ZSxcbiAgICBjb2Rldmlld0lmcmFtZVdoaXRlbGlzdFNyYzogW10sXG4gICAgY29kZXZpZXdJZnJhbWVXaGl0ZWxpc3RTcmNCYXNlOiBbJ3d3dy55b3V0dWJlLmNvbScsICd3d3cueW91dHViZS1ub2Nvb2tpZS5jb20nLCAnd3d3LmZhY2Vib29rLmNvbScsICd2aW5lLmNvJywgJ2luc3RhZ3JhbS5jb20nLCAncGxheWVyLnZpbWVvLmNvbScsICd3d3cuZGFpbHltb3Rpb24uY29tJywgJ3BsYXllci55b3VrdS5jb20nLCAndi5xcS5jb20nXSxcbiAgICBrZXlNYXA6IHtcbiAgICAgIHBjOiB7XG4gICAgICAgICdFU0MnOiAnZXNjYXBlJyxcbiAgICAgICAgJ0VOVEVSJzogJ2luc2VydFBhcmFncmFwaCcsXG4gICAgICAgICdDVFJMK1onOiAndW5kbycsXG4gICAgICAgICdDVFJMK1knOiAncmVkbycsXG4gICAgICAgICdUQUInOiAndGFiJyxcbiAgICAgICAgJ1NISUZUK1RBQic6ICd1bnRhYicsXG4gICAgICAgICdDVFJMK0InOiAnYm9sZCcsXG4gICAgICAgICdDVFJMK0knOiAnaXRhbGljJyxcbiAgICAgICAgJ0NUUkwrVSc6ICd1bmRlcmxpbmUnLFxuICAgICAgICAnQ1RSTCtTSElGVCtTJzogJ3N0cmlrZXRocm91Z2gnLFxuICAgICAgICAnQ1RSTCtCQUNLU0xBU0gnOiAncmVtb3ZlRm9ybWF0JyxcbiAgICAgICAgJ0NUUkwrU0hJRlQrTCc6ICdqdXN0aWZ5TGVmdCcsXG4gICAgICAgICdDVFJMK1NISUZUK0UnOiAnanVzdGlmeUNlbnRlcicsXG4gICAgICAgICdDVFJMK1NISUZUK1InOiAnanVzdGlmeVJpZ2h0JyxcbiAgICAgICAgJ0NUUkwrU0hJRlQrSic6ICdqdXN0aWZ5RnVsbCcsXG4gICAgICAgICdDVFJMK1NISUZUK05VTTcnOiAnaW5zZXJ0VW5vcmRlcmVkTGlzdCcsXG4gICAgICAgICdDVFJMK1NISUZUK05VTTgnOiAnaW5zZXJ0T3JkZXJlZExpc3QnLFxuICAgICAgICAnQ1RSTCtMRUZUQlJBQ0tFVCc6ICdvdXRkZW50JyxcbiAgICAgICAgJ0NUUkwrUklHSFRCUkFDS0VUJzogJ2luZGVudCcsXG4gICAgICAgICdDVFJMK05VTTAnOiAnZm9ybWF0UGFyYScsXG4gICAgICAgICdDVFJMK05VTTEnOiAnZm9ybWF0SDEnLFxuICAgICAgICAnQ1RSTCtOVU0yJzogJ2Zvcm1hdEgyJyxcbiAgICAgICAgJ0NUUkwrTlVNMyc6ICdmb3JtYXRIMycsXG4gICAgICAgICdDVFJMK05VTTQnOiAnZm9ybWF0SDQnLFxuICAgICAgICAnQ1RSTCtOVU01JzogJ2Zvcm1hdEg1JyxcbiAgICAgICAgJ0NUUkwrTlVNNic6ICdmb3JtYXRINicsXG4gICAgICAgICdDVFJMK0VOVEVSJzogJ2luc2VydEhvcml6b250YWxSdWxlJyxcbiAgICAgICAgJ0NUUkwrSyc6ICdsaW5rRGlhbG9nLnNob3cnXG4gICAgICB9LFxuICAgICAgbWFjOiB7XG4gICAgICAgICdFU0MnOiAnZXNjYXBlJyxcbiAgICAgICAgJ0VOVEVSJzogJ2luc2VydFBhcmFncmFwaCcsXG4gICAgICAgICdDTUQrWic6ICd1bmRvJyxcbiAgICAgICAgJ0NNRCtTSElGVCtaJzogJ3JlZG8nLFxuICAgICAgICAnVEFCJzogJ3RhYicsXG4gICAgICAgICdTSElGVCtUQUInOiAndW50YWInLFxuICAgICAgICAnQ01EK0InOiAnYm9sZCcsXG4gICAgICAgICdDTUQrSSc6ICdpdGFsaWMnLFxuICAgICAgICAnQ01EK1UnOiAndW5kZXJsaW5lJyxcbiAgICAgICAgJ0NNRCtTSElGVCtTJzogJ3N0cmlrZXRocm91Z2gnLFxuICAgICAgICAnQ01EK0JBQ0tTTEFTSCc6ICdyZW1vdmVGb3JtYXQnLFxuICAgICAgICAnQ01EK1NISUZUK0wnOiAnanVzdGlmeUxlZnQnLFxuICAgICAgICAnQ01EK1NISUZUK0UnOiAnanVzdGlmeUNlbnRlcicsXG4gICAgICAgICdDTUQrU0hJRlQrUic6ICdqdXN0aWZ5UmlnaHQnLFxuICAgICAgICAnQ01EK1NISUZUK0onOiAnanVzdGlmeUZ1bGwnLFxuICAgICAgICAnQ01EK1NISUZUK05VTTcnOiAnaW5zZXJ0VW5vcmRlcmVkTGlzdCcsXG4gICAgICAgICdDTUQrU0hJRlQrTlVNOCc6ICdpbnNlcnRPcmRlcmVkTGlzdCcsXG4gICAgICAgICdDTUQrTEVGVEJSQUNLRVQnOiAnb3V0ZGVudCcsXG4gICAgICAgICdDTUQrUklHSFRCUkFDS0VUJzogJ2luZGVudCcsXG4gICAgICAgICdDTUQrTlVNMCc6ICdmb3JtYXRQYXJhJyxcbiAgICAgICAgJ0NNRCtOVU0xJzogJ2Zvcm1hdEgxJyxcbiAgICAgICAgJ0NNRCtOVU0yJzogJ2Zvcm1hdEgyJyxcbiAgICAgICAgJ0NNRCtOVU0zJzogJ2Zvcm1hdEgzJyxcbiAgICAgICAgJ0NNRCtOVU00JzogJ2Zvcm1hdEg0JyxcbiAgICAgICAgJ0NNRCtOVU01JzogJ2Zvcm1hdEg1JyxcbiAgICAgICAgJ0NNRCtOVU02JzogJ2Zvcm1hdEg2JyxcbiAgICAgICAgJ0NNRCtFTlRFUic6ICdpbnNlcnRIb3Jpem9udGFsUnVsZScsXG4gICAgICAgICdDTUQrSyc6ICdsaW5rRGlhbG9nLnNob3cnXG4gICAgICB9XG4gICAgfSxcbiAgICBpY29uczoge1xuICAgICAgJ2FsaWduJzogJ25vdGUtaWNvbi1hbGlnbicsXG4gICAgICAnYWxpZ25DZW50ZXInOiAnbm90ZS1pY29uLWFsaWduLWNlbnRlcicsXG4gICAgICAnYWxpZ25KdXN0aWZ5JzogJ25vdGUtaWNvbi1hbGlnbi1qdXN0aWZ5JyxcbiAgICAgICdhbGlnbkxlZnQnOiAnbm90ZS1pY29uLWFsaWduLWxlZnQnLFxuICAgICAgJ2FsaWduUmlnaHQnOiAnbm90ZS1pY29uLWFsaWduLXJpZ2h0JyxcbiAgICAgICdyb3dCZWxvdyc6ICdub3RlLWljb24tcm93LWJlbG93JyxcbiAgICAgICdjb2xCZWZvcmUnOiAnbm90ZS1pY29uLWNvbC1iZWZvcmUnLFxuICAgICAgJ2NvbEFmdGVyJzogJ25vdGUtaWNvbi1jb2wtYWZ0ZXInLFxuICAgICAgJ3Jvd0Fib3ZlJzogJ25vdGUtaWNvbi1yb3ctYWJvdmUnLFxuICAgICAgJ3Jvd1JlbW92ZSc6ICdub3RlLWljb24tcm93LXJlbW92ZScsXG4gICAgICAnY29sUmVtb3ZlJzogJ25vdGUtaWNvbi1jb2wtcmVtb3ZlJyxcbiAgICAgICdpbmRlbnQnOiAnbm90ZS1pY29uLWFsaWduLWluZGVudCcsXG4gICAgICAnb3V0ZGVudCc6ICdub3RlLWljb24tYWxpZ24tb3V0ZGVudCcsXG4gICAgICAnYXJyb3dzQWx0JzogJ25vdGUtaWNvbi1hcnJvd3MtYWx0JyxcbiAgICAgICdib2xkJzogJ25vdGUtaWNvbi1ib2xkJyxcbiAgICAgICdjYXJldCc6ICdub3RlLWljb24tY2FyZXQnLFxuICAgICAgJ2NpcmNsZSc6ICdub3RlLWljb24tY2lyY2xlJyxcbiAgICAgICdjbG9zZSc6ICdub3RlLWljb24tY2xvc2UnLFxuICAgICAgJ2NvZGUnOiAnbm90ZS1pY29uLWNvZGUnLFxuICAgICAgJ2VyYXNlcic6ICdub3RlLWljb24tZXJhc2VyJyxcbiAgICAgICdmbG9hdExlZnQnOiAnbm90ZS1pY29uLWZsb2F0LWxlZnQnLFxuICAgICAgJ2Zsb2F0UmlnaHQnOiAnbm90ZS1pY29uLWZsb2F0LXJpZ2h0JyxcbiAgICAgICdmb250JzogJ25vdGUtaWNvbi1mb250JyxcbiAgICAgICdmcmFtZSc6ICdub3RlLWljb24tZnJhbWUnLFxuICAgICAgJ2l0YWxpYyc6ICdub3RlLWljb24taXRhbGljJyxcbiAgICAgICdsaW5rJzogJ25vdGUtaWNvbi1saW5rJyxcbiAgICAgICd1bmxpbmsnOiAnbm90ZS1pY29uLWNoYWluLWJyb2tlbicsXG4gICAgICAnbWFnaWMnOiAnbm90ZS1pY29uLW1hZ2ljJyxcbiAgICAgICdtZW51Q2hlY2snOiAnbm90ZS1pY29uLW1lbnUtY2hlY2snLFxuICAgICAgJ21pbnVzJzogJ25vdGUtaWNvbi1taW51cycsXG4gICAgICAnb3JkZXJlZGxpc3QnOiAnbm90ZS1pY29uLW9yZGVyZWRsaXN0JyxcbiAgICAgICdwZW5jaWwnOiAnbm90ZS1pY29uLXBlbmNpbCcsXG4gICAgICAncGljdHVyZSc6ICdub3RlLWljb24tcGljdHVyZScsXG4gICAgICAncXVlc3Rpb24nOiAnbm90ZS1pY29uLXF1ZXN0aW9uJyxcbiAgICAgICdyZWRvJzogJ25vdGUtaWNvbi1yZWRvJyxcbiAgICAgICdyb2xsYmFjayc6ICdub3RlLWljb24tcm9sbGJhY2snLFxuICAgICAgJ3NxdWFyZSc6ICdub3RlLWljb24tc3F1YXJlJyxcbiAgICAgICdzdHJpa2V0aHJvdWdoJzogJ25vdGUtaWNvbi1zdHJpa2V0aHJvdWdoJyxcbiAgICAgICdzdWJzY3JpcHQnOiAnbm90ZS1pY29uLXN1YnNjcmlwdCcsXG4gICAgICAnc3VwZXJzY3JpcHQnOiAnbm90ZS1pY29uLXN1cGVyc2NyaXB0JyxcbiAgICAgICd0YWJsZSc6ICdub3RlLWljb24tdGFibGUnLFxuICAgICAgJ3RleHRIZWlnaHQnOiAnbm90ZS1pY29uLXRleHQtaGVpZ2h0JyxcbiAgICAgICd0cmFzaCc6ICdub3RlLWljb24tdHJhc2gnLFxuICAgICAgJ3VuZGVybGluZSc6ICdub3RlLWljb24tdW5kZXJsaW5lJyxcbiAgICAgICd1bmRvJzogJ25vdGUtaWNvbi11bmRvJyxcbiAgICAgICd1bm9yZGVyZWRsaXN0JzogJ25vdGUtaWNvbi11bm9yZGVyZWRsaXN0JyxcbiAgICAgICd2aWRlbyc6ICdub3RlLWljb24tdmlkZW8nXG4gICAgfVxuICB9XG59KTtcblxuLyoqKi8gfSksXG5cbi8qKiovIDQ6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpblxuXG4vKioqLyB9KSxcblxuLyoqKi8gNTI6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLy8gRVNNIENPTVBBVCBGTEFHXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIoX193ZWJwYWNrX2V4cG9ydHNfXyk7XG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwge1wicm9vdFwiOlwialF1ZXJ5XCIsXCJjb21tb25qczJcIjpcImpxdWVyeVwiLFwiY29tbW9uanNcIjpcImpxdWVyeVwiLFwiYW1kXCI6XCJqcXVlcnlcIn1cbnZhciBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5XyA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7XG52YXIgZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5Xyk7XG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9zcmMvanMvYmFzZS9yZW5kZXJlci5qc1xudmFyIHJlbmRlcmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYnMzL3VpLmpzXG5mdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBcIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mXCI7IGlmICh0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9XG5cblxuXG52YXIgZWRpdG9yID0gcmVuZGVyZXJbXCJhXCIgLyogZGVmYXVsdCAqL10uY3JlYXRlKCc8ZGl2IGNsYXNzPVwibm90ZS1lZGl0b3Igbm90ZS1mcmFtZSBwYW5lbCBwYW5lbC1kZWZhdWx0XCIvPicpO1xudmFyIHRvb2xiYXIgPSByZW5kZXJlcltcImFcIiAvKiBkZWZhdWx0ICovXS5jcmVhdGUoJzxkaXYgY2xhc3M9XCJwYW5lbC1oZWFkaW5nIG5vdGUtdG9vbGJhclwiIHJvbGU9XCJ0b29sYmFyXCIvPicpO1xudmFyIGVkaXRpbmdBcmVhID0gcmVuZGVyZXJbXCJhXCIgLyogZGVmYXVsdCAqL10uY3JlYXRlKCc8ZGl2IGNsYXNzPVwibm90ZS1lZGl0aW5nLWFyZWFcIi8+Jyk7XG52YXIgY29kYWJsZSA9IHJlbmRlcmVyW1wiYVwiIC8qIGRlZmF1bHQgKi9dLmNyZWF0ZSgnPHRleHRhcmVhIGNsYXNzPVwibm90ZS1jb2RhYmxlXCIgYXJpYS1tdWx0aWxpbmU9XCJ0cnVlXCIvPicpO1xudmFyIGVkaXRhYmxlID0gcmVuZGVyZXJbXCJhXCIgLyogZGVmYXVsdCAqL10uY3JlYXRlKCc8ZGl2IGNsYXNzPVwibm90ZS1lZGl0YWJsZVwiIGNvbnRlbnRFZGl0YWJsZT1cInRydWVcIiByb2xlPVwidGV4dGJveFwiIGFyaWEtbXVsdGlsaW5lPVwidHJ1ZVwiLz4nKTtcbnZhciBzdGF0dXNiYXIgPSByZW5kZXJlcltcImFcIiAvKiBkZWZhdWx0ICovXS5jcmVhdGUoWyc8b3V0cHV0IGNsYXNzPVwibm90ZS1zdGF0dXMtb3V0cHV0XCIgcm9sZT1cInN0YXR1c1wiIGFyaWEtbGl2ZT1cInBvbGl0ZVwiPjwvb3V0cHV0PicsICc8ZGl2IGNsYXNzPVwibm90ZS1zdGF0dXNiYXJcIiByb2xlPVwic3RhdHVzXCI+JywgJzxkaXYgY2xhc3M9XCJub3RlLXJlc2l6ZWJhclwiIGFyaWEtbGFiZWw9XCJSZXNpemVcIj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtaWNvbi1iYXJcIj48L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtaWNvbi1iYXJcIj48L2Rpdj4nLCAnPGRpdiBjbGFzcz1cIm5vdGUtaWNvbi1iYXJcIj48L2Rpdj4nLCAnPC9kaXY+JywgJzwvZGl2PiddLmpvaW4oJycpKTtcbnZhciBhaXJFZGl0b3IgPSByZW5kZXJlcltcImFcIiAvKiBkZWZhdWx0ICovXS5jcmVhdGUoJzxkaXYgY2xhc3M9XCJub3RlLWVkaXRvciBub3RlLWFpcmZyYW1lXCIvPicpO1xudmFyIGFpckVkaXRhYmxlID0gcmVuZGVyZXJbXCJhXCIgLyogZGVmYXVsdCAqL10uY3JlYXRlKFsnPGRpdiBjbGFzcz1cIm5vdGUtZWRpdGFibGVcIiBjb250ZW50RWRpdGFibGU9XCJ0cnVlXCIgcm9sZT1cInRleHRib3hcIiBhcmlhLW11bHRpbGluZT1cInRydWVcIj48L2Rpdj4nLCAnPG91dHB1dCBjbGFzcz1cIm5vdGUtc3RhdHVzLW91dHB1dFwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWxpdmU9XCJwb2xpdGVcIj48L291dHB1dD4nXS5qb2luKCcnKSk7XG52YXIgYnV0dG9uR3JvdXAgPSByZW5kZXJlcltcImFcIiAvKiBkZWZhdWx0ICovXS5jcmVhdGUoJzxkaXYgY2xhc3M9XCJub3RlLWJ0bi1ncm91cCBidG4tZ3JvdXBcIj4nKTtcbnZhciBkcm9wZG93biA9IHJlbmRlcmVyW1wiYVwiIC8qIGRlZmF1bHQgKi9dLmNyZWF0ZSgnPHVsIGNsYXNzPVwibm90ZS1kcm9wZG93bi1tZW51IGRyb3Bkb3duLW1lbnVcIj4nLCBmdW5jdGlvbiAoJG5vZGUsIG9wdGlvbnMpIHtcbiAgdmFyIG1hcmt1cCA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5pdGVtcykgPyBvcHRpb25zLml0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgIHZhciB2YWx1ZSA9IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLnZhbHVlIHx8ICcnO1xuICAgIHZhciBjb250ZW50ID0gb3B0aW9ucy50ZW1wbGF0ZSA/IG9wdGlvbnMudGVtcGxhdGUoaXRlbSkgOiBpdGVtO1xuICAgIHZhciBvcHRpb24gPSBfdHlwZW9mKGl0ZW0pID09PSAnb2JqZWN0JyA/IGl0ZW0ub3B0aW9uIDogdW5kZWZpbmVkO1xuICAgIHZhciBkYXRhVmFsdWUgPSAnZGF0YS12YWx1ZT1cIicgKyB2YWx1ZSArICdcIic7XG4gICAgdmFyIGRhdGFPcHRpb24gPSBvcHRpb24gIT09IHVuZGVmaW5lZCA/ICcgZGF0YS1vcHRpb249XCInICsgb3B0aW9uICsgJ1wiJyA6ICcnO1xuICAgIHJldHVybiAnPGxpIGFyaWEtbGFiZWw9XCInICsgdmFsdWUgKyAnXCI+PGEgaHJlZj1cIiNcIiAnICsgKGRhdGFWYWx1ZSArIGRhdGFPcHRpb24pICsgJz4nICsgY29udGVudCArICc8L2E+PC9saT4nO1xuICB9KS5qb2luKCcnKSA6IG9wdGlvbnMuaXRlbXM7XG4gICRub2RlLmh0bWwobWFya3VwKS5hdHRyKHtcbiAgICAnYXJpYS1sYWJlbCc6IG9wdGlvbnMudGl0bGVcbiAgfSk7XG5cbiAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jb2Rldmlld0tlZXBCdXR0b24pIHtcbiAgICAkbm9kZS5hZGRDbGFzcygnbm90ZS1jb2Rldmlldy1rZWVwJyk7XG4gIH1cbn0pO1xuXG52YXIgZHJvcGRvd25CdXR0b25Db250ZW50cyA9IGZ1bmN0aW9uIGRyb3Bkb3duQnV0dG9uQ29udGVudHMoY29udGVudHMsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGNvbnRlbnRzICsgJyAnICsgaWNvbihvcHRpb25zLmljb25zLmNhcmV0LCAnc3BhbicpO1xufTtcblxudmFyIGRyb3Bkb3duQ2hlY2sgPSByZW5kZXJlcltcImFcIiAvKiBkZWZhdWx0ICovXS5jcmVhdGUoJzx1bCBjbGFzcz1cIm5vdGUtZHJvcGRvd24tbWVudSBkcm9wZG93bi1tZW51IG5vdGUtY2hlY2tcIj4nLCBmdW5jdGlvbiAoJG5vZGUsIG9wdGlvbnMpIHtcbiAgdmFyIG1hcmt1cCA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5pdGVtcykgPyBvcHRpb25zLml0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgIHZhciB2YWx1ZSA9IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLnZhbHVlIHx8ICcnO1xuICAgIHZhciBjb250ZW50ID0gb3B0aW9ucy50ZW1wbGF0ZSA/IG9wdGlvbnMudGVtcGxhdGUoaXRlbSkgOiBpdGVtO1xuICAgIHJldHVybiAnPGxpIGFyaWEtbGFiZWw9XCInICsgaXRlbSArICdcIj48YSBocmVmPVwiI1wiIGRhdGEtdmFsdWU9XCInICsgdmFsdWUgKyAnXCI+JyArIGljb24ob3B0aW9ucy5jaGVja0NsYXNzTmFtZSkgKyAnICcgKyBjb250ZW50ICsgJzwvYT48L2xpPic7XG4gIH0pLmpvaW4oJycpIDogb3B0aW9ucy5pdGVtcztcbiAgJG5vZGUuaHRtbChtYXJrdXApLmF0dHIoe1xuICAgICdhcmlhLWxhYmVsJzogb3B0aW9ucy50aXRsZVxuICB9KTtcblxuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNvZGV2aWV3S2VlcEJ1dHRvbikge1xuICAgICRub2RlLmFkZENsYXNzKCdub3RlLWNvZGV2aWV3LWtlZXAnKTtcbiAgfVxufSk7XG52YXIgZGlhbG9nID0gcmVuZGVyZXJbXCJhXCIgLyogZGVmYXVsdCAqL10uY3JlYXRlKCc8ZGl2IGNsYXNzPVwibW9kYWwgbm90ZS1tb2RhbFwiIGFyaWEtaGlkZGVuPVwiZmFsc2VcIiB0YWJpbmRleD1cIi0xXCIgcm9sZT1cImRpYWxvZ1wiLz4nLCBmdW5jdGlvbiAoJG5vZGUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuZmFkZSkge1xuICAgICRub2RlLmFkZENsYXNzKCdmYWRlJyk7XG4gIH1cblxuICAkbm9kZS5hdHRyKHtcbiAgICAnYXJpYS1sYWJlbCc6IG9wdGlvbnMudGl0bGVcbiAgfSk7XG4gICRub2RlLmh0bWwoWyc8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nXCI+JywgJzxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+Jywgb3B0aW9ucy50aXRsZSA/ICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+JyArICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImNsb3NlXCIgZGF0YS1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIiBhcmlhLWhpZGRlbj1cInRydWVcIj4mdGltZXM7PC9idXR0b24+JyArICc8aDQgY2xhc3M9XCJtb2RhbC10aXRsZVwiPicgKyBvcHRpb25zLnRpdGxlICsgJzwvaDQ+JyArICc8L2Rpdj4nIDogJycsICc8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPicgKyBvcHRpb25zLmJvZHkgKyAnPC9kaXY+Jywgb3B0aW9ucy5mb290ZXIgPyAnPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPicgKyBvcHRpb25zLmZvb3RlciArICc8L2Rpdj4nIDogJycsICc8L2Rpdj4nLCAnPC9kaXY+J10uam9pbignJykpO1xufSk7XG52YXIgcG9wb3ZlciA9IHJlbmRlcmVyW1wiYVwiIC8qIGRlZmF1bHQgKi9dLmNyZWF0ZShbJzxkaXYgY2xhc3M9XCJub3RlLXBvcG92ZXIgcG9wb3ZlciBpblwiPicsICc8ZGl2IGNsYXNzPVwiYXJyb3dcIj48L2Rpdj4nLCAnPGRpdiBjbGFzcz1cInBvcG92ZXItY29udGVudCBub3RlLWNoaWxkcmVuLWNvbnRhaW5lclwiPjwvZGl2PicsICc8L2Rpdj4nXS5qb2luKCcnKSwgZnVuY3Rpb24gKCRub2RlLCBvcHRpb25zKSB7XG4gIHZhciBkaXJlY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5kaXJlY3Rpb24gIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5kaXJlY3Rpb24gOiAnYm90dG9tJztcbiAgJG5vZGUuYWRkQ2xhc3MoZGlyZWN0aW9uKTtcblxuICBpZiAob3B0aW9ucy5oaWRlQXJyb3cpIHtcbiAgICAkbm9kZS5maW5kKCcuYXJyb3cnKS5oaWRlKCk7XG4gIH1cbn0pO1xudmFyIHVpX2NoZWNrYm94ID0gcmVuZGVyZXJbXCJhXCIgLyogZGVmYXVsdCAqL10uY3JlYXRlKCc8ZGl2IGNsYXNzPVwiY2hlY2tib3hcIj48L2Rpdj4nLCBmdW5jdGlvbiAoJG5vZGUsIG9wdGlvbnMpIHtcbiAgJG5vZGUuaHRtbChbJzxsYWJlbCcgKyAob3B0aW9ucy5pZCA/ICcgZm9yPVwibm90ZS0nICsgb3B0aW9ucy5pZCArICdcIicgOiAnJykgKyAnPicsICc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCInICsgKG9wdGlvbnMuaWQgPyAnIGlkPVwibm90ZS0nICsgb3B0aW9ucy5pZCArICdcIicgOiAnJyksIG9wdGlvbnMuY2hlY2tlZCA/ICcgY2hlY2tlZCcgOiAnJywgJyBhcmlhLWNoZWNrZWQ9XCInICsgKG9wdGlvbnMuY2hlY2tlZCA/ICd0cnVlJyA6ICdmYWxzZScpICsgJ1wiLz4nLCBvcHRpb25zLnRleHQgPyBvcHRpb25zLnRleHQgOiAnJywgJzwvbGFiZWw+J10uam9pbignJykpO1xufSk7XG5cbnZhciBpY29uID0gZnVuY3Rpb24gaWNvbihpY29uQ2xhc3NOYW1lLCB0YWdOYW1lKSB7XG4gIHRhZ05hbWUgPSB0YWdOYW1lIHx8ICdpJztcbiAgcmV0dXJuICc8JyArIHRhZ05hbWUgKyAnIGNsYXNzPVwiJyArIGljb25DbGFzc05hbWUgKyAnXCI+PC8nICsgdGFnTmFtZSArICc+Jztcbn07XG5cbnZhciB1aV91aSA9IGZ1bmN0aW9uIHVpKGVkaXRvck9wdGlvbnMpIHtcbiAgcmV0dXJuIHtcbiAgICBlZGl0b3I6IGVkaXRvcixcbiAgICB0b29sYmFyOiB0b29sYmFyLFxuICAgIGVkaXRpbmdBcmVhOiBlZGl0aW5nQXJlYSxcbiAgICBjb2RhYmxlOiBjb2RhYmxlLFxuICAgIGVkaXRhYmxlOiBlZGl0YWJsZSxcbiAgICBzdGF0dXNiYXI6IHN0YXR1c2JhcixcbiAgICBhaXJFZGl0b3I6IGFpckVkaXRvcixcbiAgICBhaXJFZGl0YWJsZTogYWlyRWRpdGFibGUsXG4gICAgYnV0dG9uR3JvdXA6IGJ1dHRvbkdyb3VwLFxuICAgIGRyb3Bkb3duOiBkcm9wZG93bixcbiAgICBkcm9wZG93bkJ1dHRvbkNvbnRlbnRzOiBkcm9wZG93bkJ1dHRvbkNvbnRlbnRzLFxuICAgIGRyb3Bkb3duQ2hlY2s6IGRyb3Bkb3duQ2hlY2ssXG4gICAgZGlhbG9nOiBkaWFsb2csXG4gICAgcG9wb3ZlcjogcG9wb3ZlcixcbiAgICBjaGVja2JveDogdWlfY2hlY2tib3gsXG4gICAgaWNvbjogaWNvbixcbiAgICBvcHRpb25zOiBlZGl0b3JPcHRpb25zLFxuICAgIHBhbGV0dGU6IGZ1bmN0aW9uIHBhbGV0dGUoJG5vZGUsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiByZW5kZXJlcltcImFcIiAvKiBkZWZhdWx0ICovXS5jcmVhdGUoJzxkaXYgY2xhc3M9XCJub3RlLWNvbG9yLXBhbGV0dGVcIi8+JywgZnVuY3Rpb24gKCRub2RlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBjb250ZW50cyA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIHJvdyA9IDAsIHJvd1NpemUgPSBvcHRpb25zLmNvbG9ycy5sZW5ndGg7IHJvdyA8IHJvd1NpemU7IHJvdysrKSB7XG4gICAgICAgICAgdmFyIGV2ZW50TmFtZSA9IG9wdGlvbnMuZXZlbnROYW1lO1xuICAgICAgICAgIHZhciBjb2xvcnMgPSBvcHRpb25zLmNvbG9yc1tyb3ddO1xuICAgICAgICAgIHZhciBjb2xvcnNOYW1lID0gb3B0aW9ucy5jb2xvcnNOYW1lW3Jvd107XG4gICAgICAgICAgdmFyIGJ1dHRvbnMgPSBbXTtcblxuICAgICAgICAgIGZvciAodmFyIGNvbCA9IDAsIGNvbFNpemUgPSBjb2xvcnMubGVuZ3RoOyBjb2wgPCBjb2xTaXplOyBjb2wrKykge1xuICAgICAgICAgICAgdmFyIGNvbG9yID0gY29sb3JzW2NvbF07XG4gICAgICAgICAgICB2YXIgY29sb3JOYW1lID0gY29sb3JzTmFtZVtjb2xdO1xuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKFsnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJub3RlLWNvbG9yLWJ0blwiJywgJ3N0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjonLCBjb2xvciwgJ1wiICcsICdkYXRhLWV2ZW50PVwiJywgZXZlbnROYW1lLCAnXCIgJywgJ2RhdGEtdmFsdWU9XCInLCBjb2xvciwgJ1wiICcsICd0aXRsZT1cIicsIGNvbG9yTmFtZSwgJ1wiICcsICdhcmlhLWxhYmVsPVwiJywgY29sb3JOYW1lLCAnXCIgJywgJ2RhdGEtdG9nZ2xlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCItMVwiPjwvYnV0dG9uPiddLmpvaW4oJycpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb250ZW50cy5wdXNoKCc8ZGl2IGNsYXNzPVwibm90ZS1jb2xvci1yb3dcIj4nICsgYnV0dG9ucy5qb2luKCcnKSArICc8L2Rpdj4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRub2RlLmh0bWwoY29udGVudHMuam9pbignJykpO1xuXG4gICAgICAgIGlmIChvcHRpb25zLnRvb2x0aXApIHtcbiAgICAgICAgICAkbm9kZS5maW5kKCcubm90ZS1jb2xvci1idG4nKS50b29sdGlwKHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogb3B0aW9ucy5jb250YWluZXIgfHwgZWRpdG9yT3B0aW9ucy5jb250YWluZXIsXG4gICAgICAgICAgICB0cmlnZ2VyOiAnaG92ZXInLFxuICAgICAgICAgICAgcGxhY2VtZW50OiAnYm90dG9tJ1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KSgkbm9kZSwgb3B0aW9ucyk7XG4gICAgfSxcbiAgICBidXR0b246IGZ1bmN0aW9uIGJ1dHRvbigkbm9kZSwgb3B0aW9ucykge1xuICAgICAgcmV0dXJuIHJlbmRlcmVyW1wiYVwiIC8qIGRlZmF1bHQgKi9dLmNyZWF0ZSgnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJub3RlLWJ0biBidG4gYnRuLWRlZmF1bHQgYnRuLXNtXCIgdGFiaW5kZXg9XCItMVwiPicsIGZ1bmN0aW9uICgkbm9kZSwgb3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnRvb2x0aXApIHtcbiAgICAgICAgICAkbm9kZS5hdHRyKHtcbiAgICAgICAgICAgIHRpdGxlOiBvcHRpb25zLnRvb2x0aXAsXG4gICAgICAgICAgICAnYXJpYS1sYWJlbCc6IG9wdGlvbnMudG9vbHRpcFxuICAgICAgICAgIH0pLnRvb2x0aXAoe1xuICAgICAgICAgICAgY29udGFpbmVyOiBvcHRpb25zLmNvbnRhaW5lciB8fCBlZGl0b3JPcHRpb25zLmNvbnRhaW5lcixcbiAgICAgICAgICAgIHRyaWdnZXI6ICdob3ZlcicsXG4gICAgICAgICAgICBwbGFjZW1lbnQ6ICdib3R0b20nXG4gICAgICAgICAgfSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdCgpKGUuY3VycmVudFRhcmdldCkudG9vbHRpcCgnaGlkZScpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jb2Rldmlld0J1dHRvbikge1xuICAgICAgICAgICRub2RlLmFkZENsYXNzKCdub3RlLWNvZGV2aWV3LWtlZXAnKTtcbiAgICAgICAgfVxuICAgICAgfSkoJG5vZGUsIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgdG9nZ2xlQnRuOiBmdW5jdGlvbiB0b2dnbGVCdG4oJGJ0biwgaXNFbmFibGUpIHtcbiAgICAgICRidG4udG9nZ2xlQ2xhc3MoJ2Rpc2FibGVkJywgIWlzRW5hYmxlKTtcbiAgICAgICRidG4uYXR0cignZGlzYWJsZWQnLCAhaXNFbmFibGUpO1xuICAgIH0sXG4gICAgdG9nZ2xlQnRuQWN0aXZlOiBmdW5jdGlvbiB0b2dnbGVCdG5BY3RpdmUoJGJ0biwgaXNBY3RpdmUpIHtcbiAgICAgICRidG4udG9nZ2xlQ2xhc3MoJ2FjdGl2ZScsIGlzQWN0aXZlKTtcbiAgICB9LFxuICAgIG9uRGlhbG9nU2hvd246IGZ1bmN0aW9uIG9uRGlhbG9nU2hvd24oJGRpYWxvZywgaGFuZGxlcikge1xuICAgICAgJGRpYWxvZy5vbmUoJ3Nob3duLmJzLm1vZGFsJywgaGFuZGxlcik7XG4gICAgfSxcbiAgICBvbkRpYWxvZ0hpZGRlbjogZnVuY3Rpb24gb25EaWFsb2dIaWRkZW4oJGRpYWxvZywgaGFuZGxlcikge1xuICAgICAgJGRpYWxvZy5vbmUoJ2hpZGRlbi5icy5tb2RhbCcsIGhhbmRsZXIpO1xuICAgIH0sXG4gICAgc2hvd0RpYWxvZzogZnVuY3Rpb24gc2hvd0RpYWxvZygkZGlhbG9nKSB7XG4gICAgICAkZGlhbG9nLm1vZGFsKCdzaG93Jyk7XG4gICAgfSxcbiAgICBoaWRlRGlhbG9nOiBmdW5jdGlvbiBoaWRlRGlhbG9nKCRkaWFsb2cpIHtcbiAgICAgICRkaWFsb2cubW9kYWwoJ2hpZGUnKTtcbiAgICB9LFxuICAgIGNyZWF0ZUxheW91dDogZnVuY3Rpb24gY3JlYXRlTGF5b3V0KCRub3RlKSB7XG4gICAgICB2YXIgJGVkaXRvciA9IChlZGl0b3JPcHRpb25zLmFpck1vZGUgPyBhaXJFZGl0b3IoW2VkaXRpbmdBcmVhKFtjb2RhYmxlKCksIGFpckVkaXRhYmxlKCldKV0pIDogZWRpdG9yT3B0aW9ucy50b29sYmFyUG9zaXRpb24gPT09ICdib3R0b20nID8gZWRpdG9yKFtlZGl0aW5nQXJlYShbY29kYWJsZSgpLCBlZGl0YWJsZSgpXSksIHRvb2xiYXIoKSwgc3RhdHVzYmFyKCldKSA6IGVkaXRvcihbdG9vbGJhcigpLCBlZGl0aW5nQXJlYShbY29kYWJsZSgpLCBlZGl0YWJsZSgpXSksIHN0YXR1c2JhcigpXSkpLnJlbmRlcigpO1xuICAgICAgJGVkaXRvci5pbnNlcnRBZnRlcigkbm90ZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBub3RlOiAkbm90ZSxcbiAgICAgICAgZWRpdG9yOiAkZWRpdG9yLFxuICAgICAgICB0b29sYmFyOiAkZWRpdG9yLmZpbmQoJy5ub3RlLXRvb2xiYXInKSxcbiAgICAgICAgZWRpdGluZ0FyZWE6ICRlZGl0b3IuZmluZCgnLm5vdGUtZWRpdGluZy1hcmVhJyksXG4gICAgICAgIGVkaXRhYmxlOiAkZWRpdG9yLmZpbmQoJy5ub3RlLWVkaXRhYmxlJyksXG4gICAgICAgIGNvZGFibGU6ICRlZGl0b3IuZmluZCgnLm5vdGUtY29kYWJsZScpLFxuICAgICAgICBzdGF0dXNiYXI6ICRlZGl0b3IuZmluZCgnLm5vdGUtc3RhdHVzYmFyJylcbiAgICAgIH07XG4gICAgfSxcbiAgICByZW1vdmVMYXlvdXQ6IGZ1bmN0aW9uIHJlbW92ZUxheW91dCgkbm90ZSwgbGF5b3V0SW5mbykge1xuICAgICAgJG5vdGUuaHRtbChsYXlvdXRJbmZvLmVkaXRhYmxlLmh0bWwoKSk7XG4gICAgICBsYXlvdXRJbmZvLmVkaXRvci5yZW1vdmUoKTtcbiAgICAgICRub3RlLnNob3coKTtcbiAgICB9XG4gIH07XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBiczNfdWkgPSAodWlfdWkpO1xuLy8gRVhURVJOQUwgTU9EVUxFOiAuL3NyYy9qcy9iYXNlL3NldHRpbmdzLmpzICsgMzcgbW9kdWxlc1xudmFyIHNldHRpbmdzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTtcblxuLy8gRVhURVJOQUwgTU9EVUxFOiAuL3NyYy9zdHlsZXMvc3VtbWVybm90ZS1iczMuc2Nzc1xudmFyIHN1bW1lcm5vdGVfYnMzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvanMvYnMzL3NldHRpbmdzLmpzXG5cblxuXG5cbmV4dGVybmFsX3Jvb3RfalF1ZXJ5X2NvbW1vbmpzMl9qcXVlcnlfY29tbW9uanNfanF1ZXJ5X2FtZF9qcXVlcnlfZGVmYXVsdC5hLnN1bW1lcm5vdGUgPSBleHRlcm5hbF9yb290X2pRdWVyeV9jb21tb25qczJfanF1ZXJ5X2NvbW1vbmpzX2pxdWVyeV9hbWRfanF1ZXJ5X2RlZmF1bHQuYS5leHRlbmQoZXh0ZXJuYWxfcm9vdF9qUXVlcnlfY29tbW9uanMyX2pxdWVyeV9jb21tb25qc19qcXVlcnlfYW1kX2pxdWVyeV9kZWZhdWx0LmEuc3VtbWVybm90ZSwge1xuICB1aV90ZW1wbGF0ZTogYnMzX3VpLFxuICBcImludGVyZmFjZVwiOiAnYnMzJ1xufSk7XG5cbi8qKiovIH0pXG5cbi8qKioqKiovIH0pO1xufSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdW1tZXJub3RlLmpzLm1hcCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///xN81\n");

/***/ })

}]);