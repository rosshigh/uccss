<template>
  <div class="col-lg-12">
    <div class="hover" innerhtml.bind="commentShown"></div>
    <div class='row'>
      <div class='bottomMargin'>
        <table id="helpTicketTable" class="table table-striped table-hover">
          <thead>
            <tr>
              <td colspan='12'>
                <compose view="../../../../resources/elements/table-navigation-bar.html"></compose>
              </td>
            </tr>
            <tr>
              <td colspan='12'>
                <span click.delegate="refresh()" bootstrap-tooltip data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Refresh"><i class="fa fa-refresh" aria-hidden="true"></i></span>
                <span class="pull-right" id="spinner" innerhtml.bind="spinnerHTML"></span>
              </td>
            </tr>
            <tr>
              <th></th>
              <th>
                <select change.delegate="dataTable.filterList($event)" class="form-control" id="helpTicketType">
                    <option value=""></option>
                    <option repeat.for="type of helpTickets.helpTicketTypesArray | helpTicketSubtypes"
                            value.bind="type.type">${type.description}</option>
                    
                </select>
              </th>
              <th></th>
              <th>
                <select change.delegate="dataTable.filterList($event)" class="form-control" id="owner.[0].personId" compare="obj" ref="ownerFilter">
                  <option value=""></option>
                  <option repeat.for="person of people.peopleArray | uccStaff"
                          value.bind="person._id">${person.fullName}</option>
                </select>
              </th>
           
              <th>
                <select value.bind="selectedStatus" change.delegate="dataTable.filterList($event)" class="form-control" id="helpTicketStatus">
                        <option value=""></option>
                        <option repeat.for="status of helpTicketTypes"
                                value.bind="status.code">${status.description}</option>
                      </select>
              </th>
              <th>
                <input change.delegate="dataTable.filterList($event)" id="createdDate" type="date" compare="after" placeholder="Filter Date" class="form-control datepicker" data-dateformat="yy/mm/dd">
              </th>
               <th>
                <input change.delegate="dataTable.filterList($event)" id="modifiedDate" type="date" compare="after" placeholder="Filter Date" class="form-control datepicker" data-dateformat="yy/mm/dd">
              </th>
              <th>
                <input input.delegate="dataTable.filterList($event, people.peopleArray)" id="personId-fullName" type="text" compare="lookup" class="form-control" ref="nameFilter"/>
              </th>
              <th>
                <input input.delegate="dataTable.filterList($event, people.peopleArray)" id="personId-nickName" type="text" compare="lookup" class="form-control" ref="nickNameFilter"/>
              </th>
              <th>
                <input input.delegate="dataTable.filterList($event, people.institutionsArray)" id="institutionId-name" type="text" compare="lookup" class="form-control" ref="institutionFilter"/>
              </th>
            </tr>
            <tr>
              <th>
                No <span click.trigger="dataTable.sortArray('helpTicketNo')"><i class="fa fa-sort"></i></span>
              </th>
              <th>
                Type <span click.trigger="dataTable.sortArray('helpTicketType')"><i class="fa fa-sort"></i></span><br>
              </th>
              <th></th>
              <th>
                Owner <span click.trigger="dataTable.sortArray('owner[0].personId', 'id', people.peopleArray, '_id', 'fullName')"><i class="fa fa-sort"></i></span></th>
            <!--    Owner <span click.trigger="dataTable.sortArray('owner[0].personId')"><i class="fa fa-sort"></i></span><br> -->
              </th>
             
              <th>
                Status <span click.trigger="dataTable.sortArray('status')"><i class="fa fa-sort"></i></span><br>
              </th>
              <th>
                Date Created <span click.trigger="dataTable.sortArray('createdDate')"><i class="fa fa-sort"></i></span>
              </th>
              <th>
                Date Updated <span click.trigger="dataTable.sortArray('modifiedDate')"><i class="fa fa-sort"></i></span>
              </th>
              <th>Faculty <span click.trigger="dataTable.sortArray('requestId.personId', 'id', people.peopleArray, '_id', 'fullName')"><i class="fa fa-sort"></i></span></th>
              <th>Nickname <span click.trigger="dataTable.sortArray('requestId.personId', 'id', people.peopleArray, '_id', 'nickName')"><i class="fa fa-sort"></i></span></th>
               <th>Institution</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Mobile</th>
            </tr>
          </thead>
          <tbody>
            <tr repeat.for="helpTicket of dataTable.displayArray">
              <td style="width:4rem;" data-title="referenceNo">${helpTicket.helpTicketNo}</td>
              <td style="width:11rem;" mouseover.delegate="showComment(helpTicket, $event)" mouseout.delegate="hideComment()" click.delegate="selectHelpTicket($event, $index)"
                data-title="type">${helpTicket.helpTicketType | helpTicketType:helpTickets.helpTicketTypesArray}
           
              <td style="width:5rem;" data-title="Update">
                    <span show.bind="helpTicket.owner[0].personId != userObj._id" click.trigger="ownHelpTicket(helpTicket)" bootstrap-tooltip data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Take Ownership"><i class="fa fa-child fa-lg" aria-hidden="true"></i></span>
              </td>
             
              <td style="width:12rem;" data-title="Owner" click.delegate="selectHelpTicket($event, $index)">${helpTicket.owner[0].personId | person:people.peopleArray:'fullName'}</td>
               <!--
              <td style="width:2rem;">
                <div class="dropdown">
                  <span  class="dropbtn" show.bind="helpTicket.helpTicketStatus !== config.CLOSED_HELPTICKET_STATUS && helpTicket.helpTicketStatus !== config.NEW_HELPTICKET_STATUS"><i class="fa fa-hand-spock-o fa-lg" aria-hidden="true"></i>
                  <div class="dropdown-content">
                    <a href="#" click.trigger="changeStatus(helpTicket, status.code)" repeat.for="status of config.HELP_TICKET_STATUSES | helpTicketStatuses:removeHTStatus">${status.description}</a>
                  </div>
                  </span>
              </td>
             
              <td style="width:2rem;" data-title="Update" click.trigger="changeToInProcess(helpTicket)">
                <span show.bind="helpTicket.helpTicketStatus == config.REVIEW_HELPTICKET_STATUS" bootstrap-tooltip data-toggle="tooltip" data-placement="bottom" title="" data-original-title="In Proces"><i class="fa fa-truck fa-lg" aria-hidden="true"></i></span>
              </td>
              -->
              <td style="width:7rem;" data-title="Status">
                <div class="dropdown">
                  <span  class="dropbtn" show.bind="helpTicket.helpTicketStatus !== config.CLOSED_HELPTICKET_STATUS && helpTicket.helpTicketStatus !== config.NEW_HELPTICKET_STATUS"> ${helpTicket.helpTicketStatus | lookupDescription:config.HELP_TICKET_STATUSES}
                  <div class="dropdown-content">
                    <a href="#" click.trigger="changeStatus(helpTicket, status.code)" repeat.for="status of config.HELP_TICKET_STATUSES | helpTicketStatuses:removeHTStatus">${status.description}</a>
                  </div>
                  </span>
               
                </td>
              <td style="width:9rem;" data-title="Created Date" click.delegate="selectHelpTicket($event, $index)">${helpTicket.createdDate | dateFormat:config.DATE_FORMAT_TABLE:true}</td>
              <td style="width:9rem;" data-title="Modified Date" click.delegate="selectHelpTicket($event, $index)">${helpTicket.modifiedDate | dateFormat:config.DATE_FORMAT_TABLE:true}</td>
              <td style="width:10rem;" data-title="Customer" click.delegate="selectHelpTicket($event, $index)">${helpTicket.personId | person:people.peopleArray:"fullName"}</td>
              <td style="width:10rem;" data-title="Nickname" click.delegate="selectHelpTicket($event, $index)">${helpTicket.personId | person:people.peopleArray:"nickName"}</td>
              <td style="width:10rem;" data-title="Insitution">${helpTicket.institutionId | lookupValue:people.institutionsArray:"_id":"name"}</td>
              <td style="width:10rem;" data-title="Email" click.delegate="selectHelpTicket($event, $index)">${helpTicket.personId | person:people.peopleArray:"email"}</td>
              <td style="width:10rem;" data-title="Phone" click.delegate="selectHelpTicket($event, $index)">${helpTicket.personId | person:people.peopleArray:"phone" | formatPhone}</td>
                <td style="width:10rem;" data-title="Phone" click.delegate="selectHelpTicket($event, $index)">${helpTicket.personId | person:people.peopleArray:"mobile" | formatPhone}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  </div>
</template>